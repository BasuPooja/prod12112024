{% extends 'adminDash.html' %} 
{% block content %}

{% load static %}


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="{% static '/js/bootstrap.min.js' %}"></script>
<script src="{% static '/js/jquery.min.js' %}"></script>
<script src="{% static '/js/popper.min.js' %}"></script>
<link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/bootstrap.min.css' %}">

<script src="{% static '/js/jquery-3.3.1.js' %}"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">


<link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.8/js/select2.min.js" defer></script>

<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript" src="{% static '/bootstrap-4.0.0/dist/js/bootstrap.min.js'%}"></script>
  <script type="text/javascript" src="{% static '/bootstrap-4.0.0/dist/js/bootstrap.bundle.min.js'%}"></script>
      
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<br>
<style>

        .inputtag{
              height:20px;
            }
            .button {
                 padding: 15px 25px;
                 font-size: 12px;
                 text-align: center;
                 margin-left: 2em;
                 cursor: pointer;
                 outline: none;
                 color: #fff;
                 background-color: #04AA6D;
                 border: none;
                 border-radius: 15px;
 
              }

              .button:hover {background-color: #3e8e41}

        .button:active {
          background-color: #3e8e41;
          box-shadow: 0 5px #666;
          transform: translateY(4px);
        }
        input[type=text],
        select {
                width: 100%;
                padding: 12px 20px;
                margin: 8px 0;
                display: block;
                color: rgb(38, 38, 38);
                border-radius: 4px;
                box-sizing: border-box;
        }

        input[type=submit] {
                width: 20%;
                text-align: center;
                background-color: #4CAF50;
                color: rgb(15, 12, 12);
                padding: 14px 20px;
                margin: 8px 0;
                border: none;
                border-radius: 4px;
                cursor: pointer;
        }

        input[type=submit]:hover {
                background-color: #45a049;
                text-align: center;
        }

        input[type=button] {
                width: 10%;
                text-align: center;
                background-color: #4CAF50;
                color: white;
                padding: 6px 6px;
                margin: 8px 0;
                border: none;
                border-radius: 4px;
                cursor: pointer;
        }

        input[type=button]:hover {
                background-color: #45a049;
                text-align: center;
        }
  #viewbtn {
    margin-left: 1200px;
    margin-right: 10px;
  }
  
/* Add Animation */
@-webkit-keyframes animatetop {
  from {top:-300px; opacity:0} 
  to {top:0; opacity:1}
}

@keyframes animatetop {
  from {top:-300px; opacity:0}
  to {top:0; opacity:1}
}

/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}


         
</style>

  <h3 align="center" ><b>Inspection Type Checklist </b></h3>
  <button type="button" id="back" name="back" value="Back" onclick="history.back()" class="btn btn-success btn-md "
                 style="float: right;margin-right: 2em;">Back</button>

<!-- </div> -->

<br>


<form action="/search_createchecklist/" method="post" >

  {% csrf_token %}
  <br>
  <br>
  
    <!-- <div class="row-md-6" style="padding-left: 70px;">

      <div  class="col-md-6" >
        <label for="checklist_title">Checklist Title <span style="color:red;font-weight:bold">*</span></label>
        <input type="text"  id="checklist_title" name="checklist_title" 
        class="form-control" placeholder="Enter title" value="{{ inspection_Checklist.checklist_title }}">  
      </div>
<br>
    <div class="col-md-6">
        <label for="inspection_type" >Inspection Type<span style="color:red;font-weight:bold">*</span></b></label>
        <select class="form-control" id="inspection_type" name="inspection_type" style=" height:40px;"
            required>
            <option value="All" selected>All</option>
                {% for d in INSPECTION_TYPE %}
                <option value="{{d.1}}"  selected="selected"
                 >{{d.1}}</option>
                {% endfor %}
              
        </select>
    </div>
    <br>
    <div class="col-md-6">
      <label for="Version">Version<span style="color:red;font-weight:bold">*</span></label>
      <input type="text"  id="Version" name="Version" 
        class="form-control" placeholder="Enter title" value="{{ inspection_Checklist.version }}" >
      
    </div>
        <input type="text" id="checklist_id" value="{{checklist_no}}" name='checklist_id' hidden>
        
 
        
           <br>          
        <div>               
  
      
      </div> 
  </div>  -->

  <div class="row" style="margin-left: 5em; margin-right: 5em;">

    <div class="col form-group" >
      <label for="checklist_title">Checklist Title <span style="color:red;font-weight:bold">*</span></label>
      <input type="text"  id="checklist_title" name="checklist_title" 
      class="form-control" placeholder="Enter title" value="{{ inspection_Check.checklist_title }}" >
    </div>

      
 
        <div class="col form-group" >
          <label for="checklist_title">Checklist Version <span style="color:red;font-weight:bold">*</span></label>
          <input type="text"  id="checklist_version" name="checklist_version" 
          class="form-control" placeholder="Enter Version.." onblur="Version(this);" 
          value="{{ inspection_Check.version }}" onkeypress="return isNumber(event);" readonly >
        
        </div>

        <div class="col-sm-3 form-group" style="margin-left:5em ;">
          <label for="inspection_type" >Category Type<span style="color:red;font-weight:bold">*</span></b></label>
          <select class="form-control" id="inspection_type" name="inspection_type" style=" height:40px;"
              required>
              <option value="All" selected>All</option>
                  {% for d in INSPECTION_TYPE %}
                  
                  <option value="{{d.1}}" {% ifequal d.1 inspection_Check.inspection_type %} selected="selected"
                   {% endifequal %}>{{d.1}}</option>
                  {% endfor %}
                
          </select>
      </div>

        <div class="col form-group">
          <label for="dept_type" >Department Wise</label>
    
          <select class="form-control" id="dept_type" name="dept_type" >
              <option value="" disabled hidden>select</option>
            {% for d in dept %}
            {% if d.department_code in inspection_Checklist %}
            <option value="{{d.department_code}}" selected>{{d.department_name}}</option>                
            {% else %}
            <option value="{{d.department_code}}" >{{d.department_name}}</option>     
            {% endif %}
            {% endfor %}
              
    
          </select>
          
        </div>

        <input id="checklist_id" value="{{checklist_no}}" name='checklist_id' hidden>

</div> 

    <br><br>

          <div class="col-md-12"> 
          <table id="table1" class="table table-striped table-bordered center" style="width:90%; margin-left: 4em;">

            <thead >
              <b style="margin-left: 4em;">Add Activity </b><br><br>

                <tr>
                 <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 10%;">S.No.</th>
                 <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 100%;">Point To Be Checked</th>
                 
                
               </tr>
          
            </thead>
            {%if ass != ' None' %}
            <tbody  id="addworkmech">
            {% for i in ass %}
            
          <tr>
            <td aria-readonly="true" readonly style="text-align: center; width: 10px; font-family:verdana;">{{forloop.counter}}</td>
             <!-- <td ><textarea readonly aria-readonly="true" style="width:100%; height:100%; font-family:verdana; ">{{ j }}</textarea></td> -->
             <td> 
               
               <div class="autocomplete">
                
                
                 <textarea class="form-control" maxlength="250" id="activities{{forloop.counter}}"  name="activities_name" value="{{ i.activities }}" style="font-family:verdana;width:900px;" >{{ i.activities }}</textarea>
                 <!-- <input aria-readonly="true" readonly style="font-family:verdana;white-space:nowrap;;" type="text" id="work1{{forloop.counter}}"  name = "work1{{forloop.counter}}" class = "form-control" autocomplete = "off" style="width:900px;"  value="{{ j.activity }}" > -->
                
               </div>    
             </td>
           </tr>
          {%endfor%}
          {% endif %}
        </tbody>
            
      </table>
      </div>

      
         
      <div>
      <a style="margin-left: 5em;" name="addmech" id="addmech" class="btn btn-primary btn-md">Add</a>
      <a  class="btn btn-primary btn-md" id="deletemech" >Delete</a> 
     
    </div>

    <input type="hidden" value="{{asscount}}" id="count_row" name="coun" >


    <button type="button"  class="btn btn-success btn-md " id="draft" name="draft" value="Save as draft" onclick="mydraft_update()" style=" margin-left: 710px;">Save as Draft</button>
    <button type="button"   id="submit" name="submit" value="Submit" onclick="myfinalized_update()" class="btn btn-success btn-md " >Submit</button>
    

    <br>
    <br>
</form>
<br>
<br>
<script>
  
    function myfinalized_update(){
        let mydata=[]
        let count = $('#count_row').val()
        //alert(count);
        for(let x=1; x< parseInt(count)+1; x++){
    
          let dict = {}
          let activities = 'activities'+String(x)
          //alert(activities);
          let obdata = $('#'+activities).val()
          dict['activ'] = obdata
          mydata.push(dict)

          if(obdata =='' || obdata == null){
            alert("Please fill activities ")
            return false; }
    
        }
    
        if ($("#checklist_title").val()==''){  
          alert("Please fill Checklist Title ")
          return false; }
          
        
        if ($("#inspection_type").val()==''){ 
          alert("Please fill Inspection Type ")
          return false; }

        console.log(mydata)
        //alert('hrrrrrrrrr');
        let data1 = {
          activit1: JSON.stringify(mydata),
          dept_type:$("#dept_type").val(),

          checklist_title:$("#checklist_title").val(),
          inspection_type:$("#inspection_type").val(),
          checklist_id: $("#checklist_id").val(),
          btnValues:$('#submit').val(),
          csrfmiddlewaretoken: '{{ csrf_token }}'
        };
    
        $.ajax({
          url: '{% url "admin_checklist_final_update" %}',
          dataType: 'json',
          type: 'POST',
          data: data1,
    
                //data: {obs_data, obs_good, obs_notes, obs_award},
          success: function(res){
            alert("Record Saved as Finalized!");
            window.location.reload();
          console.log(res)
          window.location.assign("/search_list_created_checklist/")
            //console.log(res)
          }
        })
    }
     

    function mydraft_update(){
        let mydata=[]
            let count = $('#count_row').val()
            //alert(count);
            for(let x=1; x< parseInt(count)+1; x++){
        
            let dict = {}
            let activities = 'activities'+String(x)
            //alert(activities);
            let obdata = $('#'+activities).val()
            dict['activ'] = obdata
            mydata.push(dict)
        
            if(obdata =='' || obdata == null){
              alert("Please fill activities ")
              return false;
            }

            }
            if ($("#checklist_title").val()==''){  
              alert("Please fill Checklist Title ")
              return false;
            }
              
            
            if ($("#inspection_type").val()==''){ 
              alert("Please fill Inspection Type ")
              return false;
            }

            console.log(mydata)
            //alert('hrrrrrrrrr');
            let data1 = {
            activit1: JSON.stringify(mydata),
            dept_type:$("#dept_type").val(),

            checklist_title:$("#checklist_title").val(),
            inspection_type:$("#inspection_type").val(),
            checklist_id: $("#checklist_id").val(),
            btnValues:$('#draft').val(),
            csrfmiddlewaretoken: '{{ csrf_token }}'
            };

        $.ajax({
        url: '{% url "admin_checklist_update" %}',
        dataType: 'json',
        type: 'POST',
        data: data1,

                //data: {obs_data, obs_good, obs_notes, obs_award},
        success: function(res){
            alert("Record Saved as Draft.");
            window.location.reload();
        console.log(res)
        window.location.assign("/search_list_created_checklist/")

            //console.log(res)
        }
        })
    }

  
</script>
     
     
<script>
        function backredirect(){
          document.location.href ="{% url 'created_checklist' %}"
        }

        
</script> 

<script>
            $(document).ready(function(){
                             
                             $("#addmech").click(function (e) {
                              
                               var table = document.getElementById("addworkmech");
                               e.preventDefault();
                               var row = table.insertRow();
            
                             
                                var rowCount = $('#addworkmech tr').length;
                                j1=rowCount;
            
                              //  j1 = j1 + 1;
                               var activities = 'activities' + String(j1);
                              
                               $('#count_row').val(rowCount)
                               var cell1 = row.insertCell(0);
                               var cell2 = row.insertCell(1);
                              //  var cell3 = row.insertCell(2);
                               //var cell4 = row.insertCell(2);
            
                              cell1.innerHTML =
                              '<td style="width:5px;""><div style="text-align: center; width:5px font-family:verdana;">'+(j1)+'</div></td>';
                           
                            cell2.innerHTML =
                              '<td><div class="autocomplete1"><textarea maxlength="350" id=' + activities + ' name="activities"   autocomplete1 = "off"  class="form-control" required /></textarea></div></td>'; 
                         
                             });
             
                             
                         });
            
            
                         $('#deletemech').click(function (e) {
                                 e.preventDefault();
                                      var rowCount = $('#addworkmech tr').length;
              
                                      j1=rowCount;                    
                                 if (j1 > 0) {
             
                                  document.getElementById("addworkmech").deleteRow(-1);
                                  j1--;
                               
                                 }
             
                               }); 
            
             
</script>

      {% comment %} <script>
        $(document).ready(function() {
          $('#inspection_type').select2();
        });
      </script> {% endcomment %}

      <script>
        function isNumber(e){
          e = e || window.event;
          var charCode = e.which ? e.which : e.keyCode;
          return /\d/.test(String.fromCharCode(charCode));
      }
      </script>
      
{% endblock %}  