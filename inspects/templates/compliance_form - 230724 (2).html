{% extends 'base.html' %}
{% block content %}
{% load static %}



<head>
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/wrap_css.css' %}">   -->
    <script type="text/javascript">
        $(".sidebar").addClass('close');
    </script>
    <style>
        .center {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 50%;
}
        .wrap.active {
            display: block;
            visibility: visible;
            box-shadow: 2px 3px 16px silver;
            transition: all 600ms;
            transform: translateY(0px);
            transition: all 0.5s;
        }

        .wrap {
            position: fixed;
            overflow: hidden;
            top: 10%;
            right: 10%;
            bottom: 85px;
            left: 10%;
            padding: 12px;
            display: block !important;
            border-radius: 4px;
            transform: translateY(20px);
            transition: all 0.5s;
            visibility: hidden;
            z-index: 9999;
            height: 85vh;
        }

        .wrap-1.active {
            display: block;
            visibility: visible;
            box-shadow: 2px 3px 16px silver;
            transition: all 600ms;
            transform: translateY(0px);
            transition: all 0.5s;
        }

        .wrap-1 {
            position: fixed;
            overflow: hidden;
            top: 10%;
            right: 10%;
            bottom: 85px;
            left: 10%;
            padding: 12px;
            display: block !important;
            border-radius: 4px;
            transform: translateY(20px);
            transition: all 0.5s;
            visibility: hidden;
            z-index: 9999;
            height: 85vh;
        }

        .wrap.active .content,
        .wrap-1.active .content {
            position: relative;
            z-index: 1;
            opacity: 1;
            transition: all 600ms cubic-bezier(0.55, 0.055, 0.675, 0.19);
        }

        .wrap .content,
        .wrap-1 .content {
            opacity: 0;
        }

        .wrap.active:before,
        .wrap-1.active:before {
            height: 2000px;
            width: 2000px;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            margin-left: -1000px;
            margin-top: -1000px;
            display: block;
            -webkit-transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
            transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
        }

        .wrap:before,
        .wrap-1:before {
            position: fixed;
            width: 1px;
            height: 1px;
            background: white;
            content: "";
            bottom: 10px;
            left: 50%;
            top: 95%;
            color: #fff;
            border-radius: 50%;
            -webkit-transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
            transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
        }

        .wrap::-webkit-scrollbar,
        .wrap-1::-webkit-scrollbar {
            width: 10px;
            /* Remove scrollbar space */
            background: #dedede;
        }

        /* Optional: show position indicator in red */
        .wrap::-webkit-scrollbar-thumb,
        .wrap-1::-webkit-scrollbar-thumb {
            background: #FF0000;
        }
    </style>


    <style>
        .loader {
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid blue;
            border-right: 16px solid green;
            border-bottom: 16px solid red;
            border-left: 16px solid pink;
            width: 120px;
            height: 120px;
            -webkit-animation: spin 2s linear infinite;
            animation: spin 2s linear infinite;
        }


        .btnactor {

            font-size: 28px;
            width: 150px;
            height: 35px;

            color: #fff;
            outline: none;
            border: 1px solid transparent;
            transition: 0.5s;
        }

        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div id="notSpinner">
        <h3 class="report_heading">Pending Reply</h3>
        <br>
        
        <div id="maindiv">
            <div class="container">
                <div class="inpt-container" id="container1" style="padding-bottom: 10px;">
                    <div class="row" style="text-align: left; margin-left: 2em;">
                        <div class="col">
                            <label for="Zone" class="lbl-caption">Rly./Org. Wise</label>
                            <select class="form-control" name="rly_id" id="rly_id" class="custom-select"
                                data-placeholder="Select zone.." style="max-width:100%;height:2em;">
                                <option value="" selected>All</option>
                                {% for z in zone %}
                                <option value="{{z}}">{{z}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col">
                            <label for="division" class="lbl-caption">Div./Unit Wise</label>
                            <select class="form-control" name="div_id" id="div_id" class="custom-select"
                                data-placeholder="Select division.." style="max-width:100%;;height:2em">
                                <option value="" selected>All</option>
                                {% for d in division %}
                                <option value="{{d.location_code}}">{{d.location_code}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col">
                            <label for="Ofc" class="lbl-caption">Insp. Officer Wise</label>
                            <select class="form-control" name="ofc_id" id="ofc_id" class="custom-select"
                                data-placeholder="Select officer.." style="max-width:100%;height:2em;">
                                <option value="" selected>All</option>
                                {% for z in officr %}
                                <option value="{{z}}">{{z}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col">
                            <label style="width:10em" class="lbl-caption">Date Range Wise</label>
                            <label id="reportrange"
                                style="width:15em;background: #fff; cursor: pointer;border: 1px solid #ccc;height:2em">
                                <i class="fa fa-calendar" style="margin-left:10px"></i>
                                <span id="dateid"></span>
                                <i class="fa fa-caret-down"></i>
                            </label>
                        </div>
                        <div class="col">
                            <div class="btn-toolbar" role="toolbar" style="margin-top:30px;">
                                <div class="btn-group mr-2" role="group">
                                    <button type="button" id="submit_filter" class="btn btn-warning btn-sm"
                                        onclick="compliance_filterdata(this);">Continue</button>
                                    <button type="button" class="btn btn-secondary btn-sm"
                                        onclick="compliance_alterdata();">Reset</button>
                                        <a type="button" class="btn btn-danger btn-sm"  target="_blank" href="{% url 'compliance_form_pdf' %}" hidden > PDF</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container" style="overflow-x: auto;">
                <table id="tableshow" class="table table-striped table-bordered table-data" cellspacing="0">
                    <thead style="background-color:black; color:white">
                        <tr style="text-align:left">
                            <th>S.No.</th>
                            <th style="display:none;"></th>
                            <th>Insp. Date</th>
                            <th>Insp. Note No</th>
                            <th>Insp. Title</th>
                            <th>Insp. Officer</th>
                            <th>Rly./Org.</th>
                            <th>Div. /Unit</th>
                            <th>Pending</th>
                            <th>Forwarded</th>
                            <th>Complied</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in listgrid %}
                        <tr style="text-align:left">
                            <td style="width:5%">{{forloop.counter}}</td>
                            <td style="display:none;">{{i.inspected_on_filter| date:'Y-m-d'}}</td>
                            <td style="width:10%">{{i.inspected_on}}</td>
                            <td style="width:10%"><a href="{% url 'inspectionReportHtml' i.inspection_no %}"
                                    id=/{{i.inspection_no}} target="blank"
                                    onclick="viewdate(this)">{{i.inspection_note_no}}</a> <br/> {{i.final_submit_on}}</td>
                            <td style="width:45%;"><a class="js-btn-tooltip" data-toggle="tooltip" data-placement="top"
                                    title='{{i.inspection_title}}'>{{i.inspection_title|truncatechars:100}}</a></td>
                            <td style="width:15%">{{i.inspection_officer}}</td>
                            <td style="width:5%">
                                {% for z in i.zone %}
                                {% if forloop.counter < 4 %}
                                    <p>{{z}}</p>
                                {% elif forloop.counter == 4 %}
                                    <span id="spandiv{{z}}{{forloop.counter}}" onclick="spanShowMore(this.id)"><p style="color: blue;cursor: pointer;">Show More</p></span>
                                    <span id="Sspandiv{{z}}{{forloop.counter}}" onclick="spanShowLess(this.id)" style="display: none;cursor: pointer;">
                                {% elif forloop.counter > 3 %}
                                     <p>{{z}}</p>
                                {% endif %}
                                {% endfor %}
                                {% for z in i.zone %}
                                {% if forloop.counter == 4 %}
                                    <p style="color: blue;">Show Less</p></span>
                                {% endif %}
                                {% endfor %}
                            </td>
                            <td style="width:5%">
                                {% for z in i.div %}
                                {% if forloop.counter < 4 %}
                                    <p>{{z}}</p>
                                {% elif forloop.counter == 4 %}
                                    <span id="spandivextra{{z}}{{forloop.counter}}" onclick="spanShowMore1(this.id)"><p style="color: blue;cursor: pointer;">Show More</p></span>
                                    <span id="Sspandivextra{{z}}{{forloop.counter}}" onclick="spanShowLess1(this.id)" style="display: none;cursor: pointer;">
                                {% elif forloop.counter > 3 %}
                                     <p>{{z}}</p>
                                {% endif %}
                                {% endfor %}
                                {% for z in i.zone %}
                                {% if forloop.counter == 4 %}
                                    <p style="color: blue;">Show Less</p></span>
                                {% endif %}
                                {% endfor %}
                            </td>

                            <td style="width:5%">
                                <button type="button" class="btn btn-outline-danger btn-sm mb-1"
                                    title="Items Forwarded/Items Pending" id={{i.inspection_no}}
                                    onclick="reply(this,'1')"
                                    style="width: 85px;">{{i.no_for_mark}}/{{i.total_items_pending}}</button>
                            </td>
                            <td style="width:5%">
                                {% if i.for_flag == 1 %}
                                <button type="button" class="btn btn-outline-warning btn-sm" data-toggle="modal"
                                    title="No. of officers Replied/No. of officers marked" id={{i.inspection_no}}
                                    onclick="forwarded_already_modal(this,'1')"
                                    style="width: 85px;">{{i.marked_forwards_reply}}/{{i.total_for_mark}}</button>

                                {% else %}
                                <button type="button" class="btn btn-outline-secondary btn-sm mb-1" disabled
                                    style="width: 85px;">To Forward</button>
                                {% endif %}
                            </td>
                            <td style="width:5%">
                                <button type="button" class="btn btn-outline-success btn-sm mb-1"
                                    title="Items Complied/Items Marked" id={{i.inspection_no}}
                                    onclick="replied(this,'1')"
                                    style="width: 85px;">{{i.total_items_complied}}/{{i.total_items_marked}}</button>
                            </td>


                        </tr>
                        {% endfor %}
                        {% for i in phase2_pending %}
                        <tr style="text-align:left">
                            <td style="width:5%">{{i.sr_no}}</td>
                            <td style="display:none;">{{i.eitemid__einspno__inspected_on| date:'Y-m-d'}}</td>
                            <td style="width:10%">{{i.eitemid__einspno__inspected_on | date:'d/m/y'}}</td>
                            <td style="width:10%"><a href="{% url 'pdfDetails' %}?id={{i.eitemid__einspno}}"
                                    id=/{{i.eitemid__einspno}}
                                    target="blank">{{i.eitemid__einspno__inspection_note_no}}</a></br>{{i.eitemid__einspno__lastmodified_on | date:'d/m/y'}}</td>
                            <td style="width:45%;"><a class="js-btn-tooltip" data-toggle="tooltip" data-placement="top"
                                    title='{{i.eitemid__einspno__inspection_title}}'>{{i.eitemid__einspno__inspection_title|truncatechars:100}}</a>
                            </td>
                            <td style="width:15%">{{i.eitemid__einspno__designation__designation}}</td>
                            <td>
                            {% for j in i.einsprly %}
                                    <span >{{j.location_code}}<br></span>
                                {% endfor %}
                                </td>
                            <td> {% for j in i.einspdiv %}
                            <span >{{j.location_code}}<br></span>
                            {% endfor %}
                            </td>

                            <td style="width:5%">
                                <button type="button" class="btn btn-outline-danger btn-sm mb-1"
                                    title="Items Forwarded/Items Pending" id={{i.eitemid__einspno}}
                                    onclick="reply(this,'2')"
                                    style="width: 85px;">{{i.total_forward}}/{{i.total_pending}}</button>
                            </td>
                            <td style="width:5%">
                                {% if i.for_flag == 1 %}
                                <button type="button" class="btn btn-outline-warning btn-sm"
                                    title="No. of officers Replied/No. of officers marked" id={{i.eitemid__einspno}}
                                    onclick="forwarded_already_modal(this,'2')"
                                    style="width: 85px;">{{i.marked_forwards_reply}}/{{i.total_for_mark}}</button>
                                {% else %}
                                <button type="button" class="btn btn-outline-secondary btn-sm mb-1" disabled
                                    style="width: 85px;">To Forward</button>
                                {% endif %}
                            </td>
                            <td style="width:5%">
                                <button type="button" class="btn btn-outline-success btn-sm mb-1"
                                    title="Items Complied/Items Marked" id={{i.eitemid__einspno}}
                                    onclick="replied(this,'2')"
                                    style="width: 85px;">{{i.total_complied}}/{{i.total_marked}}</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div id="replydivphase1" class="container">
            <div>
                <button onclick="reloadFunction()" class="btn btn-secondary"
                    style="width:60px;margin-left: 15px;">Back</button>
            </div>
            <div class="modal-body">
                <div class="inpt-container p-2">

                    <div class="acc-head" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true"
                        aria-controls="collapseOne">
                        <div class="row">
                            <div class="col-5">
                                <h5>Inspection Details</h5>
                            </div>
                            <div class="col-6">
                                <h5  style="text-align: right;padding-right:5px;"><label id="collapseOneIdNoteNo"></label></h5>
                            </div>
                            <div class="col-1" style="text-align: right;">
                                <button class="btn btn-sm btn-outline-dark ">
                                    <i class="fas fa-angle-double-up fa-lg"></i>&nbsp;&nbsp;
                                    <i class="fas fa-angle-double-down fa-lg"></i>
                                </button>

                            </div>
                        </div>


                    </div>

                    <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <label class="lbl-caption">Inspection Note No</label>
                                    <input type="text" value="" id="ins_note_id" readonly
                                        class="form-control lbl-caption" readonly />
                                </div>
                                &nbsp;&nbsp;
                                <div class="col">
                                    <label class="lbl-caption">Inspecting Officer Designation</label>
                                    <input type="text" value="" id="ins_desig" readonly class="form-control lbl-caption"
                                        readonly />
                                </div>
                                &nbsp;&nbsp;
                                <div class="col">
                                    <label class="lbl-caption">Inspecting Officer Name</label>
                                    <input type="text" value="" id="ins_officer" class="form-control lbl-caption"
                                        readonly />
                                </div>
                                &nbsp;&nbsp;
                                <div class="col">
                                    <label class="lbl-caption">Inspection Date</label>
                                    <input type="text" value="" id="ins_date" class="form-control lbl-caption"
                                        readonly />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label class="lbl-caption">Inspection Title</label>
                                        <textarea type="text" class="form-control lbl-caption word-wrap h-100"
                                            style="max-width: 100%; " id="ins_title" readonly></textarea>
                                    </div>
                                </div>
                                &nbsp;&nbsp;
                                <input type="text" value="" id="ins_id" readonly class="form-control lbl-caption"
                                    hidden />
                            </div>
                        </div>
                    </div>

                </div>

                <div id="divphase1">
                    <div id="listdivphase1">
                        <div style="height:50px;width: 100%;text-align: center;">
                            <!-- <h3 class="report_heading" id="ReplyModalLabel">List of Pending Replies</h3> -->
                        </div>
                        <br>  
                        <button type="buttton" onclick="searchFunctionDtComp()" id="searchBtnDtComp" class="btn" style="background-color: lightblue;color:white" >For Action</button>
                        <button type="buttton" onclick="searchFunctionDtInfo()" id="searchBtnDtInfo" class="btn" style="background-color: lightblue;color:white">For Info</button>
                        <button type="buttton" onclick="searchFunctionDtAll()"  id="searchBtnDtAll" class="btn" style="background-color: lightblue;color:white" >All</button>
                        <br>
                        <br>
                        <table id="mytable1" class="table table-striped table-bordered table-data" width="100%">
                            <thead>
                                <tr>
                                    <th>Item No</th>
                                    <th>Observation</th>
                                    <th>Compliance Status</th>
                                    <th>Compliance</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div class="modal-footer modal-footer-full-width ">

                            <div class="row pl-2" style="text-align:left">

                                <div class="col">
                                    <label class="lbl-caption"><b>Save: </b>Draft the particular reply.</label>
                                </div>
                                <div class="col">
                                    <label class="lbl-caption"><b>Edit: </b>Edit the particular reply.</label>
                                </div>
                                <div class="col">
                                    <label class="lbl-caption"><b>Revert: </b>Revert the particular reply.</label>
                                </div>
                                <div class="col">
                                    <label class="lbl-caption"><b>Forward: </b>To forward item(s) to a group of
                                        officers.</label>
                                </div>
                                <div class="col">
                                    <label class="lbl-caption"><b> Multiple: </b>To take actions on multiple items all
                                        at once.</label>
                                </div>
                                <div class="col">
                                    <label class="lbl-caption"><b>Submit: </b>Final Submit the reply to inspecting
                                        officer,after saving the data.</label>
                                </div>
                            </div>
                            <div class="col">
                                <div class="btn-group" role="group" id="all_buttons" hidden>
                                    <!-- <button type="button" class="btn btn-outline-danger btn-block"  id="revert_btn"  onclick="all_funcs(this)">REVERT</button>&nbsp; -->
                                    <button type="button" class="btn btn-secondary btn-sm  btn-block "
                                        style="margin-top: 8px;" id="forward_btn"
                                        onclick="all_funcs(this)">FORWARD</button>&nbsp;
                                    <button type="button" class="btn btn-info btn-block  btn-sm" id="noted_btn"
                                        onclick="all_funcs(this)">NOTED</button>&nbsp;
                                    <button type="button" class="btn btn-primary btn-block  btn-sm" id="save_btn"
                                        onclick="all_funcs(this)">SAVE</button>&nbsp;
                                </div>
                                <div class="btn-toolbar" role="toolbar" style="margin-top:30px;">
                                    <div class="btn-group" role="group" style="margin-right: 80%;">
                                        <button type="button" id="submit" class="btn btn-success btn-sm"
                                            class="js-btn-tooltip" data-toggle="tooltip" data-placement="top"
                                            title="Submit all the saved replies." onclick="save_data()" {% if request.session.userrole == 'guest' %} hidden {% endif %}>Submit</button>

                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="forwarddivphase1">
                        <div class="modal-body">
                            <div style="width:100%;">
                                <button onclick="reloadGoBack()" class="btn btn-secondary"
                                    style="width:60px; margin-left: 95%;">Back</button>
                            </div>
                            <br />

                            <div class="inpt-container p-2" id="container1" style="margin-bottom:5%;">
                                <label class=" lbl-caption">Rly./Org. Wise</label>
                                <select class="form-control  lbl-caption" name="rly_id" id="rly_id1"
                                    data-placeholder="Select zone.." style=" width:15%;height:3em">
                                    <option value="" selected disabled>All</option>
                                    {% for z in zone %}
                                    <option value="{{z}}" {% if rly_code == z %} selected {%endif%}>{{z}}</option>
                                    {% endfor %}
                                </select> &nbsp;

                                <label for="division" class="lbl-caption">Div./Unit Wise</label>
                                <select class="form-control custom-select lbl-caption" name="div_id" id="div_id1"
                                    class="custom-select" data-placeholder="Select division.."
                                    style="width:10%;height:3em">
                                    <option value="all">Select Division..</option>
                                    {% for d in division %}
                                    <option value="{{d.location_code}}" {% if div_code == d.location_code %} selected
                                        {%endif%}>{{d.location_code}}</option>
                                    {% endfor %}
                                </select> &nbsp;

                                <label class="lbl-caption">Forward To</label>

                                <select id="desig_for" name="desig_for" class="form-control custom-select lbl-caption"
                                    style="width:20%;height:2em" class="custom-select"
                                    data-placeholder="Select Designation.." multiple>
                                    <option value="" disabled>Select</option>
                                    {% for z in designation %}
                                    <option value="{{z.designation}}">{{z.designation}}</option>
                                    {% endfor %}
                                </select> &nbsp;
                                <label class="lbl-caption"> Forward To Panel</label>
                                <button type="button" class="btn btn-outline-secondary btn-sm " data-toggle="modal"
                                    data-target="#PanelModal" onclick="showPanel()"><i class="fa fa-address-book"
                                        aria-hidden="true"></i></button>

                                &nbsp;&nbsp;

                                <label class="lbl-caption">Item No</label>
                                <input type="textarea"
                                    style="width:5%;text-align: center;background-color:aliceblue;height: 2.2em; width: 15%;"
                                    id="item" value="" disabled></input>
                                <input class=" form-control lbl-caption" id="inspection_no" value="{{inspection_no}}"
                                    hidden></input>
                                <input type="textarea" class="lbl-caption" id="item_no" value="{{item_no}}"
                                    hidden></input>
                                &nbsp;&nbsp;&nbsp;
                                <button type="button" id="submit_filter"
                                    style="width:5%;border: 1px solid #ccc;margin-left: 0px;margin-bottom: 0px;"
                                    title="Click to forward item to the selected officers"
                                    class="btn btn-success btn-sm float-right" onclick="compliance_forward(this);" {% if request.session.userrole == 'guest' %} hidden {% endif %}>Submit</button>
                            </div>



                            <div>
                                <h3 class="report_heading" id="ForwardModalLabel">Previously forwarded details</h3>
                                <table id="mytable2" class="table table-striped table-bordered table-data ">
                                    <thead>
                                        <tr>
                                            <th>Sr. No.</th>
                                            <th>Forwarded On</th>
                                            <th>Forward Offiecr</th>

                                            <th>Reply Received</th>
                                            <th>Recieved On</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>


                                <button style="margin:2%" type="button" id="moveAll" class="btn btn-success"
                                    style="height:7%;" onclick="move_all()" disabled>Move All</button>

                                <div for="edit" style="text-align:left;">Edit Section</div>
                                <div class="row">
                                    <div class="col-11">
                                        <textarea class="form-control lbl-caption word-wrap" rows="2"
                                            id="textAreaExample1" onkeyup="expandarea(this)"
                                            style="background-color: aliceblue;" disabled></textarea>
                                    </div>
                                    <div class="col-1">
                                        <button style="margin:2%" type="button" class="btn btn-warning savebtn"
                                            data-dismiss="modal" id="save_btn_frwd" style="height:7%;"
                                            onclick="save_replied()">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="revertdivphase1">
                        <div class="modal-body">
                            <div style="width:100%;">
                                <button onclick="reloadGoBack()" class="btn btn-secondary"
                                    style="width:60px; margin-left: 95%;">Back</button>
                            </div>
                            <br>
                            <table id="mytable3" class="table table-striped table-bordered table-data " width="100%">
                                <thead>
                                    <tr>
                                        <th>Item No</th>
                                        <th>Observation</th>
                                        <th>Remarks</th>
                                        <th>Revert</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>

                    </div>

                    <div id="forwardeddivphase1">

                        <div class="modal-body" style="text-align: left;">
                            <!-- <div style="width:100%;">
                            <button onclick="reloadGoBack()" class="btn btn-secondary" style="width:60px; margin-left: 95%;">Back</button>
                        </div>
                        <br> -->
                            <h3 class="report_heading" id="ForwardModalLabel">Previously forwarded details</h3>
                            <table id="mytable1accept_for" class="table table-striped table-bordered table-data"
                                width="100%">
                                <thead></thead>
                                <tbody></tbody>
                            </table>

                        </div>
                    </div>
                    <div id="compileddivphase1">
                        <h3 class="report_heading" id="ReplyModalAcceptLabel">List of Accepted Replies</h3>
                        <table id="mytable1accept" class="table table-striped table-bordered table-data" width="100%">
                            <thead>
                                <tr>
                                    <th>Item No</th>
                                    <th>Observation</th>
                                    <th>Compliance Status</th>
                                    <th>Compliance</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>

                </div>

                <div id="divphase2">
                    <div id="listdivphase2">
                        <div style="height:50px;width: 100%;text-align: center;">
                            <h3 class="report_heading" id="ReplyModalLabel">List of Pending Replies</h3>
                        </div>
                        <table id="mytable12" class="table table-striped table-bordered table-data" width="100%">
                            <thead>
                                <tr>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="modal-footer modal-footer-full-width ">
                            <div class="row pl-2" style="text-align:left">
                                <div class="col">
                                    <label class="lbl-caption"><b>Save: </b>Draft the particular reply.</label>
                                </div>
                                <div class="col">
                                    <label class="lbl-caption"><b>Edit: </b>Edit the particular reply.</label>
                                </div>
                                <div class="col">
                                    <label class="lbl-caption"><b>Revert: </b>Revert the particular reply.</label>
                                </div>
                                <div class="col">
                                    <label class="lbl-caption"><b>Forward: </b>To forward item(s) to a group of
                                        officers.</label>
                                </div>
                                <div class="col">
                                    <label class="lbl-caption"><b> Multiple: </b>To take actions on multiple items all
                                        at once.</label>
                                </div>
                                <div class="col">
                                    <label class="lbl-caption"><b>Submit: </b>Final Submit the reply to inspecting
                                        officer,after saving the data.</label>
                                </div>
                            </div>
                            <div class="col">
                                <div class="btn-group" role="group" id="all_buttons2" hidden>
                                    <button type="button" class="btn btn-secondary btn-sm  btn-block "
                                        style="margin-top: 8px;" id="forward_btn2"
                                        onclick="all_funcs2(this)">FORWARD</button>&nbsp;
                                    <button type="button" class="btn btn-info btn-block  btn-sm" id="noted_btn2"
                                        onclick="all_funcs2(this)">NOTED</button>&nbsp;
                                    <button type="button" class="btn btn-primary btn-block  btn-sm" id="save_btn2"
                                        onclick="all_funcs2(this)">SAVE</button>&nbsp;
                                </div>
                                <div class="btn-toolbar" role="toolbar" style="margin-top:30px;">
                                    <div class="btn-group" role="group" style="margin-right: 80%;">
                                        <button type="button" id="submit" class="btn btn-success btn-sm"
                                            class="js-btn-tooltip" data-toggle="tooltip" data-placement="top"
                                            title="Submit all the saved replies." onclick="save_data2()" {% if request.session.userrole == 'guest' %} hidden {% endif %}>Submit</button>

                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="forwarddivphase2">
                        <div class="modal-body">
                            <div style="width:100%;">
                                <button onclick="reloadGoBack()" class="btn btn-secondary"
                                    style="width:60px; margin-left: 95%;">Back</button>
                            </div>
                            <br />
                            <div class="inpt-container p-2">
                                <div class="row">
                                    <div class="col">
                                        <label class=" lbl-caption">Rly./Org. Wise</label>
                                        <select class="form-control  lbl-caption" name="rly_id22" id="rly_id122"
                                            data-placeholder="Select zone..">
                                            <option value="" selected disabled>All</option>
                                            {% for z in zone %}
                                            <!-- <option value="{{z}}">{{z}}AA</option> -->
                                            <option value="{{z}}" {% if rly_code == z %} selected {%endif%}>{{z}}</option>
                                            {% endfor %}
                                        </select> &nbsp;
                                    </div>

                                    <div class="col">
                                        <label for="division" class="lbl-caption">Div./Unit Wise</label>
                                        <select class="form-control custom-select lbl-caption" name="div_id22"
                                            id="div_id122" class="custom-select" data-placeholder="Select division..">
                                            <option value="all">Select Division..</option>
                                            {% for d in division %}
                                            <option value="{{d.location_code}}" {% if div_code == d.location_code %}
                                                selected {%endif%}>{{d.location_code}}</option>
                                            {% endfor %}
                                        </select> 
                                        &nbsp;
                                    </div>

                                    <div class="col">
                                        <label class="lbl-caption">Forward To</label>

                                        <select id="desig_for22" style="width:60%;" name="desig_for22"
                                            class="form-control custom-select lbl-caption" class="custom-select"
                                            data-placeholder="Select Designation.." multiple>
                                            <option value="" disabled>Select</option>
                                            <!-- <option value="" selected disabled>All</option> -->
                                            {% for z in designation %}
                                            <option value="{{z.designation}}">{{z.designation}}</option>
                                            {% endfor %}
                                        </select> &nbsp;
                                    </div>
                                    <div class="col">
                                        <label class="lbl-caption"> Forward To Panel</label>
                                        <!-- <input type="checkbox" name="panel" id ="panel" value="panel" onclick="showPanel22()" data-toggle="modal" data-target="#PanelModal"> -->
                                        <button type="button" class="btn btn-outline-secondary btn-sm "
                                            data-toggle="modal" data-target="#PanelModal22" onclick="showPanel22()"><i
                                                class="fa fa-address-book" aria-hidden="true"></i></button>

                                        &nbsp;&nbsp;
                                    </div>
                                    <div class="col">

                                        <label class="lbl-caption">Item No</label>
                                        <input type="textarea"
                                            style="text-align: center;background-color:aliceblue;width:40%" id="item22"
                                            value="" disabled></input>
                                        <input class=" form-control lbl-caption" id="inspection_no22"
                                            value="{{inspection_no}}" hidden></input>
                                    </div>
                                    <div class="col">
                                        <button type="button" id="submit_filter"
                                            style="border: 1px solid #ccc; margin-left: 2%;"
                                            class="btn btn-success btn-sm float-right"
                                            onclick="compliance_forward22(this);" {% if request.session.userrole == 'guest' %} hidden {% endif %}>Submit</button>
                                    </div>
                                    <input type="textarea" class="lbl-caption" id="marked_no22" value="{{marked_no}}"
                                        hidden></input>
                                    <input type="textarea" class="lbl-caption" id="furtherFwd22" value="{{furtherFwd}}"
                                        hidden></input>
                                    &nbsp;&nbsp;&nbsp;
                                </div>

                            </div>
                        </div>
                        <table id="mytable22" class="table table-striped table-bordered table-data ">
                            <thead>
                                <tr align="left">
                                    <th>Sr.No.</th>
                                    <th>Insp. Para</th>
                                    <th>Forward On</th>
                                    <th>Forward Officer</th>
                                    <th>Received Reply</th>
                                    <th>Rejected Remark</th>
                                    <th>Rejected On</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <br><br>
                        <div for="edit" style="text-align:left;">Edit Section</div>
                        <div class="row">
                            <div class="col-11">
                                <textarea class="form-control lbl-caption word-wrap" rows="2" id="textAreaExample12"
                                    onkeyup="expandarea22(this)" style="background-color: aliceblue;"
                                    disabled></textarea>
                            </div>
                            <div class="col-1">
                                <button style="margin:2%" type="button" class="btn btn-warning savebtn"
                                    data-dismiss="modal" id="save_btn_frwd2" style="height:7%;"
                                    onclick="save_replied22()" disabled>Save</button>
                            </div>
                        </div>
                    </div>



                    <div id="revertdivphase2">
                        <div class="container-fluid mt-0">
                            <div style="width:100%;">
                                <button onclick="reloadGoBack()" class="btn btn-secondary"
                                    style="width:60px; margin-left: 95%;">Back</button>
                            </div>
                            <br />
                            <h3 class="report_heading">REASON OF REVERT</h3>
                            <br>
                            <div id="revert_remarks3">
                                <table id="mytable33" class="table table-striped table-bordered table-data "
                                    width="100%">
                                    <thead>
                                        <tr>
                                            <th>Observation</th>
                                            <th>Revert Remarks</th>
                                            <th>Revert</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="forwardeddivphase2">
                        <h3 class="report_heading">List of Replies/Forwards</h3>
                        <br>
                        <table id="mytable225" class="table table-striped table-bordered table-data ">
                            <thead>
                                <tr align="left">
                                    <th width="5%">Item No.</th>
                                    <th width="45%">Insp. Para</th>
                                    <th width="10%">Forward On</th>
                                    <th width="20%">Marked Officer</th>
                                    <th width="10%">Status</th>
                                    <th width="10%">Action</th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                        
                    </div>
                    <div id="compileddivphase2">
                        <h3 class="report_heading" id="ReplyModalAcceptLabel">List of Accepted Replies</h3>
                        <table id="mytable14" class="table table-striped table-bordered table-data" width="100%">
                            <thead>
                                <tr align="left">
                                    <th>Item No</th>
                                    <th>Insp. Para</th>
                                    <th>Accepted Compliance Remarks</th>
                                    <th>Target date</th>
                                    <th>Replied on</th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>

                </div>


            </div>
        </div>
    </div>
    </div>
    <div id="spinner" style="  margin: auto;
    width: 10%;
    padding: 10px;">

    <div class="loader"></div>

    </div>






    <!-- Wrap for phase2-->
    <div class="wrap mt-0">
        <div class="content mt-0">
            <button class="btn btn-danger" onclick="closePpln();">&times;</button>
            <iframe src="" style="width:100%;height:82vh;border:0px;" id="frmDash"></iframe>
        </div>
    </div>





    <!-- Modal for panel compliance-->
    <div class="modal fade" id="PanelModal" tabindex="-1" role="dialog" aria-labelledby="PanelModallabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="report_heading" id="PanelModalLabel">Select Designations</h3>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body" style="overflow-y:scroll; height: 300px;">
                    <table id="mytablepanel" class="table table-striped table-bordered table-data ">
                        <thead>
                            <tr>
                                <th>Mark <input class="pan_checks_all" type="checkbox" id="panel_checks_all" value="all"
                                        onclick="pan_checks_all_fun()"></th>
                                <th>Designation</th>
                                <th>Name</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>

                </div>
                <div class="modal-footer">
                    <div class="btn-toolbar" role="toolbar">
                        <div class="btn-group mr-2" role="group">
                            <button type="button" class="btn btn-outline-danger btn-sm mb-1" data-dismiss="modal"
                                onclick="save_panel(this)">Save</button>
                            <!-- <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal" id="closeforward">Close</button> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- modal -->
    <!-- Modal for panel22 compliance-->
    <div class="modal fade" id="PanelModal22" tabindex="-1" role="dialog" aria-labelledby="PanelModallabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="report_heading" id="PanelModalLabel">Select Designations</h3>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body" style="overflow-y:scroll; height: 300px;">
                    <table id="mytablepanel22" class="table table-striped table-bordered table-data ">
                        <thead>
                            <tr>
                                <th>Mark <input class="pan_checks_all" type="checkbox" id="panel_checks_all222"
                                        value="all" onclick="pan_checks_all_fun22()"></th>
                                <th>Designation</th>
                                <th>Name</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>

                </div>
                <div class="modal-footer">
                    <div class="btn-toolbar" role="toolbar">
                        <div class="btn-group mr-2" role="group">
                            <button type="button" class="btn btn-outline-danger btn-sm mb-1" data-dismiss="modal"
                                onclick="save_panel22(this)">Save</button>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- modal -->



    <!-- Modal for reply accept-->
    <div class="modal fade right" id="ReplyModalAccept" tabindex="-1" role="dialog"
        aria-labelledby="ReplyModalAcceptLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-full-width modal-dialog-scrollable" role="document">
            <div class="modal-content modal-content-full-width">
                <div class="modal-header modal-header-full-width">
                    <h3 class="report_heading" id="ReplyModalAcceptLabel">List of Accepted Replies</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body" style="text-align: left;">

                    <div class="inpt-container p-2">
                        <div class="acc-head" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true"
                            aria-controls="collapseTwo">
                            <div class="row">
                                <div class="col-11">
                                    <h5>Inspection Note Details</h5>
                                </div>
                                <div class="col-1" style="text-align: right;">
                                    <button class="btn btn-sm btn-outline-dark ">
                                        <i class="fas fa-angle-double-up fa-lg"></i>&nbsp;&nbsp;
                                        <i class="fas fa-angle-double-down fa-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="collapseTwo" class="collapse show" aria-labelledby="headingOne"
                            data-parent="#accordion">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <label class="lbl-caption">Inspection Note No</label>
                                        <input type="text" value="" id="ins_note_id_accept" readonly
                                            class="form-control lbl-caption" readonly />
                                    </div>
                                    &nbsp;&nbsp;
                                    <div class="col">
                                        <label class="lbl-caption">Inspecting Officer Designation</label>
                                        <input type="text" value="" id="ins_desig_accept" readonly
                                            class="form-control lbl-caption" readonly />
                                    </div>
                                    &nbsp;&nbsp;
                                    <div class="col">
                                        <label class="lbl-caption">Inspecting Officer Name</label>
                                        <input type="text" value="" id="ins_officer_accept"
                                            class="form-control lbl-caption" readonly />
                                    </div>
                                    &nbsp;&nbsp;
                                    <div class="col">
                                        <label class="lbl-caption">Inspection Date</label>
                                        <input type="text" value="" id="ins_date_accept"
                                            class="form-control lbl-caption" readonly />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label class="lbl-caption">Inspection Title</label>
                                        <input type="text" value="" class="form-control lbl-caption"
                                            style="max-width: 100%;" id="ins_title_accept" readonly />
                                    </div>
                                    &nbsp;&nbsp;
                                    <input type="text" value="" id="ins_id_accept" readonly
                                        class="form-control lbl-caption" hidden />
                                </div>
                            </div>
                        </div>


                    </div>
                    <br>

                </div>

                <!--  Modal Body -->

                <div class="modal-footer modal-footer-full-width">
                    <div class="btn-toolbar" role="toolbar" style="margin-top:30px;">
                        <div class="btn-group mr-2" role="group">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                id="closereply">Close</button>
                        </div>
                    </div>
                </div>
            </div><!-- Modal-Content-->
        </div><!-- Modal-Dialog -->
    </div><!-- Modal -->

    <!-- Modal for forwarded already-->
    <div class="modal fade" id="forwardedalredayModal" tabindex="-1" role="dialog"
        aria-labelledby="forwardedalredayModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-full-width modal-dialog-scrollable" role="document">
            <div class="modal-content modal-content-full-width">
                <div class="modal-header modal-header-full-width">
                    <h3 class="report_heading" id="forwardedalredayModalLabel">FORWARDED COMPLIANCE</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body" style="text-align: left;">
                    <div class="inpt-container p-2">
                        <div class="acc-head" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true"
                            aria-controls="collapseThree">
                            <div class="row">
                                <div class="col-11">
                                    <h5>Inspection Note Details</h5>
                                </div>
                                <div class="col-1" style="text-align: right;">
                                    <button class="btn btn-sm btn-outline-dark ">
                                        <i class="fas fa-angle-double-up fa-lg"></i>&nbsp;&nbsp;
                                        <i class="fas fa-angle-double-down fa-lg"></i>
                                    </button>

                                </div>
                            </div>


                        </div>
                        <div id="collapseThree" class="collapse show" aria-labelledby="headingOne"
                            data-parent="#accordion">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <label class="lbl-caption">Inspection Note No</label>
                                        <input type="text" value="" id="ins_note_id_accept_for" readonly
                                            class="form-control lbl-caption" readonly />
                                    </div>
                                    &nbsp;&nbsp;
                                    <div class="col">
                                        <label class="lbl-caption">Inspecting Officer Designation</label>
                                        <input type="text" value="" id="ins_desig_accept_for" readonly
                                            class="form-control lbl-caption" readonly />
                                    </div>
                                    &nbsp;&nbsp;
                                    <div class="col">
                                        <label class="lbl-caption">Inspecting Officer Name</label>
                                        <input type="text" value="" id="ins_officer_accept_for"
                                            class="form-control lbl-caption" readonly />
                                    </div>
                                    &nbsp;&nbsp;
                                    <div class="col">
                                        <label class="lbl-caption">Inspection Date</label>
                                        <input type="text" value="" id="ins_date_accept_for"
                                            class="form-control lbl-caption" readonly />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label class="lbl-caption">Inspection Title</label>
                                        <input type="text" value="" class="form-control lbl-caption"
                                            style="max-width: 100%;" id="ins_title_accept_for" readonly />
                                    </div>
                                    &nbsp;&nbsp;
                                    <input type="text" value="" id="ins_id_accept_for" readonly
                                        class="form-control lbl-caption" hidden />
                                </div>
                            </div>
                        </div>

                    </div>
                    <h3 class="report_heading" id="ForwardModalLabel">Previously forwarded details</h3>
                    <table id="mytable1accept_for" class="table table-striped table-bordered table-data" width="100%">
                        <thead></thead>
                        <tbody></tbody>
                    </table>

                </div>


                <!--  Modal Body -->

                <div class="modal-footer modal-footer-full-width">
                    <div class="btn-toolbar" role="toolbar" style="margin-top:30px;">
                        <div class="btn-group mr-2" role="group">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                id="closereply">Close</button>
                        </div>
                    </div>
                </div>
            </div><!-- Modal-Content-->
        </div><!-- Modal-Dialog -->
    </div><!-- Modal -->

    <br><br>



</body>

<script>
    
    $(document).ready
        (   
            function () {
                // gunjan
                $('#tableshow').DataTable({
                    "language": {
                        "search": "Keyword search:"
                    },
                    "aaSorting": [[1, "desc"]],
                    "aoColumns": [
                        null,
                        null,
                        { "sType": "date-uk" },
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null
                    ],
                    "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                        $("td:first", nRow).html(iDisplayIndex + 1);
                        return nRow;
                    }
                });
                $('#container1').hide();
                compliance_form();

                // for tooltip
                $('.js-btn-tooltip').tooltip;
            }
        );

    $('#mytable').hide();
    $("#rly_id").select2();
    $("#div_id").select2();
    $("#rly_id1").select2();
    $("#div_id1").select2();
    $("#dept_id").select2();

    $('#desig').select2();
    $('#desig_for').select2();

    function viewdate(e) {
        var inspection_id = e.id.substr(1);
        data = { 'inspection_id': inspection_id }
        // $.ajax
        // ({
        //     url: "{% url 'viewdate_ajax' %}",
        //     method: "GET",
        //     dataType: "JSON",
        //     async: false,
        //     data: data,
        //     success: function (response) 
        //     {

        //         window.location.reload();
        //     }
        // })
    }

    //  for final submit
    function save_data() {
        ins_id = $('#ins_id').val();

        data = {
            'ins_id': ins_id,
            'str': 'submit',
        }
        $.ajax
            ({
                url: "{% url 'save_data' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    if (response.length == 0) {
                        alert('Kindly Reply and Save First');
                    }
                    else {

                        alert('Do you want to continue?');
                        window.location.reload();
                    }
                    // document.getElementById(item_no_id).style.backgroundColor = "lightblue";
                }
            })
    }

    // for forwarded reply (merged)
    function save_replied() {
        var item_no = $('#item_no').val();
        var item_no_id = '//' + item_no;
        var compliance = $('#textAreaExample1').val();
        var com_id = item_no + '/';
        data =
        {
            'item_no': item_no,
            'str': 'save',
            'compliance': compliance,
        }
        $.ajax
            ({
                url: "{% url 'compliance_filterdata_ajax' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    if (response.length == 0) {
                        alert('No reply received!');
                    }
                    else {

                        document.getElementById(com_id).readOnly = true;
                        document.getElementById(com_id).value = compliance;
                        document.getElementById(com_id).style.backgroundColor = "lightblue";
                        // document.getElementById(item_no_id).disabled = true;
                        id = response.insp_no;
                        // id1 = 'closeforward';
                        document.getElementById(id).click();
                        // document.getElementById(id1).click();
                    }
                }
            })
    }

    $('#replydivphase1').hide();
    $('#spinner').hide();
    var hideshowThisReplyP1 = null, hideshowThisForwardP1 = null, hideshowThisRevertP1 = null, pass = false, hideshowPhase = null;
    function reloadFunction() {
        $('#spinner').show();
        $('#notSpinner').hide();

        window.location.href = '/compliance_form';
    }
    function reloadGoBack() {

        reply(hideshowThisReplyP1, hideshowPhase);
    }
    function reply(e, phase) {
        $('#spinner').show();
        $('#notSpinner').hide();
        hideshowThisReplyP1 = e;
        hideshowPhase = phase;

        var inspection_id = e.id;


        $('#replydivphase1').hide();
        $('#maindiv').show();




        if (phase == '2') {

            var table12 = $('#mytable12').DataTable();
            table12.destroy();
            $('#mytable12').hide();
            data =
            {
                'inspection_id': inspection_id,
                'type': 'reply',
                'status': 'P',
                'duration': 'Later'
            }
            $.ajax
                ({
                    url: "{% url 'compliance_phase2' %}",
                    method: "GET",
                    dataType: "JSON",
                    async: false,
                    data: data,
                    success: function (response) {

                        $('#divphase2').show();
                        $('#divphase1').hide();
                        $('#spinner').hide();
                        $('#notSpinner').show();
                        $('#maindiv').hide();
                        $('#replydivphase1').show();
                        $('#listdivphase2').show();
                        $('#forwarddivphase2').hide();
                        $('#revertdivphase2').hide();
                        $('#forwardeddivphase2').hide();
                        $('#compileddivphase2').hide();

                        $('#mytable1 thead').empty();
                        $('#mytable1 tbody').empty();

                        idetails = response.insp_details;
                        desigdetails = idetails[0].designation_id__designation;

                        $('#ins_desig').val(idetails[0]['designation_id__designation'])


                        $('#ins_id').val(idetails[0]['einspno']);
                        $('#ins_note_id').val(idetails[0]['inspection_note_no']);
                        $('#ins_title').val(idetails[0]['inspection_title']);
                        $('#ins_date').val(idetails[0]['inspected_on']);
                        $('#ins_officer').val(idetails[0]['insp_name']);
                        
                        
                        allData = 'Note No.- '+idetails[0]['inspection_note_no']+' dt.- '+idetails[0]['lastmodified_on'];
                        document.getElementById('collapseOneIdNoteNo').innerHTML = allData;

                        
                        


                        replydata = response.listgrid;
                        console.log(replydata)
                        let row = "";
                        let head =
                            `
                        <tr align="left">
                            <th>Item No</th>
                            <th>Insp. Para</th>
                            <th>Compliance Remarks</th>
                            <th>Action</th>
                            <th> Multiple <input class="checks_new1" type="checkbox" id="check_all2" value="all" onclick="checkboxes_clicked_all2()"></th>
                            
                        </tr>
                        `;
                        for (let i = 0; i < replydata.length; i++) {

                            row += `<tr>
                                
                        <td>${replydata[i]['sr_no']}</td>
                        <td>${replydata[i]['question']} <br>
                            Observation: ${replydata[i]['value']}<br>
                            Remarks: ${replydata[i]['report_act']}
                        </td>
                        <td>`
                            if (replydata[i]['compliance'])
                                row += `<textarea type='text' class="form-control" id="${replydata[i]['marked_no']}/" name="comp_remarks" style="height:90%; background-color: lightblue;" maxlength="3000" readonly>${replydata[i]['compliance']}</textarea>`
                            else
                                row += `<textarea type='text' class="form-control" id="${replydata[i]['marked_no']}/" name="comp_remarks" style="height:90%; " maxlength="3000" ></textarea>`

                            row += `</td>
                        <td>
                            <div class="row">
                                <div class="col-md-6-xs-12 m-1" style="width: 100%;">`


                            if (replydata[i]['tgt_date'] != -1)
                                row += ` <div><input type="text"  class="form-control datepker"  value="${replydata[i]['tgt_date']}" autocomplete="off" placeholder="Target Date" style="height: 2em; width: 110px;background-color:lightblue; " id="targetdate${replydata[i]['marked_no']}" readonly > </div>`
                            else
                                row += `  <div><input type="text"  class="form-control datepker"   autocomplete="off" placeholder="Target Date" style="height: 1.7em; width: 110px;  background-color:white;" id="targetdate${replydata[i]['marked_no']}" readonly> </div>`

                            row += `</div>
                                <div class="col-md-6-xs-12 m-1" style="width: 100%;">
                                    <div class="dropdown" style="width: 100%;">
                                        <button class="btn btn-info btn-sm  dropdown-toggle tog1" type="button" id="dropdownMenuButton"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> ACTION
                                        </button>
                                        
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="width: 100%;">`
                            if (replydata[i]['status_flag'] == 1 && replydata[i]['reject'] != 1) {
                                row += ` <button type="button" class="dropdown-item" style="width: 100%;" id="noted${replydata[i]['marked_no']}" onclick="save_compliance2(this,'noted');" >NOTED</button>
                                            <button type="button" class="dropdown-item" style="width: 100%;" id="//${replydata[i]['marked_no']}" onclick="save_compliance2(this,'save');">SAVE</button>
                                            <button type="button" class="dropdown-item" style="width: 100%;" id="///${replydata[i]['marked_no']}" onclick="edit_compliance2(this);" disabled>EDIT</button>`
                            }
                            else if (replydata[i]['status_flag'] == 2 || replydata[i]['status_flag'] == 0 || replydata[i]['reject'] == 1) {
                                row += `    <button type="button" class="dropdown-item" style="width: 100%;" id="noted${replydata[i]['marked_no']}" onclick="save_compliance2(this,'noted');" disabled>NOTED</button>
                                            <button type="button" class="dropdown-item" style="width: 100%;" id="//${replydata[i]['marked_no']}" onclick="save_compliance2(this,'save');" disabled>SAVE</button>
                                            <button type="button" class="dropdown-item" style="width: 100%;" id="///${replydata[i]['marked_no']}" onclick="edit_compliance2(this);">EDIT</button>`
                            }
                            else if (replydata[i]['status_flag'] == 3) {

                                if (replydata[i]['compliance']) {
                                    row += `   <button type="button" class="dropdown-item" style="width: 100%;" id="noted${replydata[i]['marked_no']}" onclick="save_compliance2(this,'noted');" disabled>NOTED</button>
                                                     <button type="button" class="dropdown-item" style="width: 100%;" id="//${replydata[i]['marked_no']}" onclick="save_compliance2(this,'save');" disabled>SAVE</button>
                                                    <button type="button" class="dropdown-item" style="width: 100%;" id="///${replydata[i]['marked_no']}" onclick="edit_compliance2(this);">EDIT</button>`
                                }
                                else {
                                    row += `<button type="button" class="dropdown-item" style="width: 100%;" id="noted${replydata[i]['marked_no']}" onclick="save_compliance2(this,'noted');" >NOTED</button>
                                                    <button type="button" class="dropdown-item" style="width: 100%;" id="//${replydata[i]['marked_no']}" onclick="save_compliance2(this,'save');" >SAVE</button>
                                                    <button type="button" class="dropdown-item" style="width: 100%;" id="///${replydata[i]['marked_no']}" onclick="edit_compliance2(this);" disabled>EDIT</button>`
                                }
                            }

                            if (response.user_role == 'guest')
                                row += ` <button type="button" class="dropdown-item" style="width: 100%;" data-toggle="modal" data-dismiss="modal" data-target="#RevertModal" id="/${replydata[i]['marked_no']}" disabled onclick="revert2(this)" >REVERT</button>`
                            else
                                row += `<button type="button" class="dropdown-item" style="width: 100%;" data-toggle="modal" data-dismiss="modal" data-target="#RevertModal" id="/${replydata[i]['marked_no']}" onclick="revert2(this)" >REVERT</button>`


                            if (replydata[i]['status_flag'] == 3 || replydata[i]['forwarded'])
                                row += `<button type="button" class="dropdown-item" style="width: 100%;color:green" title="${replydata[i]['forwarded_to']}" id="${replydata[i]['marked_no']}" name="get_data" onclick="fetch_forward_reply2(this.id)">FORWARDED</button>`
                            else
                                row += `<button type="button" class="dropdown-item" style="width: 100%;" data-toggle="modal" data-dismiss="modal"  id="${replydata[i]['marked_no']}" name="get_data" onclick="fetch_forward_reply2(this.id)">FORWARD</button>`


                            row += `</div>
                                    </div>
                                </div>
                                
                            </div>
                        </td>
                        <td > <input class="checks_new" type="checkbox" id="check${replydata[i]['marked_no']}" value="${replydata[i]['marked_no']}" onclick="checkboxes_clicked2()"> </td>
    
                    </tr>`;


                        }


                        $('#mytable12 thead').empty();
                        //$('#mytable12 tr').remove();
                        $('#mytable12 thead').append(head);
                        $('#mytable12 tbody').empty();
                        $('#mytable12 tbody').append(row);
                        $('#mytable12').show();
                        $('#mytable12').DataTable({
                            "language": {
                                "search": "Keyword search:"
                            },
                            "columnDefs": [{
                                "defaultContent": "-",
                                "targets": "_all"
                            }]
                        });

                        table12.$('tr').tooltip({
                            placement: '',
                            html: true
                        })
                        $(".datepker").datepicker({
                            showOn: 'focus',
                            dateFormat: 'dd/mm/y',
                            showButtonPanel: true,
                            closeText: 'Clear',
                            minDate: 0,
                            onClose: function () {
                                var event = arguments.callee.caller.caller.arguments[0];
                                if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {
                                    $(this).val('');
                                }
                            },
                            onSelect: function (selectedDate) {

                            }
                        });


                    }
                });





        }
        else {
            var table = $('#mytable1').DataTable();
            table.destroy();
            $('#mytable1').hide();
            data =
            {
                'inspection_id': inspection_id,
                'str': 'reply',
                'status': 'P',
            }
            $.ajax
                ({
                    url: "{% url 'compliance_filterdata_ajax' %}",
                    method: "GET",
                    dataType: "JSON",
                    async: false,
                    data: data,
                    success: function (response) {
                        $('#mytable12 thead').empty();
                        $('#mytable12 tbody').empty();

                        $('#maindiv').hide();
                        $('#replydivphase1').show();
                        $('#listdivphase1').show();
                        $('#forwarddivphase1').hide();
                        $('#revertdivphase1').hide();
                        $('#forwardeddivphase1').hide();
                        $('#compileddivphase1').hide();
                        $('#spinner').hide();
                        $('#notSpinner').show();

                        $('#divphase2').hide();
                        $('#divphase1').show();


                        desigdetails = response.desigdetails;
                        if (desigdetails.length != 0) { $('#ins_desig').val(desigdetails[0]['designation']); }
                        else { $('#ins_desig').val('Null'); }

                        idetails = response.idetails;
                        $('#ins_id').val(idetails[0]['inspection_no']);
                        $('#ins_note_id').val(idetails[0]['inspection_note_no']);
                        $('#ins_title').val(idetails[0]['inspection_title']);
                        $('#ins_date').val(idetails[0]['inspection_date']);
                        $('#ins_officer').val(idetails[0]['empname']);


                        allData = 'Note No.- '+idetails[0]['inspection_note_no']+' dt.- '+idetails[0]['final_submit_on'];
                        document.getElementById('collapseOneIdNoteNo').innerHTML = allData;


                        replydata = response.itemdetails;
                        let row = "";
                        let head =
                            `<thead>
                        <tr align="left">

                            <th>Item No</th>
                            <th>Insp. Para</th>
                            <th>Compliance Remarks</th>
                            <th>Action</th>
                            <th> Multiple <input class="checks_new1" type="checkbox" id="check_all" value="all" onclick="checkboxes_clicked_all()"></th>
                            <th hidden></th>
                            <th style="display:none">Forward</th>
                            <th style="display:none">View</th>
                        </tr>
                        </thead>`;
                        for (let i = 0; i < replydata.length; i++) {

                            row += "<tr>";
                            row += `<td width=2%>${replydata[i]['item']}</td>`;
                            if (replydata[i]['type'] == 'SH') 
                            { 
                                
                                row += `<td width=45% align="left" style="word-break: break-word;">${replydata[i]['observation']}<br>`
                                if(replydata[i]['tbl_data'] != '[]')
                                {
                                    row += `<br> <table  border="1"  style="width:100%">`
                                        tbl_data = replydata[i]['tbl_data']
                                    for(jk = 0; jk<tbl_data.length;jk++)
                                    {
                                        row += ` <tr>`
                                    for(ik in tbl_data[jk])
                                    {
                                        row += `<td>${ik}</td>`
                                    }
                                    
                                   
                                    row += ` </tr>`
                                
                                 

                                    }
                                
                                    
                           
                                    row += ` </table>`
                                }
                                if(replydata[i]['target_date'] != null)
                                {
                                    row += `<br>Target Date: ${formatDate(replydata[i]['target_date'])}`
                                }
                                    if(replydata[i]['priority'] == 1)
                                {
                                    row += `<br>on Priority`
                                }
                                if(replydata[i]['link_image'] != null)
                                {
                                    imdata = replydata[i]['link_image'];
                                    
                                    for(img in imdata)
                                    {
                                        
                                        row += `<br><img src="/${imdata[img]}" class="center" width="350px" height="250px" style="border: 1px solid #555;margin-top: 5px;">`
                                    }
                                }
                                    
                                row += `</td>`; 
                        
                            }
                            else if (replydata[i]['type'] == 'H') {
                                 row += `<td width=45% align="left">${replydata[i]['item_title']}<br>`;
                                    if(replydata[i]['tbl_data'] != '[]')
                                {
                                    row += `<br> <table  border="1"  style="width:100%">`
                                        tbl_data = replydata[i]['tbl_data']
                                    for(jk = 0; jk<tbl_data.length;jk++)
                                    {
                                        row += ` <tr>`
                                    for(ik in tbl_data[jk])
                                    {
                                        row += `<td>${ik}</td>`
                                    }
                                    
                                   
                                    row += ` </tr>`
                                
                                 

                                    }
                                
                                    
                           
                                    row += ` </table>`
                                }
                                if(replydata[i]['target_date'] != null)
                                {
                                    row += `<br>Target Date: ${formatDate(replydata[i]['target_date'])}`
                                }
                                    if(replydata[i]['priority'] == 1)
                                {
                                    row += `<br>on Priority`
                                }
                                if(replydata[i]['link_image'] != null)
                                {
                                    imdata = replydata[i]['link_image'];
                                    
                                    for(img in imdata)
                                    {
                                        
                                        row += `<br><img src="/${imdata[img]}" class="center" width="350px" height="250px" style="border: 1px solid #555;margin-top: 5px;">`
                                    }
                                }
                                    
                                row += `</td>`; 
                                
                                }

                            if (replydata[i]['action_type'] == 1) {
                                row +=
                                    `<td align="left" width=35%>`
                                if (replydata[i]['compliance'] == null) {
                                    row += `<div class="row">
                                                    <div class="col-9">
                                                        <textarea type='text' class="form-control ;" id="${replydata[i]['item_no']}/" name="comp_remarks" style="height:90%;" maxlength="3000" readonly></textarea>
                                                    </div>
                                                    <div class="col-3">
                                                        
                                                        <button type="button" class="btn btn-block btn-outline-info btn-sm"  id="noted${replydata[i]['item_no']}" onclick="save_compliance(this,'noted');" >Noted</button>`
                                    if (replydata[i]['forwardes'].length > 0) {
                                        row += ` 
                                                                    <button type="button" class="btn btn-block btn-outline-warning btn-sm glyphicon p-0" title="${replydata[i]['forwardes']}"  data-dismiss="modal"  id="${replydata[i]['item_no']}" name="get_data" onclick="fetch_forward_reply(this,'get_data')">FORWARDED</button>
                                                                `
                                    }
                                    else {
                                        row += ` 
                                                                    <button type="button" class="btn btn-block btn-outline-secondary btn-sm glyphicon p-0"  data-dismiss="modal"  id="${replydata[i]['item_no']}" name="get_data" onclick="fetch_forward_reply(this,'get_data')">FORWARD</button>
                                                                `
                                    }
                                    row += `</div>                          
                                                </div>`;
                                }
                                else {
                                    row += `<div class="row">
                                                    <div class="col-9 ">
                                                        <textarea type='text' class="form-control ;" id="${replydata[i]['item_no']}/" name="comp_remarks" style="height:90%; background-color:lightblue" maxlength="3000" readonly>${replydata[i]['compliance']}</textarea>
                                                    </div>
                                                    <div class="col-3">
                                                        <button type="button" class="btn btn-block btn-info btn-sm"  id="noted${replydata[i]['item_no']}" disabled >Noted</button>`
                                    if (replydata[i]['forwardes'].length > 0) {
                                        row += ` 
                                                                    <button type="button" class="btn btn-block btn-outline-warning btn-sm glyphicon p-0" title="${replydata[i]['forwardes']}"   id="${replydata[i]['item_no']}" name="get_data" onclick="fetch_forward_reply(this,'get_data')">FORWARDED</button>
                                                                `
                                    }
                                    else {
                                        row += `
                                                                    <button type="button" class="btn btn-block btn-outline-secondary btn-sm glyphicon p-0"   id="${replydata[i]['item_no']}" name="get_data" onclick="fetch_forward_reply(this,'get_data')">FORWARD</button>
                                                                `
                                    }
                                    row += `</div>
                                                </div>`
                                }

                                row += ` </td>
                                    <td></td>
                                    
                                    <td style="display:none"></td>
                                    <td hidden>0</td>
                                    <td style="display:none"></td>
                                    <td></td>
                                </tr>`;
                            }


                            else {
                                if (replydata[i]['compliance'] == null) {
                                    row +=
                                        `<td align="left" width=35%>
                                    <div class="row">
                                        <div class="col-12">
                                            <textarea type='text' class="form-control ;" id="${replydata[i]['item_no']}/" name="comp_remarks" style="height:90%;" maxlength="3000"></textarea>
                                        </div>`


                                    row += `

                                    </div>
                                </td>
                                <td width=15%>
                                    <div class="row">
                                        <div class="col-6">`
                                    if (replydata[i]['tgt_date'])
                                        row += `<div><input type="text"  class="form-control datepker"  value='${replydata[i]['tgt_date']}' autocomplete="off" placeholder="Target Date" style="height: 2em; width: 118px;background-color:lightblue; " id='targetdate${replydata[i]['item_no']}' readonly > </div>`
                                    else
                                        row += `<div><input type="text"  class="form-control datepker"   autocomplete="off" placeholder="Target Date" style="height: 2em; width: 118px;  background-color:white;" id='targetdate${replydata[i]['item_no']}' readonly> </div>`
                                    row += `</div>
                                            <div class="col-6">
                                                <div class="dropdown" style="width: 100%;">
                                                    <button class="btn btn-info btn-sm  dropdown-toggle tog1" type="button" id="dropdownMenuButton"
                                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> ACTION
                                                    </button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="width: 100%;">
                                                        <button type="button" class="dropdown-item" style="width: 100%;" id="noted${replydata[i]['item_no']}" onclick="save_compliance(this,'noted');" >NOTED</button>
                                                        <button type="button" class="dropdown-item" style="width: 100%;" id="//${replydata[i]['item_no']}" onclick="save_compliance(this,'save');" >SAVE</button>
                                                        <button type="button" class="dropdown-item" style="width: 100%;" id="///${replydata[i]['item_no']}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title="You have not saved any reply yet." onclick="edit_compliance(this);" disabled >EDIT</button>`
                                    if (response.user_role == 'guest')
                                        row += ` <button type="button" class="dropdown-item" style="width: 100%;"  id="/${replydata[i]['item_no']}" disabled onclick="revert(this)" >REVERT</button>`
                                    else
                                        row += ` <button type="button" class="dropdown-item" style="width: 100%;"  id="/${replydata[i]['item_no']}" onclick="revert(this)" >REVERT</button>`
                                    if (replydata[i]['forwardes'].length > 0)
                                        row += `<button type="button" class="dropdown-item" style="width: 100%;color:green" title="${replydata[i]['forwardes']}"  id="${replydata[i]['item_no']}" name="get_data" onclick="fetch_forward_reply(this,'get_data')">FORWARDED</button>`
                                    else
                                        row += `<button type="button" class="dropdown-item" style="width: 100%;"  id="${replydata[i]['item_no']}" name="get_data" onclick="fetch_forward_reply(this,'get_data')">FORWARD</button>`
                                    row += `
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>`




                                }
                                else {
                                    row +=
                                        `<td align="left" width=35%>
                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <textarea type='text' class="form-control ;" id="${replydata[i]['item_no']}/" name="comp_remarks" style="height:90%; background-color:lightblue" maxlength="3000" readonly>${replydata[i]['compliance']}</textarea>
                                        </div>`

                                    row += `
                                    </div>
                                    
                                </td>
                                <td width=15%>
                                    <div class="row">
                                        <div class="col-6">`
                                    if (replydata[i]['tgt_date'])
                                        row += `<div><input type="text"  class="form-control datepker"  value='${replydata[i]['tgt_date']}' autocomplete="off" placeholder="Target Date" style="height: 2em; width: 118px;background-color:lightblue; " id='targetdate${replydata[i]['item_no']}' readonly disabled> </div>`
                                    else
                                        row += `<div><input type="text"  class="form-control datepker"   autocomplete="off" placeholder="Target Date" style="height: 1.7em; width: 118px;  background-color:white;" id='targetdate${replydata[i]['item_no']}' readonly> </div>`
                                    row += `</div>
                                            <div class="col-6">
                                                <div class="dropdown" style="width: 100%;">
                                                    <button class="btn btn-info btn-sm  dropdown-toggle tog1" type="button" id="dropdownMenuButton"
                                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> ACTION
                                                    </button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="width: 100%;">
                                                        <button type="button" class="dropdown-item" style="width: 100%;" id="noted${replydata[i]['item_no']}" onclick="save_compliance(this,'noted');" >NOTED</button>
                                                        <button type="button" class="dropdown-item" style="width: 100%;" id="//${replydata[i]['item_no']}" onclick="save_compliance(this,'save');" disabled>SAVE</button>
                                                        <button type="button" class="dropdown-item" style="width: 100%;" id="///${replydata[i]['item_no']}" onclick="edit_compliance(this);"  >EDIT</button>`
                                    if (response.user_role == 'guest')
                                        row += ` <button type="button" class="dropdown-item" style="width: 100%;"  id="/${replydata[i]['item_no']}" disabled onclick="revert(this)" >REVERT</button>`
                                    else
                                        row += ` <button type="button" class="dropdown-item" style="width: 100%;"  id="/${replydata[i]['item_no']}" onclick="revert(this)" >REVERT</button>`
                                    if (replydata[i]['forwardes'].length > 0)
                                        row += `<button type="button" class="dropdown-item" style="width: 100%;color:green" title="${replydata[i]['forwardes']}"  id="${replydata[i]['item_no']}" name="get_data" onclick="fetch_forward_reply(this,'get_data')">FORWARDED</button>`
                                    else
                                        row += `<button type="button" class="dropdown-item" style="width: 100%;" id="${replydata[i]['item_no']}" name="get_data" onclick="fetch_forward_reply(this,'get_data')">FORWARD</button>`
                                    row += `
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>`

                                }
                                row +=
                                    `<td style="padding-left:2%;display:none">
                                <a href="/compliance_forward/${replydata[i]['item_no']}">
                                    <i class="fa fa-send" style="size:7%;color: blue">
                            </i></a></td>
                            <td hidden>1</td>
                            <td style="display:none" width=5%>
                                <button type="button" class="btn btn-primary"  id="${replydata[i]['item_no']}" name="get_data" onclick="fetch_forward_reply(this,'get_data')">Received Reply</button>
                            </td>
                            <td width=3%> <input class="checks_new" type="checkbox" id="check${replydata[i]['item_no']}" value="${replydata[i]['item_no']}" onclick="checkboxes_clicked()"> </td>
                            </tr>`;
                            }
                        }
                        $('#mytable1 thead').remove();
                        $('#mytable1 tr').remove();
                        $('#mytable1').append(head);
                        $('#mytable1 tbody').append(row);
                        $('#mytable1').show();
                        $('#mytable1').DataTable({
                            "language": {
                                "search": "Keyword search:"
                            },
                            "columnDefs": [{
                                "defaultContent": "-",
                                "targets": "_all"
                            }]
                        });

                        document.getElementById('searchBtnDtComp').click();
                        table.$('tr').tooltip({
                            placement: '',
                            html: true
                        })
                        $(".datepker").datepicker({
                            showOn: 'focus',
                            dateFormat: 'dd/mm/y',
                            showButtonPanel: true,
                            closeText: 'Clear',
                            minDate: 0,
                            onClose: function () {
                                var event = arguments.callee.caller.caller.arguments[0];
                                if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {
                                    $(this).val('');
                                }
                            },
                            onSelect: function (selectedDate) {

                            }
                        });


                    }
                })
        }
    }

    function searchFunctionDtAll()
    {
        $('#searchBtnDtComp').css('background-color','lightblue');
        $('#searchBtnDtAll').css('background-color','blue');
        $('#searchBtnDtInfo').css('background-color','lightblue');

        $('#mytable1').DataTable().destroy();
    $('#mytable1').DataTable({
                            "language": {
                                "search": "Keyword search:"
                            },
                            "columnDefs": [{
                                "defaultContent": "-",
                                "targets": "_all"
                            }]
                        });
    }
function searchFunctionDtInfo()
{
    
    $('#searchBtnDtComp').css('background-color','lightblue');
    $('#searchBtnDtAll').css('background-color','lightblue');
    $('#searchBtnDtInfo').css('background-color','blue');
    
    $('#mytable1').DataTable().column(5).search(
        '0'
    ).draw();
 }
function searchFunctionDtComp()
{
    $('#searchBtnDtComp').css('background-color','blue');
    $('#searchBtnDtAll').css('background-color','lightblue');
    $('#searchBtnDtInfo').css('background-color','lightblue');
    $('#mytable1').DataTable().column(5).search(
        '1'
    ).draw();
}
    function revert(e) {
        $('#spinner').show();
        $('#notSpinner').hide();

        var item_id = e.id.substr(1);

        var table = $('#mytable3').DataTable();
        table.destroy();
        $('#mytable3').hide();
        data =
        {
            'item_no': item_id,
            'str': 'reply',
        }
        $.ajax
            ({
                url: "{% url 'compliance_filterdata_ajax' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    $('#listdivphase1').hide();
                    $('#forwarddivphase1').hide();
                    $('#revertdivphase1').show();
                    $('#forwardeddivphase1').hide();
                    $('#compileddivphase1').hide();


                    $('#spinner').hide();
                    $('#notSpinner').show();
                    $('#divphase2').hide();
                    $('#divphase1').show();

                    replydata = response.itemdetails;
                    let row = "";
                    let head =
                        `<thead>
                    <tr align="left">
                        <th style='display:none'>Item No</th>
                        <th>Observation</th>
                        <th>Revert Remarks</th>
                        <th>Revert</th>
                    </tr>
                    </thead>`;
                    console.log(replydata, "replydata")
                    for (let i = 0; i < replydata.length; i++) {
                        // alert(replydata[i]['item_no']);
                        row += "<tr>";
                        row += `<td style='display:none' width=10%>${replydata[i]['item']}</td>`
                        if (replydata[i]['type'] == 'SH')
                            row += `<td align="left" width=40%>${replydata[i]['observation']}</td>`;
                        else
                            row += `<td align="left" width=40%>${replydata[i]['item_title']}</td>`;
                        row += `<td style="width:40%"><textarea type="text" id="revert_remarks" name="comp_remarks" style="width:100%;" maxlength="500"> </textarea></td>`
                        if (response.user_role == 'guest')
                            row += `<td width=10%><button type="button" class="btn btn-primary btn-sm" id="/${replydata[i]['item_no']}" onclick="revert_compliance(this);" disabled >Revert</button></td>`
                        else
                            row += `<td width=10%><button type="button" class="btn btn-primary btn-sm" id="/${replydata[i]['item_no']}" onclick="revert_compliance(this);" >Revert</button></td>`
                        row += `</tr>`;
                    }

                    $('#mytable3 thead').remove();
                    $('#mytable3 tr').remove();
                    $('#mytable3').append(head);
                    $('#mytable3 tbody').append(row);
                    $('#mytable3').show();
                    $('#mytable3').DataTable({
                        "language": {
                            "search": "Keyword search:"
                        }
                    });

                }
            })


    }


    function fetch_forward_reply(e) {
        $('#spinner').show();
        $('#notSpinner').hide();
        items = []
        var item_no = (e.id);
        document.getElementById('textAreaExample1').value = '';
        document.getElementById('save_btn_frwd').disabled = true;

        elements = document.getElementsByClassName("checks_new");
        for (i = 0; i < elements.length; i++) {
            var dd = elements[i].id
            if (document.getElementById(dd).checked == true) {
                var x = '#' + dd;
                var valdd = $(x).val();
                items.push(valdd)
            }
        }
        if (items.length == 0) {
            items.push(item_no)
        }


        item_no = JSON.stringify(items)

        forwarded_already = already_for(item_no);

        $('#listdivphase1').show();
        $('#forwarddivphase1').hide();
        $('#revertdivphase1').hide();
        $('#forwardeddivphase1').hide();
        $('#compileddivphase1').hide();
        $('#divphase2').hide();
        $('#divphase1').show();


        var table = $('#mytable2').DataTable();
        table.destroy();
        $('#mytable2').hide();
        data = { 'item_no': item_no, }
        $.ajax
            ({
                url: "{% url 'fetch_forward_reply' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    $('#listdivphase1').hide();
                    $('#forwarddivphase1').show();
                    $('#revertdivphase1').hide();
                    $('#forwardeddivphase1').hide();
                    $('#compileddivphase1').hide();


                    $('#spinner').hide();
                    $('#notSpinner').show();
                    $('#divphase2').hide();
                    $('#divphase1').show();

                    $('#item_no').val(response.item_no);
                    $('#inspection_no').val(response.inspection_no);
                    document.getElementById("item").innerHTML = response.item;
                    $('#item').val(response.item);
                    forwardreplydata = response.list1;
                    console.log(forwardreplydata)
                    let row = "";

                    let head =
                        `<thead>
                        <tr align="left">
                            <th>Sr.No.</th>
                            <th>Forward On</th>
                            <th>Forward Officer</th>
                            <th>Received Reply</th>
                            <th>Rejected Remark</th>
                            <th>Rejected On</th>
                            <th>Action</th>
                        </tr>
                    </thead>`;


                    for (let i = 0; i < forwardreplydata.length; i++) {

                        row += "<tr>";
                        row += `<td width=5%>${forwardreplydata[i]['des_id']}</td>
                            <td width=10%>${forwardreplydata[i]['recieved_on']}</td>`;
                        if (forwardreplydata[i]['status_flag'] == 1) {
                            row += `<td width=15% align="left" style="color:red">${forwardreplydata[i]['designation']}<br>(${forwardreplydata[i]['marked_to_forward']})</td>
                                <td align="left" width=30%>${forwardreplydata[i]['reply']}</td>
                                <td width=18%>`
                            if (forwardreplydata[i]['remark']) {
                                row += `<textarea class="form-control" name="remark_id" id="remark_id${forwardreplydata[i]['marked_no_forward']}" rows="2" maxlength="200" disabled>${forwardreplydata[i]['remark']}</textarea></td> 
                                    <td width=8%>${forwardreplydata[i]['daterej']}</td>`
                            }
                            else {
                                row += `<textarea class="form-control" name="remark_id" id="remark_id${forwardreplydata[i]['marked_no_forward']}" rows="2" maxlength="200" disabled></textarea></td> 
                                    <td width=8%></td>`
                            }

                            row += `  
                                <td width=14%>
                                    <button type="button" class="btn btn-primary" id="${forwardreplydata[i]['reply']}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title='No reply received yet.' disabled>Move</button>
                                    &nbsp;
                                    <button type="button" class="btn btn-primary" id="${forwardreplydata[i]['marked_no_forward']}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title='No reply received yet.' disabled>Reject</button>
                                </td>`;




                            $("#textAreaExample1").prop('disabled', true);
                            $(".savebtn").prop('disabled', true);

                        }
                        else if (forwardreplydata[i]['status_flag'] == 3) {
                            row += `<td width=15% align="left" style="color:red">${forwardreplydata[i]['designation']}<br>(${forwardreplydata[i]['marked_to_forward']})</td>
                                <td align="left" width=30%>${forwardreplydata[i]['reply']}</td>
                                <td width=18%>`
                            if (forwardreplydata[i]['remark']) {
                                row += `<textarea class="form-control" name="remark_id" id="remark_id${forwardreplydata[i]['marked_no_forward']}" rows="2" maxlength="200" disabled>${forwardreplydata[i]['remark']}</textarea></td> 
                                    <td width=8%>${forwardreplydata[i]['daterej']}</td>`
                            }
                            else {
                                row += `<textarea class="form-control" name="remark_id" id="remark_id${forwardreplydata[i]['marked_no_forward']}" rows="2" maxlength="200" disabled></textarea></td> 
                                    <td width=8%></td>`
                            }

                            row += `  
                                <td width=14%>
                                    <button type="button" class="btn btn-primary" id="${forwardreplydata[i]['reply']}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title="Move reply to edit Section" onclick="merge(this) disabled">Move</button>
                                    &nbsp;
                                    <button type="button" class="btn btn-primary" id="${forwardreplydata[i]['marked_no_forward']}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title='No reply received yet.' disabled>Reject</button>
                                </td>`;




                            $("#textAreaExample1").prop('disabled', false);
                            $(".savebtn").prop('disabled', false);
                        }
                        else if (forwardreplydata[i]['status_flag'] == 2) {
                            row += `<td width=15% align="left" style="color:green">${forwardreplydata[i]['designation']}<br>(${forwardreplydata[i]['marked_to_forward']})</td>
                                <td align="left" width=30%>${forwardreplydata[i]['reply']}</td>
                                <td width=18%>`
                            if (forwardreplydata[i]['remark']) {
                                row += `<textarea class="form-control" name="remark_id" id="remark_id${forwardreplydata[i]['marked_no_forward']}" rows="2" maxlength="200" disabled>${forwardreplydata[i]['remark']}</textarea></td> 
                                    <td width=8%>${forwardreplydata[i]['daterej']}</td>`
                            }
                            else {
                                row += `<textarea class="form-control" name="remark_id" id="remark_id${forwardreplydata[i]['marked_no_forward']}" rows="2" maxlength="200"></textarea></td> 
                                    <td width=8%></td>`
                            }

                            row += `  
                                <td width=14%>
                                    <button type="button" class="btn btn-primary mergebtn" id="${forwardreplydata[i]['reply']}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title="Move reply to edit Section" onclick="merge(this)" >Move</button>
                                    &nbsp;`
                            //  {% if request.session.userrole == 'guest' %} hidden {% endif %}
                            user_role = response.user_role
                            // alert(user_role)
                            if (user_role == 'guest')
                                row += `<button type="button" class="btn btn-primary" id="${forwardreplydata[i]['marked_no_forward']}" onclick="reject_forward_reply(this);" disabled>Reject</button>`
                            else
                                row += `<button type="button" class="btn btn-primary" id="${forwardreplydata[i]['marked_no_forward']}" onclick="reject_forward_reply(this);">Reject</button>`
                            row += `</td>`;




                            // $("#textAreaExample1").prop('disabled', false);
                            // $(".savebtn").prop('disabled', false);
                        }


                        row += "</tr>";
                    }
                    $('#mytable2 thead').remove();
                    $('#mytable2 tr').remove();
                    $('#mytable2').append(head);
                    $('#mytable2 tbody').append(row);
                    $('#mytable2').show();
                    $('#mytable2').DataTable({
                        "language": {
                            "search": "Keyword search:"
                        }
                    });
                    desig = response.desig;
                    $('#desig_for').empty();
                    $('#desig_for').append(`<option value="" disabled>Select</option>`);
                    for (let i = 0; i < desig.length; i++) {
                        if (forwarded_already.includes(desig[i]['designation'])) {

                            $('#desig_for').append(`<option value="${desig[i]['designation']}" disabled>${desig[i]['designation']}</option>`);

                        }
                        else
                            $('#desig_for').append(`<option value="${desig[i]['designation']}" >${desig[i]['designation']}</option>`);

                    }
                    if (response.move == 1) {
                        document.getElementById('moveAll').disabled = false
                    }

                    $("#rly_id1").select2().val(response.rly_code);
                    $("#div_id1").select2().val(response.div_code);

                }
            })

    }




    function move_all() {
        elements = document.getElementsByClassName("mergebtn");
        for (i = 0; i < elements.length; i++) {
            id = elements[i].id
            document.getElementById(id).click()
        }
    }

    var prev_item_no = -1;
    function merge(e) {
        var val = e.id;
        // alert(val)
        var item_no = $('#item_no').val();
        if (prev_item_no == -1) {
            prev_item_no = item_no;

        }
        else if (prev_item_no == item_no) { }
        else {
            prev_item_no = item_no;
            document.getElementById('textAreaExample1').value = '';
            document.getElementById('save_btn_frwd').disabled = true;
        }


        if (document.getElementById(val)) {
            expandarea(document.getElementById('textAreaExample1'))
            var textval = $('#textAreaExample1').val() + '\n' + val;
            $('#textAreaExample1').val(textval);
            document.getElementById('textAreaExample1').disabled = false;
            document.getElementById('save_btn_frwd').disabled = false;
        }
    }

    function edit_compliance(e) {
        var id = e.id;
        id = id.substr(3);
        var com_id = id + '/';
        var c_id = '//' + id;
        var edit_id = '///' + id;
        document.getElementById(com_id).readOnly = false;
        document.getElementById(com_id).style.backgroundColor = "transparent";
        // $('#'+com_id).attr('disabled','disabled');
        document.getElementById(c_id).disabled = false;
        document.getElementById(edit_id).disabled = true;
        // date_id='targetdate'+id;
        // document.getElementById(date_id).style.backgroundColor = "transparent";
        // document.getElementById(date_id).disabled= false;
        // $('#'+c_id).attr('disabled','disabled');
    }

    // for save as draft
    function save_compliance(e, type) {

        if (type == 'noted') {
            var item_no_id = e.id;
            item_no = item_no_id.substr(5);
            // alert(item_no_id)
            var com_id = item_no + '/';
            var edit_id = '///' + item_no;
            var revert_id = '/' + item_no;
            var compliance = document.getElementById(com_id).value;
            // alert(compliance)
            if (String(compliance).length != 0) {
                // compliance='Noted'+compliance
                compliance = 'Noted'
                document.getElementById(com_id).value = compliance
            }
            else {
                compliance = 'Noted.'
                document.getElementById(com_id).value = compliance
            }
            data =
            {
                'item_no': item_no,
                'str': 'save',
                'compliance': compliance,
            }
        }
        else {
            var item_no_id = e.id;
            item_no = item_no_id.substr(2);
            var com_id = item_no + '/';
            var edit_id = '///' + item_no;
            var revert_id = '/' + item_no;
            var compliance = document.getElementById(com_id).value;
            date_id = 'targetdate' + item_no;
            targetDate = document.getElementById(date_id).value;
            // alert(targetDate)
            data =
            {
                'item_no': item_no,
                'str': 'save',
                'compliance': compliance,
                'targetDate': targetDate,
            }
        }
        console.log(data)
        $.ajax
            ({
                url: "{% url 'compliance_filterdata_ajax' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    if (response.length == 0) {
                        alert('Kindly Reply First');
                    }
                    else {
                        // alert('Reply Saved!')
                        document.getElementById(com_id).readOnly = true;
                        document.getElementById(com_id).style.backgroundColor = "lightblue";
                        // document.getElementById(date_id).style.backgroundColor = "lightblue";
                        document.getElementById(item_no_id).disabled = true;
                        document.getElementById(revert_id).disabled = true;
                        document.getElementById(edit_id).disabled = false;
                    }
                    // document.getElementById(item_no_id).style.backgroundColor = "lightblue";
                }
            })

    }

    // for reverting the compliance
    function revert_compliance(e) {
        var item_no = e.id.substr(1);
        // item_no=item_no_id.substr(2);
        // var revert_id=item_no+'/';
        // var remarks=document.getElementById("revert_remarks");
        remarks = $('#revert_remarks').val();
        data =
        {
            'item_no': item_no,
            'str': 'revert',
            'remarks': remarks,
        }
        $.ajax
            ({
                url: "{% url 'compliance_filterdata_ajax' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    if (response.length == 0) {
                        alert('Specify the Reason');
                    }
                    else {

                        alert('Reverted Successfully')
                        reloadGoBack();
                    }
                }
            })


    }
    

    $('#rly_id').change(function () {
        var rly_id = $('#rly_id').val();
        data =
        {
            'rly_id': rly_id,
            'str': 'filter',
        }
        $.ajax
            ({
                url: "{% url 'compliance_filterdata_ajax' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    div = response.div;
                    console.log(div)
                    $('#div_id').empty();
                    $('#div_id').append(`<option value="">All</option>`);
                    for (let i = 0; i < div.length; i++) {
                        $('#div_id').append
                            (
                                `<option value="${div[i]}">
                        ${div[i]}
                        </option>`);
                    }
                }
            })
    });

    // clear button
    function compliance_alterdata() {
        window.location.href = '{% url "compliance_form" %}'

    }

    function compliance_filterdata(e) {
        var table = $('#tableshow').DataTable(
        );
        table.destroy();
        $('#tableshow').hide();
        var str = e.id;
        var data = {}
        if (str == 'submit_filter') {
            var div_id = $('#div_id').val();
            var rly_id = $('#rly_id').val();
            var ofc_id = $('#ofc_id').val();
            // var dept_id=$('#dept_id').val();
            var date_id = document.getElementById('dateid').innerHTML
            if (date_id == '') {
                var start = moment().subtract(50, 'years');
                var end = moment();
            }
            else {
                var start = $('#reportrange').data('daterangepicker').startDate;
                var end = $('#reportrange').data('daterangepicker').endDate;
            }

            var startDate = new Date(start);
            startDate = startDate.getFullYear() + '-' + (startDate.getMonth() + 1) + '-' + startDate.getDate()
            var endDate = new Date(end);
            endDate = endDate.getFullYear() + '-' + (endDate.getMonth() + 1) + '-' + endDate.getDate()
            data =
            {
                'div_id': div_id,
                'rly_id': rly_id,
                'ofc_id': ofc_id,
                'startDate': startDate,
                'endDate': endDate,
                // 'dept_id':dept_id,
                'str': 'pending'
            }
            console.log(data)
        }
        $.ajax
            ({
                url: "{% url 'compliance_filterdata1' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    let filterdata = response.inspect_details;

                    let row = "";
                    let head =
                        `<thead style="background-color:black; color:white">
                        <tr align=left>
                            <th>S.No.</th><th style="display:none;"></th>
                            <th>Insp. Date</th>
                            <th>Insp. Note No</th>
                            <th>Insp. Title</th>
                            <th>Insp. Officer</th>
                            <th>Rly./Org.</th>
                            <th>Div. /Unit</th>
                            <th>Pending</th>
                            <th>Forwarded</th>
                            <th>Complied</th>
                        </tr>
                    </thead>`;
                    // <td>${filterdata[i]['viewed_on']}</td>
                    for (let i = 0; i < filterdata.length; i++) {
                        var zns = filterdata[i]['zone'];
                        var divs = filterdata[i]['div'];
                        var railway_zone = '';
                        for (let z = 0; z < zns.length; z++) {
                            railway_zone += `<p>` + zns[z] + `</p>`;
                        }
                        var divisions = '';
                        for (let z = 0; z < divs.length; z++) {
                            divisions += `<p>` + divs[z] + `</p>`;
                        }

                        row += "<tr align=left>";
                        row += `<td width=5%>${filterdata[i]['sr_no']}</td>
                    <td style="display:none;">${filterdata[i]['inspected_on_filter']}</td>
                    <td width=10%>${filterdata[i]['inspected_on']}</td>
                    <td width=10% ><a href="/inspectionReportHtml/${filterdata[i]['inspection_no']}" target="blank">${filterdata[i]['inspection_note_no']}</a><br/>${filterdata[i]['final_submit_on']}</td>
                    <td width=45%><a class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title='${filterdata[i]['inspection_title']}'>${filterdata[i]['inspection_title'].slice(0, 100)}..</a></td>
                    <td width=15%>${filterdata[i]['inspection_officer']}</td>
                    <td style="width:5%">`+ railway_zone + `</td>
                    <td style="width:5%">`+ divisions + `</td>`

                        row += `<td style="width:5%">
                        <button type="button" class="btn btn-outline-danger btn-sm mb-1" data-toggle="modal" title="Items Forwarded/Items Pending" data-target="#ReplyModal" id=${filterdata[i]['inspection_no']} onclick="reply(this,'1')" style="width: 85px;">` + filterdata[i]['no_for_mark'] + `/` + filterdata[i]['total_items_pending'] + `</button>
                    </td>
                    <td style="width:5%">`
                        if (filterdata[i]['for_flag'] == 1)
                            row += `<button type="button" class="btn btn-outline-warning btn-sm"  title="No. of officers replied/No. of officers marked" id=${filterdata[i]['inspection_no']}   onclick="forwarded_already_modal(this,'1')" style="width: 85px;">` + filterdata[i]['marked_forwards_reply'] + `/` + filterdata[i]['total_for_mark'] + `</button>`

                        else
                            row += `<button type="button" class="btn btn-outline-secondary btn-sm mb-1" disabled  style="width: 85px;">Forwarded</button>`
                        row += `
                    </td>
                    <td style="width:5%">
                        <button type="button" class="btn btn-outline-success btn-sm mb-1" title="Items Complied/Items Marked"  id=${filterdata[i]['inspection_no']} onclick="replied(this,'1')" style="width: 85px;">` + filterdata[i]['total_items_complied'] + `/` + filterdata[i]['total_items_marked'] + `</button>
                    </td>`

                        row += "</tr>";
                    }

                    let phase2_data = response.phase2;
                    for (let i = 0; i < phase2_data.length; i++) {
                        row += "<tr align=left>";
                        row += `<td width=5%>${i + 1}</td><td style="display:none;">${phase2_data[i]['eitemid__einspno__inspected_on']}</td>
                    <td width=10%>${phase2_data[i]['eitemid__einspno__inspected_on']}</td>
                    <td width=10% ><a href="/pdfDetails/?id=${phase2_data[i]['eitemid__einspno']}"  id=/${phase2_data[i]['eitemid__einspno']} target="blank">${phase2_data[i]['eitemid__einspno__inspection_note_no']}</a></td>
                    <td width=45%><a class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title='${phase2_data[i]['eitemid__einspno__inspection_title']}'>${phase2_data[i]['eitemid__einspno__inspection_title'].slice(0, 100)}..</a></td>
                    <td width=15%>${phase2_data[i]['eitemid__einspno__designation__designation']}</td>`

                    row += `<td>`;
				for(j in phase2_data[i]['einsprly'])
                 {
                  row += phase2_data[i]['einsprly'][j]['location_code']+'<br>';
                 }
                 
                 row += `</td><td width=7%>`;
                  for(j in phase2_data[i]['einspdiv'])
                 {
                  row += phase2_data[i]['einspdiv'][j]['location_code']+'<br>';
                 }
                 row += `</td>`;

                        row += `<td style="width:5%">
                        <button type="button" class="btn btn-outline-danger btn-sm mb-1" 
                         title="Items Forwarded/Items Pending"  id=${phase2_data[i]['eitemid__einspno']} onclick="reply(this,'2')" style="width: 85px;">${phase2_data[i]['total_forward']}/${phase2_data[i]['total_pending']}</button>
                    </td>
                    <td style="width:5%">`
                        if (phase2_data[i]['for_flag'] == 1)
                            row += ` <button type="button" class="btn btn-outline-warning btn-sm" title="No. of officers Replied/No. of officers marked" id=${phase2_data[i]['eitemid__einspno']} onclick="forwarded_already_modal(this,'2')" style="width: 85px;">${phase2_data[i]['total_replied']}/${phase2_data[i]['total_forwarded']}</button>`
                        else
                            row += `<button type="button" class="btn btn-outline-secondary btn-sm mb-1" disabled  style="width: 85px;">To Forward</button>`

                        row += `</td>
                    <td style="width:5%">
                        <button type="button" class="btn btn-outline-success btn-sm mb-1" title="Items Complied/Items Marked" id=${phase2_data[i]['eitemid__einspno']}onclick="replied(this,'2')" style="width: 85px;">${phase2_data[i]['total_complied']}/${phase2_data[i]['total_marked']}</button>
                    </td>`
                        row += "</tr>";
                    }


                    $('#tableshow thead').remove();
                    $('#tableshow tr').remove();
                    $('#tableshow').append(head);
                    $('#tableshow tbody').append(row);
                    $('#tableshow').show();
                    $('#tableshow').DataTable({
                        "language": {
                            "search": "Keyword search:"
                        },
                        "aaSorting": [[1, "desc"]],
                        "aoColumns": [
                            null,
                            null,
                            { "sType": "date-uk" },
                            null,
                            null,
                            null,
                            null,
                            null,
                            null,
                            null,
                            null
                        ],
                        "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                            $("td:first", nRow).html(iDisplayIndex + 1);
                            return nRow;
                        }
                    });
                }
            })
    }

    function compliance_form() {
        $('#container1').show();
        $('#tableshow').show();
        var start = moment().subtract(30, 'days');
        var end = moment();
        function cb(start, end) {
            // $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            $('#reportrange span').html(start.format('D/M/YY') + ' to ' + end.format('D/M/YY'));
        }
        $('#reportrange').daterangepicker
            ({
                startDate: start,
                endDate: end,
                maxDate: new Date(),
                // ranges: 
                // {
                //     'Today': [moment(), moment()],
                //     'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                //     'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                //     'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                //     'This Month': [moment().startOf('month'), moment().endOf('month')],
                //     'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                // }
            }, cb);
        // cb(start, end);
    }

    // to reject the reply sent by forwarded marked officers
    function reject_forward_reply(e) {
        var forward = e.id;
        alert(forward);
        remark_id = '#remark_id'+forward
        var remark = $(remark_id).val()
        alert(remark);
        data = { 'forward': forward, 'remark': remark }
        $.ajax
            ({
                url: "{% url 'reject_forward_reply' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {

                    alert('Reject Successful');
                    id = 'remark_id'+forward;
                    // id1 = 'closeforward';
                    document.getElementById(forward).disabled = true;
                    document.getElementById(id).style.backgroundColor = "lightred";
                    reloadGoBack()
                    // document.getElementById(id1).click();
                    // window.location.reload();
                }
            })
    }

    // to forward query successfully (multiselect)
    function compliance_forward() {
        item_no = $('#item_no').val()
        inspection_no = $('#inspection_no').val()
        // var rly=$('#desig_for').val();
        // alert(rly)
        data =
        {
            'item_no': JSON.stringify(item_no),
            'inspection_no': inspection_no,
            'forward_to': JSON.stringify($('#desig_for').val()),
            'str': 'filter-desig',
        }
        $.ajax
            ({
                url: "{% url 'compliance_marked_forward' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {

                    alert('Forwarded Successfully');
                    reloadGoBack();
                    // id=inspection_no;
                    // id1='closeforward';
                    // document.getElementById(id).click();
                    // document.getElementById(id1).click();
                    // }
                }
            })
    }

</script>

<script>
    // $("textarea").trigger("input");
    function expandarea(element) {
        // alert(element.scrollHeight)
        element.style.height = "1px";
        element.style.height = (15 + element.scrollHeight) + "px";
    }



    $('#rly_id1').change(function () {
        var rly = $('#rly_id1').val();
        var desigss = $('#desig_for').val();
        // desigss=JSON.stringify(desigss)
        // alert(desigss)
        forwarded_already = already_for(1);

        data = {
            'rly_data_hrms': JSON.stringify(rly),

        }

        $.ajax({
            type: 'GET',
            url: "{% url 'getdiv_rly_desig' %}",
            dataType: 'json',
            data: data,

            success: function (response) {
                if (response.desig) {
                    $('#desig_for').empty()
                    $('#desig_for').append(`<option value="">Select Designation</option>`);
                    for (let j = 0; j < desigss.length; j++) {
                        $('#desig_for').append(`<option value="${desigss[j]}" selected> ${desigss[j]}</option>`);
                    }
                    for (let i = 0; i < response.desig.length; i++) {
                        if (forwarded_already.includes(response.desig[i]['designation']))
                            $('#desig_for').append(`<option value="${response.desig[i].designation}" disabled> ${response.desig[i].designation}</option>`);
                        else
                            $('#desig_for').append(`<option value="${response.desig[i].designation}"> ${response.desig[i].designation}</option>`);
                    }
                    let division = response.division;
                    $('#div_id1').empty()
                    $('#div_id1').append(`<option value="all">Select Division..</option>`);
                    for (let i = 0; i < division.length; i++) {
                        $('#div_id1').append(`<option value="${division[i].location_code}"> ${division[i].location_code}</option>`);

                        // $('#div_id1').append(`<option value="${division[i].location_code}"> ${division[i].location_code}-${division[i].location_type}</option>`);
                    }

                }


            }


        });
    });

    $('#div_id1').change(function () {
        var rly = $('#rly_id1').val();
        var div = $('#div_id1').val();
        var desigss = $('#desig_for').val();
        forwarded_already = already_for(1);
        data = {
            'rly_data_hrms': JSON.stringify(rly),
            'div_data_hrms': JSON.stringify(div),
        }

        $.ajax({
            type: 'GET',
            url: "{% url 'getdiv_div_desig' %}",
            dataType: 'json',
            data: data,

            success: function (response) {
                if (response.desig) {
                    $('#desig_for').empty()
                    $('#desig_for').append(`<option value="">Select Designation</option>`);
                    for (let j = 0; j < desigss.length; j++) {
                        $('#desig_for').append(`<option value="${desigss[j]}" selected> ${desigss[j]}</option>`);
                    }
                    for (let i = 0; i < response.desig.length; i++) {
                        if (forwarded_already.includes(response.desig[i]['designation']))
                            $('#desig_for').append(`<option value="${response.desig[i].designation}" disabled> ${response.desig[i].designation}</option>`);
                        else
                            $('#desig_for').append(`<option value="${response.desig[i].designation}"> ${response.desig[i].designation}</option>`);
                    }

                }


            }


        });

    });

    function showPanel() {
        forwarded_already = already_for(1);
        $.ajax({
            type: 'GET',
            url: "{% url 'get_panel_officers' %}",
            dataType: 'json',

            success: function (response) {
                $('#mytablepanel tbody').empty();
                console.log(response.desig)
                if (response.desig) {
                    row = ''
                    for (var i = 0; i < response.desig.length; i++) {
                        if (forwarded_already.includes(response.desig[i]['designation'])) {
                            row += `<tr disabled>
                            <td><input class="pan_checks" type="checkbox" disabled id =chck${response.desig[i]['designation_code']} value=${response.desig[i]['designation']}></td>
                            <td>${response.desig[i]['designation']}</td>
                            <td>${response.desig[i]['name']}</td>
                            </tr>`
                        }
                        else {
                            row += `<tr>
                            <td><input class="pan_checks" type="checkbox" id =chck${response.desig[i]['designation_code']} value=${response.desig[i]['designation']}></td>
                            <td>${response.desig[i]['designation']}</td>
                            <td>${response.desig[i]['name']}</td>
                            </tr>`
                        }
                    }
                    $('#mytablepanel tbody').append(row);


                }


            }


        });

    }

    function save_panel() {
        var desigss = $('#desig_for').val();
        elements = document.getElementsByClassName("pan_checks");
        new_desig = []
        for (i = 0; i < elements.length; i++) {
            var dd = elements[i].id
            // alert(dd)
            if (document.getElementById(dd).checked == true) {
                var x = '#' + dd;
                var valdd = $(x).val();
                new_desig.push(valdd)
            }
        }
        // alert(new_desig)
        $('#desig_for').empty()
        $('#desig_for').append(`<option value="">Select Designation</option>`);
        for (let j = 0; j < desigss.length; j++) {
            if (!(new_desig.includes(response.desig[i]['designation'])))
                $('#desig_for').append(`<option value="${desigss[j]}" selected> ${desigss[j]}</option>`);
        }

        for (let i = 0; i < new_desig.length; i++)
            $('#desig_for').append(`<option value="${new_desig[i]}" selected> ${new_desig[i]}</option>`);

        var rly = $('#rly_id1').val();
        var div = $('#div_id1').val();
        data = {
            'rly_data_hrms': JSON.stringify(rly),
            'div_data_hrms': JSON.stringify(div),
        }

        $.ajax({
            type: 'GET',
            url: "{% url 'getdiv_div_desig' %}",
            dataType: 'json',
            data: data,

            success: function (response) {
                if (response.desig) {
                    for (let i = 0; i < response.desig.length; i++) {
                        if ((desigss.includes(response.desig[i]['designation'])) || (new_desig.includes(response.desig[i]['designation'])))
                            continue;
                        else
                            $('#desig_for').append(`<option value="${response.desig[i].designation}"> ${response.desig[i].designation}</option>`);
                    }
                }
            }
        });
    }

    function already_for(item_no) {
        var val = 0
        if (item_no == 1) {
            var item_no = $('#item_no').val();
            item_no = JSON.stringify(item_no);
            val = 1
        }
        data = { 'item_no': item_no, 'val': val }
        // alert(data['item_no'], )
        // alert(data['val'])
        var forwarofc;
        $.ajax
            ({
                url: "{% url 'forward_officer' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    forwarofc = response.for_desigs;
                    // console.log(forwarofc);

                }
            })
        return forwarofc
    }

</script>

<script>
    var tabledta;
    function replied(e, phase) {
        var inspection_id = e.id;
        if (phase == '2') {
            // urls='/compliance_phase2/'+"?inspection_id=" + inspection_id + "&type=reply&status=C";
            // $("#frmDash").attr("src",urls);
            // $(".wrap").toggleClass('active');
            data =
            {
                'inspection_id': inspection_id,
                'type': 'reply',
                'status': 'C',
                'duration': 'Later',

            }
            $.ajax
                ({
                    url: "{% url 'compliance_phase2' %}",
                    method: "GET",
                    dataType: "JSON",
                    async: false,
                    data: data,
                    success: function (response) {
                        $('#divphase2').show();
                        $('#divphase1').hide();
                        $('#spinner').hide();
                        $('#notSpinner').show();
                        $('#maindiv').hide();
                        $('#replydivphase1').show();
                        $('#listdivphase2').hide();
                        $('#forwarddivphase2').hide();
                        $('#revertdivphase2').hide();
                        $('#forwardeddivphase2').hide();
                        $('#compileddivphase2').show();

                        var listgrid = response.listgrid, row = '';
                        
                        idetails = response.insp_details;
                        desigdetails = idetails[0].designation_id__designation;

                        $('#ins_desig').val(idetails[0]['designation_id__designation'])


                        $('#ins_id').val(idetails[0]['einspno']);
                        $('#ins_note_id').val(idetails[0]['inspection_note_no']);
                        $('#ins_title').val(idetails[0]['inspection_title']);
                        $('#ins_date').val(idetails[0]['inspected_on']);
                        $('#ins_officer').val(idetails[0]['insp_name']);

                        allData = 'Note No.- '+idetails[0]['inspection_note_no']+' dt.- '+idetails[0]['final_submit_on'];
                        document.getElementById('collapseOneIdNoteNo').innerHTML = allData;

                        for (let i = 0; i < listgrid.length; i++) {
                            row += `<tr>
                                    <td>${listgrid[i]['sr_no']}</td>
                                    <td>${listgrid[i]['question']} <br>
                                        Observation: ${listgrid[i]['value']}<br>
                                        Remarks: ${listgrid[i]['report_act']}
                                    </td>
                                    <td>`
                            if (listgrid[i]['compliance'])
                                row += ` <textarea type='text' class="form-control" id=${listgrid[i]['marked_no']}/ name="comp_remarks" style="height:90%; background-color: lightblue;" maxlength="3000" readonly>${listgrid[i]['compliance']}</textarea>`
                            else
                                row += `<textarea type='text' class="form-control" id=${listgrid[i]['marked_no']}/ name="comp_remarks" style="height:90%; " maxlength="3000" ></textarea>`

                            row += `</td>`
                            if (listgrid[i]['tgt_date'] != -1)
                                row += `<td>${listgrid[i]['tgt_date']}</td>`
                            else
                                row += `<td>NA</td>`

                            row += `<td>${listgrid[i]['compliance_recieved_on']}</td>
                                </tr>`

                        }
                        var table1123 = $('#mytable14').DataTable();
                        table1123.destroy();
                        $('#mytable14 tbody').empty();
                        $('#mytable14 tbody').append(row);

                        $('#mytable14').DataTable({
                            "language": {
                                "search": "Keyword search:"
                            }
                        });
                    }
                });




        }
        else {
            var table = $('#mytable1accept').DataTable();
            table.destroy();
            $('#mytable1accept').hide();
            data =
            {
                'inspection_id': inspection_id,
                'str': 'reply',
                'status': 'A',
            }
            $.ajax
                ({
                    url: "{% url 'compliance_filterdata_ajax' %}",
                    method: "GET",
                    dataType: "JSON",
                    async: false,
                    data: data,
                    success: function (response) {
                        $('#maindiv').hide();
                        $('#replydivphase1').show();
                        $('#listdivphase1').hide();
                        $('#forwarddivphase1').hide();
                        $('#revertdivphase1').hide();
                        $('#forwardeddivphase1').hide();
                        $('#compileddivphase1').show();

                        $('#spinner').hide();
                        $('#notSpinner').show();
                        $('#divphase2').hide();
                        $('#divphase1').show();

                        desigdetails = response.desigdetails;
                        if (desigdetails.length != 0) { $('#ins_desig').val(desigdetails[0]['designation']); }
                        else { $('#ins_desig').val('Null'); }

                        idetails = response.idetails;
                        $('#ins_id').val(idetails[0]['inspection_no']);
                        $('#ins_note_id').val(idetails[0]['inspection_note_no']);
                        // $('#ins_officer').val(idetails[0]['empname']);
                        // $('#ins_desig').val(idetails[0]['desig_longdesc']);           
                        $('#ins_title').val(idetails[0]['inspection_title']);
                        $('#ins_date').val(idetails[0]['inspection_date']);
                        $('#ins_officer').val(idetails[0]['empname']);

                        allData = 'Note No.- '+idetails[0]['inspection_note_no']+' dt.- '+idetails[0]['final_submit_on'];
                        document.getElementById('collapseOneIdNoteNo').innerHTML = allData;

                        replydata = response.itemdetails;
                        let row = "";
                        let head =
                            `<thead>
                    <tr align="left">
                        <th>Item No</th>
                        <th>Insp. Para</th>
                        <th>Compliance Remarks</th>
                        <th>Target date</th>
                        <th>Replied on</th>
                    </tr>
                    </thead>`;
                        for (let i = 0; i < replydata.length; i++) {
                            // alert(replydata[i]['item_no']);
                            row += "<tr>";
                            row += `<td width=10%>${replydata[i]['item']}</td>`;
                            if (replydata[i]['type'] == 'SH') { row += `<td align="left" width=35%>${replydata[i]['observation']}</td>`; }
                            else if (replydata[i]['type'] == 'H') { row += `<td align="left" width=35%>${replydata[i]['item_title']}</td>`; }
                            row += `<td align="left" width=35%>
                            <textarea type='text' class="form-control ;" id="${replydata[i]['item_no']}/" name="comp_remarks" style="height:7%;background-Color:lightblue;" maxlength="500" readonly >${replydata[i]['compliance']}</textarea>
                        </td>`

                            // row += `<td align="left"><input  type="text" id="${replydata[i]['item_no']}/" name="comp_remarks" style="height:20%;background-Color:lightblue;" value="${replydata[i]['compliance']}" readonly></td>`;
                            if (replydata[i]['tgt_date'])
                                row += `<td width=10%>${replydata[i]['tgt_date']}</td>`
                            else
                                row += `<td width=10%>NA</td>`
                            row += `<td width=10%>${replydata[i]['reply_on']}</td>`
                        }
                        $('#mytable1accept thead').remove();
                        $('#mytable1accept tr').remove();
                        $('#mytable1accept').append(head);
                        $('#mytable1accept tbody').append(row);
                        $('#mytable1accept').show();
                        $('#mytable1accept').DataTable({
                            "language": {
                                "search": "Keyword search:"
                            }
                        });
                    }
                })
        }
    }

    function formatDate(date) {
        var d = new Date(date),
            month = '' + (d.getMonth() + 1),
            day = '' + d.getDate(),
            year = d.getFullYear();

        if (month.length < 2)
            month = '0' + month;
        if (day.length < 2)
            day = '0' + day;
        let newyear = String(year).slice(2, 5)
        return [day, month, newyear].join('/');
    }

    function forwarded_already_modal(e, phase) {
       
        hideshowThisReplyP1 = e;
        hideshowPhase = phase;
        var inspection_id = e.id;
        if (phase == '2') {
           
            data =
            {
                'inspection_id': inspection_id,
                'phase': '2',
                'duration': 'Later1',
            }
            $.ajax
                ({
                    url: "{% url 'compliance_phase2' %}",
                    method: "GET",
                    dataType: "JSON",
                    async: false,
                    data: data,
                    success: function (response) {
                        $('#divphase2').show();
                        $('#divphase1').hide();
                        $('#spinner').hide();
                        $('#notSpinner').show();
                        $('#maindiv').hide();
                        $('#replydivphase1').show();
                        $('#listdivphase2').hide();
                        $('#forwarddivphase2').hide();
                        $('#revertdivphase2').hide();
                        $('#forwardeddivphase2').show();
                        $('#compileddivphase2').hide();

                        // ,inspection_note_no,  officer_desig, name, inspection_title  ,inspection_no 

                        // desigdetails = response.desigid;
                        // if (desigdetails.length != 0) { $('#ins_desig').val(desigdetails[0]['designation']); }
                        // else { $('#ins_desig').val('Null'); }
                        idetails = response.details;
                        $('#ins_id').val(response.inspection_no);
                        $('#ins_note_id').val(idetails[0]['inspection_note_no']);
                        $('#ins_title').val(idetails[0]['inspection_title']);
                        $('#ins_date').val(formatDate(idetails[0]['inspected_on']));
                        $('#ins_desig').val(idetails[0]['officer_desig'])
                        $('#ins_officer').val(response.name);


                        allData = 'Note No.- '+idetails[0]['inspection_note_no']+' dt.- '+String(formatDate(idetails[0]['lastmodified_on']));
                        document.getElementById('collapseOneIdNoteNo').innerHTML = allData;


                        let listgrid = response.listgrid, row = '';
                        console.log(listgrid)
                        for(let i=0;i<listgrid.length;i++)
                        {
                            let forwardss = listgrid[i].forwardss;
                            console.log(forwardss)
                                        row +=`   <tr>
                                        <td>${(i+1)}</td>
                                        <td>${listgrid[i]['question']} <br>
                                            Observation: ${listgrid[i]['value']}<br>
                                            Remarks: ${listgrid[i]['report_act']}
                                        </td>
                                        <td>
                                            <table>`

                                            for(let x = 0;x<forwardss.length;x++)
                                                row +=`<tr><td>${forwardss[x]['forward_on']}</td></tr>`
                                            
                                                row +=`</table>
                                        </td>
                                        <td>
                                            <table>`
                                                for(let x = 0;x<forwardss.length;x++)
                                                        row +=`<tr><td>${forwardss[x]['designationTo']}</td></tr>`
                                            
                                                        row +=` </table>
                                        </td>
                                        <td>
                                            <table>`
                                                for(let x = 0;x<forwardss.length;x++)
                                                {
                                                    if (forwardss[x]['forwardStatus'] == 2)
                                                    row +=` <tr><td style="color: green;">${forwardss[x]['stts']}</td></tr>`
                                                    else 
                                                    row +=`<tr><td style="color: red;">${forwardss[x]['stts']}</td></tr>`
                                                           
                                                }
                                        row +=`</table>
                                        </td>
                                        <td><button type="button" class="btn btn-outline-primary" id="${listgrid[i]['marked_no']}" name="get_data" onclick="fetch_forward_reply2(this.id)"><i class="far fa-edit"></i></button></td>
                                    </tr>
                                    `;
                                }

                        $('#mytable225 tbody').empty();
                        $('#mytable225 tbody').append(row)
                    }
                })


        }
        // var tabless = $('#mytable1accept_for').DataTable();
        // tabless.destroy();
        // $('#mytable1accept_for').hide();
        else {
            if (tabledta instanceof $.fn.dataTable.Api) {
                tabledta.destroy();
            }

            data =
            {
                'inspection_id': inspection_id,
            }
            $.ajax
                ({
                    url: "{% url 'forwarded_already' %}",
                    method: "GET",
                    dataType: "JSON",
                    async: false,
                    data: data,
                    success: function (response) {
                        $('#maindiv').hide();
                        $('#replydivphase1').show();
                        $('#listdivphase1').hide();
                        $('#forwarddivphase1').hide();
                        $('#revertdivphase1').hide();
                        $('#forwardeddivphase1').show();
                        $('#compileddivphase1').hide();

                        $('#spinner').hide();
                        $('#notSpinner').show();
                        $('#divphase2').hide();
                        $('#divphase1').show();


                        desigdetails = response.desigid;
                        if (desigdetails.length != 0) { $('#ins_desig').val(desigdetails[0]['designation']); }
                        else { $('#ins_desig').val('Null'); }
                        idetails = response.details;
                        $('#ins_id').val(response.inspection_no);
                        $('#ins_note_id').val(idetails[0]['inspection_note_no']);
                        $('#ins_title').val(idetails[0]['inspection_title']);
                        $('#ins_date').val(response.inspection_date);
                        $('#ins_officer').val(response.name);

                        allData = 'Note No.- '+idetails[0]['inspection_note_no']+' dt.- '+idetails[0]['final_submit_on'];
                        document.getElementById('collapseOneIdNoteNo').innerHTML = allData;



                        forwardreplydata = response.final_list;
                        let row = "";
                        let head =
                            `<thead>
                        <tr align="left">
                            <th>Item.No.</th>
                            <th>INSP. PARA</th>
                            <th>Forwarded On</th>
                            <th>Forward Officer</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>`;
                        for (let i = 0; i < forwardreplydata.length; i++) {
                            if (forwardreplydata[i]['chk'] == 'YES') {
                                row += "<tr>";
                                row += `<td width=5%>${forwardreplydata[i]['item_no']}</td>`
                                if (forwardreplydata[i]['type'] == 'SH') { row += `<td align="left" width=50% >${forwardreplydata[i]['observation']}</td>`; }
                                else if (forwardreplydata[i]['type'] == 'H') { row += `<td align="left" width=50%>${forwardreplydata[i]['item_title']}</td>`; }
                                // <td width=50%>${forwardreplydata[i]['observation']}</td>`;
                                row += `<td  width=10%><table>`;
                                mark_row = '';
                                marked = forwardreplydata[i]['marked'];
                                for (let j = 0; j < marked.length; j++) {
                                    mark_row += `<tr><td>` + formatDate(marked[j]['created_on_forward']) + `</td></tr>`
                                }
                                row += mark_row;
                                row += `</table></td>`;
                                row += `<td  width=15%><table>`;
                                mark_row = '';
                                marked = forwardreplydata[i]['marked'];
                                for (let j = 0; j < marked.length; j++) {
                                    mark_row += `<tr><td >${marked[j]['marked_to_forward__designation']}</td></tr>`;
                                    // if(marked[j]['status_flag']==1 || marked[j]['status_flag']==3 )
                                    //     mark_row += `<tr><td style="color:red">${marked[j]['marked_to_forward__designation']}</td></tr>`;
                                    // else
                                    //     mark_row += `<tr><td style="color:green">${marked[j]['marked_to_forward__designation']}</td></tr>`;
                                }
                                row += mark_row;

                                row += `</table></td>`;
                                row += `<td  width=10%><table>`;
                                mark_row = '';
                                marked = forwardreplydata[i]['marked'];
                                for (let j = 0; j < marked.length; j++) {

                                    if (marked[j]['status_flag'] == 1)
                                        mark_row += `<tr><td style="color:red">Pending</td></tr>`;
                                    else if (marked[j]['status_flag'] == 2)
                                        mark_row += `<tr><td style="color:green">Received</td></tr>`;
                                    if (marked[j]['status_flag'] == 3)
                                        mark_row += `<tr><td style="color:red">Rejected</td></tr>`;
                                }
                                row += mark_row;
                                row += `</table></td>`;

                                row += `<td>
                        <button type="button" class="btn btn-outline-primary" 
                         id="${forwardreplydata[i]['item_db']}" 
                        name="get_data" onclick="fetch_forward_reply(this)"><i class="far fa-edit"></i></button></td>`;
                                row += "</tr>";
                            }
                        }

                        $('#mytable1accept_for thead').remove();
                        $('#mytable1accept_for tr').remove();
                        $('#mytable1accept_for').append(head);
                        $('#mytable1accept_for tbody').append(row);
                        $('#mytable1accept_for').show();
                        tabledta = $('#mytable1accept_for').DataTable({
                            "language": {
                                "search": "Keyword search:"
                            }
                        });



                    }
                })
        }
    }
</script>
<script>
    jQuery.extend(jQuery.fn.dataTableExt.oSort, {
        "date-uk-pre": function (a) {
            var ukDatea = a.split('/');
            return (ukDatea[2] + ukDatea[1] + ukDatea[0]) * 1;
        },

        "date-uk-asc": function (a, b) {
            return ((a < b) ? -1 : ((a > b) ? 1 : 0));
        },

        "date-uk-desc": function (a, b) {
            return ((a < b) ? 1 : ((a > b) ? -1 : 0));
        }
    });
</script>

<script>
    function checkboxes_clicked() {
        let count = 0;
        elements = document.getElementsByClassName("checks_new");
        for (i = 0; i < elements.length; i++) {
            if (elements[i].checked == true)
                count++;
        }
        if (count) {
            document.getElementById("check_all").checked = true;
            document.getElementById("all_buttons").hidden = false
            let elements = document.getElementsByClassName("dropdown");
            for (i = 0; i < elements.length; i++) {
                elements[i].hidden = true
            }

        }

        else {
            document.getElementById("check_all").checked = false;
            document.getElementById("all_buttons").hidden = true;
            let elements = document.getElementsByClassName("dropdown");
            for (i = 0; i < elements.length; i++) {
                elements[i].hidden = false
            }
        }
        // alert(count)
    }
    function all_funcs(e) {
        if (e.id == 'forward_btn') {
            elements = document.getElementsByClassName("checks_new");
            for (i = 0; i < elements.length; i++) {
                if (elements[i].checked == true)
                    var dd = elements[i].id
                real_id = dd.substr(5);
                document.getElementById(real_id).click();
                break;
                // id="${replydata[i]['item_no']}"
            }
        }
        else if (e.id == 'save_btn') {
            elements = document.getElementsByClassName("checks_new");
            for (i = 0; i < elements.length; i++) {
                if (elements[i].checked == true) {
                    var dd = elements[i].id
                    real_id = dd.substr(5);
                    var com_id = real_id + '/';
                    if (document.getElementById(com_id).disabled == false) {
                        id = "//" + real_id
                        document.getElementById(id).click();
                    }
                    elements[i].checked = false
                }
            }
        }
        else if (e.id == 'noted_btn') {
            elements = document.getElementsByClassName("checks_new");
            for (i = 0; i < elements.length; i++) {
                if (elements[i].checked == true) {
                    var dd = elements[i].id
                    real_id = dd.substr(5);
                    var com_id = real_id + '/';
                    if (document.getElementById(com_id).disabled == false) {
                        id = "noted" + real_id
                        // alert(id)
                        document.getElementById(id).click();
                    }
                    elements[i].checked = false
                }
            }
        }
        checkboxes_clicked()
    }

    function checkboxes_clicked_all() {
        if (document.getElementById("check_all").checked == true) {
            elements = document.getElementsByClassName("checks_new");
            for (i = 0; i < elements.length; i++) {
                elements[i].checked = true
            }
        }
        else {
            elements = document.getElementsByClassName("checks_new");
            for (i = 0; i < elements.length; i++) {
                elements[i].checked = false
            }
        }
        checkboxes_clicked()
    }
    function pan_checks_all_fun() {
        if (document.getElementById("panel_checks_all").checked == true) {
            elements = document.getElementsByClassName("pan_checks");
            for (i = 0; i < elements.length; i++) {
                elements[i].checked = true
            }
        }
        else {
            elements = document.getElementsByClassName("pan_checks");
            for (i = 0; i < elements.length; i++) {
                elements[i].checked = false
            }
        }
    }
</script>

<script>
    function closePpln() {
        $(".wrap").toggleClass('active');
        window.location.reload();
    }
</script>





<script>
    // for save as draft
    function save_compliance2(e, type) {

        if (type == 'noted') {
            var marked_no_id = e.id;
            marked_no = marked_no_id.substr(5);
            var com_id = marked_no + '/';
            var edit_id = '///' + marked_no;
            var revert_id = '/' + marked_no;
            var compliance = document.getElementById(com_id).value;
            if (String(compliance).length != 0) {
                // compliance='Noted'+compliance
                compliance = 'Noted'
                document.getElementById(com_id).value = compliance
            }
            else {
                compliance = 'Noted.'
                document.getElementById(com_id).value = compliance
            }
            data =
            {
                'marked_no': marked_no,
                'byOthersAction': 'close',
                'compliance': compliance,
                'id': marked_no,
            }
        }
        else {
            var marked_no_id = e.id;
            marked_no = marked_no_id.substr(2);
            var com_id = marked_no + '/';
            var edit_id = '///' + marked_no;
            var revert_id = '/' + marked_no;
            var compliance = document.getElementById(com_id).value;
            date_id = 'targetdate' + marked_no;
            targetDate = document.getElementById(date_id).value;
            if (compliance == '' && targetDate == '') {
                alert("Please enter either target date or compliance")
                return fasle;
            }
            else if (compliance == '' && targetDate != '') {
                compliance = 'It will be done by ' + targetDate
                document.getElementById(com_id).value = compliance
            }
            data =
            {
                'id': marked_no,
                'byOthersAction': 'close',
                'compliance': compliance,
                'targetDate': targetDate,
            }
        }
        $.ajax({
            url: "{% url 'updateEinspUser' %}",
            type: 'GET',
            dataType: 'json',
            data: data,
            success: function (response) {
                alert(response);
                document.getElementById(com_id).readOnly = true;
                document.getElementById(com_id).style.backgroundColor = "lightblue";
                // document.getElementById(date_id).style.backgroundColor = "lightblue";
                document.getElementById(marked_no_id).disabled = true;
                // document.getElementById(revert_id).disabled = true;
                document.getElementById(edit_id).disabled = false;
                // document.getElementById(marked_no_id).style.backgroundColor = "lightblue";
            }
        })
    }


    function edit_compliance2(e) {
        var id = e.id;
        id = id.substr(3);
        // alert(id)
        var com_id = id + '/';
        var c_id = '//' + id;
        var edit_id = '///' + id;
        document.getElementById(com_id).readOnly = false;
        document.getElementById(com_id).style.backgroundColor = "white";
        // $('#'+com_id).attr('disabled','disabled');
        document.getElementById(c_id).disabled = false;
        document.getElementById(edit_id).disabled = true;
        // date_id='targetdate'+id;
        // document.getElementById(date_id).style.backgroundColor = "transparent";
        // document.getElementById(date_id).disabled= false;
        // $('#'+c_id).attr('disabled','disabled');
    }

    // to open revert2 modal
    function revert2(e) {
        var marked_no = e.id.substr(1);
        var inspection_id = document.getElementById("ins_id").value;
        $('#divphase2').show();
        $('#divphase1').hide();
        $('#spinner').hide();
        $('#notSpinner').show();
        $('#maindiv').hide();
        $('#replydivphase1').show();
        $('#listdivphase2').hide();
        $('#forwarddivphase2').hide();
        $('#revertdivphase2').show();
        $('#forwardeddivphase2').hide();
        $('#compileddivphase2').hide();
        data =
        {
            'inspection_id': inspection_id,
            'type': 'reply',
            'status': 'R',
            'duration': 'Later',
            'marked_no': marked_no,
        }
        $.ajax
            ({
                url: "{% url 'compliance_phase2' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    let listgrid = response.listgrid, row = '';
                    for (let i = 0; i < listgrid.length; i++) {
                        row += `
                                        <tr>
                                            <td>${listgrid[i]['question']} <br>
                                                Observation: ${listgrid[i]['value']}<br>
                                                Remarks: :${listgrid[i]['report_act']}
                                            </td>
                                            <td>
                                                <textarea type='text' class="form-control" id="remarks_for_revert3" name="comp_remarks3" style="height:90%; " maxlength="500" ></textarea>
                                            </td>`
                        if (response.user_role == 'guest')
                            row += `<td width=10%><button type="button" class="btn btn-primary btn-sm" id="/3${listgrid[i]['marked_no']}" onclick="revert_compliance3(this);" disabled >Revert</button></td>`
                        else
                            row += `<td width=10%><button type="button" class="btn btn-primary btn-sm" id="/3${listgrid[i]['marked_no']}" onclick="revert_compliance3(this);" >Revert</button></td>
                                            
                                        </tr>`

                    }
                    $('#mytable33 tbody').empty();
                    $('#mytable33 tbody').append(row);

                }
            });
    
    
        }


    function fetch_forward_reply2(id) {
        var marked_no = (id);
        var inspection_id = document.getElementById("ins_id").value;



        $('#divphase2').show();
        $('#divphase1').hide();
        $('#spinner').hide();
        $('#notSpinner').show();
        $('#maindiv').hide();
        $('#replydivphase1').show();


        $('#listdivphase2').hide();
        $('#forwarddivphase2').show();
        $('#revertdivphase2').hide();
        $('#forwardeddivphase2').hide();
        $('#compileddivphase2').hide();



        data =
        {
            'inspection_id': inspection_id,
            'type': 'Forward',
            'status': 'F',
            'duration': 'Later',
            'marked_no': marked_no,
        }
        $.ajax
            ({
                url: "{% url 'compliance_phase2' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {

                    $('#inspection_no22').val(response.inspection_id);
                    $('#marked_no22').val(response.marked_no);
                    $('#furtherFwd22').val(response.furtherFwd);

                    let listgrid = response.listgrid, row = '';

                    for (let i = 0; i < listgrid.length; i++) {
                        let forwardss = listgrid[i].forwardss;
                        console.log(forwardss)
                        for (let j = 0; j < forwardss.length; j++) {
                            console.log(listgrid[i]['sr_no'])
                            row += ` <tr>
                                <td>${listgrid[i]['sr_no']}</td>
                                <td>${listgrid[i]['question']} <br>
                                    Observation: ${listgrid[i]['value']}<br>
                                    Remarks: ${listgrid[i]['report_act']}
                                </td>
                            <td>${forwardss[j]['forward_on']}</td>
                            <td>${forwardss[j]['designationTo']}</td>
                            <td>`
                            if (forwardss[j]['forwardStatus'] == 0)
                                row += `NA`
                            else
                                row += ` ${forwardss[j]['compliance_forward']}
                                </td>    
                            <td>
                                <textarea class="form-control" name="remark_id" id="remark_id${forwardss[j]['forwardId']}" rows="2" maxlength="200"`

                            if (forwardss[j]['forwardStatus'] != 2)
                                row += ` disabled`

                            row += ` >${forwardss[j]['remarks_forward']} </textarea>
                            </td>
                            <td>
                                ${forwardss[j]['rejected_on_fwd']}
                                </td>  
                            <td>`
                            if (forwardss[j]['forwardStatus'] != 2)
                                row += `    <button type="button" class="btn btn-primary" id="${forwardss[j]['compliance_forward']}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title='No reply received yet.' disabled>Move</button>`
                            else
                                row += `<button type="button" class="btn btn-primary" id="${forwardss[j]['compliance_forward']}"  >Move</button> &nbsp;
                                    <br>`


                            if (forwardss[j]['forwardStatus'] == 2)
                                row += `<button type="button" class="btn btn-primary" id="${forwardss[j]['forwardId']}" onclick="reject_forward_reply22(this);">Reject</button>`
                            else
                                row += `<button type="button" class="btn btn-primary" id="${forwardss[j]['forwardId']}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title='No reply received yet.' disabled>Reject</button>`

                            row += ` </td>  
                            </tr>`;
                        }

                    }

                    $('#mytable22 tbody').empty();
                    $('#mytable22 tbody').append(row);
                }
            });

    }


    //  for final submit
    function save_data2() {
        ins_id = $('#ins_id').val();

        data = {
            'ins_id': ins_id,
            'byOthersAction': 'submit',
        }
        alert('Do you want to continue?');
        $.ajax
            ({
                url: "{% url 'updateEinspUser' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    alert(response);
                    window.location.reload();
                    // window.parent.closePpln();
                }
            })
    }

    $(".datepker").datepicker({
        showOn: 'focus',
        dateFormat: 'dd/mm/y',
        showButtonPanel: true,
        closeText: 'Clear',
        minDate: 0,
        onClose: function () {
            var event = arguments.callee.caller.caller.arguments[0];
            if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {
                $(this).val('');
            }
        },
        onSelect: function (selectedDate) {

        }
    });

    function checkboxes_clicked2() {
        let count = 0;
        elements = document.getElementsByClassName("checks_new");
        for (i = 0; i < elements.length; i++) {
            if (elements[i].checked == true)
                count++;
        }
        if (count) {
            document.getElementById("check_all2").checked = true;
            document.getElementById("all_buttons2").hidden = false
            let elements = document.getElementsByClassName("dropdown");
            for (i = 0; i < elements.length; i++) {
                elements[i].hidden = true
            }

        }

        else {
            document.getElementById("check_all2").checked = false;
            document.getElementById("all_buttons2").hidden = true
            let elements = document.getElementsByClassName("dropdown");
            for (i = 0; i < elements.length; i++) {
                elements[i].hidden = false
            }
        }
        // alert(count)
    }
    function all_funcs2(e) {

        if (e.id == 'forward_btn2') {
            
            all_fwds = []
            elements = document.getElementsByClassName("checks_new");
            for (i = 0; i < elements.length; i++) {
                if (elements[i].checked == true)
                    var dd = elements[i].id
                real_id = dd.substr(5);
                all_fwds.push(real_id)

            }
            all_fwds = JSON.stringify(all_fwds)
            var inspection_id = document.getElementById("ins_id").value;
            data = { 'all_fwds': all_fwds, }
           



            $('#divphase2').show();
            $('#divphase1').hide();
            $('#spinner').hide();
            $('#notSpinner').show();
            $('#maindiv').hide();
            $('#replydivphase1').show();
            $('#listdivphase2').hide();
            $('#forwarddivphase2').show();
            $('#revertdivphase2').hide();
            $('#forwardeddivphase2').hide();
            $('#compileddivphase2').hide();
            data =
            {
                'inspection_id': inspection_id,
                'type': 'Forward',
                'status': 'M',
                'duration': 'Later',
                'marked_no': all_fwds,
            }
            $.ajax
                ({
                    url: "{% url 'compliance_phase2' %}",
                    method: "GET",
                    dataType: "JSON",
                    async: false,
                    data: data,
                    success: function (response) {

                        $('#inspection_no22').val(response.inspection_id);
                        $('#marked_no22').val(response.marked_no);
                        $('#furtherFwd22').val(response.furtherFwd);

                        let listgrid = response.listgrid, row = '';

                        for (let i = 0; i < listgrid.length; i++) {
                            let forwardss = listgrid[i].forwardss;
                            console.log(forwardss)
                            for (let j = 0; j < forwardss.length; j++) {
                                console.log(listgrid[i]['sr_no'])
                                row += ` <tr>
                                <td>${listgrid[i]['sr_no']}</td>
                                <td>${listgrid[i]['question']} <br>
                                    Observation: ${listgrid[i]['value']}<br>
                                    Remarks: ${listgrid[i]['report_act']}
                                </td>
                            <td>${forwardss[j]['forward_on']}</td>
                            <td>${forwardss[j]['designationTo']}</td>
                            <td>`
                                if (forwardss[j]['forwardStatus'] == 0)
                                    row += `NA`
                                else
                                    row += ` ${forwardss[j]['compliance_forward']}
                                </td>    
                            <td>
                                <textarea class="form-control" name="remark_id" id="remark_id${forwardss[j]['forwardId']}" rows="2" maxlength="200"`

                                if (forwardss[j]['forwardStatus'] != 2)
                                    row += ` disabled`

                                row += ` >${forwardss[j]['remarks_forward']} </textarea>
                            </td>
                            <td>
                                ${forwardss[j]['rejected_on_fwd']}
                                </td>  
                            <td>`
                                if (forwardss[j]['forwardStatus'] != 2)
                                    row += `    <button type="button" class="btn btn-primary" id="${forwardss[j]['compliance_forward']}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title='No reply received yet.' disabled>Move</button>`
                                else
                                    row += `<button type="button" class="btn btn-primary" id="${forwardss[j]['compliance_forward']}"  >Move</button> &nbsp;
                                    <br>`


                                if (forwardss[j]['forwardStatus'] == 2)
                                    row += `<button type="button" class="btn btn-primary" id="${forwardss[j]['forwardId']}" onclick="reject_forward_reply22(this);">Reject</button>`
                                else
                                    row += `<button type="button" class="btn btn-primary" id="${forwardss[j]['forwardId']}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title='No reply received yet.' disabled>Reject</button>`

                                row += ` </td>  
                            </tr>`;
                            }

                        }

                        $('#mytable22 tbody').empty();
                        $('#mytable22 tbody').append(row);
                    }
                });
        
            }
        else if (e.id == 'save_btn2') {
            elements = document.getElementsByClassName("checks_new");
            for (i = 0; i < elements.length; i++) {
                if (elements[i].checked == true) {
                    var dd = elements[i].id
                    real_id = dd.substr(5);
                    var com_id = real_id + '/';
                    if (document.getElementById(com_id).disabled == false) {
                        id = "//" + real_id;
                        document.getElementById(id).click();
                    }
                    elements[i].checked = false
                }
            }
        }
        else if (e.id == 'noted_btn2') {
            elements = document.getElementsByClassName("checks_new");
            for (i = 0; i < elements.length; i++) {
                if (elements[i].checked == true) {
                    var dd = elements[i].id
                    real_id = dd.substr(5);
                    var com_id = real_id + '/';
                    if (document.getElementById(com_id).disabled == false) {
                        id = "noted" + real_id;
                        document.getElementById(id).click();
                    }
                    elements[i].checked = false
                }
            }
        }
        checkboxes_clicked2()
    }

    function checkboxes_clicked_all2() {
        if (document.getElementById("check_all2").checked == true) {
            elements = document.getElementsByClassName("checks_new");
            for (i = 0; i < elements.length; i++) {
                elements[i].checked = true
            }
        }
        else {
            elements = document.getElementsByClassName("checks_new");
            for (i = 0; i < elements.length; i++) {
                elements[i].checked = false
            }
        }
        checkboxes_clicked2()
    }
    function pan_checks_all_fun2() {
        if (document.getElementById("panel_checks_all").checked == true) {
            elements = document.getElementsByClassName("pan_checks");
            for (i = 0; i < elements.length; i++) {
                elements[i].checked = true
            }
        }
        else {
            elements = document.getElementsByClassName("pan_checks");
            for (i = 0; i < elements.length; i++) {
                elements[i].checked = false
            }
        }
    }
</script>



<script>
    $("#rly_id22").select2();
    $("#div_id22").select2();
    $("#rly_id122").select2();
    $("#div_id122").select2();
    $('#desig').select2();
    $('#desig_for22').select2();


    function expandarea22(element) {
        element.style.height = "1px";
        element.style.height = (15 + element.scrollHeight) + "px";
    }

    $('#rly_id122').change(function () {
        var rly = $('#rly_id122').val();
        var desigss = $('#desig_for22').val();

        forwarded_already = already_for22(1);

        data = {
            'rly_data_hrms': JSON.stringify(rly),

        }

        $.ajax({
            type: 'GET',
            url: "{% url 'getdiv_rly_desig' %}",
            dataType: 'json',
            data: data,

            success: function (response) {
                if (response.desig) {
                    $('#desig_for22').empty()
                    $('#desig_for22').append(`<option value="">Select Designation</option>`);
                    for (let j = 0; j < desigss.length; j++) {
                        $('#desig_for22').append(`<option value="${desigss[j]}" selected> ${desigss[j]}</option>`);
                    }
                    for (let i = 0; i < response.desig.length; i++) {
                        if (forwarded_already.includes(response.desig[i]['designation']))
                            $('#desig_for22').append(`<option value="${response.desig[i].designation}" disabled> ${response.desig[i].designation}</option>`);
                        else
                            $('#desig_for22').append(`<option value="${response.desig[i].designation}"> ${response.desig[i].designation}</option>`);
                    }
                    let division = response.division;
                    $('#div_id122').empty()
                    $('#div_id122').append(`<option value="all">Select Division..</option>`);
                    for (let i = 0; i < division.length; i++) {
                        $('#div_id122').append(`<option value="${division[i].location_code}"> ${division[i].location_code}</option>`);

                    }

                }


            }


        });
    });

    $('#div_id122').change(function () {
        var rly = $('#rly_id122').val();
        var div = $('#div_id122').val();
        var desigss = $('#desig_for22').val();
        forwarded_already = already_for22(1);
        data = {
            'rly_data_hrms': JSON.stringify(rly),
            'div_data_hrms': JSON.stringify(div),
        }

        $.ajax({
            type: 'GET',
            url: "{% url 'getdiv_div_desig' %}",
            dataType: 'json',
            data: data,

            success: function (response) {
                if (response.desig) {
                    $('#desig_for22').empty()
                    $('#desig_for22').append(`<option value="">Select Designation</option>`);
                    for (let j = 0; j < desigss.length; j++) {
                        $('#desig_for22').append(`<option value="${desigss[j]}" selected> ${desigss[j]}</option>`);
                    }
                    for (let i = 0; i < response.desig.length; i++) {
                        if (forwarded_already.includes(response.desig[i]['designation']))
                            $('#desig_for22').append(`<option value="${response.desig[i].designation}" disabled> ${response.desig[i].designation}</option>`);
                        else
                            $('#desig_for22').append(`<option value="${response.desig[i].designation}"> ${response.desig[i].designation}</option>`);
                    }

                }


            }


        });

    });

    function showPanel22() {
        forwarded_already = already_for22(1);
        $.ajax({
            type: 'GET',
            url: "{% url 'get_panel_officers' %}",
            dataType: 'json',

            success: function (response) {
                $('#mytablepanel22 tbody').empty();
                console.log(response.desig)
                if (response.desig) {
                    row = ''
                    for (var i = 0; i < response.desig.length; i++) {
                        if (forwarded_already.includes(response.desig[i]['designation'])) {
                            row += `<tr disabled>
                    <td><input class="pan_checks" type="checkbox" disabled id =chck${response.desig[i]['designation_code']} value=${response.desig[i]['designation']}></td>
                    <td>${response.desig[i]['designation']}</td>
                    <td>${response.desig[i]['name']}</td>
                    </tr>`
                        }
                        else {
                            row += `<tr>
                    <td><input class="pan_checks" type="checkbox" id =chck${response.desig[i]['designation_code']} value=${response.desig[i]['designation']}></td>
                    <td>${response.desig[i]['designation']}</td>
                    <td>${response.desig[i]['name']}</td>
                    </tr>`
                        }
                    }
                    $('#mytablepanel22 tbody').append(row);


                }
            }
        });
    }

    function save_panel22() {
        var desigss = $('#desig_for22').val();
        elements = document.getElementsByClassName("pan_checks");
        new_desig = []
        for (i = 0; i < elements.length; i++) {
            var dd = elements[i].id
            if (document.getElementById(dd).checked == true) {
                var x = '#' + dd;
                var valdd = $(x).val();
                new_desig.push(valdd)
            }
        }
        $('#desig_for22').empty()
        $('#desig_for22').append(`<option value="">Select Designation</option>`);
        for (let j = 0; j < desigss.length; j++) {
            if (!(new_desig.includes(response.desig[i]['designation'])))
                $('#desig_for22').append(`<option value="${desigss[j]}" selected> ${desigss[j]}</option>`);
        }

        for (let i = 0; i < new_desig.length; i++)
            $('#desig_for22').append(`<option value="${new_desig[i]}" selected> ${new_desig[i]}</option>`);

        var rly = $('#rly_id122').val();
        var div = $('#div_id122').val();
        data = {
            'rly_data_hrms': JSON.stringify(rly),
            'div_data_hrms': JSON.stringify(div),
        }

        $.ajax({
            type: 'GET',
            url: "{% url 'getdiv_div_desig' %}",
            dataType: 'json',
            data: data,

            success: function (response) {
                if (response.desig) {
                    for (let i = 0; i < response.desig.length; i++) {
                        if ((desigss.includes(response.desig[i]['designation'])) || (new_desig.includes(response.desig[i]['designation'])))
                            continue;
                        else
                            $('#desig_for22').append(`<option value="${response.desig[i].designation}"> ${response.desig[i].designation}</option>`);
                    }
                }
            }
        });
    }

    function already_for22(item_no) {
        var val = 0
        var furtherFwd = $('#furtherFwd22').val()
        if (item_no == 1) {
            var marked_no = $('#marked_no22').val();
            marked_no = JSON.stringify(marked_no);
            val = 1
        }
        else {
            var marked_no = $('#marked_no22').val();
            val = marked_no.length()
            marked_no = JSON.stringify(marked_no);
        }

        data = {
            'marked_no': marked_no,
            'val': val,
            'furtherFwd': furtherFwd
        }
        // alert(data['item_no'], )
        // alert(data['val'])
        // alert(marked_no)
        var forwarofc;
        $.ajax
            ({
                url: "{% url 'forward_officer_phase2' %}",
                method: "GET",
                dataType: "JSON",
                async: false,
                data: data,
                success: function (response) {
                    forwarofc = response.for_desigs;
                    // console.log(forwarofc);

                }
            })
        return forwarofc
    }


    // to forward query successfully (multiselect)
    function compliance_forward22() {
        marked_no = JSON.stringify($('#marked_no22').val())
        // alert(marked_no+"shafgashfgashf")

        inspection_no = $('#inspection_no22').val()
        var furtherFwd = $('#furtherFwd22').val()
        data =
        {
            // 'marked_no':JSON.stringify(marked_no),
            'inspection_no': inspection_no,
            'forwardToId': JSON.stringify($('#desig_for22').val()),
            'id': marked_no,
            'byOthersAction': 'forward',
            'furtherFwd': furtherFwd
        }
        $.ajax({
            url: "{% url 'updateEinspUser' %}",
            type: 'GET',
            dataType: 'json',
            data: data,
            success: function (response) {
                alert(response);
                reloadGoBack();
            }
        })
    }

    function reject_forward_reply22(e) {
        marked_no = $('#marked_no22').val()
        inspection_no = $('#inspection_no22').val()
        var forward = e.id;
        var remark = $('#remark_id' + forward).val()
        data =
        {
            'inspection_no': inspection_no,
            'id': marked_no,
            'forward_id': forward,
            'byOthersAction': 'reject_forward',
            'forwardToRemarks': remark,
        }
        $.ajax({
            url: "{% url 'updateEinspUser' %}",
            type: 'GET',
            dataType: 'json',
            data: data,
            success: function (response) {
                alert(response);
            }
        })
    }

    function merge22(e) {
        var val = e.id;


        if (document.getElementById(val)) {
            expandarea22(document.getElementById('textAreaExample12'))
            var textval = $('#textAreaExample12').val() + '\n' + val;
            $('#textAreaExample12').val(textval);
            document.getElementById('textAreaExample12').disabled = false;
            document.getElementById('save_btn_frwd2').disabled = false;
        }
    }


    function save_replied22() {
        var marked_no = $('#marked_no22').val();
        var item_no_id = '//' + item_no;
        var compliance = $('#textAreaExample12').val();
        var com_id = item_no + '/';
        data =
        {
            'marked_no': marked_no,
            'byOthersAction': 'close',
            'compliance': compliance,
        }
        $.ajax({
            url: "{% url 'updateEinspUser' %}",
            type: 'GET',
            dataType: 'json',
            data: data,
            success: function (response) {
                alert(response);
                reloadGoBack();
            }
        })
    }

</script>

<script>

    function revert_compliance3(e) {
        var marked_no = e.id.substr(2);
        var revert_button = e.id;
        var inspection_id = document.getElementById("ins_id").value;
        var remarks = document.getElementById('remarks_for_revert3').value;

        if (remarks == '') {
            alert('Specify the Reason');
            return false
        }
        data =
        {
            'id': marked_no,
            'byOthersAction': 'revert',
            'revertremarks': remarks,
        }
        $.ajax({
            url: "{% url 'updateEinspUser' %}",
            type: 'GET',
            dataType: 'json',
            data: data,
            success: function (response) {
                alert(response);
                reloadGoBack();

            }
        })
    }

function spanShowMore(id)
{
    $('#'+id).css('display','none');
    $('#S'+id).css('display','block');
}
function spanShowLess(id)
{
    $('#'+id).css('display','none');
    $('#'+id.substring(1,id.length)).css('display','block');
}
function spanShowMore1(id)
{
    $('#'+id).css('display','none');
    $('#S'+id).css('display','block');
}
function spanShowLess1(id)
{
    $('#'+id).css('display','none');
    $('#'+id.substring(1,id.length)).css('display','block');
}
</script>
{% endblock %}