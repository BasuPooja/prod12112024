{% extends 'base_do.html' %} 

{% load static %}


{% block content %}
<head>
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script src="//code.jquery.com/jquery.min.js"></script>
  <!-- <link rel="stylesheet" href="jquery.dropdown.css"> -->
  <script src="jquery.dropdown.js"></script>
  <!-- Include the plugin's CSS and JS: -->
  
  <script type="text/javascript" src="js/bootstrap-multiselect.js"></script>
  <link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css"/>
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  
  <link rel="stylesheet" type="text" href="{% static '/bootstrap-5.1.3-dist/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/bootstrap.min.css' %}">
  
  <link href="{% static '/css/bootstrap-toggle.min.css' %}" rel="stylesheet">
  <script src="{% static '/js/bootstrap-toggle.min.js' %}"></script>
  
      <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
      <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/select2.min.css' %}">
  <link rel="stylesheet" href="{% static '/css/jquery-ui.css' %}">
  
  
  <link rel="stylesheet" href="{% static '/css/font-awesome.min.css' %}">
  
  <script src="{% static 'js/timepicker.js' %}"></script>
  <!-- <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" /> -->
  
    <script src="{% static '/js/jquery.min.js' %}"></script>
     <!-- Select2 CSS --> 
  
  <!-- jQuery --> <script src="{% static '/js/jquery.min4.js' %}"></script> 
  
  <!-- Select2 JS --> 
  <script src="{% static '/js/select2.min.js' %}"></script>
  <!-- Load icon library -->
  <link rel="stylesheet" href="{% static '/css/font-awesome.min.css' %}">
  <!-- multiple selesct marked officer -->
  
  <link href="css/jquery.multiselect.css" rel="stylesheet" type="text/css">
  <script src="{% static '/js/jquery.dataTables.min.js' %}"></script>
    <link href="{% static '/css/jquery.dataTables.min.css' %}"  rel="stylesheet"/>
    <!-- Sheets for datepicker for target date -->
    
    <link rel="stylesheet" href="{% static '/css/jquery-ui.css' %}">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="{% static '/js/jquery-ui.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/quicksand.css' %} ">
    <link rel="stylesheet" type="text/css" href="{% static '/css/lato.css' %} ">
    <link href="{% static 'css/roboto.css' %}" rel="stylesheet"><br>


    <script type="text/javascript" src="{% static '/daterangepicker-master/moment.min.js'%}"></script>
   <script type="text/javascript" src="{% static '/daterangepicker-master/daterangepicker.js'%}"></script>
  <link rel="stylesheet" type="text/css" href="{%static '/daterangepicker-master/daterangepicker.css'%}" />

    <!-- Latest compiled and minified CSS -->
    <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta3/js/bootstrap-select.min.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css"> -->
    
  
  <style>
    * {
    box-sizing: border-box;
  }
  body {
          font-family: 'Quicksand', sans-serif;;
          height: 100%;
          margin: 0;
          }
  
  
      
        input[type=text]
        {
                width: 100%;
                padding: 12px 20px;
                margin: 8px 0;
                display: block;
                /* border: 1.5px solid rgb(14, 12, 12); */
                border-radius: 4px;
                box-sizing: border-box;
        }
      
        input[type=submit] {
                width: 40%;
                text-align: center;
                background-color: #4CAF50;
               
                padding: 14px 20px;
                margin: 8px 0;
                border: none;
                border-radius: 4px;
                cursor: pointer;
        }
      
        input[type=submit]:hover {
                background-color: #45a049;
                text-align: center;
        }
      
      
        input[type=button]:hover {
                background-color: #45a049;
                text-align: center;
        }
        /* #viewbtn{
          margin-left:1050px;
        } */
      
        .inputtag{
          height:20px;
        }
        .button {
    padding: 15px 25px;
    font-size: 12px;
    text-align: center;
    margin-left: 2em;
    cursor: pointer;
    outline: none;
    color: #fff;
    background-color: #04AA6D;
    border: none;
    border-radius: 15px;
   
  }
  
  .button:hover {background-color: #3e8e41}
  
  .button:active {
    background-color: #3e8e41;
    box-shadow: 0 5px #666;
    transform: translateY(4px);
  }
      </style>
      
    
</head>
<body data-media-url="{% get_media_prefix %}">
    <div class="container-fluid">
        <div class="row ">
          <div class="col-6" style="overflow: auto;">
            <center style="background-color: grey;">
              <h4>D.O Letters</h4>
            </center>
            <table class="table table-striped table-bordered table-sm" id="view_table"
              style="width: 100%">
              <thead style="background-color: #343a40;white-space: nowrap; color:white;text-align: left;">
                <th style="width: 3%;"> S.No.</th>
                <th style="width: 8%;">D.O. Date</th>
                <th style="width: 15%;">D.O. Letter No.</th>
                <th style="width: 7%;">Marked To</th>
                <th style="width: 7%;">Reply Status</th>
                <!-- <th style="width: 8%;">Reply Date</th>
                        <th style="width: 50%;">Remarks</th>
                        <th style="width: 2%;">Attachment</th>   -->
              </thead>
              <tbody>
                <!-- jinja2 Technique -->
                {% if letters %}  
                {% for i in letters  %}
                  <tr>
                    <td style="width: 3%;"> {{forloop.counter}}</td>
                    <td style="width: 8%;">{{i.do_letter_date }}</td>
                    <td style="width: 15%;"><a href="" onclick="open_do('{{i.id}}'); return false;" > {{i.do_letter_no}}</a></td>
                    <td style="width: 7%;">{{i.desig_id}}</td>
                    {% if i.status_flag == 'Pending' %}
                    <td style="width: 7%; color: red;">{{i.status_flag}}</td>
                    {% else %}
                    <td style="width: 7%; color: green;">{{i.status_flag}}</td>
                    {% endif %}
                </tr>
                {% endfor %}
                {% endif %}
              </tbody>
            </table>
          </div>
          <!--end table div-->

          <div class="col-6">
            <center style="background-color: grey;">
              <h4>D.O Letters</h4>
            </center>

            <div hidden id="view2" style="padding: 10%;">
              <table border="1" align="center">

                <th style="font-size: 20px; color: red; height: 10%;">click on the D.O. Letter No. for more
                  information</th>

                <h5></h5>
              </table>
            </div>

            <div id="view1">
              <ul class="nav nav-tabs nav-fill mb-2">
                <li class="nav-item">
                  <a class="nav-link active" data-toggle="tab" href="#details">Details</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" data-toggle="tab" href="#history">Reply Status</a>
                </li>
              </ul>

              <div class="tab-content">
                <div id="details" class="container-fluid tab-pane active">
                  <div class="row">
                    <div class="col-4 mt-3">
                      <h5 style="font-family: copperplate; color: red;">D.O. Letter No : </h5>
                    </div>
                    <div class="col-6"><input type="text" value="" id="letter_no" readonly class="form-control" />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-4 mt-3">
                      <h5 style="font-family: copperplate; color: blue;">D.O. Letter Date : </h5>
                    </div>
                    <div class="col-6"><input type="text"  id="letter_date" readonly class="form-control" />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-4 mt-3">
                      <h5 style="font-family: copperplate; color: blue;">Subject: </h5>
                    </div>
                    <div class="col-6"><textarea value="" id="subject" readonly class="form-control"
                        width="100%"></textarea></div>
                  </div>
                  <div class="rectangle m-3" id="preiew_div" style="height: 350px;">
                    <!-- <img src="" id="preview" style="width:100%;height:120%;"> -->
                    
                    <iframe id="iframetest"  style="width:718px; height:700px;" frameborder="0"></iframe>

                    <!-- <object   data-media-url="{% get_media_prefix %}" data="" style="width:100%; height:30vw;" type="application/pdf" id="preview_obj">
                    <embed  data-media-url="{% get_media_prefix %}" src="" type="application/pdf" id="preview_embed"/></object> -->
                    
                    <!-- <img src="media/do_letter/IMG-20220816-WA0005_IIZGA3b.jpg " style="width:100%;height:50vh;" >
                    
                       <object data="/media/do_letter/IMG-20220816-WA0005_IIZGA3b.jpg " style="width:100%;height:50vh;" type="application/pdf">
                      <embed src="/media/do_letter/IMG-20220816-WA0005_IIZGA3b.jpg " type="application/pdf" /></object> -->
                  </div>
                </div>



                <div id="history" class="container-fluid tab-pane table responsive">
                  <table class="table table-striped table-bordered table-sm mt-4" id="modal_table"
                    style="width: 100%; ">
                    <thead style="background-color: #343a40;white-space: nowrap; color:white;text-align: left;">
                      <th style="width: 7%;">Marked To</th>
                      <th style="width: 8%;">Reply Date</th>
                      <th style="width: 80%;">Remarks</th>
                      <th style="width: 5%;">Attachment</th>
                    </thead>
                    <tbody>
                      <!-- jinja2 Technique -->
                      <!-- {% if status %}  
                              {% for i in status  %}
                                <tr>
                                    <td style="width: 7%;">{{i.desig_id}}</td>
                                    <td style="width: 8%;">{{i.date_of_reply | date:'d-m-Y' }}</td>
                                    <td style="width: 50%;">{{i.remarks}}</td>
                                    <td style="width: 2%;"><i class="fa fa-paperclip" aria-hidden="true"></i></td>  
                                </tr>
                              {% endfor %}
                              {% endif %} -->
                    </tbody>
                  </table>
                  <iframe id="iframereply"  style="width:718px; height:700px;" frameborder="0"></iframe>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
</body>





<script type="text/javascript">

$(document).ready(function () {

$('#modal_table').DataTable();
$('#view_table').DataTable();

});

var table = $('#modal_table').DataTable({
        "language": {
          "search": "Search:"
        }
});

    function open_do(id) {
     
    console.log(id);
    data = {
      'id': id
    }
    $.ajax
      ({
        url: "{% url 'view_ajax2' %}",
        method: "GET",
        dataType: "JSON",
        async: false,
        data: data,
        success: function (response) {

          table.destroy()
            $('#modal_table tbody').empty()

          letter_no = response.do_letter_no;
          $('#letter_no').val(letter_no);
          letter_date = response.do_letter_date;
          $('#letter_date').val(letter_date);
          subject = response.subject;
          $('#subject').val(subject);
          
          file = "/media/" + response.do_file;
          $('#iframetest').attr('src', file);
          //alert(file);
          //file = "/static/images/" + response.do_file;
          //$('#preview').attr('src', file);
          // test_img="/static/images/2022-09-10.png";
          // test_pdf="static/images/09_Sep_2022.pdf";
          // $('#preview_obj').attr('data', file);
          // $('#preview_embed').attr('src', file);
          // text='';
          // text+='<img src="media/"'+ file + 'style="width:100%;height:50vh;" >';
          // $('#preview_div').append(text);
          
         

          //document.getElementById('preview').src=url;
          status23= response.status;
          table_data = '';
          for (var i = 0; i < status23.length; i++) {
            if (status23[i]['status_flag'] == 'Pending'){
              table_data += '<tr><td style="color: red; width: 8%;">' + status23[i]['desig_id__designation'] + '</td>';
              table_data += '<td style="width: 7%;"> </td>';
              table_data += '<td style="width: 80%;"> </td>';
              table_data += '<td style="width: 5%;"> </td></tr>';
            }
            else{
              table_data += '<tr><td style="color: green;width: 8%;">' + status23[i]['desig_id__designation'] + '</td>';
              table_data += '<td >' + status23[i]['date_of_reply'] + '</td>';
              table_data += '<td style="width: 80%;">'+ status23[i]['remarks'] +' </td>';
              if (status23[i]['reply_path']){
                
                 table_data += '<td style="width: 5%;"> <a href="/media/'+ status23[i]['reply_path'] +'"   target="_blank"><i class="fa fa-paperclip" aria-hidden="true"></i></a> </td></tr>';
                //table_data += '<td style="width: 5%;"> <a href="#" onclick="openPDF('+ status23[i]['remarks'] + '); return false;"><i class="fa fa-paperclip" aria-hidden="true"></i></a> </td></tr>';
                
              }
              else
              table_data += '<td style="width: 5%;"> </td></tr>';
          }
            // table_data += '<tr><td>' + status23[i]['desig_id__designation'] + '</td>';
            // table_data += '<td>' + status23[i]['date_of_reply'] + '</td>';
            // table_data += '<td>' + status23[i]['remarks'] + '</td>';
            // table_data += '<td>' + status23[i]['reply_path'] + '</td></tr>';
          }
          
          
          $('#modal_table tbody').empty()
          $('#modal_table tbody').append(table_data)
          table = $('#modal_table').DataTable({
                          "language": {
                "search": "Search:"
              }
            });
        }
      });
  }

  function openPDF(pdf){
    file = "/media/" + pdf;
          src=`http://docs.google.com/gview?url=file.pdf&embedded=true`
          $('#iframereply').attr('src', file);
  window.open(pdf);
  return false;
}
    
</script>

{% endblock %}