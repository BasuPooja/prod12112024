{% extends 'base.html' %}
{% block content %}
{% load static %}

<head>
    <script src="{% static '/js/select2.min.js' %}"></script>
    <script src="{% static '/js/bootstrap.min.js' %}"></script>
    <script src="{% static '/js/jquery.min.js' %}"></script>
    <script src="{% static '/js/popper.min.js' %}"></script>
    <script type="text/javascript" src="{% static '/bootstrap-4.0.0/dist/js/bootstrap.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/bootstrap-4.0.0/dist/js/bootstrap.bundle.min.js'%}"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/bootstrap.min.css' %}">
    <script src="{% static '/js/jquery-3.3.1.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/DataTables/datatables.min.css' %}" />
    <link href="{% static '/css/bootstrap-toggle.min.css' %}" rel="stylesheet">
    <script src="{% static 'js/timepicker.js' %}"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="{% static '/daterangepicker-master/moment.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/daterangepicker-master/daterangepicker.js'%}"></script>
    <link rel="stylesheet" type="text/css" href="{%static '/daterangepicker-master/daterangepicker.css'%}" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" type="text" href="{% static '/bootstrap-4.0.0/dist/css/font-awesome.min.css'%}">
    <script src="{% static '/js/select2.min.js' %}"></script>

    <!-- <link rel="stylesheet" type="text/css" href="{% static 'DataTables/datatables.css' %}" /> -->
    <script type="text/javascript" src="{% static 'DataTables/datatables.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'jquery-ui/jquery-ui.css' %}" />
    <script type="text/javascript" src="{% static 'jquery-ui/jquery-ui.js' %}"></script>
</head>

<!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"> -->
<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script> -->
<!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script> -->

<style>
    .datepicker-dropdown {

        border-radius: 10px;
    }

    * {
        box-sizing: border-box;
    }

    .input,
    input[type=text] {
        width: 100%;
        padding: 12px 20px;
        margin: 2px 0;
        display: block;
        /* border: 1.5px solid rgb(14, 12, 12); */
        resize: vertical;
        border-radius: 4px;
        box-sizing: border-box;
    }

    input[type=submit] {
        width: 40%;
        text-align: center;
        background-color: #4CAF50;
        color: rgb(15, 12, 12);
        padding: 14px 20px;
        margin: 2px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    input[type=submit]:hover {
        background-color: #45a049;
        text-align: center;
    }

    input[type=button] {
        width: 30%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 6px 6px;
        margin: 2px 2px 2px 2px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    input[type=button]:hover {
        background-color: #45a049;
        text-align: center;
    }

    .inputtag {
        height: 20px;
    }

    .modal-dialog-full-width {
        width: 80% !important;
        height: 100% !important;
        margin: 0 !important;
        padding-left: 20% !important;
        padding-top: 5% !important;
        padding-bottom: 5% !important;
        max-width: none !important;
        text-align: center !important;
    }

    .modal-content-full-width {
        height: auto !important;
        min-height: 100% !important;
        border-radius: 0 !important;
        text-align: center !important;
    }

    .modal-header-full-width {
        border-bottom: 0px solid #9ea2a2 !important;
    }

    .modal-footer-full-width {
        border-top: 0px solid #9ea2a2 !important;
    }

    .container {
        max-width: 1500px
    }

    input[type="radio"] {
        margin: 0 5px 0 5px;
    }

    div.bold-selected {
        font-weight: bold;
    }
</style>

<body>
    <h3 style="font-family: 'Lato', sans-serif;">
        <center><b>New Budget Pronouncement</b></center>
    </h3>
    <br><br>

    {% for i in dataList %}
    <input class="form-control " id="budget_id" name="para_id" value="{{ i.budget_id }}" hidden/>
    {% endfor %}
    <div class="container" id="container1" style="margin-bottom:5%; text-align: center;">
        <div class="row" style="text-align: left; padding-left: 3em;">

            <div class="col">
                <label for="year_id">Financial Year<span style="color:red;font-weight:bold">*</span></label>
                <select class="form-control" name="year_id" id="year_id" class="custom-select"
                    data-placeholder="Select year.." style="max-width:auto;height:2.5em;">
                    
                    {% for f in fin_year %}
                        {% if dataList.0.financial_year == f %}
                        <option value="{{f}}" selected>{{f}}</option>
                        {% else %}
                        <option value="{{f}}">{{f}}</option>
                        {% endif %}
                    {% endfor %}
                    
                </select>
                <!-- '<span style="color:red;font-weight:bold">*</span>' : Required Fields -->
            </div>

            {% for i in dataList %}
            <div class="col">
                <label for="para_id">Para Number<span style="color:red;font-weight:bold">*</span></label>
                <textarea class="form-control "  maxlength="10" id="para_id" name="para_id"
                    style="max-width:auto;height:2.5em;">{{ i.para_no }}</textarea>
            </div>
            {% endfor %}

            <div class="col">
                <label for="action">Action<span style="color:red;font-weight:bold">*</span></label>
                <select class="form-control" name="action" id="action" class="custom-select"
                    data-placeholder="Select year.." style="max-width:auto;height:2.5em;">
                    {% for i in dataList %}
                    <option value="{{ i.action }}" selected>{{ i.action }}</option>
                    {% endfor %}
                    <option value="Action Initiated">Action Initiated</option>
                    <option value="Action Not Initiated">Action Not Initiated</option>
                    <option value="Dropped">Dropped</option>
                    <option value="Implemented">Implemented</option>
                    <option value="Needs Monitoring">Needs Monitoring</option>
                    <option value="Substantially Implemented">Substantially Implemented</option>
                    <option value="Under Reconsideration">Under Reconsideration</option>
                    <!-- <option value="Action Not Initiated">Action Not Initiated</option>
                    <option value="Action Initiated">Action Initiated</option>
                    <option value="Needs Monitoring">Needs Monitoring</option>
                    <option value="Substantially Implemented">Substantially Implemented</option>
                    <option value="Implemented">Implemented</option>
                    <option value="Under Reconsideration">Under Reconsideration</option>
                    <option value="Dropped">Dropped</option> -->
                </select>
                
            </div>
        </div>

       
        <div class="row" style="text-align: left; padding-left: 3em;">
            <div class="container">
                <br>
                <label for="p_title">Pronouncement Title<span style="color:red;font-weight:bold">*</span></label>
                <textarea class="form-control " maxlength="200" placeholder="Maximum character limit 200" id="p_title"
                    name="p_title">{{ dataList.0.title }}</textarea>
                <div class="mt-2">
                    '<span style="color:red;font-weight:bold">*</span>' : Required Fields in Forms
                </div>
            </div>
        </div>
        


        <form action="{% url 'create_budget_form' %}" method="POST">
            {% csrf_token %}
            <br><br>
            <table id="createTable" class="table table-striped table-bordered center">
                <thead>
                    <tr style="margin-left: 5em;">
                        <th
                            style="text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5%;">
                            S.No.</th>
                        <th
                            style="text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 45%">
                            Action Points<span style="color:red;font-weight:bold">*</span></th>
                        <th
                            style="text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 30%;">
                            Marked Officer<span style="color:red;font-weight:bold">*</span></th>
                        <th
                            style="text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 15%;">
                            Target Date</th>
                        <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5%;">Remark</th> -->
                    </tr>
                </thead>
                
                <tbody id="addworkpara">
                    {% for i in List1 %}
                    
                    {% if i.data_type == 'H' %}

                        <tr>
                            <td>
                                <div style="text-align: center; width:5px ; font-family: verdana;">{{i.data_id}}</div>
        
                            </td>
        
                            <td><textarea maxlength="500" id="heading{{i.data_id}}"  style="height:auto;"
                                class="form-control" value="{{i.specific_action}}">{{ i.specific_action }}</textarea></td>
                            
                            {% if i.chk_cts == 'YES' %}
                            <td>
                                <div id="divofficer{{i.data_id}}">
                                    <select class="form-control sel2" style="height:2em" id="Hofficer{{i.data_id}}" name="mofficer" multiple
                                        required>
                                        {% for y in dealt_officer %}

                                        {% if y.designation_code in i.marked_officer %}
                                        <option value="{{ y.designation_code }}" selected>{{ y.designation}}</option>
                                        {% else %}

                                        <option value="{{ y.designation_code }}">{{ y.designation}}</option>
                                        {% endif %}
                                        {% endfor %}

                                       
                                        
                                    </select>
                                </div>
                            </td>
        
                            <td><input type="text" value="{{i.target_date|date:'d/m/Y'}}" class="form-control datepker" placeholder="dd/mm/yy"
                                    style="height:2em; width: 130px;" id='Htargetdate{{i.data_id}}' readonly />
                            </td>
                            {% else %}
                            <td>
                                <div id="divofficer{{i.data_id}}" style="display: none;">
                                    <select class="form-control sel2" style="height:2em;width: 100%;" id="Hofficer{{i.data_id}}" name="mofficer" multiple
                                        required>
                                        {% for y in dealt_officer %}

                                        {% if y.designation_code in i.marked_officer %}
                                        <option value="{{ y.designation_code }}" selected>{{ y.designation}}</option>
                                        {% else %}

                                        <option value="{{ y.designation_code }}">{{ y.designation}}</option>
                                        {% endif %}
                                        {% endfor %}

                                       
                                        
                                    </select>
                                </div>
                            </td>
        
                            <td><input type="text" value="{{i.target_date|date:'d/m/Y'}}" class="form-control datepker" placeholder="dd/mm/yy"
                                    style="height:2em; width: 130px; display: none;" id='Htargetdate{{i.data_id}}' readonly />
                            </td>
                            {% endif %}
        
                        </tr>
                    
                    {% elif i.data_type == 'SH' %}
                    <tr>
                        <td><div style="text-align: center; width:5px" id='itemno{{i.data_id}}'>{{i.data_id}}</div></td>
                        <td><textarea maxlength="500" id='subheading{{i.data_id}}' placeholder="Add Details of work.." style="height:6em;" class="form-control">{{ i.sub_specific_action }}</textarea>
                            <br></td>
    
                        <td>
                            <div><select class="form-control sel2" style="height:2em" id='SHofficer{{i.des_id_two}}' name="mofficer" multiple required>
    
                    
                                {% for y in dealt_officer %}

                                {% if y.designation_code in i.marked_officer %}
                                <option value="{{ y.designation_code }}" selected>{{ y.designation}}</option>
                                {% else %}

                                <option value="{{ y.designation_code }}">{{ y.designation}}</option>
                                {% endif %}
                                {% endfor %}
                            </select>

                        </div></td>
                        <td><input type="text" value="{{i.target_date|date:'d/m/Y'}}" class="form-control datepker" placeholder="dd/mm/yy" style="height:2em; width: 130px;" id='SHtargetdate{{i.data_id}}' readonly/></td>
                        
                    </tr>
                    
                    {% endif %}
                    {% endfor %}

            </tbody>
           
            
            </table>
            <div>
                <button type="button" class="btn btn-primary" name="addP" onclick="changeColorBtn(this);" id="addP">Add
                    Action Point</button>
                <button type="button" class="btn btn-primary" name="addSP" onclick="changeColorBtn(this);"
                    id="addSP">Add
                    Sub Action Point</button>
                <button type="button" class="btn btn-danger btn-md" id="delete">Delete</button>
            </div>
            <input type="hidden" id="budget_id_id" value="{{budget_id}}">
        </form>
        <!-- </div> -->
        <div style="text-align: center;">
            <button type="button" id="draft" name="draft" style="margin-top:2em;width:8em;border: 1px solid #ccc;"
                onclick="Savedraft_budget();" class="btn btn-success btn-md ">Save as Draft</button>
            <button type="button" id="submit" name="submit" value="Submit"
                style="margin-top:2em;width:8em;border: 1px solid #ccc;" class="btn btn-success"
                onclick="Submit_draft();">Submit</button>
        </div>
    </div>
    <br><br>
</body>
<script>


    function changeColorBtn(el) {
        let val = el.id
        if (val == 'addP') {
            document.getElementById('addP').style.backgroundColor = "#3333ff";
            document.getElementById('addSP').style.backgroundColor = "#337AB7";
            // document.getElementById('addSSP').style.backgroundColor = "#337AB7";
        }
        else if (val == 'addSP') {
            document.getElementById('addP').style.backgroundColor = "#337AB7";
            document.getElementById('addSP').style.backgroundColor = "#3333ff";
            // document.getElementById('addSSP').style.backgroundColor = "#337AB7";
        }
        else if (val == 'addSSP') {
            document.getElementById('addP').style.backgroundColor = "#337AB7";
            document.getElementById('addSP').style.backgroundColor = "#337AB7";
            // document.getElementById('addSSP').style.backgroundColor = "#3333ff";
        }
    }

    var Nlist = 0
    var Plist = []
    var SPlist = []
    var SSPlist = []
    var full_array = []


    var desc_id = JSON.parse(('{{full_array|safe}}'))
    var Plist1 = JSON.parse(('{{plist|safe}}'))
    var SPlist1 = JSON.parse(('{{splist|safe}}'))
    Nlist = parseInt(('{{Nlist|safe}}'))
    
  
  for(i in Plist1){
    Plist.push(Plist1[i])
  }
  for(j in SPlist1){
    SPlist.push(SPlist1[j])
  }
    
for(id in desc_id){
    full_array.push(desc_id[id])
  }

  console.log(full_array)
  console.log(Plist)
  console.log(SPlist)
  $(".sel2").select2();
  $(".datepker").datepicker({
                        showOn: 'focus',
                        dateFormat: 'dd/mm/yy',
                        showButtonPanel: true,
                        closeText: 'Clear',
                        minDate: 0,
                        onClose: function () {
                            var event = arguments.callee.caller.caller.arguments[0];
                            // If "Clear" gets clicked, then really clear it
                            if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {
                                $(this).val('');
                            }
                        }
                    });
    var dealt = JSON.parse('{{dealt|safe}}')

    $(document).ready
        (
            function () {
                // to add action point in budget
                $("#addP").click(function (e) {
                    var table = document.getElementById("addworkpara");
                    e.preventDefault();
                    var row1 = table.insertRow();
                    var row1Count = 1;
                    Nlist++;
                    Plist.push(0)
                    var cell1 = row1.insertCell(0);
                    var cell2 = row1.insertCell(1);
                    var cell3 = row1.insertCell(2);
                    var cell4 = row1.insertCell(3);

                    full_array.push(String(Nlist))
                    console.log(full_array)
                    var heading = 'heading' + Nlist
                    var Hofficer = 'Hofficer' + Nlist
                    var divofficer = 'divofficer' + Nlist
                    var Htargetdate = 'Htargetdate' + Nlist
                    cell1.innerHTML =
                        '<div style="text-align: center; width:5px font-family:verdana;">' + Nlist + '</div>'
                    cell2.innerHTML =
                        '<td><textarea maxlength="500" id=' + heading + ' placeholder="Add Action Point.." style="height:auto;" class="form-control"/></textarea></td>';

                    str = '<td><div id=' + divofficer + '><select class="form-control" style="height:2em" id=' + Hofficer + ' name="mofficer" multiple required>'
                    for (var i = 0; i < dealt.length; i++) { str += '<option value="' + dealt[i] + '">' + dealt[i] + '</option>' }
                    str += '</select></div></td>'
                    cell3.innerHTML = str

                    cell4.innerHTML =
                        '<td><input type="text" class="form-control datepker" placeholder="dd/mm/yy" style="height:2em; width: 130px;" id=' + Htargetdate + ' readonly/></td>';


                    $(".datepker").datepicker({
                        showOn: 'focus',
                        dateFormat: 'dd/mm/yy',
                        showButtonPanel: true,
                        closeText: 'Clear',
                        minDate: 0,
                        onClose: function () {
                            var event = arguments.callee.caller.caller.arguments[0];
                            // If "Clear" gets clicked, then really clear it
                            if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {
                                $(this).val('');
                            }
                        }
                    });
                    console.log(full_array)
  console.log(Plist)
  console.log(SPlist)

                    $('#Hofficer' + Nlist).select2();
                });

                // to add sub-heading in budget
                $("#addSP").click(function (e) {
                    if (Plist.length == 0) {
                        alert('Please Add Action Point!')
                        return false;
                    }
                    var table = document.getElementById("addworkpara");
                    e.preventDefault();
                    var row = table.insertRow();
                    Plist[Nlist - 1] = Plist[Nlist - 1] + 1
                    let item = Nlist + '.' + String(Plist[Nlist - 1])
                    SPlist.push(0)
                    let Hofficer = 'Hofficer' + Nlist;
                    let divofficer = 'divofficer' + Nlist;
                    let Hpriority = 'Hpriority' + Nlist;
                    let Htargetdate = 'Htargetdate' + Nlist;
                    $('#' + Hofficer).hide();

                    $('#' + Htargetdate).empty();
                    $('#' + divofficer).hide();
                    $('#' + Hpriority).hide();
                    $('#' + Htargetdate).hide();

                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    var cell4 = row.insertCell(3);
                    //var cell5 = row.insertCell(4);
                    full_array.push(item)
                    item1 = Nlist + String(Plist[Nlist - 1])
                    var itemno = 'itemno' + item
                    var SHofficer = 'SHofficer' + item1
                    var subheading = 'subheading' + item
                    var SHpriority = 'SHpriority' + item1
                    var SHtargetdate = 'SHtargetdate' + item
                    var description = 'description' + item

                    cell1.innerHTML =
                        '<td><div style="text-align: center; width:5px font-family:verdana;" id=' + itemno + '>' + item + '</div></td>';
                    cell2.innerHTML =
                        '<td><textarea maxlength="500" id=' + subheading + ' placeholder="Add Details of work.." style="height:6em;" class="form-control"/></textarea></div><br></td>';

                    str = '<td><div><select class="form-control" style="height:2em" id=' + SHofficer + ' name="mofficer" multiple required>'

                    for (var i = 0; i < dealt.length; i++) { str += '<option value="' + dealt[i] + '">' + dealt[i] + '</option>' }
                    str += '</select></div></td>'

                    cell3.innerHTML = str

                    str += '</select></div></td>'
                    cell3.innerHTML = str
                    cell4.innerHTML =
                        '<td><input type="text" class="form-control datepker" placeholder="dd/mm/yy" style="height:2em; width: 130px;" id=' + SHtargetdate + ' readonly/></td>';


                    $(".datepker").datepicker({
                        showOn: 'focus',
                        dateFormat: 'dd/mm/yy',
                        showButtonPanel: true,
                        closeText: 'Clear',
                        minDate: 0,
                        onClose: function () {
                            var event = arguments.callee.caller.caller.arguments[0];
                            // If "Clear" gets clicked, then really clear it
                            if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {
                                $(this).val('');
                            }
                        }
                    });

                    $("textarea").each(function () { this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;"); }).on("input", function () {
                        this.style.height = "auto";
                        this.style.height = (this.scrollHeight) + "px";
                    }
                    );
                    $("#SHofficer" + item1).select2();
                    console.log(full_array)
                    console.log(Plist)
                    console.log(SPlist)
                });

                // to delete the item
                $('#delete').click(function (e) {
                    e.preventDefault();
                    if(!confirm('Are you sure you want to Delete the row!'))
                    {
                        return false;
                    }
                    var rowCount = $('#addworkpara tr').length;
                    var table = document.getElementById("addworkpara");
                    let val_id = table.rows[rowCount - 1].cells[0].innerText;
                    if (val_id != '') {
                        let val_split = val_id.split('.');
                        if (val_split.length > 1) {
                            let del_id = val_split[0] + '.' + '1';
                            if (del_id == val_id) {

                                let Hofficer = 'Hofficer' + val_split[0];
                                let divofficer = 'divofficer' + val_split[0];
                                let Hpriority = 'Hpriority' + val_split[0];
                                let Htargetdate = 'Htargetdate' + val_split[0];
                                $('#' + divofficer).show();
                                $('#' + Hofficer).show();
                                $('#' + Hpriority).show();
                                $('#' + Htargetdate).show();

                                $("textarea").each(function () { this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;"); }).on("input", function () {
                                    this.style.height = "auto";
                                    this.style.height = (this.scrollHeight) + "px";
                                });
                            }
                        }
                    }
                    j1 = rowCount;
                    if (j1 > 0) {
                        full_array.pop()
                        document.getElementById("addworkpara").deleteRow(-1);
                        if (Nlist > 0 && Plist[Nlist - 1] != 0) {
                            if (SPlist[SPlist.length - 1] == 0) {
                                SPlist.pop()
                                if (Plist[Nlist - 1] == 0) {
                                    Plist.pop()
                                    Nlist--;
                                }
                                else { Plist[Nlist - 1] = Plist[Nlist - 1] - 1 }
                            }
                            else { SPlist[SPlist.length - 1] = SPlist[SPlist.length - 1] - 1 }
                        }
                        else if (Nlist > 0 && Plist[Nlist - 1] == 0) {
                            if (Plist[Nlist - 1] == 0) {
                                Plist.pop()
                                Nlist--;
                            }
                            else {
                                Nlist
                                Plist[Nlist - 1] = Plist[Nlist - 1] - 1
                            }
                        }
                        j1--;
                    }
                });

            }
        );

</script>

<script>
    function Submit_draft() {
        var action = $('#action').val();
        var fin_yr = $('#year_id').val();
        var para_no = $('#para_id').val();
        var p_title = $('#p_title').val();
        let ar1 = {}
        let myarr2 = {}


        if (action == '' || action == null) {
            alert("Please Select Action from drop down!")
            return false;
        }

        if (fin_yr == '' || fin_yr == null) {
            alert("Please Select Financial Year present in Budget!")
            return false;
        }

        if (para_no == '' || para_no == undefined) {
            alert("Please fill Para Number of Budget!")
            return false;
        }

        if (p_title == '' || p_title == null) {
            alert("Please enter Pronouncement title for Budget!")
            return false;
        }

        if (full_array.length == 0) {
            alert("Please enter the Action Point and Sub Action Point")
            return false;
        }
        for (let i = 1; i <= Nlist; i++) {
            let ar = {}
            let myar1 = []
            for (let j = 0; j < full_array.length; j++) {
                if ((String(i) + '.') == ((String(full_array[j]).split('.'))[0]) + '.') {
                    let temp = full_array[j].split('.')
                    myar1.push(String(full_array[j]))
                    // for heading
                    if (temp.length == 1) {
                        // alert('For heading')
                        let hid = 'heading' + full_array[j];
                        var head = document.getElementById(hid).value;
                        if (head == '') {
                            alert('Please fill-in some information!')
                            return false;
                        }

                        let td = 'Htargetdate' + full_array[j];
                        let mf = 'Hofficer' + full_array[j];
                        //  alert(document.getElementById(mf).value, +'heyyyyyyyyyyyyy')

                        lenarr = full_array.length;
                        chk = 0;
                        if (j + 1 < lenarr)
                            if (full_array[j] + '.1' == full_array[j + 1])
                                chk = 1;
                        // alert(chk)

                        if (document.getElementById(mf).value == '' && chk == 0) {
                            // alert('please select mark officer!')
                            alert('Please mark concerned officer!')
                            return false;
                        }
                        var tddate = document.getElementById(td).value;
                        var options = document.getElementById(mf).selectedOptions;
                        var values = Array.from(options).map(({ value }) => value);
                        var officer_val = document.getElementById(mf).innerHTML = values;

                        ar[hid] = head
                        ar[td] = tddate
                        ar[mf] = officer_val

                    }
                    else if (temp.length == 2) {
                        x = (String(full_array[j]).split('.'))[0]
                        y = (String(full_array[j]).split('.'))[1]
                        Pitem = x + y
                        let shid = 'subheading' + full_array[j];
                        // let shdid= 'description'+full_array[j];
                        var subhead = document.getElementById(shid).value;
                        // var description=document.getElementById(shdid).value;
                        if (subhead == '') {
                            alert('Please add Sub-heading!')
                            return false;
                        }

                        let td = 'SHtargetdate' + full_array[j];
                        let mf = 'SHofficer' + Pitem;
                        //  print(mf, 'heyyyyyyyyyyyyy')
                        if (document.getElementById(mf).value == '') {
                            alert('Please mark Officer!')
                            return false;
                        }
                        var tddate = document.getElementById(td).value;
                        var options = document.getElementById(mf).selectedOptions;
                        var values = Array.from(options).map(({ value }) => value);
                        var officer_val = document.getElementById(mf).innerHTML = values;

                        ar[shid] = subhead
                        ar[td] = tddate
                        ar[mf] = officer_val

                    }
                }
            }
            ar1[String(i)] = ar
            myarr2[String(i)] = myar1
        }
        r = confirm('Are you sure you want to confirm!')
        if (r == false) {
            console.log("true");
            return false;
        }
        

        var final_p = JSON.stringify(ar1)
        var id_final = JSON.stringify(myarr2)
        $("#submit").attr("disabled", true);

        let data =
        {
            p_title: p_title,
            'action': action,
            //fin_yr: JSON.stringify($('#year_id').val()),
            'fin_yr': fin_yr,
            para_no: $('#para_id').val(),
            final_partinspected: final_p,
            id_partinspected: id_final,
            // copyto: JSON.stringify($('#copyto').val()),
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }
        // alert('end')
        $.ajax
            ({
                type: 'POST',
                url: "{% url 'create_budget_details' %}",
                dataType: 'json',
                data: data,
                success: function (response) {
                    alert("Record Saved");
                    $("#submit").attr("disabled", false);
                    // window.location.reload();
                    window.location.href = "{% url 'budget_implementation' %}";
                },
                error: function (exception) {
                    alert("An error occured while saving the record!");
                    $("#submit").attr("disabled", false);
                }

            });
    }



</script>


<script>
      function Savedraft_budget() {

var fin_yr = $('#year_id').val();
var para_no = $('#para_id').val();
var p_title = $('#p_title').val();
var action = $('#action').val();
let ar1 = {}
let myarr2 = {}

if (fin_yr == '' || fin_yr == null) {
    alert("Please Select Financial Year present in Budget!")
    return false;
}

if (para_no == '' || para_no == undefined) {
    alert("Please fill Para Number of Budget!")
    return false;
}
if (action == '' || action == null) {
    alert("Please Select Action from drop down!")
    return false;
}
if (p_title == '' || p_title == null) {
    alert("Please enter Pronouncement title for Budget!")
    return false;
}

if (full_array.length == 0) {
    alert("Please enter the Action Point and Sub Action Point")
    return false;
}
for (let i = 1; i <= Nlist; i++) {
    let ar = {}
    let myar1 = []
    for (let j = 0; j < full_array.length; j++) {
        if ((String(i) + '.') == ((String(full_array[j]).split('.'))[0]) + '.') {
            let temp = full_array[j].split('.')
            myar1.push(String(full_array[j]))
            if (temp.length == 1) {
                let hid = 'heading' + full_array[j];
                var head = document.getElementById(hid).value;
                if (head == '') {
                    alert('Please fill-in some information!')
                    return false;
                }
                let td = 'Htargetdate' + full_array[j];
                let mf = 'Hofficer' + full_array[j];
                var tddate = document.getElementById(td).value;
                var options = document.getElementById(mf).selectedOptions;
                var values = Array.from(options).map(({ value }) => value);
                var officer_val = document.getElementById(mf).innerHTML = values;

                ar[hid] = head
                ar[td] = tddate
                ar[mf] = officer_val

            }
            else if (temp.length == 2) {
                x = (String(full_array[j]).split('.'))[0]
                y = (String(full_array[j]).split('.'))[1]
                Pitem = x + y
                let shid = 'subheading' + full_array[j];
                var subhead = document.getElementById(shid).value;
                if (subhead == '') {
                    alert('Please add Sub-heading!')
                    return false;
                }

                let td = 'SHtargetdate' + full_array[j];
                let mf = 'SHofficer' + Pitem;
                var tddate = document.getElementById(td).value;
                var options = document.getElementById(mf).selectedOptions;
                var values = Array.from(options).map(({ value }) => value);
                var officer_val = document.getElementById(mf).innerHTML = values;

                ar[shid] = subhead
                ar[td] = tddate
                ar[mf] = officer_val
            }
        }
    }
    ar1[String(i)] = ar
    myarr2[String(i)] = myar1
}
var final_p = JSON.stringify(ar1)
var id_final = JSON.stringify(myarr2)
$("#draft").attr("disabled", true);

let data =
{
    'budget_id':$('#budget_id_id').val(),
    p_title: p_title,
    'fin_yr': fin_yr,
    para_no: $('#para_id').val(),
    final_partinspected: final_p,
    id_partinspected: id_final,
    'action': action,
    csrfmiddlewaretoken: '{{ csrf_token }}'
}
$.ajax
    ({
        type: 'POST',
        url: "{% url 'create_budget_draft_details' %}",
        dataType: 'json',
        data: data,
        success: function (response) {
            alert("Record save as a Draft");
            $("#draft").attr("disabled", false);
            window.location.reload();
        },
        error: function (exception) {
            alert("An error occured while saving the record!");
            $("#draft").attr("disabled", false);
        }

    });
}

</script>


<script>

function validatePara(e) {
    let para_no = e.value;
    $.ajax({
        type: 'GET',
        url: "{% url 'validatePara_ajax' %}",
        dataType: 'json',
        data: { para_no },
        success: function (response) {
            if (response == 'True') {
                alert('Para Number already exist')
            } else {

            }
        },
        error: function (exception) {

        }

    });
}


</script>


{% endblock %}