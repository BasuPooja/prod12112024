{% extends 'adminDash.html' %}
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Roster Draft List</title>
   
  <style type="text/css">
    table {
  counter-reset: section;
}

/* 
.select2-container--default .select2-selection--single{
    padding:6px;
    height: 37px;
    font-size: 1em;  
    position: relative;
} */
    
      </style>
</head>
<body>
  <div id="selectedDate" hidden>
    <label for="roster_id" >Roster id:</label>
    <input  value="{{roster_no}}" id="roster_no" readonly="readonly">

    <label for="fdate"style="text-align: left;margin-left:14.5%" >From Date:</label>
    <input  value="{{fdate}}" id="strtdt" readonly="readonly">
 
    <label for="tdate" style="text-align:right; margin-left:35%;" >To Date:</label>
    <input value="{{tdate}}" id="enddatedt" readonly="readonly"><br>
  </div>
<br>

  <form id="form" style="margin-left:24% ;text-align:center ;">
    <div class="container" id="container" style="text-align:center ;">
      <div class="row" style="text-align:center ;">

        
          <div  class="col-3" >
              <div class="form-group">
                <label style="width:8em">From Date:</label>
                <br>
                <input type="text" autocomplete="off" maxlength="10" placeholder="Select Date" class="form-control date_range"
                  id="date_range1" name="date_range1" readonly>
              </div>
            </div>
    
            <div class="col-md-3">
              <div class="form-group">
                <label style="width:10em">To Date:</label>
                <br>
                <input type="text" autocomplete="off" maxlength="10" placeholder="Select Date" class="form-control date_range"
                  id="date_range2" name="date_range2" readonly>
              </div>
            </div>
         
          <div class="form-group">
            <button type="button" class="btn btn-primary mb-2" id="search_filter"
              style="margin-left:5em; margin-top:2em" onclick="getFilterValueDraft()" ><i class="fa fa-search"></i>Search</button>
          
            <button type="submit" class="btn btn-secondary mb-2" type="reset" id="btnReset" value="submit"
              style="margin-top: 2em;" onclick="refreshPage()">Reset</button>
         
                <a href="{%url 'roster' %}"> <button type="button" style="margin-top: 1.4em; "class="btn btn-success" >Add New Roster</button></a>
          </div>
      </div>
    </div>
  </form><br><br>

    <div style="text-align: center;">
        <h3>List of Draft Roster </h3>
        
        <form class="form-horizontal" id="indexForm" style="margin-left:5%;margin-right:5%">
      <div class="table-responsive container-fluid" >
        
        <table class="table table-bordered table-striped table-highlight" id="userData1">
        <thead>
            <tr >
                <th style="text-align:center">Roster id</th>
                <th style="text-align:center">Created by</th>
                <th style="text-align:center">Created on</th>
                <th style="text-align:center">Start Date</th>
                <th style="text-align:center">End Date</th>
                <th style="text-align:center">Status</th>
                <th style="text-align:center">Action</th>
            </tr>
        </thead>
        <tbody>
            
        </tbody>
        </table>
      </div>

       
    </form>
    </div>

<script>

     
var table = $('#userData1').DataTable({
  
})

$(document).ready(function(){
 
    $.ajax({
                url:"{% url 'showDraftData1' %}",
                dataType: 'json',
                type:'GET',
                success: function(response){
                    table.destroy()
                    
                    for(i=0;i<response.user.length;i++){
                    var createdDate = new Date(response.user[i].created_on);
                    
                    var date = createdDate.toLocaleDateString();

                    var day = createdDate.getDate();
                    var month = createdDate.getMonth() + 1; //months are zero based
                    var year = createdDate.getFullYear();
                 
                    year = year - 2000;
                    
                    var created_on = day + '/' + month + '/' + year 

                        tdate=String(response.user[i].fromdate)+'@'+String(response.user[i].todate)
                        row='';
                        row+= `<tr>`
                          row+=`<td >${response.user[i].erosterid}</td>`
                           row+=`<td > ${response.user[i].created_by}</td>`
                           row+=`<td > ${created_on}</td>`
                           row+=`<td > ${response.user[i].fromdate}</td>`
                           row+=`<td > ${response.user[i].todate}</td>`
                           row+=`<td > ${response.user[i].status1}</td>`
                           row+=`<td>  

                            <button type="button"  class="btn btn-primary" data-toggle="popover" title="view draft"  onclick="dateform('${tdate}', '${response.user[i].erosterid}') "> <i class="fas fa-eye"></i></button></a>
                            <button type="button"  class="btn btn-primary"data-toggle="popover" title="edit draft" id="${response.user[i].erosterid}" onclick="edit(this)" > <i class="fas fa-pen"></i></button></a>
                            <button type="button"data-toggle="popover" title="delete draft" id="${response.user[i].erosterid}"onclick="delet1(this)" class="btn btn-danger"><i class="fas fa-trash-alt"></i></button></td>`
                            
                            row+=`</tr>`
                        
                        $('#userData1 tbody').append(row)
                         
                      }
                      table = $('#userData1').DataTable()
                }
            })

});

function dateform(val, erosterid)
{
  URL="{% url 'roster_draft' %}"+"?val="+val+'&erosterid='+erosterid;
  window.open(URL, '_blank');
  // window.location.href="{% url 'view_roster' %}"+"?val="+val;
  //$("#selectedDate").show()
}
function dateform2(val,erosterid)
{
  URL="{% url 'roster_details2' %}"+"?val="+val+'&erosterid='+erosterid;
  // window.location.href="{% url 'view_roster' %}"+"?val="+val;
  //$("#selectedDate").show()
}
var id=0;
// var detailid=0;
      function edit(U){
        id=U.id
        console.log(id)
        // alert(id)
        var data={
          'id':id,
        }
       $.ajax({
       type:"GET",
       dataType:"json",
       url:"{% url 'edit_details_draft' %}", 
       data:data,
       success:function(response){
        // alert("hi")
        console.log(response.user1)
        console.log('hiiiiiiiiiii')
      }
    })

  window.location.href="{% url 'roster' %}"+"?id="+id;
  //$("#selectedDate").show()
}

function addOfficer()
{
  $("#addofficer").show()
}               

function delet1(i)
 {
  let erosterid = i.id;
    //  alert(erosterid)
     console.log(erosterid)
     data={'erosterid':erosterid}
     r= confirm('Are you sure you want to delete the Data!')
      if(r==true){
        console.log("true")
        
        $.ajax
     ({
         url:'{% url "delet1" %}',
         dataType:'json',
         type:'GET',
         data:data,
         success :function(response)
         {
             alert("Your data is deleted.")
            window.location.reload()
         }
     })
      }
      else{
        window.location.reload();
      }
     
 } 
 $(function() {
  var currentdate= new Date();
    $( ".date_range" ).datepicker({ 
      // maxDate: currentdate,
      // minDate:0,
      autoclose:true,
      dateFormat: "dd/mm/yy",
      endDate:"currentdate",
      changeMonth : true,
      changeYear : true,
      todayHighlight: true,
      clearBtn : true 
    });
});


function getFilterValueDraft(){
    
    var date1 = $('#date_range1').val();
    var date2 = $('#date_range2').val();
    if(date1=="" && date2=="" ){
      alert("Enter date first to search")
    }
    // alert(date1)
    // var status=$('#status').val();
    // alert(date2)
    data = {'date1':date1,'date2':date2}
   
    $.ajax({
           url:'{% url "getFilterValueDraft" %}',
           dataType: 'json',
           type: 'GET',
           data: data,
           success: function(response)
           {
            // var table=$('#userData1').DataTable();
            table.destroy()
            $('#userData1 tbody').empty()
                    
                    for(i=0;i<response.user.length;i++){
                    var createdDate = new Date(response.user[i].created_on);
                    
                    var date = createdDate.toLocaleDateString();

                    var day = createdDate.getDate();
                    var month = createdDate.getMonth() + 1; //months are zero based
                    var year = createdDate.getFullYear();
                 
                    year = year - 2000;
                    
                    var created_on = day + '/' + month + '/' + year 
                    row='';
                        row+= `<tr>`
                           row+=`<td > ${response.user[i].erosterid}</td>`
                           row+=`<td > ${response.user[i].created_by}</td>`
                           row+=`<td > ${created_on}</td>`
                           row+=`<td > ${response.user[i].fromdate}</td>`
                           row+=`<td > ${response.user[i].todate}</td>`
                           row+=`<td > ${response.user[i].status1}</td>`

                            row+=`<td >  
                            <button type="button"  class="btn btn-primary" onclick="dateform('${tdate}') "> <i class="fas fa-eye"></i></button></a>
                            <button type="button"  class="btn btn-primary"data-toggle="popover" title="edit draft" id="${response.user[i].erosterid}" onclick="edit(this)" > <i class="fas fa-pen"></i></button></a>
                            <button type="button" id="${response.user[i].erosterid}"onclick="delet1(this)" class="btn btn-danger""><i class="fas fa-trash-alt"></i></button></td>`
                            
                            row+=`</tr>`
                        
                        $('#userData1 tbody').append(row)
                         
                      }
                      table = $('#userData1').DataTable()
                }
            })

          };

 function refreshPage() {
            location.reload();
        
    }


</script>
</body>
</html>
{% endblock content %}