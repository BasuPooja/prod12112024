{% extends 'base.html' %} 
{% block content %}
{% load static %}

<script type="text/javascript" src="{% static '/js/numscroll.js'%}"></script>
    <script type="text/javascript" src="{% static '/js/jquery.waypoints.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/js/jquery.animateNumber.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/js/jquery.easing.1.3.js'%}"></script>
    <script type="text/javascript">
        $(".sidebar").addClass('close');
      </script> 


<style>
    .modal-content{
    border: solid !important;
    border-width: 1px !important;
    }
    .modal-header{
    background-color: #0066cc !important;
    color: #fff;
    border-radius: inherit;
    }
    .close span{
    color: #fff !important;
    }
    .close span:hover{
    color: #fff !important;
    }
  .modal.left .modal-dialog,
  .modal.right .modal-dialog {
    position: fixed;
    margin: auto;
    width: 1500px;
    height: 100%;
    -webkit-transform: translate3d(0%, 0, 0);
    -ms-transform: translate3d(0%, 0, 0);
    -o-transform: translate3d(0%, 0, 0);
    transform: translate3d(0%, 0, 0);
  }

  .modal.left .modal-content,
  .modal.right .modal-content {
    height: 100%;
    overflow-y: auto;
  }

  .modal.left .modal-body,
  .modal.right .modal-body {
    padding: 15px 15px 80px;
  }

  /*Left*/
  .modal.left.fade .modal-dialog {
    left: -320px;
    -webkit-transition: opacity 0.3s linear, left 0.3s ease-out;
    -moz-transition: opacity 0.3s linear, left 0.3s ease-out;
    -o-transition: opacity 0.3s linear, left 0.3s ease-out;
    transition: opacity 0.3s linear, left 0.3s ease-out;
  }

  .modal.left.fade.show .modal-dialog {
    left: 0;
  }

  /*Right*/
  .modal.right.fade .modal-dialog {
    right: -320px;
    -webkit-transition: opacity 0.3s linear, right 0.3s ease-out;
    -moz-transition: opacity 0.3s linear, right 0.3s ease-out;
    -o-transition: opacity 0.3s linear, right 0.3s ease-out;
    transition: opacity 0.3s linear, right 0.3s ease-out;
  }

  .modal.right.fade.show .modal-dialog {
    right: 0;
  }

  /* ----- MODAL STYLE ----- */
  .modal-content {
    border-radius: 0;
    border: none;
  }

  .modal-header {
    border-bottom-color: #EEEEEE;
    background-color: #FAFAFA;
  }

  .modal-lg {
    max-width: 70% !important;
  }

</style>

<style>
  * {
      box-sizing: border-box;
    }
    .input,
    input[type=text]
    {
        width: 100%;
        padding: 12px 20px;
        margin: 2px 0;
        display: block;
        /* border: 1.5px solid rgb(14, 12, 12); */
        resize: vertical;
        border-radius: 4px;
        box-sizing: border-box;
    }
    input[type=submit] 
    {
        width: 40%;
        text-align: center;
        background-color: #4CAF50;
        color: rgb(15, 12, 12);
        padding: 14px 20px;
        margin: 2px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    input[type=submit]:hover 
    {
        background-color: #45a049;
        text-align: center;
    }
    input[type=button] 
    {
        width: 30%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 6px 6px;
        margin: 2px 2px 2px 2px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    input[type=button]:hover 
    {
        background-color: #45a049;
        text-align: center;
    }
    .inputtag
    {
        height:20px;
    }
    /* .container
    {
        width:1500px;
    } */

    input[type="radio"]
    {   margin: 0 5px 0 5px;    }
    div.bold-selected 
    {   font-weight: bold;  }

    tr.row_selected td{background-color:lightgrey !important;}


    .card1{
        /* box-shadow: 0 15px 25px rgba(129, 124, 124, 0.2); */
                /* border-radius: 5px; */
                /* backdrop-filter: blur(14px); */
                /* -webkit-box-reflect:below 2px linear-gradient(transparent, transparent, #0004); */
        
        transform-origin:center;
        transform: rotateY(15deg);
        transition:0.5s;
      }
  
      .stats-header{
        font-weight: 700;
        font-size: 25px;
        margin-bottom: 0%;
      }
      .stats-value{
        font-weight: 700;
        font-size: 45px;
      }

        .rb:hover .card1{
        opacity:0.5;
        }
        .rb .card1:hover  {
        transform:perspective(800px)       rotateY(0deg);
        opacity:1;
        }
</style>

<head>
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">  
</head>

<body>
    

    
    <div class="row" style="margin-bottom: 2%">
        <!-- <div class="col-3"></div> -->
        <div class="col-12" style="text-align:center !important;">
            <h2 class="report_heading"> Board Meeting Minutes</h2>
        </div>
        <!-- <div class="col-3"></div> -->
    </div>
    
    
    
    <div class="row mb-5 rb">
        <div class=" col-md-3 text-center">
            <div class="card1 text-white" style="border-radius: 15px;margin-left: 1%;" >
                <div class="card-body" id="0" style="background: radial-gradient(circle at 12.3% 19.3%, rgb(97, 100, 246) 0%, rgb(95, 209, 249) 100.2%);padding-bottom: 0%;padding-left: 0%;padding-right: 0%;padding-top: 0%;" onclick="momdone_filter(this)">
                    <div class="card-top">  
                        <p class="stats-header">All</p>
                    </div>
                    <div class="card-text">
                        <p class="stats-value statsfig">{{all}}</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 text-center">
            <div class="card1 text-white" style="margin-left: 1%;">
                <div class="card-body" id="4" style="background: linear-gradient(110.1deg, rgb(41, 222, 41) 2.9%, rgb(158, 241, 50) 90.3%);padding-bottom: 0%;padding-left: 0%;padding-right: 0%;padding-top: 0%;" onclick="momdone_filter(this)">
                    <div class="card-top">  
                        <p class="stats-header">Closed</p>
                    </div>
                    <div class="card-text">
                        <p class="stats-value statsfig" >{{closed}}</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 text-center">
            <div class="card1 text-white" style="margin-left: 1%;">
                <div class="card-body" id="2" style="background: radial-gradient(circle at 10% 20%, orange, rgb(247, 193, 65) 90%);padding-bottom: 0%;padding-bottom: 0%;padding-left: 0%;padding-right: 0%;padding-top: 0%;" onclick="momdone_filter(this)">
                    <div class="card-top">  
                        <p class="stats-header">Partial</p>
                    </div>
                    <div class="card-text">
                        <p class="stats-value statsfig" >{{partial}}</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 text-center">
            <div class="card1 text-white" style="margin-left: 1%;">
                <div class="card-body" id="1" style="background: linear-gradient(to right, rgb(241, 80, 52), rgb(240, 118, 96));padding-bottom: 0%;padding-bottom: 0%;padding-left: 0%;padding-right: 0%;padding-top: 0%;" onclick="momdone_filter(this)">
                    <div class="card-top">  
                        <p class="stats-header">Pending</p>
                    </div>
                    <div class="card-text">
                        <p class="stats-value statsfig">{{pending}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
   
    <div class="container" style="text-align: center; margin-bottom:5%;">
        <form method="POST">{%csrf_token%}
        <input id="dis_id" value="{{str}}" hidden>
        <div class="row">
            <div class="col-md-12 container-fluid"  >
                <div class="col mt-3" style="text-align:center;color: rgb(9, 9, 9);">
                    <a href="/create_mom_form" class="btn btn-primary"><b><i class='bx bx-plus-medical' ></i> Add New Meeting </b></a>
                </div>
            </div>
        </div>
        
        <div class="container" style="font-family:'Lato', sans-serif; overflow-x: auto;">
        <table id="doneTable" class="table table-bordered  table-data table-sm ">
            <thead>
                <tr>
                    <th >S.No.</th>
                    <th>MOM Date</th>
                    <th>MOM Note No.</th>
                    <th>MOM Title</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for i in mom_data %}
                <tr>
                    <td style= "text-align: left;">{{forloop.counter}}</td>
                    <td style= "text-align: left;">{{i.mom_date|date:"d/m/y"}}</td>
                    {% if i.status_flag == 1 %}
                        <td style= "text-align: left;"><a href="" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal('{{i.insp_no}}'); return false;" style="color:crimson">{{i.mom_note_no}}</a></td>
                    {% elif i.status_flag == 2 %}
                        <td style= "text-align: left;"><a href="" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal('{{i.insp_no}}'); return false;" style="color:crimson">{{i.mom_note_no}}</a></td>
                    {% elif i.status_flag == 3 %}
                        <td style= "text-align: left;"><a href="" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal('{{i.insp_no}}'); return false;" style="color:green">{{i.mom_note_no}}</a></td>
                    {% elif i.status_flag == 4 %}
                        <td style= "text-align: left;"><a href="" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal('{{i.insp_no}}'); return false;" style="color:green">{{i.mom_note_no}}</a></td>
                    {% else %}
                    {% endif %}
                    <td style= "text-align: left;">{{i.mom_title}}</td>
                    {% for x in list_mom_details %}
                        {% if x.insp == i.insp_no %}
                            {% if i.status_flag == 1 %}
                                <td style="text-align: center;"><a href="" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal('{{i.insp_no}}'); return false;" style="color:crimson">{{x.reply_status}}/{{x.total_status}}</a></td>
                            {% elif i.status_flag == 2 %}
                                <td style="text-align: center;"><a href="" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal('{{i.insp_no}}'); return false;" style="color:crimson">{{x.reply_status}}/{{x.total_status}}</a></td>
                            {% elif i.status_flag == 3 %}
                                <td style="text-align: center;"><a href="" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal('{{i.insp_no}}'); return false;" style="color:green">{{x.reply_status}}/{{x.total_status}}</a></td>
                            {% elif i.status_flag == 4 %}
                                <td style="text-align: center;"><a href="" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal('{{i.insp_no}}'); return false;" style="color:green">{{x.reply_status}}/{{x.total_status}}</a></td> 
                            {% else %}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>   
        </table> 
        </div>  
    </form> 
    </div>
    

    
    

    <div class="modal right fade" id="StatusModal" tabindex="-1" role="dialog" aria-labelledby="StatusModalLabel">
        <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title w-100 text-left" id="StatusModalLabel"><label id="note_no"></label></h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col" id="preiew_report_pdf" style="max-width: 100%; max-height: 100%;">
                            <!-- <div id="preiew_report_pdf"> -->
                                <iframe id="iframepreview1"  style="width:500px; height:740px;" frameborder="0"></iframe>
                            <!-- </div> -->
                        </div>
                        <div class="col">
                            <table class="table table-striped table-bordered center table-data" id="remarksTable" style="max-width: 100%; ">
                                <thead style="white-space: nowrap; text-align: left;">
                                    <th style="width: 10%">Item No.</th>
                                    <th style="width: 15%">Dealt By</th>
                                    <th style="width: 15%;">Reply Date</th>
                                    <th style="width: 55%;">Remarks</th>
                                    <th style="width: 5%;">File</th>  
                                </thead>
                                <tbody>
                                </tbody>
                            </table> 
                            <div id="preiew_reply_pdf">
                                <iframe id="iframepreview2"  style="width:500px; height:700px;" frameborder="0"></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- modal-body -->
        
        </div><!-- modal-content -->
        </div><!-- modal-dialog -->
    </div><!-- modal -->

</body>

<!-- script for datepicker -->
<script>

        

        function scrollCounter()
        {
        $('.statsfig').each(function () {
        $(this).prop('Counter', 0).animate({
        Counter: Number($(this).text()) },
        {
        duration: 500,
        easing: 'swing',
        step: function (now) {
            $(this).text(Math.ceil(now));
        }
        });
        });
        }

    $(function() 
    {
        $('input[name="filterdate"]').daterangepicker
        ({
            autoUpdateInput: false,
            defaultDate: null,
            maxDate: new Date(),
            locale: {   cancelLabel: 'Clear'    }
        });
    
        $('input[name="filterdate"]').on('apply.daterangepicker', function(ev, picker) 
        {
            $(this).val(picker.startDate.format('DD/MM/YYYY') + ' to ' + picker.endDate.format('DD/MM/YYYY'));
            if(picker.startDate.format('DD/MM/YYYY') == picker.endDate.format('DD/MM/YYYY'))
            {   $(this).val(picker.startDate.format('DD/MM/YYYY'))  }
            else
            {   $(this).val(picker.startDate.format('DD/MM/YYYY') + ' to ' + picker.endDate.format('DD/MM/YYYY'));  }
            $('.applyButtonClasses').click()
        });
    
        $('input[name="filterdate"]').on('cancel.daterangepicker', function(ev, picker) 
        {   $(this).val('');    });
    });

    $(document).ready(function()
{
scrollCounter();
});

</script>

<script>
    
    $( document ).ready
    (
       function() 
       {
            $('#doneTable').DataTable();
            $('#remarksTable').DataTable();
            $('#type').select2();
       }
    )

    function clear_filter(e)
    {
        window.location.href='{% url "rbmins" %}'
    }
 
    $("#doneTable tbody tr").on('click',function(event) 
    {
        $("#doneTable tbody tr").removeClass('row_selected');
        $(this).addClass('row_selected');
    });

    function momdone_filter(e)
    {
        var table = $('#doneTable').DataTable();
        table.destroy();
        $('#doneTable').hide();
        status=e.id;
        // var status=$('#status').val();
        // var date_mom=$('#filterdate').val();
        // if(date_mom=='' || date_mom==undefined)
        // {       alert("Data will be shown according to today's date.")    }
        // var d=$('#filterdate').data('daterangepicker').startDate;
        // var startDate = new Date(d);
        // startDate= startDate.getFullYear()+ '-' + (startDate.getMonth()+1) + '-' + startDate.getDate()
        // d=$('#filterdate').data('daterangepicker').endDate;
        // var endDate = new Date(d);
        // endDate=endDate.getFullYear() + '-' +(endDate.getMonth()+1) + '-' + endDate.getDate()
        // if($('#dis_id').val()=='NoRB')
        // {
        // var type=$('#type').val();
        data={
            // 'str':str,
            // 'meeting_type':type,
            'status':status,
            // 'startDate':startDate,
            // 'endDate': endDate
        }
        // }
        // else
        // {
        //     data={
        //     'str':str,
        //     'meeting_type':null,
        //     'status':status,
        //     'startDate':startDate,
        //     'endDate': endDate
        //     }
        // }
        console.log(data)
        $.ajax
        ({
            url: "{% url 'filterdata_ajax_pr' %}",
            method: "GET",
            dataType: "JSON",
            async: false,
            data: data,
            success:function (response)
            {
                let list_filter = response.list_filter;
                console.log(list_filter)
                let row = "";
                let head = 
                    `<thead>
                        <tr align=left>
                            <th width=5%>S.No.</th>
                            <th width=15%>MOM Date</th>
                            <th width=20%>MOM Note No</th>
                            <th width=55%>MOM Title</th>
                            <th width=5%>Status</th>
                        </tr>
                    </thead>`;
                for (let i = 0; i < list_filter.length; i++) 
                {
                    row += "<tr align=left>";
                    row += `<td>${list_filter[i]['sr_no']}</td>
                        <td>${list_filter[i]['mom_date']}</td>`;
                    
                    if(list_filter[i]['status']=='Pending')
                        row += `<td><a href="#" id="${list_filter[i]['insp_no']}" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal(this.id); " style="color:crimson">${list_filter[i]['mom_note_no']}</a></td>`;
                    else if(list_filter[i]['status']=='Partial')
                        row += `<td><a href="#" id="${list_filter[i]['insp_no']}" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal(this.id); " style="color:crimson">${list_filter[i]['mom_note_no']}</a></td>`;
                    else if(list_filter[i]['status']=='Completed')
                        row += `<td><a href="#" id="${list_filter[i]['insp_no']}" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal(this.id); " style="color:green">${list_filter[i]['mom_note_no']}</a></td>`;
                    else if(list_filter[i]['status']=='Closed')
                        row += `<td><a href="#" id="${list_filter[i]['insp_no']}" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal(this.id); " style="color:green">${list_filter[i]['mom_note_no']}</a></td>`;
                    
                    row += `<td>${list_filter[i]['mom_title']}</td>`;
    
                    if(list_filter[i]['status']=='Pending')
                        row += `<td><a href="#" id="${list_filter[i]['insp_no']}" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal(this.id); " style="color:crimson">${list_filter[i]['reply_status']}/${list_filter[i]['total_status']}</a></td>`;
                    else if(list_filter[i]['status']=='Partial')
                        row += `<td><a href="#" id="${list_filter[i]['insp_no']}" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal(this.id); " style="color:crimson">${list_filter[i]['reply_status']}/${list_filter[i]['total_status']}</a></td>`;
                    else if(list_filter[i]['status']=='Completed')
                        row += `<td><a href="#" id="${list_filter[i]['insp_no']}" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal(this.id); " style="color:green">${list_filter[i]['reply_status']}/${list_filter[i]['total_status']}</a></td>`;
                    else if(list_filter[i]['status']=='Closed')
                        row += `<td><a href="#" id="${list_filter[i]['insp_no']}" data-toggle="modal" data-target="#StatusModal" onclick="mom_modal(this.id); " style="color:green">${list_filter[i]['reply_status']}/${list_filter[i]['total_status']}</a></td>`;
                }
                $('#doneTable thead').remove();
                $('#doneTable tr').remove();
                $('#doneTable').append(head);
                $('#doneTable tbody').append(row);
                $('#doneTable').show();
                $('#doneTable').DataTable();
            }

        })
    }

    function mom_modal(e)
    {
        $('#iframepreview2').hide();
        data=
        {
          'insp_no':e
        }
        $.ajax
        ({
            url: "{% url 'mom_modal_ajax' %}",
            method: "GET",
            dataType: "JSON",
            async: false,
            data: data,
            success: function (response) 
            {
                document.getElementById('note_no').innerHTML = response.note_no;
                reply_details=response.item_details;
                let row = "";
                let head = 
                    `<thead>
                        <tr align="left">
                            <th style="width: 10%">Item No.</th>
                            <th style="width: 15%">Dealt By</th>
                            <th style="width: 15%;">Reply Date</th>
                            <th style="width: 55%;">Remarks</th>
                            <th style="width: 5%;">File</th> 
                        </tr>
                    </thead>`;
                for (let i = 0; i < reply_details.length; i++) 
                {
                    row += "<tr>";
                    row += 
                        `<td width=10%>${reply_details[i]['item_no']}</td>
                        <td width=15%>${reply_details[i]['marked_to']}</td>
                        <td align="left" width=10%>${reply_details[i]['reply_on']}</td>`;
                    // if(reply_details[i]['status_flag']==1)
                    // {
                    //     row +=
                    //         `<td width=15% style="color:red">${reply_details[i]['marked_to']}</td>
                    //         <td align="left" width=10%>-</td>`;
                    // }
                    // else
                    // {
                    //     row +=
                    //         `<td width=15% style="color:green">${reply_details[i]['marked_to']}</td>
                    //         <td align="left" width=10% style="color:green">${reply_details[i]['reply_on']}</td>`;
                    // }
                    if(reply_details[i]['text']!='' && reply_details[i]['file']!='')
                    {
                        row+=`<td width=55% style="color:green">${reply_details[i]['text']}</td>
                        <td width=5%><a href="#" onclick="show_reply_file('${reply_details[i]['file']}')"><i class="fa fa-paperclip" aria-hidden="true"></i></a></td>`;
                    }
                    else if(reply_details[i]['text']!='' && reply_details[i]['file']=='')
                    {
                        row+=`<td width=55% style="color:green">${reply_details[i]['text']}</td>
                        <td width=5% style="color:crimson">-</td>`;
                    }
                    else if(reply_details[i]['text']=='' && reply_details[i]['file']!='')
                    {
                        row+=`<td width=55% style="color:crimson">-</td>
                        <td width=5%><a href="#" onclick="show_reply_file('${reply_details[i]['file']}')" ><i class="fa fa-paperclip" aria-hidden="true"></i></a></td>`;;
                    }
                    else if(reply_details[i]['text']=='' && reply_details[i]['file']=='')
                    {
                        row+=`<td width=55% style="color:crimson">-</td>   
                        <td width=5% style="color:crimson">-</td>`;
                    }
                    row += "</tr>";
                } 
                $('#remarksTable thead').remove();
                $('#remarksTable tr').remove();
                $('#remarksTable').append(head);
                $('#remarksTable tbody').append(row);
                $('#remarksTable').show();
                $('#remarksTable').DataTable();
            }
        })
        pdf='preiew_report_pdf';
        file = "/mom_ReportPdf/"+e;
        $('#iframepreview1').attr('src', file);
    }

    function show_reply_file(e)
    {
        // alert(e)
        $('#iframepreview2').show();
        pdf='preiew_reply_pdf';
        file = e;
        $('#iframepreview2').attr('src', file);
    }

</script>

{% endblock %}
                
