{% extends 'base.html' %}
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Complience Form</title>
  <script src="{% static '/js/jquery-3.4.1.min.js' %}"></script>
  <script src="{% static '/js/popper.min.js' %}"></script>
  <script src="{% static '/js/Chart.min.js' %}"></script>
  <script src="{% static '/js/jquery-3.3.1.slim.min.js' %}"></script>
  <script src="{% static '/js/bootstrap.min.js' %}"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
  <script src="{% static '/js/jquery-ui.js' %}"></script>
  <script src="{% static '/js/jquery-1.12.4.js' %}"></script>
  <script src="{% static '/js/select2.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
  <script src="{% static '/js/moment.min.js' %}"></script>
  <script src="{% static '/js/jquery-3.3.1.js' %}"></script>
  <script src="{% static '/js/sweetalert.min.js' %}"></script>
  <script src="{% static '/js/jquery.min.js' %}"></script>
  <script src="{% static '/js/bootstrap.min1.js' %}"></script>
  <script src="{% static '/js/jquery.min1.js' %}"></script>
  <script src="{% static '/js/jquery-ui.min.js' %}"></script>
  <script src="{% static '/js/jspdf.min.js' %}"></script>
  <script src="{% static '/DataTables/datatables.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/DataTables/datatables.min.css' %}" />



  <link rel="stylesheet" type="text/css" href="{% static '/css/bootstrap.min.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static '/css/jquery-ui.css' %}" />

  <script src="{% static '/js/jquery.timepicker.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/css/jquery.timepicker.min.css' %}" />

  <!-- swasti link -->

  <script type="text/javascript" src="{% static '/daterangepicker-master/moment.min.js'%}"></script>
  <script type="text/javascript" src="{% static '/datepicker-master/moment.min.js'%}"></script>
  <script type="text/javascript" src="{% static '/daterangepicker-master/daterangepicker.js'%}"></script>

  <link rel="stylesheet" type="text/css" href="{%static '/daterangepicker-master/daterangepicker.css'%}" />
  <!-- <link href="https://cdnjs.cl
  ps://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"> -->

  <link rel="stylesheet" type="text/css" href="{% static '/css/forms_common.css' %}" />


</head>
<style>
  input {
    border: 1px solid transparent;
    background-color: #f1f1f1;
    padding: 10px;
    font-size: 16px;
  }

  input[type=text] {
    background-color: #f1f1f1;
    width: 100%;
  }


  .autocomplete-items {
    position: absolute;
    border: 1px solid #d4d4d4;
    border-bottom: none;
    border-top: none;
    z-index: 99;
    /*position the autocomplete items to be the same width as the container:*/
    top: 100%;
    left: 0;
    right: 0;
  }

  .autocomplete-items div {
    padding: 10px;
    cursor: pointer;
    background-color: #fff;
    border-bottom: 1px solid #d4d4d4;
  }

  /*when hovering an item:*/
  .autocomplete-items div:hover {
    background-color: #e9e9e9;
  }

  /*when navigating through the items using the arrow keys:*/
  .autocomplete-active {
    background-color: DodgerBlue !important;
    color: #ffffff;
  }
</style>


<body>

  <div>
    <h3 id="h6" class="report_heading">Deficiency Report</h3>
  </div>

  <div class="container">

    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#defaultId" onclick="setTypeValue('byMe');">Reported By Me</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#defaultId" onclick="setTypeValue('byOthers');">Reported By Others</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#defaultId" onclick="setTypeValue('forByMe');">Forwarded By Me</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#defaultId" onclick="setTypeValue('forToMe');">Forwarded To Me</a>
      </li>
    </ul>

    <div class="tab-content">
      <div id="defaultId" class="container-fluid  tab-pane active">
      <form id="form">
        <div class="container inpt-container mt-5" id="filterForm">
          <div class="row">
            <div class="col-lg-2">
              <div class="form-group">
                <label class="lbl-caption">Date Wise</label>
                <input readonly type="text" autocomplete="off" placeholder="Select Date Range"
                  class="form-control dateofInsp" name="dateofInsp" id="date1">
              </div>
            </div>

            <div class="col-lg-2">
              <div class="form-group">
                <label class="lbl-caption">Reported By</label>
                <select class="form-control" data-live-search="true" id="reportedby" data-actions-box="true">
                  <option value="Select">All</option>
                  {% for i in rep_by %}
                  <option value="{{i.designation}}">{{i.designation}}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <div class="col-lg-2">
              <div class="form-group">
                <label class="lbl-caption">Action By</label>
                <select class="form-control" data-live-search="true" id="actionby" data-actions-box="true">
                  <option value="Select">All</option>
                  {% for i in desg_no %}
                  <option value="{{i.designation}}">{{i.designation}}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <div class="col-lg-2">
              <div class="form-group">
                <label class="lbl-caption">Priority</label>
                <select class="form-control" id="prio" data-live-search="true">
                  <option value="Select">All</option>
                  <option value="Low">Low</option>
                  <option value="High">High</option>
                  <option value="Medium">Medium</option>
                </select>
              </div>
            </div>

            <div class="col-lg-2">
              <div class="form-group autocomplete">
                <label id="inspcode" class="lbl-caption">Status</label>
                <select class="form-control" id="status" data-live-search="true" data-actions-box="true">
                  <option value="Select">All</option>
                  <option value="Pending">Pending</option>
                  <option value="Closed">Closed</option>
                </select>
              </div>
            </div>

            <div class="col-lg-2 col-md-12 col-sm-12 ">
              <div class="row text-center">
                <div class="form-group mx-auto">
                  <div class="btn-toolbar mx-1" role="toolbar">
                    <div class="btn-group" role="group">
                      <button type="button" class="btn btn-warning btn-sm" type="reset" id="btnReset"
                        style="margin-top:15px ;white-space: normal; word-wrap: break-word;" value="submit"
                        onclick="searchCompliance()">Continue</button>
                      <button type="button" class="btn btn-secondary btn-sm" type="reset" id="btnReset"
                        style="margin-top:15px ;white-space: normal; word-wrap: break-word;" value="submit"
                        onclick="myFunction()">Reset</button>
                    </div>
                  </div>

                  <div class="btn-toolbar mx-1 " role="toolbar">
                    <div class="btn-group" role="group">
                      <button type="button" name="submitpdf" id="submitpdf"
                        style="margin-top:15px ;white-space: normal; word-wrap: break-word;" class="btn btn-danger btn-sm"
                        value="PDF" onclick="pdfShow()">PDF <i class="fa fa-file-pdf"></i></button>
                      <button type="button" name="submitexcel"
                        style="margin-top:15px ;white-space: normal; word-wrap: break-word;" id="submitexcel"
                        class="btn btn-success btn-sm" value="excel" onclick="excelShow()">Excel <i
                          class="fa fa-file-excel"></i></button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </form>

      <div class="container mt-5">
        <div class="row"
          style="background-image: radial-gradient(circle farthest-side, #fceabb, #f8b500);  color: black ;font-weight: bold;height: 40px; vertical-align: middle;">
          <div class="col-lg-6 my-1">
            <div class="row ml-1">
              Show
              <div class="col-lg-5">
                <select name="category" class="form-control-sm" id="selectedCategory" style="width:100%;">
                  <option value="" selected="selected" disabled>Select</option>
                  <option>10</option>
                  <option>50</option>
                </select>
              </div>
              Entries
            </div>
          </div>

          <div class="col-lg-6 my-1">
            <div class="row float-right mr-2">
              <button class="btn btn-sm bg-white mr-2" style="height:30px; margin-top: 2px;" type="button"
                id="filterButton" value="filter" onclick="show_filters(this.val)">
                <i class="fa fa-filter fa-sm"></i>
                Toggle Filter
              </button>

              <div class="form-inline float-right">
                <div>
                  <input type="text" class="form-control form-control-sm" id="myInput" placeholder="Search Text...">
                </div>
                <div>
                  <i class="fa-solid fa-print my-2 mx-2" onclick="window.print();"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <table style="width: 100%;" class="table table-sm table-hover table-bordered table-data" id="show_details">
        <thead>
          <tr>
            <th scope="col">Reported On</th>
            <th scope="col" style="width: 30%;">Deficiency</th>
            <th scope="col">Reported By</th>
            <th scope="col" style="width: 20%;">Inspection Type</th>
            <th scope="col">Action By</th>
            <th scope="col" style="width: 20%;">Remarks</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody id="details121"> </tbody>
      </table>
  </div>
  
  </div>
</div>
  
<div class="modal fade" id="Modal1" role="dialog" aria-labelledby="userModal" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="report_heading" id="userModal">Update Status</h3>
          <button class="btn close" type="button" data-dismiss="modal" aria-label="close" style="color:black;"><span
              class="glyphicon glyphicon-remove">&times;</span></button>
        </div>
        <div class="modal-body">
          <div id="byMeDetails">
            <form method="GET" id="remarks1">
              <div class="form-group row">
                <div class="col-sm-12">
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="modalStatus" id="pending" value="pending"
                      onclick="getPendingDetails('pending')" checked>
                    <label class="form-check-label" for="pending">Give Target</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="modalStatus" id="close" value="close"
                      onclick="getCloseDetails('close')">
                    <label class="form-check-label" for="close">Close</label>
                  </div>

                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="modalStatus" id="revertBack" value="revertBack"
                      onclick="getRevertDetails('revert')">
                    <label class="form-check-label" for="revertBack">Revert Back</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="modalStatus" id="forwardTo" value="forwardTo"
                      onclick="getForwardDetails('forward')">
                    <label class="form-check-label" for="forwardTo">Forward To</label>
                  </div>

                </div>
              </div>
              <div class="form-group" id="hidePending">
                <label for="form-check-input">Will be completed by </label>
                <div class="col-sm-5">
                  <input type="text" autocomplete="off" placeholder="dd/mm/yyyy" class="form-control modaldate"
                    id="modalDate" name="modalDate">
                </div>
              </div>
              <div class="form-group" id="hideClose" style="display: none;">
                <div class="md-10">
                  <label for="remarks" style="font-size:20px;color:black;">Remarks</label><br>
                  <textarea class="form-control" name="modalremarks" placeholder="Give Remarks" id="modalremarks" cols="55" rows="2"></textarea>
                </div>
              </div>

              <div class="form-group" id="hideRevertBack" style="display: none;">
                <div class="row">
                  <div class="col-md-12">
                  <label for="revertremarks" style="font-size:20px;color:black;">Revert Remarks</label><br>
                  <textarea class="form-control" name="revertremarks" id="revertremarks" placeholder="Give Remarks" maxlength="500" cols="55" rows="2"></textarea>
                </div>
              </div>
              </div>

              <div class="form-group" id="hideForwardTo" style="display: none;">
                <div class="row">
                <div class="col-md-12">

                  <label for="forwardToId" style="font-size:20px;color:black;">Forward To Id</label><br>
                  <select class="form-control" name="forwardToId" id="forwardToId">
                    <option selected disabled hidden value="">Select Officer To Forward</option>
                  </select>
                 
                </div>
                <div class="col-md-12">
                  <label for="forwardToRemarks" style="font-size:20px;color:black;">Forward To Remarks</label><br>
                  <textarea class="form-control" name="forwardToRemarks" maxlength="500" placeholder="Give Remarks" id="forwardToRemarks" cols="55" rows="2"></textarea>
                </div>
              </div>
              </div>


              <!-- <input type="text" id="remarks"><br> -->
              <!-- <label for="rlyorg" style="font-size:20px;color:black;">rlyorg</label><br> -->
              <input type="text" id="rlyorg" name="rlyorg" readonly="true" hidden><br>
            </form>
          </div>
          <div id="fromMeDetails">
            <table id="fromMeDetailsTable" style="width: 100%;"
              class="table table-sm table-hover table-bordered table-data">
              <thead>
                <tr>
                  <th colspan="6" style="text-align: center;">Previous Details</th>
                </tr>
                <tr>
                  <th>From Designation</th>
                  <th>Date</th>
                  <th>Remarks</th>
                  <th>To Designation</th>
                  <th>Compliance</th>
                  <th>Compliance Date</th>
                </tr>
              </thead>
              <tbody>

              </tbody>
            </table>
          </div>
          <button type="button" id="updateSubmit" onclick="updateEinsp()" class="btn btn-primary bt-sm"
            style="margin-top:5px; margin-left: 309px; padding: 3px 8px 3px 8px;">Submit</button>
          <button id="remarkSubmit" class="btn btn-secondary btn-sm" type="button" data-dismiss="modal"
            style="margin-top:5px;  padding: 3px 8px 3px 8px;" aria-label="close">Close</button>
        </div>
      </div>
    </div>
</div>

<div id="byMeModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-xl">
      <div class="modal-content">
          <div class="modal-header">
              <h3
                  style="text-align: center; font-weight: bold; color: black;">
                  Reported By Me</h3>
                  <button class="btn close" type="button" data-dismiss="modal" aria-label="close" style="color:black;"><span
                    class="glyphicon glyphicon-remove">&times;</span></button>
          </div>
          <div class="modal-body">
            <input type="text" id="byMeId" name="byMeId" readonly="true" hidden><br>
              <div class="col-lg-12 ">
                  <form action="" method="POST"
                      enctype="multipart/form-data">
                      {% csrf_token %}

                      <div class="form-group" id="hideRequestBy" style="display: none;">
                        <div class="row">
                        <div class="col-md-12">
                          <label for="forwardToId1" style="font-size:20px;color:black;">Forward To Officer</label><br>
                          <select class="form-control" name="forwardToId1" id="forwardToId1">
                            <option selected disabled hidden value="">Select Officer To Forward</option>
                          </select>
                         
                        </div>
                        <div class="col-md-12">
                          <label for="forwardToRemarks1" style="font-size:20px;color:black;">Remarks</label><br>
                          <textarea class="form-control" name="forwardToRemarks1" maxlength="500" id="forwardToRemarks1" cols="55"
                            rows="1" placeholder="Enter Remarks"></textarea>
                        </div>
                      </div>
                      </div>

                      <table id="requestByMeTable" style="width: 100%;"
                          class="table table-sm table-hover table-bordered table-data">
                          <thead>
                            <tr>
                              <th colspan="6" style="text-align: center;">Previous Details</th>
                            </tr>
                            <tr>
                              <th>From Designation</th>
                              <th>Date</th>
                              <th>Remarks</th>
                              <th>To Designation</th>
                              <th>Compliance</th>
                              <th>Compliance Date</th>
                            </tr>
                          </thead>
                          <tbody>

                          </tbody>
                      </table>
                  </form>
                 
              </div>
          </div>
          <div class="modal-footer">
            <button type="button" name="proceed" id="proceed" onclick="updateForwarded();" class="btn btn-primary">Forward</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>


<div id="forByMeModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-xl">
      <div class="modal-content">
          <div class="modal-header">
              <h3
                  style="text-align: center; font-weight: bold; color: black;">
                  Forwarded By Me</h3>
                  <button class="btn close" type="button" data-dismiss="modal" aria-label="close" style="color:black;"><span
                    class="glyphicon glyphicon-remove">&times;</span></button>
          </div>
          <div class="modal-body">
            <input type="text" id="forMeId" name="forMeId" readonly="true" hidden><br>
              <div class="col-lg-12 ">
                  <form action="" method="POST"
                      enctype="multipart/form-data">
                      {% csrf_token %}


                      <table id="requestForByMeTable" style="width: 100%;"
                          class="table table-sm table-hover table-bordered table-data">
                          <thead>
                            <tr>
                              <th colspan="7" style="text-align: center;">Forwarded Details</th>
                            </tr>
                            <tr>
                              <th>From Designation</th>
                              <th>Date</th>
                              <th>Remarks</th>
                              <th>To Designation</th>
                              <th>Compliance</th>
                              <th>Compliance Date</th>
                             
                            </tr>
                          </thead>
                          <tbody>

                          </tbody>
                      </table>
                  </form>
                 
              </div>
          </div>
          <div class="modal-footer">
            <!-- <button type="button" name="proceed" id="proceed" onclick="updateForwarded();" class="btn btn-primary">Forward</button> -->
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>


<div id="forToMeModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-xl">
      <div class="modal-content">
          <div class="modal-header">
              <h3
                  style="text-align: center; font-weight: bold; color: black;">
                  Forwarded To Me</h3>
                  <button class="btn close" type="button" data-dismiss="modal" aria-label="close" style="color:black;"><span
                    class="glyphicon glyphicon-remove">&times;</span></button>
          </div>
          <div class="modal-body">
            <input type="text" id="forToMeId" name="forToMeId" readonly="true" hidden><br>
              <div class="col-lg-12 ">
                  <form action="" method="POST"
                      enctype="multipart/form-data">
                      {% csrf_token %}

                      <div class="row" id="forToMeDiv">
                        <div class="col-md-6">
                          <textarea class="form-control" name="forwardToMeRemarks" maxlength="500" placeholder="Give Compliance" id="forwardToMeRemarks" cols="55" rows="1"></textarea>
                        </div>
                        <div class="col-md-6">
                          <button type="button"  onclick="updateForwardToMeData('accept');" class="btn btn-primary">Accept</button>
                          <button type="button"  onclick="updateForwardToMeData('reject');" class="btn btn-secondary">Revert</button>

                        </div>
                      </div>
<br><br>
                      <table id="requestForToMeTable" style="width: 100%;"
                          class="table table-sm table-hover table-bordered table-data">
                          <thead>
                            <tr>
                              <th colspan="7" style="text-align: center;">Forwarded Details</th>
                            </tr>
                            <tr>
                              <th>From Designation</th>
                              <th>Date</th>
                              <th>Remarks</th>
                              <th>To Designation</th>
                              <th>Compliance</th>
                              <th>Compliance Date</th>
                            </tr>
                          </thead>
                          <tbody>
                          </tbody>
                      </table>
                  </form>
                 
              </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>

<script>
  var typeValue = 'byMe';
  function show_filters(val) {
    $('#filterForm').toggle();
  }
  function setTypeValue(val) {
    typeValue = val;
    searchCompliance();
  }


  $(document).ready(function () {
    $("#myInput").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#details121 tr").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });

    });
    var s = 0;
    $("#details121").empty();
    searchCompliance();
  });

  function pdfShow() {
    var date1 = $('#date1').val();
    var reportedby = $('#reportedby').val();
    var prio = $('#prio').val();
    var actionby = $('#actionby').val();
    var status = $('#status').val();
    submitbtn = $('#submitpdf').val();
    // alert(submitbtn)
    window.open("{% url 'DeficiencyReportpdf' %}" + "?date=" + date1 + "&reportedby=" + reportedby + '&prio=' + prio + '&actionby=' + actionby + '&status=' + status + '&submitbtn=' + submitbtn + '&_blank');
  }
  function excelShow() {
    var date1 = $('#date1').val();
    var reportedby = $('#reportedby').val();
    var prio = $('#prio').val();
    var actionby = $('#actionby').val();
    var status = $('#status').val();
    submitbtn = $('#submitexcel').val();
    // alert(submitbtn)
    window.location.href = "{% url 'DeficiencyReportpdf' %}" + "?date=" + date1 + "&reportedby=" + reportedby + '&prio=' + prio + '&actionby=' + actionby + '&status=' + status + '&submitbtn=' + submitbtn;
  }
  function searchCompliance() {
    var s = 0;
    var date1 = $('#date1').val();
    var reportedby = $('#reportedby').val();
    var prio = $('#prio').val();
    var actionby = $('#actionby').val();
    var status = $('#status').val();
    data = { 'date': date1, 'reportedby': reportedby, 'actionby': actionby, 'status': status, 'prio': prio, valType: typeValue }
    $("#details121").empty();
    $.ajax
      ({
        url: '{% url "searchCompliance" %}',
        dataType: 'json',
        type: 'GET',
        data: data,
        success: function (response) {
          table = $('#show_details').DataTable(
          );
          table.destroy();


          let headRow = `<tr>
              <th scope="col">Reported On</th>
              <th scope="col" style="width: 30%;">Deficiency</th>
              <th scope="col">Reported By</th>
              <th scope="col" style="width: 20%;">Inspection Type</th>`
          if(typeValue == 'byMe' || typeValue == 'byOthers') 
          {  
            headRow += `<th scope="col">Action By</th>
              <th scope="col" style="width: 20%;">Remarks</th>
              <th scope="col">Action</th>
            </tr>`;
          }
          else if(typeValue == 'forByMe')
          {
            headRow += `<th scope="col" style="width: 10%;">Forwarded To</th>
                      <th scope="col" style="width: 10%;">Forwarded On</th>
                      <th scope="col" style="width: 20%;">Remarks</th>
                      <th scope="col">Action</th>
                    </tr>`;
          }

          else
          {
            headRow += `<th scope="col" style="width: 10%;">Forwarded By</th>
                      <th scope="col" style="width: 10%;">Forwarded On</th>
                      <th scope="col" style="width: 20%;">Remarks</th>
                      <th scope="col">Action</th>
                    </tr>`;
          }



          $('#show_details tbody').empty();
          $('#show_details thead').empty();
          $('#show_details thead').append(headRow)
          row = '';
          for (i in response.details) {
            s = s + 1;
            row += `<tr>
                      <td>${response.details[i].date}</td>`
            if (response.details[i].pr == "Low") {
              row += `<td><a href="#" style="color:green;" data-toggle="tooltip" data-placement="right" title="Low Priority">${response.details[i].rem}</a></td>`
            }
            else if (response.details[i].pr == "Medium") {
              row += `<td><a href="#" data-toggle="tooltip" style="color:orange;" data-placement="right" title="Medium Priority">${response.details[i].rem}</a></td>`
            }
            else if (response.details[i].pr == "High") {
              row += `<td><a href="#" data-toggle="tooltip" style="color:red;" data-placement="right" title="High Priority">${response.details[i].rem}</a></td>`
            }
            else {
              row += `<td>${response.details[i].rem}</td>`
            }
            row += `<td>${response.details[i].repo}</td>
                            
            <td>${response.details[i].loc} Inspection of ${response.details[i].entdet} ${response.details[i].entid}</td>`



            if(typeValue == 'byMe') 
            {
              row += `<td>${response.details[i].act}</td>
                            <td>${response.details[i].st}: ${response.details[i].comp}</td>
                            <td><button  type="button" id="bymei,${i}" onclick="actionEinspByMe(this)" class="btn btn-secondary" data-toggle="modal" data-target="#byMeModal"><i class="fas fa-pen"></i></button></td>`
         
            }
            else if(typeValue == 'byOthers')
            {
              row += `<td>${response.details[i].act}</td>
                            <td>${response.details[i].st}: ${response.details[i].comp}</td>
                            <td><button  type="button" id="einsp,${i}" onclick="actionEinsp(this)" class="btn btn-secondary" data-toggle="modal" data-target="#Modal1"><i class="fas fa-pen"></i></button></td>`
         
            }
            else if(typeValue == 'forByMe')
          {
            d1 = (response.details[i].designationTo).split('@$@')
            d2 = (response.details[i].created_date).split('@$@')
            d3 = (response.details[i].st).split('@$@')
            d4 = (response.details[i].comp).split('@$@')
            row += `<td colspan="3"><table border="0"><tbody>`
                
                for(let ij=0;ij<d1.length;ij++)
                {
                  row += `<tr>
                          <td style="width: 25%;">${d1[ij]}</td>
                          <td style="width: 25%;">${d2[ij]}</td>
                          <td style="width: 50%;">${d3[ij]} - ${d4[ij]}</td>
                  </tr>`
                }
                  row += `</tbody></table></td>
                          <td hidden></td>
                            <td hidden></td>
                            <td><button  type="button" id="forme,${i}" onclick="actionEinspForByMe(this)" class="btn btn-secondary" data-toggle="modal" data-target="#forByMeModal"><i class="fas fa-pen"></i></button></td>`
         
          }

            else
          {
            row += `<td>${response.details[i].designationTo}</td>
                          <td>${response.details[i].created_date}</td>
                            <td>${response.details[i].st}: ${response.details[i].comp}</td>
                            <td><button  type="button" id="forto,${i}" onclick="actionEinspForToMe(this)" class="btn btn-secondary" data-toggle="modal" data-target="#forToMeModal"><i class="fas fa-pen"></i></button></td>`
         
          }
       
            row += `</tr>`;
            


          }
          console.log(row)
            $('#show_details tbody').append(row);
          table = $('#show_details').DataTable({
            pageLength: 10,
            "lengthChange": false,
            searching: false,
            pagingType: "simple",
            "language": {
              "info": "Page _PAGE_ of _PAGES_",

            },
            "order": [[0, 'desc']]
          });
        }
      })
  }
  
  function myFunction() {
    var s = 0;
    $("#details121").empty();
    var data = {
      valType: typeValue
    }
    $.ajax
      ({
        url: '{% url "showCompliance" %}',
        dataType: 'json',
        type: 'GET',
        data: data,
        success: function (response) {
          table = $('#show_details').DataTable(
          );
          table.destroy();
          let headRow = `<tr>
              <th scope="col">Reported On</th>
              <th scope="col" style="width: 30%;">Deficiency</th>
              <th scope="col">Reported By</th>
              <th scope="col" style="width: 20%;">Inspection Type</th>`
          if(typeValue == 'byMe' || typeValue == 'byOthers') 
          {  
            headRow += `<th scope="col">Action By</th>
              <th scope="col" style="width: 20%;">Remarks</th>
              <th scope="col">Action</th>
            </tr>`;
          }
          else if(typeValue == 'forByMe')
          {
            headRow += `<th scope="col" style="width: 10%;">Forwarded By</th>
                      <th scope="col" style="width: 10%;">Forwarded On</th>
                      <th scope="col" style="width: 20%;">Remarks</th>
                      <th scope="col">Action</th>
                    </tr>`;
          }

          else
          {
            headRow += `<th scope="col">Forwarded By</th>
                      <th scope="col">Forwarded On</th>
                      <th scope="col" style="width: 20%;">Remarks</th>
                      <th scope="col">Action</th>
                    </tr>`;
          }



          $('#show_details tbody').empty();
          $('#show_details thead').empty();
          $('#show_details thead').append(headRow);
          row = '';
          for (i in response.details) {
            s = s + 1
           
            row += `<tr>
                        <td>${response.details[i].date}</td>`
            if (response.details[i].pr == "Low") {
              row += `<td><a href="#" style="color:green;" data-toggle="tooltip" data-placement="right" title="Low Priority">${response.details[i].rem}</a></td>`
            }
            else if (response.details[i].pr == "Medium") {
              row += `<td><a href="#" data-toggle="tooltip" style="color:orange;" data-placement="right" title="Medium Priority">${response.details[i].rem}</a></td>`
            }
            else if (response.details[i].pr == "High") {
              row += `<td><a href="#" data-toggle="tooltip" style="color:red;" data-placement="right" title="High Priority">${response.details[i].rem}</a></td>`
            }
            else {
              row += `<td>${response.details[i].rem}</td>`
            }
            row += `<td>${response.details[i].repo}</td>
                            
            <td>${response.details[i].loc} Inspection of ${response.details[i].entdet} ${response.details[i].entid}</td>`

            if(typeValue == 'byMe') 
              {
                row += `<td>${response.details[i].act}</td>
                              <td>${response.details[i].st}: ${response.details[i].comp}</td>
                              <td><button  type="button" id="bymei,${i}" onclick="actionEinspByMe(this)" class="btn btn-secondary" data-toggle="modal" data-target="#byMeModal"><i class="fas fa-pen"></i></button></td>`          
              }
            else if(typeValue == 'byOthers')
              {
                row += `<td>${response.details[i].act}</td>
                              <td>${response.details[i].st}: ${response.details[i].comp}</td>
                              <td><button  type="button" id="einsp,${i}" onclick="actionEinsp(this)" class="btn btn-secondary" data-toggle="modal" data-target="#Modal1"><i class="fas fa-pen"></i></button></td>`
          
              }
              else if(typeValue == 'forByMe')
          {
            d1 = (response.details[i].designationTo).split('@$@')
            d2 = (response.details[i].created_date).split('@$@')
            d3 = (response.details[i].st).split('@$@')
            d4 = (response.details[i].comp).split('@$@')
            row += `<td colspan="3">
              <table border="0">`
                for(let ij=0;ij<d1.length;ij++)
                {
                  row += `<tr>
                          <td style="width: 25%;">${d1[ij]}</td>
                          <td style="width: 25%;">${d2[ij]}</td>
                          <td style="width: 50%;">${d3[ij]} - ${d4[ij]}</td>
                  </tr>`
                }
                  row += `</table></td>
                          <td hidden></td>
                            <td hidden></td>
                            <td><button  type="button" id="forme,${i}" onclick="actionEinspForByMe(this)" class="btn btn-secondary" data-toggle="modal" data-target="#forByMeModal"><i class="fas fa-pen"></i></button></td>`
         
          }

              else
              {
                row += `<td>${response.details[i].designationTo}</td>
                          <td>${response.details[i].created_date}</td>
                                <td>${response.details[i].st}: ${response.details[i].comp}</td>
                                <td><button  type="button" id="forto,${i}" onclick="actionEinspForToMe(this)" class="btn btn-secondary" data-toggle="modal" data-target="#forToMeModal"><i class="fas fa-pen"></i></button></td>`
            
              }
           
            row += `</tr>`

           


          }
          $('#show_details tbody').append(row)
          table = $('#show_details').DataTable({
            pageLength: 10,
            "lengthChange": false,
            searching: false,
            pagingType: "simple",
            "language": {
              "info": "Page _PAGE_ of _PAGES_",

            },
            "order": [[0, 'desc']]
          }
          );
        }
      })


  }

</script>
<script>

  var byOthersAction = 'pending';
  $(function () {
    var currentdate = new Date();
    $(".dateofInsp").daterangepicker({
      maxDate: currentdate,
      autoApply: true,
      autoUpdateInput: false,
      autoclose: true,
      dateFormat: "dd/mm/yy",
      endDate: "currentdate",
      changeMonth: true,
      changeYear: true,
      todayHighlight: true,
      clearBtn: true
    });
    $(".dateofInsp").on('apply.daterangepicker', function (ev, picker) {
      $(this).val(picker.startDate.format('DD/MM/YY') + '-' + picker.endDate.format('DD/MM/YY'));
    });

  });
  
function actionEinspForToMe(U)
  {
      var id = U.id
      id = id.split(',').pop();
      $('#forToMeId').val(id);
      data = { 'id': id };
      $.ajax({
        url: "{% url 'actionEinspForToMe' %}",
        type: 'GET',
        dataType: 'json',
        data: data,
        success: function (response) {
          let details = response.details;
          let dept = response.dept, row = '';
          $('#forToMeId').val(response.forwardId);

          for (let i = 0; i < details.length; i++) {
            row += `<tr><td>${details[i].from}</td>`;
            row += `<td>${details[i].date}</td>`;
            row += `<td>${details[i].remarks}</td>`;
            row += `<td>${details[i].to}</td>`;
            row += `<td>${details[i].status}</td>`;
            row += `<td>${details[i].cdate}</td></tr>`;
          }
          $('#requestForToMeTable tbody').empty();
          $('#requestForToMeTable tbody').append(row);
         //

         if(response.revert == '1')
        {
          $('#forToMeDiv').show();
        }
        else
        {
          $('#forToMeDiv').hide();
        }
        }
      })
}

function updateForwardToMeData(val)
{
  var id = $('#forToMeId').val() ; 
    var forwardToRemarks = $('#forwardToMeRemarks').val();
    if(forwardToId == '')
      {
        alert('please Give Remarks');
        return false;
      }
    
      
    data = {'forwardToRemarks':forwardToRemarks,'val':val,'id': id}
    $.ajax({
      url: "{% url 'updateForwardToMeData' %}",
      type: 'GET',
      dataType: 'json',
      data: data,
      success: function (response) {
        window.location.reload()
      },
      error:function(err)
      {
        alert('Some error Exists')
      }
    })
}

function actionEinspForByMe(U)
{
    var id = U.id
    id = id.split(',').pop();
    $('#forMeId').val(id);
    data = { 'id': id };
    $.ajax({
      url: "{% url 'actionEinspForByMe' %}",
      type: 'GET',
      dataType: 'json',
      data: data,
      success: function (response) {
        let details = response.details;
        let dept = response.dept, row = '',drop = '<option selected disabled hidden value="">Select Officer To Forward</option>';
        for(let i=0;i<dept.length;i++)
        {
             drop += `<option value="${dept[i].designation_code}">${dept[i].designation}</option>`;
        }
        $('#forwardToId1').empty();
        $('#forwardToId1').append(drop);

        for (let i = 0; i < details.length; i++) {
          row += `<tr><td>${details[i].from}</td>`;
          row += `<td>${details[i].date}</td>`;
          row += `<td>${details[i].remarks}</td>`;
          row += `<td>${details[i].to}</td>`;
          row += `<td>${details[i].status}</td>`;
          row += `<td>${details[i].cdate}</td></tr>`;
        }
        $('#requestForByMeTable tbody').empty();
        $('#requestForByMeTable tbody').append(row);
       
      }
    })
}

  function actionEinspByMe(U) {
    var id = U.id
    id = id.split(',').pop();
    $('#byMeId').val(id)
    data = { 'id': id }
    $.ajax({
      url: "{% url 'actionEinspByMe' %}",
      type: 'GET',
      dataType: 'json',
      data: data,
      success: function (response) {
        let details = response.details;
        let dept = response.dept, row = '',drop = '<option selected disabled hidden value="">Select Officer To Forward</option>';
        for(let i=0;i<dept.length;i++)
        {
             drop += `<option value="${dept[i].designation_code}">${dept[i].designation}</option>`;
        }
        $('#forwardToId1').empty();
        $('#forwardToId1').append(drop);

        for (let i = 0; i < details.length; i++) {
          row += `<tr><td>${details[i].from}</td>`;
          row += `<td>${details[i].date}</td>`;
          row += `<td>${details[i].remarks}</td>`;
          row += `<td>${details[i].to}</td>`;
          row += `<td>${details[i].status}</td>`;
          row += `<td>${details[i].cdate}</td></tr>`;
        }
        $('#requestByMeTable tbody').empty();
        $('#requestByMeTable tbody').append(row);
        if(response.revert == '1')
        {
          document.getElementById('hideRequestBy').style.display = 'flex';
          $('#proceed').show();
        }
        else
        {
          document.getElementById('hideRequestBy').style.display = 'none';
          $('#proceed').hide();
        }
      }
    })
  }


  function actionEinsp(U) {
    var id = U.id
    id = id.split(',').pop();
    $('#rlyorg').val(id)
    data = { 'id': id }
    $.ajax({
      url: "{% url 'actionEinsp' %}",
      type: 'GET',
      dataType: 'json',
      data: data,
      success: function (response) {
        let details = response.details;
        let dept = response.dept, row = '',drop = '<option selected disabled hidden value="">Select Officer To Forward</option>';
        for(let i=0;i<dept.length;i++)
        {
             drop += `<option value="${dept[i].designation_code}">${dept[i].designation}</option>`;
        }
        $('#forwardToId').empty();
        $('#forwardToId').append(drop);

        for (let i = 0; i < details.length; i++) {
          row += `<tr><td>${details[i].from}</td>`;
          row += `<td>${details[i].date}</td>`;
          row += `<td>${details[i].remarks}</td>`;
          row += `<td>${details[i].to}</td>`;
          row += `<td>${details[i].status}</td>`;
          row += `<td>${details[i].cdate}</td></tr>`;
        }
        $('#fromMeDetailsTable tbody').empty();
        $('#fromMeDetailsTable tbody').append(row);
        if(response.showhide == 1)
        {
          $('#byMeDetails').hide();
          $('#fromMeDetails').show();  
          $('#updateSubmit').hide();
        }
        else
        {
          $('#fromMeDetails').show();
          $('#byMeDetails').show();
          $('#updateSubmit').show();
        }
        if (response.flag == 1) {
          $(`#modalDate`).attr("readonly", true)
          $(`#modalDate`).attr("disabled", true)
          $(`#modalDate`).val(response.date)
        }
        else {
          $(`#modalDate`).attr("disabled", false)
          $(`#modalDate`).val('')
        }
      }
    })
  }

  function updateEinsp() {
    var modalremarks = $('#modalremarks').val();
    var date = $('#modalDate').val();
    var id = $('#rlyorg').val() ; 
    var revertremarks = $('#revertremarks').val() ; 
    var forwardToId = $('#forwardToId').val();
    var forwardToRemarks = $('#forwardToRemarks').val();
    
    if(byOthersAction == 'pending')
    {
      if(date == '')
      {
        alert('please Select Date');
        return false;
      }
    }
    if(byOthersAction == 'close')
    {
      if(modalremarks == '')
      {
        alert('please Give Remarks');
        return false;
      }
    }
    if(byOthersAction == 'revert')
    {
      if(revertremarks == '')
      {
        alert('please Give Revert Remarks');
        return false;
      }
    }
    if(byOthersAction == 'forward')
    {
      if(forwardToRemarks == '')
      {
        alert('please Give Forward To Remarks');
        return false;
      }
      if(forwardToId == '')
      {
        alert('please Select Forward To Id');
        return false;
      }
    }
    
    data = {'forwardToId':forwardToId,'forwardToRemarks':forwardToRemarks, 'modalremarks': modalremarks, 'id': id, 'modalDate': date ,'byOthersAction':byOthersAction,'revertremarks':revertremarks}
    $.ajax({
      url: "{% url 'updateEinspUser' %}",
      type: 'GET',
      dataType: 'json',
      data: data,
      success: function (response) {
        alert(response);
        window.location.reload()
      }
    })
  }

  function updateForwarded()
  {
    var id = $('#byMeId').val() ; 
    var forwardToId = $('#forwardToId1').val();
    var forwardToRemarks = $('#forwardToRemarks1').val();
    if(forwardToId == '')
      {
        alert('please Select Forward To Officer');
        return false;
      }
    if(forwardToRemarks == '')
      {
        alert('please Give Forward  Remarks');
        return false;
      }
      
    data = {'forwardToId':forwardToId,'forwardToRemarks':forwardToRemarks,'id': id}
    $.ajax({
      url: "{% url 'updateForwarded' %}",
      type: 'GET',
      dataType: 'json',
      data: data,
      success: function (response) {
        window.location.reload()
      },
      error:function(err)
      {
        alert('Some error Exists')
      }
    })
  }
  
  function getPendingDetails(val) {
    byOthersAction = val;
    document.getElementById('hideClose').style.display = 'none';
    document.getElementById('hidePending').style.display = 'flex';
    document.getElementById('hideRevertBack').style.display = 'none';
    document.getElementById('hideForwardTo').style.display = 'none';
  }

  function getCloseDetails(val) {
    byOthersAction = val;
    document.getElementById('hideClose').style.display = 'flex';
    document.getElementById('hidePending').style.display = 'none';
    document.getElementById('hideRevertBack').style.display = 'none';
    document.getElementById('hideForwardTo').style.display = 'none';
  }

  function getRevertDetails(val) {
    byOthersAction = val;
    document.getElementById('hideClose').style.display = 'none';
    document.getElementById('hidePending').style.display = 'none';
    document.getElementById('hideRevertBack').style.display = 'flex';
    document.getElementById('hideForwardTo').style.display = 'none';
  }

  function getForwardDetails(val) {
    byOthersAction = val;
    document.getElementById('hideClose').style.display = 'none';
    document.getElementById('hidePending').style.display = 'none';
    document.getElementById('hideRevertBack').style.display = 'none';
    document.getElementById('hideForwardTo').style.display = 'flex';
  }




  $(document).ready(function () {
    var currentdate = new Date();
    $(".modaldate").datepicker({
      minDate: currentdate,
      autoclose: true,
      dateFormat: "dd-mm-yy",
      endDate: "currentdate",
      changeMonth: true,
      changeYear: true,
      todayHighlight: true,
      clearBtn: true
    });
  })



</script>


<script>
  $(document).ready(function () {
    $('[data-toggle="tooltip"]').tooltip();
  });
</script>

</body>

</html>
{% endblock content %}