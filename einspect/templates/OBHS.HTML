{% extends 'base.html' %} 
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBHS Report</title>
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous"> -->
    <script src="{% static '/js/jquery-3.4.1.min.js' %}" ></script>
    <script src="{% static '/js/popper.min.js' %}" ></script>
    <script src="{% static '/js/Chart.min.js' %}"></script>
    <script src="{% static '/js/jquery-3.3.1.slim.min.js' %}" ></script>
    <script src="{% static '/js/bootstrap.min.js' %}" ></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="{% static '/js/jquery-ui.js' %}"></script>
    <script src="{% static '/js/jquery-1.12.4.js' %}"></script>
    <script src="{% static '/js/select2.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}"  />
    <script src="{% static '/js/moment.min.js' %}"></script>

    <script src="{% static '/js/jquery-3.3.1.js' %}"></script>
    <script src="{% static '/js/sweetalert.min.js' %}"></script>
    <script src="{% static '/js/jquery.min.js' %}"></script>
    <script src="{% static '/js/bootstrap.min1.js' %}"></script>
    <script src="{% static '/js/jquery.min1.js' %}"></script>
    <script src="{% static '/js/jquery-ui.min.js' %}"></script>
    <script src="{% static '/js/jspdf.min.js' %}"></script>

    <script src="{% static '/DataTables/datatables.min.js' %}"></script>
    <script src="{% static '/js/dataTables.bootstrap4.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/DataTables/datatables.min.css' %}"  />

    <link rel="stylesheet" type="text/css" href="{% static '/css/bootstrap.min.css' %}"  />
    <link rel="stylesheet" type="text/css" href="{% static '/css/jquery-ui.css' %}"  />
    
    <script src="{% static '/js/jquery.timepicker.min.js' %}"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

<!-- (Optional) Latest compiled and minified JavaScript translation files -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-*.min.js"></script>
<script src="{% static '/js/select2.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}"  />
    
  <!-- swasti link -->

  <script type="text/javascript" src="{% static '/daterangepicker-master/moment.min.js'%}"></script>
  <script type="text/javascript" src="{% static '/daterangepicker-master/daterangepicker.js'%}"></script>
 <link rel="stylesheet" type="  text/css" href="{%static '/daterangepicker-master/daterangepicker.css'%}" />

 <script type="text/javascript" src="{% static '/js/dataTables.fixedColumns.min.js' %}"></script>
 <link rel="stylesheet" type="  text/css" href="{% static '/css/dataTables.fixedColumns.min.css' %}" />

 <!-- <script type="text/javascript" src="https://cdn.datatables.net/fixedcolumns/4.1.0/js/dataTables.fixedColumns.min.js"></script>
 <link rel="stylesheet" type="  text/css" href="https://cdn.datatables.net/fixedcolumns/4.1.0/css/fixedColumns.dataTables.min.css" /> -->

 <!-- <link rel="stylesheet" type="text/css" href="{%static '/datepicker-master/datepicker.css'%}" /> -->

<style>

th, td { white-space: nowrap; }
    div.dataTables_wrapper {
        /* width: 800px; */
        margin: 0 auto;
    }


</style>
</head>
<body>
    <br>
    <center><h3 style="font-family:'Lato', sans-serif"><b> OBHS Performance Rating Search</b></h3></center>
    <br>
    <form id="form">
      <div class="container" id="container" style="font-family:'Lato', sans-serif">
        <div class="row">
            <div class="col-md-3">
                <div class="form-group">
                    <label for="exampleFormControlSelect1">Train</label>
                    <select class="form-control select2" id="tr" data-live-search="true" data-actions-box="true">
                      <option>Select Train</option>
                      {% for i in tr %}
                      <option value="{{i.train_no}}">{{i.train_no}} {{i.train_name}}</option>
                      {% endfor %}
                      </select>
                    </div>
                </div>
          <div class="col-md-3">
            <div class="form-group">
                <label style="width:10em">From Date</label>
                <br>
                <input type="text" autocomplete="off" placeholder="Select Date" class="form-control" id="dateofInsp1" name="dateofInsp" readonly>
                </div>
            </div>
          <div class="col-md-3">
                <div class="form-group">
                    <label style="width:10em">To Date</label>
                    <br>
                    <input type="text" autocomplete="off" placeholder="Select Date" class="form-control" id="dateofInsp2" name="dateofInsp" readonly>
                    </div>
                </div>

                
                  
            <div class="col-md-2">
                <div class="form-group">
                    <button type="button" class="btn btn-primary mb-2" id="search_filter" style="margin-left:5em; margin-top:2em" onclick="searchOBHS()">Search</button>
                    </div>
                </div>    

                <div class="col-md-1">
                  <div class="form-group">
                    
                    <button type="submit" class="btn btn-secondary mb-2" type="reset" id="btnReset"  value="submit" style="margin-top: 2em;">Clear</button>
                    </div>

                </div>  


        </div>
      
      </div>
    </form>
    <br><br>
    
    <div class="container" style="width:100%">
      {% comment %} <center><h4 style="font-family:'Lato', sans-serif"><b>Train OBHS Performance Rating</b></h4></center> {% endcomment %}
    <table class="table table-striped table-bordered table-sm"  id="tableshow" cellspacing="0"  >
        <thead id="thead_IC "  style="font-size:1.2em">
          <tr>
            {% comment %} <th scope="col">Abnormality</th> {% endcomment %}
          </tr>
        </thead>
        <tbody id="tbody_IC">
          {% comment %} <tr></tr> {% endcomment %}
        </tbody>
      </table>
    </div>

</body>
<script>
  $('.select2').select2();
</script>
<script>
    $(document).ready(function() {
      
      var currentdate=new Date();
      var startdate=moment().subtract(7, 'days')
      var enddate=moment()
      $("#dateofInsp1").val(startdate.format('DD-MM-YYYY'))
      $("#dateofInsp2").val(enddate.format('DD-MM-YYYY'))
      $( "#dateofInsp1" ).datepicker({ 
        maxDate: currentdate,
        enddate:"currentdate",
        dateFormat: "dd-mm-yy",
        changeMonth : true, 
        changeYear : true,
        todayHighlight: true,
        clearBtn:true
     
      });
      $('#dateofInsp1').change(function(){
        var dateofInsp1 = $('#dateofInsp1').val();
        console.log("hii",dateofInsp1)
        var currentdate=new Date();
        $("#dateofInsp2").val(currentdate.getDate() + "-" + parseInt(currentdate.getMonth() + 1) + "-" + currentdate.getFullYear())
        $( "#dateofInsp2" ).datepicker({ 
        maxDate: currentdate,
        minDate: dateofInsp1,
        // startDate: dateofInsp1,
        dateFormat: "dd-mm-yy",
        changeMonth : true,
        changeYear : true,
        todayHighlight: true 
      });
      })
      {% comment %} searchOBHS(); {% endcomment %}
    });
  var table; 
   
 
 
  function searchOBHS(){
  
    if(table instanceof $.fn.DataTable.Api)
    {
      table.destroy();
    }
    $('#tableshow thead').empty();
    $('#tableshow tbody').empty();
    // $('#tableshow').empty();
      var fromdate=$('#dateofInsp1').val();
      var todate=$('#dateofInsp2').val();
      var tr=$('#tr').val()
      data={
          'fromdate':fromdate,
          'todate':todate,
          'tr':tr
      }
      $.ajax({
        
        url: '{% url "searchOBHS" %}',
        dataType: 'json',
        type: 'GET',
        data: data,
        success: function(response)
        {
          ans=response.ans
          bo1=response.bo1
          abn1=response.abn
          console.log(response)
          let header=response.ans
          console.log(header)
          var ro='';
            var row='';
             ro += '<tr>';
                    ro += `
                        <th scope="col">SNo.</th>;
                        <th scope="col">Abnormality</th>;`
            for (const [key, value] of Object.entries(header)) {
              for (const [key1, value1] of Object.entries(value))
                  ro += `<th scope="col">${key1}</th>`;
              break
          }
          ro += '</tr>';


          let ctr = 0;


          for (const [key, value] of Object.entries(header)) {
              ctr++;

              row += '<tr>';
              row += `<td scope="col">${ctr}</td>`;
              row += `<td scope="col">${key}</td>`;
              console.log(key)
              for (const [key1, value1] of Object.entries(value)) {
                  row += `<td scope="col">${value1}</td>`;
              }
              row += '</tr>';
          }
          //table.destroy();
  
          $('#tableshow thead').append(ro);
          $('#tableshow tbody').append(row);
          table=$('#tableshow').DataTable({
          scrollX:        true,
          scrollCollapse: true,
          paging:         true,
          fixedColumns:   {
              left: 1,
              
          }
        });
        }
      })
      
     }


  </script>
  

  </script>
</html>
{% endblock content %}