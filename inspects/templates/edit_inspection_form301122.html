{% extends 'base.html' %} 
{% block content %}

{% load static %}
{% load to_and %}


<head>
  <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">
  		
<link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">	
<script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
</head>

<br>
<style>

.bootstrap-select.btn-group .dropdown-menu.inner,	
.dropdown-menu.open {	
  min-height: 70vh !important;} 

  .btn-save {	
  align-items: center;	
  background-clip: padding-box;	
  background-color: #fa6400;	
  border: 1px solid transparent;	
  border-radius: .25rem;	
  box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;	
  box-sizing: border-box;	
  color: #fff;	
  cursor: pointer;	
  display: inline-flex;	
  font-family: system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;	
  font-size: 16px;	
  font-weight: 600;	
  justify-content: center;	
  line-height: 1.25;	
  margin: 0;	
  min-height: 3rem;	
  padding: calc(.875rem - 1px) calc(1.5rem - 1px);	
  position: relative;	
  text-decoration: none;	
  transition: all 250ms;	
  user-select: none;	
  -webkit-user-select: none;	
  touch-action: manipulation;	
  vertical-align: baseline;	
  width: auto;	
}	
.btn-save:hover,	
.btn-save:focus {	
  background-color: #fb8332;	
  box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;	
}	
.btn-save:hover {	
  transform: translateY(-1px);	
}	
.btn-save:active {	
  background-color: #c85000;	
  box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;	
  transform: translateY(0);	
}	
.btn-draft {	
  align-items: center;	
  background-clip: padding-box;	
  background-color: #666699;	
  border: 1px solid transparent;	
  border-radius: .25rem;	
  box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;	
  box-sizing: border-box;	
  color: #fff;	
  cursor: pointer;	
  display: inline-flex;	
  font-family: system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;	
  font-size: 16px;	
  font-weight: 600;	
  justify-content: center;	
  line-height: 1.25;	
  margin: 0;	
  min-height: 3rem;	
  padding: calc(.875rem - 1px) calc(1.5rem - 1px);	
  position: relative;	
  text-decoration: none;	
  transition: all 250ms;	
  user-select: none;	
  -webkit-user-select: none;	
  touch-action: manipulation;	
  vertical-align: baseline;	
  width: auto;	
}	
.btn-draft:hover,	
.btn-draft:focus {	
  background-color: #666699;	
  box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;	
}	
.btn-draft:hover {	
  transform: translateY(-1px);	
}	
.btn-draft:active {	
  background-color: #666699;	
  box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;	
  transform: translateY(0);	
}	
.modal-title	
{	
  font-size:1rem;	
  font-weight:600;	
}	
.copy-link	
{	
  cursor:pointer;	
  text-decoration: none;	
  font-weight:600;	
  color:#0059b3;	
  font-size:13px;	
}	
.table-inpt-fields td {padding:0px;border:0px;padding-left:10px;}


* {
  box-sizing: border-box;
}
/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}
* {
  box-sizing: border-box;
}

/* Style the search field */
form.example input[type=text] {
  padding: 8px;
  font-size: 17px;
  border: 1px solid grey;
  float: left;
  width: 60%;
  background: #f1f1f1;
}

/* Style the submit button */
form.example button {
  float: left;
  width: 15%;
  padding: 8px;
  background: #2196F3;
  color: white;
  font-size: 17px;
  border: 1px solid grey;
  border-left: none; /* Prevent double borders */
  cursor: pointer;
}

form.example button:hover {
  background: #0b7dda;
}

/* Clear floats */
form.example::after {
  content: "";
  clear: both;
  display: table;
}        
</style>

<style>
 
 
#s2id_desig .select2-default {
  color: rgb(89, 255, 0) !important;
}

.autocomplete {
  /*the container must be positioned relative:*/
  position: relative;
  display: inline-block;
}

.autocomplete-items {
  position: absolute;
  border: 1px solid #d4d4d4;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  /*position the autocomplete items to be the same width as the container:*/
  top: 100%;
  left: 0;
  right: 0;
}
.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
  background-color: #fff;
  border-bottom: 1px solid #d4d4d4;
}
.autocomplete-items div:hover {
  /*when hovering an item:*/
  background-color: #e9e9e9;
}
.autocomplete-active {
  /*when navigating through the items using the arrow keys:*/
  background-color: DodgerBlue !important;
  color: #ffffff;
}

.select2-selection__choice__remove{
  border: none;
}

.multi_select_box{
  width: 150px;
  margin: 1px auto;
}
.multi_select_box select{
  width: 100%;
}
.multi_select_box button{
  background-color: darkslategray !important;
  color: #fff !important;
}

.home-section .home-content .text{
    font-size: 15px;
    font-weight: 400;
  }

 
  .bootstrap-select.form-control-sm .dropdown-toggle {
    height: 2.8em;
  }

  .select2-search--inline {
    display: contents; /*this will make the container disappear, making the child the one who sets the width of the element*/
}

.select2-search__field:placeholder-shown {
    width: 100% !important; /*makes the placeholder to be 100% of the width while there are no options selected*/
}

  .mycls{
    display: inline-flex;
  }
    

</style>

<body>

  <div class="container">
    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'success' %}
              <div class="alert alert-remove alert-success alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            {% elif message.tags == 'error' %}
              
              <div class="alert alert-remove alert-danger alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            {% elif message.tags == 'info' %}
              
              <div class="alert alert-remove alert-info alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            {% else %}
            
            {% endif %}
           
        
        {% endfor %}
    {% endif %}
  </div>


  <h3 class="report_heading">Create Inspection Notes
  </h3>
  <br>
 
  <form method="POST"> 
    {% csrf_token %}
    <div class="container">
       <div class="inpt-container">
      
      <div class="row" >
       
          <div class="col">
              <label for="Zone" class="lbl-caption" >Rly./Org.</label><span style="color:red;font-weight:bold">*</span>
              <select class="form-control" id="zone" data-placeholder="Select zone.." name="zone" class="custom-select" multiple required>
                {% for g in multi_loc %}
                      {% if g.type == 'HQ' %}
                            <option value="{{g.item}}" selected>{{g.item}}</option> 
                      {% endif %}
                        {% for zn in Zone %}
                          {% if zn != g.item and g.type == 'HQ' %}
                          <option value="{{zn}}">{{zn}}</option>
                          {% endif %}
                        {% endfor %}
                {% endfor %}
              </select>
          </div>
    
        <div class="col">
            <label for="division" class="lbl-caption">Div./Unit</label>
            
            <select class="form-control" data-placeholder="Select division.." id="division" name="division" class="custom-select" style="max-width:100%;" multiple>
              {% for g in multi_loc %}
                {% if g.type == 'DIV' %}
                    <option value="{{g.item}}" selected>{{g.item}}</option> 
                {% endif %}
                  {% for div in division %}
                    {% if div != g.item %}
                      <option value="{{div.location_code}}">{{div.location_code}}</option>
                    {% endif %}
                  {% endfor %}
              {% endfor %}
            </select>
            
        </div>
        <div class="col">
          <!-- <label for="">Department</label>
          <select class="form-control" data-placeholder="Select department.." id="department" name="department" class="custom-select" style="max-width:100%;" multiple>
            {% for g in multi_loc %}
            {% if g.type == 'DPT' %}
                <option value="{{g.item}}" selected>{{g.item}}</option> 
            {% endif %}
                {% for dp in department %}
                {% if dp.department_name != g.item %}
                <option value="{{dp.department_name}}">{{dp.department_name}}</option>
                {% endif %}
                {% endfor %}
            {% endfor %}
          </select> -->

          <label for="division" class="lbl-caption">Location type</label>
          <select class="form-control" id="locationType" data-placeholder="Select department.."  name="department" style="max-width:100%;" multiple>
        
                  <option value=""   disabled hidden>select</option>
                  {% for i in location_array %}
                  
                      {% if i.type_code in multi_loc_from %}
                        <option value="{{i.type_code}}" selected>{{i.type}}</option>
                      {% else %}
                        <option value="{{i.type_code}}" >{{i.type}}</option>
                      {% endif %}
                 

                  {% endfor %}
              <!-- {% for g in multi_loc_from %}
                
                    {% for i in location_array %}
                      {% if g.table_from == i.type_code %}
                          <option value="{{i.type_code}}" selected>{{i.type}}</option>
                      {% endif %}
                      {% for i in location_array %}
                      {% if g.table_from != i.type_code %}
                          
                            <option value="{{g.table_from}}" >{{i.type}}</option>
                         
                      {% endif %}

                      {% endfor %}
                    {% endfor %}
               
                  
              {% endfor %} -->
                  
              </select>
          
        </div>
      
        <div  class="col" >
            <label for="location" class="lbl-caption">Location Name</label><br>
            <div>
              <select name="location" id="location" data-placeholder="Select location.." class="form-control" multiple>
                {% for g in multi_loc %}
                {% if g.type == 'LOC' %}
                    <option value="{{g.item}}#{{g.table_from}}#{{g.item_code}}" selected>{{g.item}}</option>
                {% endif %}
                {% endfor %}
                
              </select>
            </div>
            
        </div>
          
          <div class="col" >
            <label for="txtDate2" class="lbl-caption">Insp. Date<span style="color:red;font-weight:bold">*</span></label><br>
            <!-- <input type="text" autocomplete="off"  onchange="setTitle()" name="daterange1" required class="form-control" style="margin-top:0em ;height: 36px; background-color: #fff; max-width: 100%;" id="txtDate2"   readonly requied> -->
            {% for date in ins_detail %}
              {% if date.start_date|date:'d/m/Y' == date.inspected_on|date:'d/m/Y' %}
              <input type="text" autocomplete="off" placeholder="Select daterange.."  name="daterange1"   class="form-control" style="margin-top:0em ;height: 36px; background-color: #fff; max-width: 100%;" id="txtDate2"  value="{{date.start_date|date:'d/m/y'}}" readonly>
              {% else %}
              <input type="text" autocomplete="off" placeholder="Select daterange.."  name="daterange1"   class="form-control" style="margin-top:0em ;height: 36px; background-color: #fff; max-width: 100%;" id="txtDate2"  value="{{date.start_date|date:'d/m/y'}} to {{date.inspected_on|date:'d/m/y'}}" readonly>
              {% endif %}
            
            {% endfor %}
        </div>
    
      </div> 
    </div>
    </div>
   

    
    {% for i in ins_detail %}

     
    <br>
    <div class="container">
      <div class="row">
      <div class="col-lg-6 col-sm-12">
        
      <label for="start" class="lbl-caption">Title<span style="color:red;font-weight:bold">*</span></label>
      <textarea class="form-control" maxlength="500"   id="titleinsp"  name="titleinsp" >{{i.inspection_title}}</textarea>
      
      <input type="text" value="{{i.inspection_no}}" id="inspection_no" hidden>
      </div>
      <div class="col-lg-6 col-sm-12">
        <label for="start" >Accompanied By</label>
        
        <select id="accompany"  class="form-control" data-placeholder="Search Designation.."  multiple>
          {% for acc in Accompany %}

          <option value="{{acc.accompany}}" selected>{{acc.accompany}}</option>
          {% endfor %}
        </select>
        <div class="mt-2">
          '<span style="color:red;font-weight:bold">*</span>': Required Fields in Forms
        </div>
      </div>
    </div> 
    </div>
    <br>
    

    <div class="container">
            <table id="table1" class="table table-striped table-bordered center table-input" >
  
              <thead >
                <tr style="margin-left: 5em;">
                     
                  <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5%;">Item No.</th>
                  <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 200px;">Title</th> -->
                  <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 50%;"> Inspection Para</th>
                  <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 50px;">Upload Document/Image</th> -->
                  
                  <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 150px;">Action by</th> -->
                  <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 150px;">Search Officer</th> -->
                  <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 30%;">Select Officer</th>

                   <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 10%;">Target Date</th>
                  <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5%;">Priority</th>
                  <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 300px;">Compliance Received On</th> --> 
                </tr>
            
              </thead>
              
              
              <tbody  id="addworkmech">
              {% for j in i.item_details1 %}
              
              {% if j.type == 'H' %}
              
    
              <tr>
              <td><div style="text-align: center; width:5px; font-family: verdana;">{{j.des_id}}</div></td>
              <td><div class="autocomplete1"><textarea maxlength="100" id='heading{{j.des_id}}'  autocomplete1=off  style="height:70px;" class="form-control">{{j.item_title}}</textarea></div></td>
              
              {% if j.chk_cts == 'YES' %}
              
              
              <!-- <td><div class="autocomplete1" id="divofficer{{j.des_id}}"><button type="button" class="btn btn-primary btn-md" id='officer{{j.des_id}}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" style="margin-left:1vh;margin-top:1vh;"><i class="fas fa-info"></i></button>  </div></td> -->
              
              <td>

                <div class="mycls">
                  <div class="autocomplete1" id="divmarkeofficer{{j.des_id}}">
                    
                    <a style="display:inline-block;
                    width:130px;
                    height:35px;
                    margin-top:3px;
                    color: white;
                        background-color: darkslategray;
                        padding: 5px 11px;
                        border-style: 2px solid" id="tooltip{{j.des_id}}" class="js-btn-tooltip" value="{{j.mrkoffi.desig_longdesc}}" data-toggle="tooltip" data-placement="top" title="Add From Dropdown" >Add From D...</a>  
                 
                    
                    <textarea hidden type="text" class="form-control" placeholder="Add officer" value="{{j.mrkoffi.desig_longdesc}}" custom-offic="{{j.mrkoffi.marked_officers}}" custom-key="{{j.mrkoffi.custom_key}}" id='markeofficer{{j.des_id}}' class="autocomplete1" readonly>{{j.mrkoffi.desig_longdesc}}</textarea></div>
                  &nbsp;
                  <div class="multi_select_box" id="divdesgn{{j.des_id | to_and }}" >
              
                    <select id="desgn{{j.des_id}}" onchange="addDesigBy(this);"   class="desgn{{j.des_id | to_and }} demo w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true" multiple data-selected-text-format="count > 2" multiple>
                      {% for i in desg_no %}
                          <option  value="{{i.designation_code}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
                          {% endfor %}
  
                    </select>
                    
                    <!-- <button type="button" class="btn btn-primary btn-md" style="box-shadow: none;" id='officer{{j.des_id}}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()"><i class="fas fa-search"></i></button> -->
                    <input type="button" id="desgnbtn{{j.des_id}}"   value="Ok" onclick="getOption('desgn{{j.des_id}}');" hidden>
                    <input type="text" id="desgninp{{j.des_id}}" value="" hidden>
  
                  </div>
                </div>

                
              </td>

              <td><div class="autocomplete1" id="divtargetdate{{j.des_id}}"><input type="text"  class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;" id='targetdate{{j.des_id}}'  value='{{j.target_date|date:"d/m/y"}}' readonly> </div></td>
                  {% if j.priority == 1 %}
                  <td><div class="autocomplete1" id="divcheckbox{{j.des_id}}"><input type="checkbox" name="priority" checked autocomplete="off" id='check{{j.des_id}}'>&nbsp; High </div></td>
                  {% else %}
                  <td><div class="autocomplete1" id="divcheckbox{{j.des_id}}"><input type="checkbox" name="priority" autocomplete="off" id='check{{j.des_id}}'>&nbsp; High </div></td>
                  {% endif %}
              {% else %}
                
               
                <!-- <td><div class="autocomplete1" id="divofficer{{j.des_id}}" style="display: none;"><button type="button" class="btn btn-primary btn-md" id='officer{{j.des_id}}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" style="margin-left:1vh;margin-top:1vh;"><i class="fas fa-info"></i></button>  </div></td> -->
                <td> 
                  <div class="mycls">
                    <div class="autocomplete1" id="divmarkeofficer{{j.des_id}}" style="display: none;">
                      <a style="display:inline-block;
                      width:130px;
                      height:35px;
                      margin-top:3px;
                      color: white;
                          background-color: darkslategray;
                          padding: 5px 11px;
                          border-style: 2px solid" id="tooltip{{j.des_id}}" class="js-btn-tooltip" value="{{j.mrkoffi.desig_longdesc}}" data-toggle="tooltip" data-placement="top" title="Add From Dropdown" >Add From D...</a>  
                   
                      
                      <textarea hidden type="text" class="form-control" value="{{j.mrkoffi.desig_longdesc}}" custom-offic="{{j.mrkoffi.marked_officers}}" custom-key="{{j.mrkoffi.custom_key}}" id='markeofficer{{j.des_id}}' class="autocomplete1" readonly>{{j.mrkoffi.desig_longdesc}}</textarea></div>
                    &nbsp;
                    <div class="multi_select_box" id="divdesgn{{j.des_id  | to_and }}" style="display: none;">
              
                      <select id="desgn{{j.des_id}}" onchange="addDesigBy(this);" class="desgn{{j.des_id | to_and }} demo w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true" multiple data-selected-text-format="count > 2" multiple>
                        {% for i in desg_no %}
                            <option  value="{{i.designation_code}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
                            {% endfor %}
  
                      </select>
                      
                      <!-- <button type="button" class="btn btn-primary btn-md" style="box-shadow: none;" id='officer{{j.des_id}}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()"><i class="fas fa-search"></i></button> -->
                      <input type="button" id="desgnbtn{{j.des_id}}" value="Ok" onclick="getOption('desgn{{j.des_id}}');" hidden>
                      <input type="text" id="desgninp{{j.des_id}}" value="" hidden>
  
                    </div>
                  </div>
                  
                </td>
                <td><div class="autocomplete1" id="divtargetdate{{j.des_id}}" style="display: none;"><input type="text"  class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;" id='targetdate{{j.des_id}}' value='{{j.target_date|date:"d/m/y"}}' readonly> </div></td>
                <td><div class="autocomplete1" id="divcheckbox{{j.des_id}}" style="display: none;"><input type="checkbox" name="priority" autocomplete="off"  id='check{{j.des_id}}'>&nbsp; High </div></td>
            

              {% endif %}
            </tr>
  
  
  
  
              {% elif j.type == 'SH' %}
              <tr>
                
                  <td><div class="autocomplete1"><div style="text-align: center; width:5px; font-family: verdana;" id='itemno'>{{j.des_id}}</div></td>
                  <td><div class="autocomplete1"><textarea maxlength="500" id='observation{{j.des_id}}' autocomplete1 = "off"  style="height:120px;" class="form-control">{{j.observation}}</textarea></div></td>
                  
                  
                  <!-- <td><div class="autocomplete1"><button type="button" class="btn btn-primary btn-md" id='officer{{j.des_id}}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" style="margin-left:1vh;margin-top:1vh;"><i class="fas fa-info"></i></button>  </div></td> -->
                  
                  <td> 
                    <div class="mycls">
                      <a style="display:inline-block;
                      width:130px;
                      height:35px;
                      margin-top:3px;
                      color: white;
                          background-color: darkslategray;
                          padding: 5px 11px;
                          border-style: 2px solid" id="tooltip{{j.des_id | to_and }}" class="js-btn-tooltip" value="{{j.mrkoffi.desig_longdesc}}" data-toggle="tooltip" data-placement="top" title="Add From Dropdown" >Add From D...</a>  
                   
                      
                      <textarea hidden type="text" class="form-control" placeholder="Add officer" custom-offic="{{j.mrkoffi.marked_officers}}" custom-key="{{j.mrkoffi.custom_key}}" id='markeofficer{{j.des_id}}' class="autocomplete1" readonly>{{j.mrkoffi.desig_longdesc}}</textarea>
                      &nbsp;
                      <div class="multi_select_box" id="divdesgn{{j.des_id  | to_and }}" >
              
                        <select id="desgn{{j.des_id}}" onchange="addDesigBy(this);" class="desgn{{j.des_id | to_and }} demo w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true" multiple data-selected-text-format="count > 2" multiple>
                          {% for i in desg_no %}
                              <option  value="{{i.designation_code}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
                              {% endfor %}
    
                        </select>
                        
                        <!-- <button type="button" class="btn btn-primary btn-md" style="box-shadow: none;" id='officer{{j.des_id}}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()"><i class="fas fa-search"></i></button> -->
                        <input type="button" id="desgnbtn{{j.des_id}}"  value="Ok" onclick="getOption('desgn{{j.des_id}}');" hidden>
                        <input type="text" id="desgninp{{j.des_id}}" value="" hidden>
    
                      </div>
                    </div>
                    
                  </td>

                  <td><div class="autocomplete1"><input type="text" autocomplete="off" value='{{j.target_date|date:"d/m/y"}}'  class="form-control datepker" style="height: 2em; width: 115px;" id='targetdate{{j.des_id}}' placeholder="dd/mm/yy" readonly> </div></td>
                  
                    {% if j.priority == 1 %}
                    <td><div class="autocomplete1" id="divcheckbox{{j.des_id}}"><input type="checkbox" name="priority" checked autocomplete="off" id='check{{j.des_id}}'>&nbsp; High </div></td>
                    {% else %}
                    <td><div class="autocomplete1" id="divcheckbox{{j.des_id}}"><input type="checkbox"  name="priority" autocomplete="off" id='check{{j.des_id}}'>&nbsp; High </div></td>
                    {% endif %}
                </tr>
                  
              {% else %}
              <tr>
                <td><div style="text-align: center; width:5px; font-family:verdana;"></div></td>
                <td>{{j.des_id}}<div class="autocomplete1"><textarea maxlength="100" id='subdes{{j.des_id}}' autocomplete1 = "off"  style="height:30px;margin-left: 100px; width: 82%;" class="form-control">{{j.item_subtitle}}</textarea></div></td>
              </tr>
              {% endif  %}  
            {% endfor %}
            
             </tbody>
              
          </table>
     
  
  {% endfor %} 
      
         
    <div class="btn-group">
      <button  class="btn btn-primary btn-sm" onclick="changeColorBtn(this);" id="addheading" style="margin-left: 6em;">Add Para</button> &nbsp;
      <button  type="button" name="addmech"onclick="changeColorBtn(this);" id="addmech" class="btn btn-primary btn-sm">Add Sub Para</button>&nbsp;
      <button  type="button" name="addSubmech" onclick="changeColorBtn(this);" id="addSubmech" class="btn btn-primary btn-sm">Add Sub Sub Para</button>&nbsp;
      <button  class="btn btn-danger btn-sm" id="deletemech" >Delete</button> 
      
      
     
</div>

    
    
     
        <div class="container">
          <hr>
          <div class="row">
            <div class="col-sm-12 col-md-6">
                
                  <div class="input-group">
                    <span class="input-group-btn">
                          <!-- <a href="#" id="Copy To" value="Copy To" data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setCopyValue();">Copy To <i class="fas fa-paper-plane"></i></a> -->
                          Copy To &nbsp;
                        </span>
                    
                    
                    <div class="multi_select_box" id="copy_divdesgn">
              
                      <select id="copy_desgn"  class="demo-copy w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true" multiple data-selected-text-format="count > 2" multiple>
                            {% for i in desg_no %}
                            <option  value="{{i.designation_code}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
                            {% endfor %}
                      </select>
                      
                      <input type="button" id="copy_desgnbtn" value="Ok" onclick="copyToOption()" hidden>
  
                      <input type="text" id="copy_desgninp" hidden >
  
                    </div>
                    <textarea type="text" class="form-control ml-2" custom-offic="{{new_mail_desig_code}}" id="copyto" placeholder="Add officer from dropdown" autocomplete="off" readonly>{{new_mail_detail}}</textarea>
                  </div>
                
            </div>
          </div>

          <div class="row">	
            <div class="col-sm-12 col-md-12" align="right">	
          <div class="btn-group">  
            <button type="button" id="draft" name="draft" value="Save as draft" onclick="Updatedraft_data(this)" class="btn btn-draft btn-sm" >Save as Draft</button> &nbsp; 
            <!-- <button type="button" id="submit" name="submit" value="Submit"  class="btn btn-success btn-md" onclick="Updatedraft_data(this)">Submit</button>  -->
            
            <button type="button" id="submit" name="submit" value="Submit"  class="btn btn-save btn-sm" onclick="Updatedraft_data(this);" hidden>Submit</button> 
            <button type="button" id="submit1" name="submit1" value="Submit1"  class="btn btn-save btn-sm" data-toggle="modal" data-target="#otpModalCenter" onclick="saveByOtp(this);" hidden>Submit</button> 
            <button type="button" id="submit2" class="btn btn-save btn-sm" onclick="chkvalidation();">Submit</button> 
        </div>
            </div>
          </div>
        
      </div>
     

    <br>

    
    


</form>
    
   
   
<div class="modal" tabindex="-1" id="exampleModal" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog-modal-xl" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title" id="exampleModalLabel"><b> Mark Officers</b></h4>
      <button type="button" class="btn btn-light  btn-sm" id="close1" data-dismiss="modal">&times;</button>
      
    </div>
   
    <div class="modal-body">
      <form   action="" method="POST" >
        {% csrf_token %}
       <input type="text" value="" id="mark_officersss" hidden/>
  
  <div class="inpt-container" style="padding:10px;">
  <div class="row">
      <div class="col-md-3">
          <label class="lbl-caption">Railway/Org.</label>
          <select multiple class="form-control" id="rly_1" name="rly_1" class="custom-select" style="width: 100%;" data-placeholder="Select zone..." multiple >
              {% for i in Zone %}
              <option >{{i}}</option>
              {% endfor %}
  
          </select>
      </div>
      <div class="col-md-3">
          <label class="lbl-caption">Division/Unit</label>
          <select class="form-control" id="div_1" name="div_1" class="custom-select" style="width: 100%;" data-placeholder="Select division..." multiple onchange="getdivwisedata()">
              {% for i in division %}
              <option>{{i}}</option>
              {% endfor %}
          </select>
      </div>
      <div class="col-md-3">
          <label class="lbl-caption">Department</label>
          <select multiple class="form-control" id="dept_1" name="dept_1" class="custom-select" style="width: 100%;" data-placeholder="Select department..." onchange="getdivdeptdata()">
              {% for i in department %}
              <option value="{{i.department_name}}">{{i.department_name}}</option>
              {% endfor %}        
          </select>
      </div>
      <div class="col-md-3">
          <label  class="lbl-caption">Designation</label>
          <select multiple class="form-control" id="desig" name="desig" class="custom-select" style="width: 100%;" data-placeholder="Select designation..." onchange="getdesigdata();">
              {% for i in alldesig %}
              <option value="{{i.designation}}">{{i.designation}}</option>
              {% endfor %}
          </select>
      </div>
  </div>
  </div><br>
<div class="row">
    <div class="col-md-3">
        <input type="checkbox"  id="allgm" >
        <label class="lbl-caption" >Select All GM/ZR</label>
    </div>
    <div class="col-md-3">
        <input type="checkbox"  id="alldrm">
        <label class="lbl-caption">Select All DRM</label>
       
    </div>
    <div class="col-md-3">
        <input type="checkbox"  id="allphod">
        <label class="lbl-caption">Select All PHOD</label>
       
    </div>
    <div class="col-md-3">
        <input type="checkbox"  id="allboard">
        <label class="lbl-caption">Select All Board Members</label>
       
    </div>
</div>
<br>
<br>
<div class="row">
    <div class="col-md-6">
      <label class="lbl-caption">Selected Designation</label>
        <textarea type="text"  id="alltext" class="form-control" style="background-color: rgb(247, 218, 248);" readonly></textarea>
        
    </div>


    <div class="col-md-6"  align="right">
      <div class="btn-group" >
      <label></label>
      <button type="button" class="form-control  btn btn-info" onclick="add_save_marked_officers();">Add</button>&nbsp;

    
    
      <label></label>
      <button type="button" class="form-control btn btn-danger" onclick="remove_save_marked_officers();">Remove</button>

    
    
      </div>
    </div>
  
    <br>
   <br>
    <div class="row">
      <div class="col-lg-12 col-sm-12">
        <label></label>
    <label></label>
      <button type="button" class="form-control btn btn-save" onclick="save_marked_officers();">Save</button>
      </div>
    </div>
  
</div>
<br>

  <div class="row" id="showdiv1">
    <div class="col-md-6">
          <table id="text" class="table table-striped table-bordered ">
            <thead>
              <tr><th></th>
                <th></th></tr>
            </thead>
            <tbody>
            </tbody>  
        </table>
    </div>
    <div class="col-md-6">
          <table id="text1" class="table table-striped table-bordered ">
            <thead>
                <tr><th></th><th></th></tr>
            </thead>
            <tbody>
              
            </tbody>
        </table>
    </div>
  </div>
  <div class="row" id="showdiv2">
    <div class="col-md-6">
          <table id="textdesig" class="table table-striped table-bordered ">
            <thead>
              <tr>
                <th></th>
                <th></th>
              </tr>
            </thead>
            <tbody>
            </tbody>  
          </table>
    </div>
    <div class="col-md-1"></div>
    <div class="col-md-5" hidden>
      <table id="textdesigselect" class="table table-striped table-bordered ">
        <thead>
          <tr>
            <th hidden></th>
            <th>Selected Employee/Designation</th>
          </tr>
        </thead>
        <tbody>
        </tbody>  
      </table>
    </div>
  </div>
  <br>

  <input type="hidden" value="0" id="s1" name="s1">
  </form>
  </div>
    <!-- <div class="modal-footer">
     
    </div> -->
  </div>
</div>

</div>


      
   
            
    
    <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title"><b> Target Date</b></h4>
          
        </div>
       
          <div class="modal-body">
            
              
        
       
          
          <div><label for="start" >Target Date</label><br><input type="date"  class="col-md-2" required class="form-control" style="height: 2em;margin-top:0.7em;" id="target_date" value="new Date()"  onkeydown='event.preventDefault()' requied>
           
           
           </div>

        </div>
       
            
          </body>
          </div>
         
          </div>

      </div>
    </div>
  </div>

  <!-- otp Modal -->
<div class="modal fade" id="otpModalCenter" tabindex="-1" role="dialog" aria-labelledby="otpModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="otpModalLongTitle">Verify Your inspection Form</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container">
          
          <div class="row">
            <div id="otpcurrent"></div>
            <div id="count_down">
              <div>Time left : <span id="timer"></span></div>
            </div>
            <br>
            <div class="col-8">
              <input style="background-color: #fff;" autocomplete="off" placeholder="- - - -" type="text" name="" id="your_otp" class="form-control" maxlength="4">
            </div>
            <div class="col-4">
              <button class="btn btn-info" id="verify_otp" onclick="verify_my_otp()">Verify</button>
            </div>
            
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>



  <script>

 

    $("#zone").select2({

    });
</script>
    
    
 
    
<script>

var globallistgm='';
var globallistbm='';
var globallistdrm='';
var globallistphod='';

function auto(inp, arr) {
  var currentFocus;
  inp.addEventListener("input", function(e) {
      var a, b, i, val = this.value;
      closeAllLists();
      if (!val) { return false;}
      currentFocus = -1;
      a = document.createElement("DIV");
      a.setAttribute("id", this.id + "autocomplete-list");
      a.setAttribute("class", "autocomplete-items");
    
      this.parentNode.appendChild(a);
   
      for (i = 0; i < arr.length; i++) {

        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
          
          b = document.createElement("DIV");
       
          b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
          b.innerHTML += arr[i].substr(val.length);
        
          b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
       
              b.addEventListener("click", function(e) {
        
              inp.value = this.getElementsByTagName("input")[0].value;
              
              closeAllLists();
          });
          a.appendChild(b);
        }
      }
  });

  inp.addEventListener("keydown", function(e) {
      var x = document.getElementById(this.id + "autocomplete-list");
      if (x) x = x.getElementsByTagName("div");
      if (e.keyCode == 40) {
        
        currentFocus++;
        
        addActive(x);
      } else if (e.keyCode == 38) { 
      
        currentFocus--;
       
        addActive(x);
      } else if (e.keyCode == 13) {
     
        e.preventDefault();
        if (currentFocus > -1) {
        
          if (x) x[currentFocus].click();
        }
      }
  });
  function addActive(x) {
    if (!x) return false;
    removeActive(x);
    if (currentFocus >= x.length) currentFocus = 0;
    if (currentFocus < 0) currentFocus = (x.length - 1);
  
    x[currentFocus].classList.add("autocomplete-active");
  }
  function removeActive(x) {
   
    for (var i = 0; i < x.length; i++) {
      x[i].classList.remove("autocomplete-active");
    }
  }
  function closeAllLists(elmnt) {
   
    var x = document.getElementsByClassName("autocomplete-items");
    for (var i = 0; i < x.length; i++) {
      if (elmnt != x[i] && elmnt != inp) {
      x[i].parentNode.removeChild(x[i]);
    }
  }
}

document.addEventListener("click", function (e) {
    closeAllLists(e.target);
});
}



</script>
<script>
  function Updatedraft_data(el)
        { 
          
          var zone=$("#zone").val();
          var division=$("#division").val();
          var location=$("#location").val();
          var department=$('#department').val();

          console.log("zone",zone)

          
          
          
      
          //alert(hli)
          let ar1 = {}
          let myarr2 = {}
          
          for(let i=1; i<=hli; i++){
            
            let ar ={}
            let myar1 = []
            
            for(let j=0; j<full_array.length; j++){
              
              //if(String(i)==String(full_array[j]).substr(0,1)){
            if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.'){ 
                let temp = full_array[j].split('.')
                //alert(temp)
                myar1.push(String(full_array[j]))
                
                if(temp.length == 1){
                  let hid='heading'+ full_array[j];
                  var val = document.getElementById(hid).value;
                  ar[hid]=val

                  
                  
                  if(full_array.includes(String(full_array[j]+'.1')))
                  {
                        a=1;
                            
                  }
                  else{


                      console.log('ff', full_array)
                      let td = 'targetdate' + full_array[j];
                      let mf = 'markeofficer' + full_array[j];
                      let chk = 'check' + full_array[j];
                      //alert(td)

                      //alert(chk)
                      var tddate = document.getElementById(td).value;


                      
                      let chk_val = document.getElementById(chk)
                      // alert(chk_val)
                      if (chk_val.checked == true){
                          var checkbox = '1'
                          //alert(checkbox)
                      }
                      else if (chk_val.checked == false){

                        checkbox = '0'
                        //alert(checkbox)
                      }
                      
                      var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                      
                      ar[td]=tddate
                      ar[mf]=officer_val
                      ar[chk]=checkbox
                              
                  }

            
                }
                else if(temp.length == 2){
                  let sid='observation'+full_array[j];
                  let td = 'targetdate' + full_array[j];
                  let mf = 'markeofficer' + full_array[j];
                  let chk = 'check' + full_array[j];

                  var val1 = document.getElementById(sid).value;
                  var tddate = document.getElementById(td).value;

                  
                  
                  let chk_val = document.getElementById(chk)
                  // alert(chk_val)
                  if (chk_val.checked == true){
                      var checkbox = '1'
                      // alert(checkbox)
                  }
                  else if (chk_val.checked == false){

                    checkbox = '0'
                    // alert(checkbox)
                  }
                  
                  //alert(checkbox)

                  var officer_val = document.getElementById(mf).getAttribute('custom-offic');

                  if(officer_val == '' && el.value == 'Submit'){
                    alert('Please Add mark officers')
                    return false;
                  }
              
                  ar[sid]=val1
                  ar[td]=tddate
                  ar[mf]=officer_val
                  ar[chk]=checkbox
                } 
                else{
                  let ssid='subdes'+full_array[j];
                  var val2 = document.getElementById(ssid).value;
                  ar[ssid]=val2
                }
                
              }
            }
            
            ar1[String(i)]=ar
            myarr2[String(i)]=myar1
          }
          console.log(ar1)
          console.log(myarr2)
  
      var final_p=JSON.stringify(ar1)
      var id_final = JSON.stringify(myarr2)
  
  
      let data1 = {
          zone: JSON.stringify($('#zone').val()),
          division: JSON.stringify($('#division').val()),
          department: JSON.stringify($('#department').val()),
          location: JSON.stringify($('#location').val()),
          accompany: JSON.stringify($('#accompany').val()),



          txtDate2:$('#txtDate2').val(),
          titleinsp: $('#titleinsp').val(),
          inspection_no: $('#inspection_no').val(),

          buttonValues: el.value,
          final_partinspected:final_p,
          id_partinspected:id_final,
          send_to: document.getElementById('copyto').getAttribute('custom-offic'),
          send_desig: document.getElementById('copyto').value,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        };
      
              $.ajax({
                        type: 'POST',
                          url: "{% url 'update_draft_data' %}",
                          dataType: 'json',
                          data: data1,
                          success: function (response) {
  
                            
                            if(response.status=='Record Saved as Draft.'){
                              window.location.href='{% url "draft_inspection_form" %}'
                            }
                            else if(response.status=='Record Saved'){
                              window.location.href='{% url "inspection_doneby_list" %}'
                            }
                            else{
                              window.location.reload();
                            }
                        
                            
                            
                            
         
                      },
                      error: function (exception) {
                  
                        alert("oops error!");
                      // window.location.reload();
              }
            
        });
           
  }
</script>
<script>
 var hli = 0
  var sli = []
  var ssli = []

  var indexid = {{item_id|safe}}
  console.log(indexid)
  var length_of_h = {{length_of_h}}
      hli += parseInt(length_of_h)
      console.log('hli', hli)


  var sh_list = {{sh_list}}
  var ssh_list = {{ssh_list}}

  for(i in sh_list){
    sli.push(sh_list[i])
  }
  for(j in ssh_list){
    ssli.push(ssh_list[j])
  }
 

  var full_array = []
  
  for(id in indexid){
    full_array.push(indexid[id])
  }


$(document).ready(function(){
              // let rly ="{{ ins_detail.zone }}";
              // console.log(rly);
              // $('select[name="zone"] option:selected').attr("selected", null);
              // $("#zone option[value="+rly+"]").attr("selected", "selected");
              $('#submit2').show()
                $("#addmech").click(function (e) {

                  if (sli.length == 0){
                    alert('Please Add heading First')
                    return false;
                  }
                
                  var table = document.getElementById("addworkmech");
                  e.preventDefault();
                //  var heading= table.insertRow();
                //  h1=headingCount;
                  var row = table.insertRow();

                
                
                  
                  //j1=rowCount;
                  //i1=rowCount;
                  
                  
                  sli[hli-1] = sli[hli-1]+1
                  //let rowlen = parseInt(rowCount)-1
                  console.log(sli)
                  
                  //let item = hli+'.' + String(rowlen)
                  let item = hli+'.' + String(sli[hli-1])
                  ssli.push(0)

                  ///added/////////////////////////////////////
                  let officerid='divofficer'+hli;
                  let markeofficerid='divmarkeofficer'+hli;
                  let targetdateid='divtargetdate'+hli;
                  let div_checkbox='divcheckbox'+hli

                  $('#'+officerid).hide();
                  $('#'+markeofficerid).hide();
                  $('#'+targetdateid).hide();
                  $('#'+div_checkbox).hide();

                  $('#desgnbtn'+hli).hide();
                  $('#desgn'+hli).selectpicker('hide');
                  ///////////////////////////////////////

                //  j1 = j1 + 1;
                //  var work1 = 'work1' + String(j1);
                // var heading_title=heading.insertCell(0);
        
                //  var cell1 = row.insertCell(0);
                  var cell2 = row.insertCell(0);
                  var cell3 = row.insertCell(1);
                  var cell4 = row.insertCell(2);
                  var cell5 = row.insertCell(3);
                  var cell6 = row.insertCell(4);
                  // var cell7 = row.insertCell(5);
                  // var cell8 = row.insertCell(6);

                // cell1.innerHTML =
                // '<td style="width:5px;""><div style="text-align: center; width:5px font-family:verdana;">'+(j1)+'</div></td>';
                
                full_array.push(item)
                
                var itemno='itemno'+item
                var observation='observation'+item
                var officer='officer'+item
                var markeofficer='markeofficer'+item
                var targetdate='targetdate'+item
                var divcheckbox='divcheckbox'+item
                var checkbox='check'+item
                
              
                cell2.innerHTML =
                '<td><div class="autocomplete1"><div style="text-align: center; width:5px font-family:verdana;" id='+itemno+'>'+item+'</div></td>';
            
                
                cell3.innerHTML ='<td><div class="autocomplete1"><textarea maxlength="500" placeholder="Maximum character limit 500" id='+observation+' autocomplete1 = "off"  style="height:50px;" class="form-control" /></textarea></div></td>'; 
                
                //cell4.innerHTML ='<td></td>'
                
                // cell5.innerHTML ='<td><div class="autocomplete1"><button type="button" class="btn btn-primary btn-md" id='+officer+'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" style="margin-left:1vh;margin-top:1vh;"><i class="fas fa-info"></i></button>  </div></td>'; 
                
                let test=item.split('.');
                testid='';
                for(let ii=0;ii<test.length;ii++)
                {
                  if(ii==0)
                    testid=String(test[ii]);
                  else
                    testid=testid+'a'+String(test[ii]);
                }

                cell4.innerHTML = `<td> 
                  <div class="mycls">
                    <a style="display:inline-block;
                        width:130px;
                        height:35px;
                        margin-top:3px;
                        color: white;
                            background-color: darkslategray;
                            padding: 5px 11px;
                            border-style: 2px solid" id="tooltip${testid}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title="Add From Dropdown" >Add From D...</a>  
                     
                    <textarea hidden type="text" class="form-control" placeholder="Add officer" value="" custom-offic="" custom-key="" id='${markeofficer}' class="autocomplete1" readonly></textarea>
                      &nbsp;
                    <div class="multi_select_box" id="divdesgn${testid}" >
                
                          <select id="desgn${item}"  class="desgn${testid} demo w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true" multiple data-selected-text-format="count > 2" multiple>
                            {% for i in desg_no %}
                                <option  value="{{i.designation_code}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
                                {% endfor %}

                          </select>
                          
                          
                          <input type="button" id="desgnbtn${item}" value="Ok" onclick="getOption('desgn${item}' )" hidden>
                          <input type="text" id="desgninp${item}" value="" hidden>

                    </div>
                  </div>
                  
                  
                  </td>`

                $(`#tooltip${testid}`).tooltip();
                $('.demo').selectpicker();
                $(".demo").removeClass("dropdown");
                var button = $(`#divdesgn${testid} .bs-actionsbox .btn-group`);
                button.append(`<button type="button" id="bdesgn${item}" class="btn btn-default btn-light" onclick="getOption('desgn${item}')" hidden>Save</button>`)
                button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${item}');">Close</button>`)
                button.append(`&nbsp;<button type="button" class="btn btn-primary btn-md" style="box-shadow: none;" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()"><i class="fas fa-search"></i></button>`)
                button.append(`<button type="button" id="btndel${testid}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)
                
                $(".demo").on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue) {
                  console.log('b'+this.id);
                  getOption(`desgn${item}`)
                  });

                cell5.innerHTML ='<td><div class="autocomplete1"><input type="text" autocomplete="off" class="form-control datepker" placeholder="dd/mm/yy" style="height: 2em; width: 118px;" id='+targetdate+' readonly> </div></td>'; 
                
                cell6.innerHTML ='<td><div class="autocomplete1" id="'+divcheckbox+'"><input type="checkbox" name="priority" autocomplete="off" id='+checkbox+'>&nbsp; High </div></td>'; 
                
                
              
                $("textarea").each(function () {
                  this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                    }).on("input", function () {
                      this.style.height = "auto";
                      this.style.height = (this.scrollHeight) + "px";
                    });
                function removePopupForBtn(el){
                  let idpattern = '#'+el +' '+'.bootstrap-select'
                  $(idpattern).removeClass('show')
                };

             
                    $(".datepker").datepicker({
                      showOn: 'focus',
                      dateFormat: 'dd/mm/y',
                      showButtonPanel: true,
                      closeText: 'Clear', 
                      minDate: 0,
                      onClose: function () {
                        var event = arguments.callee.caller.caller.arguments[0];
                        // If "Clear" gets clicked, then really clear it
                        if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {
                            $(this).val('');
                        }
                      }
                  });

             
              
              
              });

                
            
          
          $("#addheading").click(function (e) {
            
                  $('#submit2').show()
                  var table = document.getElementById("addworkmech");
                  e.preventDefault();
                
                  var row1 = table.insertRow();
                  var row1Count = 1;
                  hli++;
                  sli.push(0)
                  
                  var cell1 = row1.insertCell(0);
                  var cell2 = row1.insertCell(1);
                //  var cell3 = row.insertCell(2);
                  var cell3 = row1.insertCell(2);
                  var cell4 = row1.insertCell(3);
                  var cell5 = row1.insertCell(4);
                  // var cell6 = row1.insertCell(5);
                  // var cell7 = row1.insertCell(6);
                  
                  
                

                  full_array.push(String(hli))
                  
                  var heading1='heading'+hli


                  cell1.innerHTML='<div style="text-align: center; width:5px font-family:verdana;">'+ hli+'</div>'
                  cell2.innerHTML ='<td><div class="autocomplete1"><textarea maxlength="500" placeholder="Maximum character limit 500" id='+heading1+'  autocomplete1=off  style="height:30px;" class="form-control" /></textarea></div></td>'; 

                  ///added//////////////////////////////////

                  
                  var officer='officer'+hli
                  var markeofficer='markeofficer'+hli
                  var targetdate='targetdate'+hli
                  var divofficer='divofficer'+hli
                  var divmarkeofficer='divmarkeofficer'+hli
                  var divtargetdate='divtargetdate'+hli
                  var divcheckbox='divcheckbox'+hli
                  var checkbox='check'+hli

                // cell3.innerHTML ='<td ></td>'
                
                // cell4.innerHTML ='<td ><div class="autocomplete1" id="'+divofficer+'"><button type="button" class="btn btn-primary btn-md" id='+officer+'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" style="margin-left:1vh;margin-top:1vh;"><i class="fas fa-info"></i></button>  </div></td>'; 
                
                cell3.innerHTML = `<td> 
                  <div class="mycls">
                      <div class="autocomplete1" id="${divmarkeofficer}">
                        <a style="display:inline-block;
                            width:130px;
                            height:35px;
                            margin-top:3px;
                            color: white;
                            background-color: darkslategray;
                            padding: 5px 11px;
                            border-style: 2px solid" id="tooltip${hli}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title="Add From Dropdown" >Add From D...</a>  
                     
                        <textarea hidden type="text" placeholder="Add officer" class="form-control" value="" custom-offic="" custom-key="" id='${markeofficer}' class="autocomplete1" readonly></textarea></div>&nbsp;
                     
                        <div class="multi_select_box" id="divdesgn${hli}" >
            
                        <select id="desgn${hli}" class="desgn${hli} demo w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true" multiple data-selected-text-format="count > 2" multiple>
                              {% for i in desg_no %}
                              <option  value="{{i.designation_code}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
                              {% endfor %}
                        </select>
                        <div class="autocomplete1" id="${divofficer}">
                        <input type="button" id="desgnbtn${hli}" value="Ok" onclick="getOption('desgn${hli}')" hidden>

                        <input type="text" id="desgninp${hli}" hidden >

                      </div>
                      </div>
                  </td>`
                
                  $(`#tooltip${hli}`).tooltip();
              $('.demo').selectpicker();
              $(".demo").removeClass("dropdown");

              var button = $(`#divdesgn${hli} .bs-actionsbox .btn-group`);
              button.append(`<button type="button" id="bdesgn${hli}" class="btn btn-default btn-light" onclick="getOption('desgn${hli}')" hidden>Save</button>`)
              button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${hli}');">Close</button>`)
              button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);
              
              button.append(`<button type="button" id="btndel${hli}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)
               
              $(".demo").on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue) {
                  console.log('b'+this.id);
                  getOption(`desgn${hli}`)
                  });
              
            function removePopupForBtn(el){
                let idpattern = '#'+el +' '+'.bootstrap-select'
                $(idpattern).removeClass('show')
              };
              


                cell4.innerHTML ='<td ><div class="autocomplete1" id="'+divtargetdate+'"><input type="text"  class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;" id='+targetdate+' readonly> </div></td>'; 
                cell5.innerHTML ='<td><div class="autocomplete1" id="'+divcheckbox+'"><input type="checkbox" name="priority" autocomplete="off" id='+checkbox+'>&nbsp; High </div></td>'; 
                   
               
                $(".datepker").datepicker({
                      showOn: 'focus',
                      dateFormat: 'dd/mm/y',
                      showButtonPanel: true,
                      closeText: 'Clear', 
                      minDate: 0,
                      onClose: function () {
                        var event = arguments.callee.caller.caller.arguments[0];
                        // If "Clear" gets clicked, then really clear it
                        if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {
                            $(this).val('');
                        }
                      }
                  });
                //var min = new Date();
                //$('.datepker').datepicker('setDate',min);

                  $("textarea").each(function () {
                  this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                    }).on("input", function () {
                      this.style.height = "auto";
                      this.style.height = (this.scrollHeight) + "px";
                    });

                  ///////////////////////////////////////
                  
          });

          $("#addSubmech").click(function (e) {
            
            var table = document.getElementById("addworkmech");
                  e.preventDefault();
                  let item = hli+'.' + String(sli[hli-1])
                  
                  if(hli == 0){
                    alert('Add Desc First')
                    return false;
                  }
                  if(sli[hli-1] == 0)
                  {
                    alert('Add Sub Desc');
                    return false;
                  }
                  var row1 = table.insertRow();
                  var row1Count = 1;
                  
                  
                  ssli[ssli.length-1] = ssli[ssli.length-1]+1
                  
                  let item2 = item+'.'+String(ssli[ssli.length-1])
                  console.log(ssli)
                  var cell1 = row1.insertCell(0);
                  var cell2 = row1.insertCell(1);
                //  var cell3 = row.insertCell(2);
                  full_array.push(item2)

                  var subheading1='subdes'+item2

                  cell1.innerHTML='<div style="text-align: center;  height:50px; width:5px; font-family:verdana;"></div>'
                  cell2.innerHTML ='<td>'+ item2 +'<div class="autocomplete1"><textarea maxlength="500" placeholder="Maximum character limit 500" id='+subheading1+' autocomplete1 = "off"  style="height:30px;margin-left: 100px; width: 82%;" class="form-control" /></textarea></div></td>'; 

                  $("textarea").each(function () {
                  this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                    }).on("input", function () {
                      this.style.height = "auto";
                      this.style.height = (this.scrollHeight) + "px";
                    });
          });




      $('#deletemech').click(function (e) {
            e.preventDefault();
              var rowCount = $('#addworkmech tr').length;

              ///added////////////////
              var table = document.getElementById("addworkmech"); 
              let val_id=table.rows[rowCount-1].cells[0].innerText;
             
              if(val_id !='')
              {     
                let val_split=val_id.split('.');
                
                if(val_split.length > 1)
                {
                  let del_id=val_split[0]+'.'+'1';
                  if(del_id == val_id)
                  {
                   
                    let officerid='divofficer'+val_split[0];
                    let markeofficerid='divmarkeofficer'+val_split[0];
                    let targetdateid='divtargetdate'+val_split[0];
                    let divcheckbox='divcheckbox'+val_split[0]
                    
                    $('#'+officerid).show();
                    $('#'+markeofficerid).show();
                    $('#'+targetdateid).show();
                    $('#'+divcheckbox).show();

                    $('#desgnbtn'+hli).show();
                      $('#desgn'+hli).selectpicker('show');

                    $("textarea").each(function () {
                      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                        }).on("input", function () {
                          this.style.height = "auto";
                          this.style.height = (this.scrollHeight) + "px";
                    });
                  }

                }
                    
              }
              ///////////////////////////////////////

              j1=rowCount;                    
              if (j1 > 0) {
              //console.log(sli)
              full_array.pop()
              document.getElementById("addworkmech").deleteRow(-1);
              if( hli > 0 && sli[hli-1] !=0 )
              {
               
                  if(ssli[ssli.length-1]==0)
                  {
                    ssli.pop()
                    if(sli[hli-1]==0){
                      sli.pop()
                      hli--;
                    }else{
                      sli[hli-1] = sli[hli-1]-1
                    }
                  }
                  else
                  {
                    ssli[ssli.length-1]=ssli[ssli.length-1]-1
                  }
            }
            else if( hli > 0 && sli[hli-1] == 0 )
              {
                    if(sli[hli-1]==0)
                    {
                      sli.pop()
                      hli--;
                    }
                    else
                    {
                      sli[hli-1] = sli[hli-1]-1
                    }
            }
              j1--;
              

            }
            

      });

      copyToOption1();
});

//================================================================================================           
//================================================================================================           
//================================================================================================         
</script>

<script>
    

var globalarrid=[],main=[];
function remove_save_marked_officers()
{
  if(globalarrid.length==0)
  {
    alert('Nothing to Remove');
    return false;
  }
  globalarrid.pop();
  main.pop();

  document.getElementById('alltext').value=globalarrid;
    
}
function add_save_marked_officers(){
  var emp_no = ""
  var emp_no1 = ""
  var table = $('#text').DataTable();
  table.destroy();
  table = $('#text1').DataTable();
  table.destroy();
  var table = $('#text').DataTable();
  table.destroy();
  table = $('#textdesigselect').DataTable();
  table.destroy();

  
  let lst1='no';
  let lst2='no';
  $("input[type='checkbox'][name='chktext']:not(:checked)").each(function (){
    lst1='yes';
  });
  $("input[type='checkbox'][name='chktext1']:not(:checked)").each(function (){
    lst2='yes';
  });
  var rly_1=$('#rly_1').val();
  var div_1=$('#div_1').val();
  if(globallistgm!='' && lst1 == 'yes')
  { 
    globallistgm='';
  }
  if(globallistbm!='' && lst1 == 'yes')
  { 
    globallistbm='';
  }
  if(globallistphod!='' && lst1 == 'no')
  { 
      let x='';
      if(rly_1 == '')
        globallistphod=globallistphod;
        else{
      for(ii=0;ii<rly_1.length;ii++)
      {
        x=x+globallistphod+'/'+rly_1[ii]+', ';
      }
      globallistphod=x;}
  }
  else if(globallistphod!='' && lst1 == 'yes')
  { 
    globallistphod='';
  }
  if(globallistdrm!='' && lst2 == 'no')
  { let x='';
      if(rly_1 == '')
        globallistdrm=globallistdrm;
      else{
        for(ii=0;ii<rly_1.length;ii++)
        {
          x=x+globallistdrm+'/'+rly_1[ii]+', ';
        }

        globallistdrm=x;}
  }
  else if(globallistdrm!='' && lst2 == 'yes')
  { 
    globallistdrm='';
  }
  let chkdes=0,arrdemp=[],arrsemp=[];
  let g=0,d=0,p=0,b=0,chgdesig ='Y';
  
  $('.messageCheckbox:checkbox:checked').each(function(i){
    //val[i] = $(this).val();
    let oneOffic= $(this).val();
    let id = oneOffic.split(',')[0]
    let desig = oneOffic.split(',')[1]
    
    
    chkdes=0;
    if(desig.startsWith("DRM/") && chgdesig == 'Y')
    {
      chgdesig = 'N';
      if(arrsemp.length != 0)
                  {
                    arrdemp.push(arrsemp);
                    arrsemp=[]
                  }
    }
    if(globallistgm!='' )
    {
          $("input[type='checkbox'][name='chktext']:checked").each(function (){
                if(desig == $(this).val().split(',')[1])
                chkdes=1;
          });
          if(g==0)
          { 
            g=1;
            if(emp_no1!="")
              emp_no1+=',';
          emp_no1 +=globallistgm;

          if(arrsemp.length != 0)
                  {
                    arrdemp.push(arrsemp);
                    arrsemp=[]
                  }
                  
        }
    }
    else if(globallistbm!=''  )
    {
            $("input[type='checkbox'][name='chktext']:checked").each(function (){
                 if(desig == $(this).val().split(',')[1])
                  chkdes=1;
            });
            if(g==0){ g=1;
              if(emp_no1!="")
                emp_no1+=',';
            emp_no1 +=globallistbm;
            if(arrsemp.length != 0)
                  {
                    arrdemp.push(arrsemp);
                    arrsemp=[]
                  }}
    }
    else if(globallistphod!='' )
    {
      $("input[type='checkbox'][name='chktext']:checked").each(function (){
                 if(desig == $(this).val().split(',')[1])
                  chkdes=1;
            });
            if(p==0){ p=1;
              if(emp_no1!="")
                emp_no1+=',';
            emp_no1 +=globallistphod;
            if(arrsemp.length != 0)
                  {
                    arrdemp.push(arrsemp);
                    arrsemp=[]
                  }}
    }
 
    if(globallistdrm!=''  && desig.startsWith("DRM/"))
    {
      $("input[type='checkbox'][name='chktext1']:checked").each(function (){
                 if(desig == $(this).val().split(',')[1])
                    chkdes=1;
            });
            if(d==0){ d=1;
              if(emp_no1!="")
                emp_no1+=',';
            emp_no1 +=globallistdrm;
           
                if(arrsemp.length != 0)
                  {
                    arrdemp.push(arrsemp);
                    arrsemp=[]
                  }}
    }
    if(chkdes == 0)
    {
      if(arrsemp.length != 0)
      {
        arrdemp.push(arrsemp);
      }
      arrsemp=[]
      if(emp_no1!="")
                emp_no1+=',';
      emp_no1 +=desig;
     
      if(emp_no!="")
          emp_no+=',';
      emp_no +=id;
      arrsemp.push(id);
      
    }
    else
    {
      if(emp_no!="")
          emp_no+=',';
      emp_no +=id;
      arrsemp.push(id);
      
    }
    
  });
  arrdemp.push(arrsemp);
  if(emp_no == '')
  {
    alert('Select Checkbox To add');
    $('#text').DataTable();
    $('#text1').DataTable();
    $('#textdesigselect').DataTable();
    return false;
  }
  
    let chkemp_no1=emp_no1.split(',');
    let chkemp_no=emp_no.split(',');

    if(document.getElementById('alltext').value!='')
        globalarrid=(document.getElementById('alltext').value).split(',');
    // for(let ij=0;ij<chkemp_no1.length;ij++)
    // {
    //     if(globalarrid.includes(String(chkemp_no1[ij])))
    //     {
    //       alert(chkemp_no1[ij]+' is already previously added ..');
    //     }
    //     else
    //     {
    //       main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
    //       globalarrid.push(chkemp_no1[ij]);
    //     }
    // }
    // document.getElementById('alltext').value=globalarrid;
    

    
    //////////////////  changed
    let prevpost='',prevchk=0;

for(let ij=0;ij<chkemp_no1.length;ij++)
{
  //alert(chkemp_no1[ij]);
    if(globalarrid.includes(String(chkemp_no1[ij])))
    {
      if (prevpost!='')
        prevpost=prevpost+', ';
      prevpost=prevpost+chkemp_no1[ij];
      prevchk=1;
      //alert(chkemp_no1[ij]+' is already previously added ..');
    }
    
    else if(chkemp_no1[ij] == "All GM's/ZR")
    {
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm].substring(0,3)=='GM/')
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }

      }
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);

    }
    else if(chkemp_no1[ij].substring(0,3)=='GM/')
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All GM's/ZR")
        {
          chkcgm=1
        }

      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
          prevpost=prevpost+', ';
        prevpost=prevpost+chkemp_no1[ij];
        prevchk=1;
      }

    }

    else if(chkemp_no1[ij] == "All DRM's")
    {
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm].substring(0,4)=='DRM/')
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }
        else if(globalarrid[cgm].substring(0,10)=="All DRM's/")
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }

      }
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);

    }

    else if(chkemp_no1[ij].substring(0,4)=='DRM/')
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All DRM's")
        {
          chkcgm=1
        }
        else if(globalarrid[cgm].substring(0,10)=="All DRM's/")
        {
          for(drmi=0;drmi<main[cgm]['designation_code'].length;drmi++)
          {
            if(chkemp_no.includes(main[cgm]['designation_code'][drmi]))
            {
              chkcgm=1;
              break;
            }

          }
        }
      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
            prevpost=prevpost+', ';
          prevpost=prevpost+chkemp_no1[ij];
          prevchk=1;
      }
    }
    
    else if(chkemp_no1[ij].substring(0,10)=="All DRM's/")
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All DRM's")
        {
          chkcgm=1
        }
      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
            prevpost=prevpost+', ';
          prevpost=prevpost+chkemp_no1[ij];
          prevchk=1;
      }
    }
    else
    {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
    }
}



if(prevchk==1)
{
  alert('Following Post Are already Present '+prevpost);
}
for(let remi=globalarrid.length-1;remi>=0;remi--)
{
  if(globalarrid[remi].length==0 || globalarrid[remi]==' ')
        {
          globalarrid.splice(remi,1);
          main.splice(remi,1);
        }

}
//////////////////  changed
document.getElementById('alltext').value=globalarrid;

    

  ele=document.getElementsByName('chktext');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        } 

  ele=document.getElementsByName('chk');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        }

  ele=document.getElementsByName('chktext1');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        } 


        //////////////////  changed
        ele=document.getElementsByName('chkdesig');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        }
//////////////////  changed

  globallistdrm='';
  globallistgm='';
  globallistphod='';
  globallistbm='';
  document.getElementById('allphod').checked=false;
  document.getElementById('allgm').checked=false;
  document.getElementById('allboard').checked=false;
  document.getElementById('alldrm').checked=false;

  document.getElementById('rly_1').value='';
  document.getElementById('div_1').value='';
  document.getElementById('dept_1').value='';
  document.getElementById('desig').value='';
    $('#text').DataTable();
    $('#text1').DataTable();
    $('#textdesigselect').DataTable();
  
}


/////////////////////////////    end 03/08/22   
function save_marked_officers(){
 let emp_no='',emp_no1='';
  for(i=0;i<main.length;i++)
  {
    if(emp_no1!="")
        emp_no1+=',';
      emp_no1+=main[i].desig;
    x=main[i].designation_code;
    if(emp_no!="")
        emp_no+=',';
      emp_no+=main[i].designation_code;
  }
 
  let mark_off = $('#mark_officersss').val();

  if(mark_off=='Copy To'){
                              
    document.getElementById('copyto').value=emp_no1;
    var myInput = document.getElementById('copyto');
        myInput.setAttribute('custom-offic', emp_no);
    let Y = document.getElementById('copyto').scrollHeight
    document.getElementById('copyto').style.height =(10+Y)+"px";


    var myInput = document.getElementById('copyto');
    myInput.setAttribute('custom-key', JSON.stringify(main));

    let cop2 = $('#copyto').attr('custom-offic')
    let new_cop2 = cop2.split(',')
    $('#copy_desgn').selectpicker('val', new_cop2)

    
  }else{
    markofficer='markeofficer'+ mark_off
    document.getElementById(markofficer).value=emp_no1;
    var myInput = document.getElementById(markofficer);
        myInput.setAttribute('custom-offic', emp_no);

        let x = document.getElementById(markofficer).scrollHeight
        document.getElementById(markofficer).style.height =(10+x)+"px";


        var myInput = document.getElementById(markofficer);
        myInput.setAttribute('custom-key', JSON.stringify(main));

        
                let test=mark_off.split('.');
                let testid='';
                for(let ii=0;ii<test.length;ii++)
                {
                  if(ii==0)
                    testid=String(test[ii]);
                  else
                    testid=testid+'a'+String(test[ii]);
                }
                id='btndel'+testid;
               
              document.getElementById(id).click();
              emp_no=emp_no.split(',');
              $(`.desgn${testid}`).selectpicker('val', emp_no);
        
  }
  $('#close1').click();
  

}
      
</script>


<script>




    function select1(id){  
      var table = $('#text1').DataTable();
      table.destroy();
      if(id.checked)
      {
        var ele=document.getElementsByName('chktext1');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=true;  
        }  
        var table = $('#text1').DataTable();
      }
      else
      {
        var ele=document.getElementsByName('chktext1');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        }  
        var table = $('#text1').DataTable();
      }
    }  
    function select21(id){  
      var table = $('#text').DataTable();
      table.destroy();
      if(id.checked)
      {
        var ele=document.getElementsByName('chktext');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=true;  
        }  
        var table = $('#text').DataTable();
      }
      else
      {
        var ele=document.getElementsByName('chktext');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        }  
        var table = $('#text').DataTable();
      }
    }  
  
   
  
</script>
    
<script>

var globaldiv='';
function setvalueIN(){
  
  $("#alltext").css({"height": "50px",});
  main=[];
  globalarrid=[];

  let zone = $('#zone').val();
  $('#rly_1').val(zone);

var arrayArea = $('#department').val();
$('#dept_1').select2({}).select2('val', arrayArea);

  if($('#division').val()!='')
    globaldiv=$('#division').val();
  $('#rly_1').select2().trigger('change');
  

  let mark_off = $('#mark_officersss').val();

if(mark_off=='Copy To'){
   
    var myInput = document.getElementById('copyto');
    var officer_val11=myInput.getAttribute('custom-key');
    
    document.getElementById('alltext').value=document.getElementById('copyto').value;
    
}
else{
      markofficer='markeofficer'+ mark_off
      var myInput = document.getElementById(markofficer);
      var officer_val11=myInput.getAttribute('custom-key');
      document.getElementById('alltext').value=document.getElementById(markofficer).value;   
}
if((document.getElementById('alltext').value).length>0)
{
  globalarrid=String(document.getElementById('alltext').value).split(',');
  main=JSON.parse(officer_val11);
}


  
}


function setCopyValue()
{

  $('#rly_1').select2().trigger('change');
  
  setvalueIN();
  
}


function hidetable(e){
  //alert(e.id)
  if (e.id == 'Copy To'){
    $('#mark_officersss').val(e.id);
  }
  else{
    $('#mark_officersss').val((e.id).substr(7));
  }
  $("#alltext").css({"height": "50px",});
  
  $('#text').show(); $('#text1').hide(); $('#table2').hide(); $('#table3').hide(); $('#table4').hide(); $('#table5').hide();
  

}


          
                  // Read selected option
$('#rly').click(function(){
  var username = $('#rly option:selected').text();
  var userid = $('#rly').val();
                
                   
                    
});

$("#rly_1").select2();
          
          // Read selected option
$('#rly_1').click(function(){
  var username = $('#rly_1 option:selected').text();
  var userid = $('#rly_1').val();
                         
});

$("#div_1").select2();
          
// Read selected option

$('#div_1').click(function(){
  var username = $('#div_1 option:selected').text();
  var userid = $('#div_1').val();
});

$("#division").select2();
          
$('#division').click(function(){
  var username = $('#div option:selected').text();
  var userid = $('#div').val();
});

$("#department").select2();
          
$('#department').click(function(){
    var username = $('#department option:selected').text();
    var userid = $('#department').val();
});

//////////////////////////////////////////////
$('#desig').select2({});

var globaldesigid=[];


function selordesel(id)
{
      var table = $('#textdesig').DataTable();
      table.destroy();
      var table1 = $('#textdesigselect').DataTable();
      table1.destroy();
     
      if(id.checked)
      {
        globaldesigid=[];
        $('#textdesigselect tbody').empty();
        var row='';
        var ele=document.getElementsByName('chkdesig');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox') 
               {
                ele[i].checked=true; 
                let id=ele[i].id;
                val=ele[i].value;
                val=val.split(',')
                globaldesigid.push(id.substring(2,id.length));
                row += "<tr id='trid"+id+"'>";  
                row+=  '<td hidden><input checked type="checkbox" id="'+val[0]+'" class="messageCheckbox" value="'+(val[0]+','+val[1])+'" name="chk" ></td>';
                row += '<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="'+val[0]+'" hidden>'+val[0]+'</td>';
                row += '</tr>';
            
               } 
        }  
        $('#textdesigselect tbody').append(row);
        var table1 = $('#textdesigselect').DataTable();
        var table = $('#textdesig').DataTable();
      }
      else 
      {
        var ele=document.getElementsByName('chkdesig');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        }  
        globaldesigid=[];
        $('#textdesigselect tbody').empty();
        var table1 = $('#textdesigselect').DataTable();
        var table = $('#textdesig').DataTable();
      }       
}

function selectdesig(val)
{
  let id=val.id;
  val=val.value;
  
  var table = $('#textdesigselect').DataTable();
  table.destroy();
  val=val.split(',');
  var row='';
  if(document.getElementById(id).checked==true)
      {
        globaldesigid.push(id.substring(2,id.length));
          row += "<tr id='trid"+id+"'>";  
              row+=  '<td hidden><input checked type="checkbox" id="'+val[0]+'" class="messageCheckbox" value="'+(val[0]+','+val[1])+'" name="chk" ></td>';
            row += '<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="'+(val[2]+','+val[1])+'" hidden>'+(val[2]+','+val[1])+'</td>';
            row += '</tr>';
            $('#textdesigselect tbody').append(row);
            var table = $('#textdesigselect').DataTable();
      }
      else 
      {
        let id1=id.substring(2,id.length);
        id='trid'+id;

            index = globaldesigid.indexOf(id1);
            if (index > -1) { 
              globaldesigid.splice(index, 1);
            }

        var row = document.getElementById(id);
        row.parentNode.removeChild(row);
        var table = $('#textdesigselect').DataTable();
      }       
}

function getdesigdata()
{
  let desig=$('#desig').val();
  $('#showdiv1').hide();
  $('#showdiv2').show();
  $('#textdesigselect').DataTable();
  var table = $('#textdesig').DataTable();
    table.destroy();

  data={
          'desig':desig,
      }
            $.ajax({
                type: "GET",
                url: "{% url 'designation_wise' %}",
                data: data, //--> send id of checked checkbox on other page
                success: function(mydata) {
                   let row = "";
                    let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="selordesel(this)"></th>
                    <th>Division Officers</th></tr></thead>`;
                    
                    for (let i = 0; i < mydata.length; i++) {
                     
   

                      if(globaldesigid.includes(mydata[i]['designation']))
                       { 
                          row += "<tr>";  
                          row+=  `<td><input type="checkbox" checked id="ab${mydata[i]['designation_code']}"  value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chkdesig" onclick="selectdesig(this)"></td>`;
                          row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden >
                            ${mydata[i]['desig_longdesc']}</td>`;
                        
                          row += `</tr>`;
                       }
                       else
                       {
                          row += "<tr>";  
                          row+=  `<td><input type="checkbox"  id="ab${mydata[i]['designation_code']}"  value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chkdesig" onclick="selectdesig(this)"></td>`;
                          row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden >
                            ${mydata[i]['desig_longdesc']}</td>`;
                        
                          row += `</tr>`;
                       }

                    }
                    
                    $('#textdesig thead').remove();
                    $('#textdesig tr').remove();
                    $('#textdesig').append(head);
                    $('#textdesig tbody').append(row);
                    
                    $('#textdesig').DataTable();
                      
       
                },
           
            });

}

$(".datepker").datepicker({
    showOn: 'focus',
    dateFormat: 'dd/mm/y',
    showButtonPanel: true,
    closeText: 'Clear', 
    minDate: 0,
    onClose: function () {
      var event = arguments.callee.caller.caller.arguments[0];
      // If "Clear" gets clicked, then really clear it
      if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {
          $(this).val('');
      }
    }
});
//////////////////////////////////////
$('#desig').click(function(){
    var username = $('#desig option:selected').text();
    var userid = $('#desig').val();
});

$("#dept_1").select2();
          
$('#dept_1').click(function(){
    var username = $('#desig option:selected').text();
    var userid = $('#desig').val();
});
</script>
   
<script>

function getdivdeptdata()
{
  $('#showdiv1').show();
  $('#showdiv2').hide();
  getdivwisedata();
  fungetzonedata();
}

function getdivwisedata()
{
  $('#showdiv1').show();
  $('#showdiv2').hide();
  var table = $('#text1').DataTable();
    table.destroy();
    $('#text1').hide();
    var rly_1=$('#rly_1').val();
      var div_1=$('#div_1').val();
      var dept_1=$('#dept_1').val();
      data={
          'rly_1':rly_1,
          'dept_1':dept_1,
          'div_1':div_1,
          
        }
            $.ajax({
                type: "GET",
                url: "{% url 'division_wise1' %}",
                data: data, //--> send id of checked checkbox on other page
                success: function(response) {
                 
                  mydata=response.divwise;
                   let row = "";
                    let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select1(this)"></th>
                    <th>Division Officers</th></tr></thead>`;
                    for (let i = 0; i < mydata.length; i++) {
                        row += "<tr>";  
                          row+=  `<td><input type="checkbox" id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext1" ></td>`;
                          row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                            ${mydata[i]['desig_longdesc']}</td>`;
                        
                        row += `</tr>`;
                    }
                    $('#text1 thead').remove();
                    $('#text1 tr').remove();
                    $('#text1').append(head);
                    $('#text1 tbody').append(row);
                    $('#text1').show();
                    $('#text1').DataTable();
                      
       
                },
            });
  document.getElementById('allphod').checked=false;
  document.getElementById('allgm').checked=false;
  document.getElementById('allboard').checked=false;
  document.getElementById('alldrm').checked=false;
           
}

    $('#allgm').click(function() {
      document.getElementById('allboard').checked=false;
      document.getElementById('allphod').checked=false;
      var table = $('#text').DataTable();
        table.destroy();
      var rly_1=$('#rly_1').val();
      data={
          'rly_1':rly_1,
          
      }
      globallistgm='';
       if(this.checked){
        globallistgm= "All GM's/ZR";
          $.ajax({
                type: "GET",
                url: "{% url 'gm_list_officers' %}",
                data: data, //--> send id of checked checkbox on other page
                success: function(response) {
                 
                    mydata=response.allgm;
                    let row = "";
                    let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                    <th>Division Officers</th></tr></thead>`;
                    for (let i = 0; i < mydata.length; i++) {
                      row += "<tr>";  
                          row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                          row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                            ${mydata[i]['desig_longdesc']}</td>`;
                          row += `</tr>`;
                    }
                    $('#text thead').remove();
                    $('#text tr').remove();
                    $('#text').append(head);
                    $('#text tbody').append(row);
                    $('#text').show();
                    $('#text').DataTable();
               
                }, 
            });

        }
        else{
          globallistgm='';
          var ele=document.getElementsByName('chktext');  
          for(var i=0; i<ele.length; i++){  
              if(ele[i].type=='checkbox')  
                  ele[i].checked=false;  
          }  
              var table = $('#text').DataTable();
            }
      });   

      
    $('#alldrm').click(function() {
          
      var table = $('#text1').DataTable();
      table.destroy();
        var div_1=$('#rly_1').val();
          data={
              'div_1':div_1,
              
          }
          globallistdrm='';   
       if(this.checked){
        globallistdrm="All DRM's"
            $.ajax({
                type: "GET",
                url: "{% url 'drm_officers' %}",
                data: data, //--> send id of checked checkbox on other page
                success: function(response) {
                 
                  mydata=response.alldrm;
                  let row = "";
                    let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select1(this)"></th>
                    <th>Division Officers</th></tr></thead>`;
                    for (let i = 0; i < mydata.length; i++) {
                      row += "<tr>";  
                          row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext1"  ></td>`;
                          row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                            ${mydata[i]['desig_longdesc']}</td>`;
                          row += `</tr>`;
                    }
                    $('#text1 thead').remove();
                    $('#text1 tr').remove();
                    $('#text1').append(head);
                    $('#text1 tbody').append(row);
                    $('#text1').show();
                    $('#text1').DataTable();       
                },
  
            });

            }

            else{
              globallistdrm=''; 
              var ele=document.getElementsByName('chktext1');  
          for(var i=0; i<ele.length; i++){  
              if(ele[i].type=='checkbox')  
                  ele[i].checked=false;  
          }  
              var table = $('#text1').DataTable();
            }
      });   

 
    $('#allphod').click(function() {
      document.getElementById('allboard').checked=false;
      document.getElementById('allgm').checked=false;
      var table = $('#text').DataTable();
        table.destroy();
      var rly_1=$('#rly_1').val();
      data={
          'rly_1':rly_1,
      }
      globallistphod='';
       if(this.checked){
        globallistphod="All PHOD's";
          $.ajax({
                type: "GET",
                url: "{% url 'phod_officers' %}",
                data: data, //--> send id of checked checkbox on other page
                success: function(response) {
                 
                    mydata=response.allphod;
                    let row = "";
                    let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                    <th>Division Officers</th></tr></thead>`;
                    for (let i = 0; i < mydata.length; i++) {
                      row += "<tr>";  
                          row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                          row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                            ${mydata[i]['desig_longdesc']}</td>`;
                          row += `</tr>`;
                    }
                    $('#text thead').remove();
                    $('#text tr').remove();
                    $('#text').append(head);
                    $('#text tbody').append(row);
                    $('#text').show();
                    $('#text').DataTable();
               
                }, 
            });

        }
        else{
          globallistphod='';
          var ele=document.getElementsByName('chktext');  
          for(var i=0; i<ele.length; i++){  
              if(ele[i].type=='checkbox')  
                  ele[i].checked=false;  
          }  
              var table = $('#text').DataTable();
            }
    }); 
   
    $('#allboard').click(function() {
      document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      var table = $('#text').DataTable();
        table.destroy();
      var rly_1=$('#rly_1').val();
      data={
          'rly_1':rly_1,
          
      }
      globallistbm=''; 
       if(this.checked){
        globallistbm="All Board Member's"; 
          $.ajax({
                type: "GET",
                url: "{% url 'board_officers' %}",
                data: data, //--> send id of checked checkbox on other page
                success: function(response) {
                 
                    mydata=response.allboard;
                    let row = "";
                    let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                    <th>Division Officers</th></tr></thead>`;
                    for (let i = 0; i < mydata.length; i++) {
                      row += "<tr>";  
                          row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                          row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                            ${mydata[i]['desig_longdesc']}</td>`;
                          row += `</tr>`;
                    }
                    $('#text thead').remove();
                    $('#text tr').remove();
                    $('#text').append(head);
                    $('#text tbody').append(row);
                    $('#text').show();
                    $('#text').DataTable();
               
                }, 
            });

        }
        else{
          globallistbm='';
          var ele=document.getElementsByName('chktext');  
          for(var i=0; i<ele.length; i++){  
              if(ele[i].type=='checkbox')  
                  ele[i].checked=false;  
          }  
              var table = $('#text').DataTable();
            }
}); 

 function fungetzonedata()
 {
  $('#showdiv1').show();
  $('#showdiv2').hide();
      var table = $('#text').DataTable();
      table.destroy();
      $('#text').hide();
      var rly_1=$('#rly_1').val();
      var div_1=$('#div_1').val();
      var dept_1=$('#dept_1').val();
      data={
          'rly_1':rly_1,
          'dept_1':dept_1,
          'div_1':div_1,
          
        }
            $.ajax({
                type: "GET",
                url: "{% url 'headqwise' %}",
                data: data,
                success: function(response) {
                  mydata=response.hqwise;
                  let row = "";
                  let head = `<tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                    <th>Zonal Officers</th></tr>`;
                    
                   
                      for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                          row+=  `<td><input type="checkbox" id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                          row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                            ${mydata[i]['desig_longdesc']}</td>`;
                          row += `</tr>`;
                      }
                    
                    $('#text thead').empty();
                    $('#text tbody').empty();
                    //$('#text tr').remove();
                    $('#text thead').append(head);
                    $('#text tbody').append(row);
                    $('#text').show();
                    $('#text').DataTable();      
                   
                },
                
               
            });
            document.getElementById('allphod').checked=false;
  document.getElementById('allgm').checked=false;
  document.getElementById('allboard').checked=false;
  document.getElementById('alldrm').checked=false;
 }
        

  $('#rly_1').change(function() {
        var rly_1=$('#rly_1').val();
        if(rly_1 == []) 
          return false;
        let divdata=$('#div_1').val();
       
        // elif(dept_1 == [] && rly_1 == [])
        //   return false;
        // elif(dept_1 != [])
        //   return false;
        data={
            'rly_1':rly_1,
        }
      
        $.ajax({
          type : 'GET',
          url : "{% url 'division_by_rly1' %}",
          dataType : 'json',
          data : data,
    
          success : function(response){
            division=response.division;
            $('#div_1').empty();
            
              for (let i = 0; i < division.length; i++) {
                if(globaldiv.length!=0)
                {
                  if(globaldiv == division[i])
                    { 
                      $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
                    }
                  else
                    $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
                }
                else
                {
                  if(divdata.includes(division[i]))
                    { 
                      $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
                    }
                  else
                    $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
                }
    
              }
              globaldiv=[];
              fungetzonedata();
              $('#div_1').select2().trigger('change');          
          }
    
          
        })
              
      })  
    



    

</script>
        <script>
      //     var officer = $('#officer_code1').val();
      //     officers = JSON.stringify(officer);
      //      document.getElementById('officer_code_hidden').value = officers;
           


        
      //  $(document).ready(function () {
      //      setSelect2();
      //  });

      //  function setSelect2() {
      //      var selectedValues = new Array();

      //      if ("{{officer_code1.empno}}" != "") {
      //          var trades = "{{biodetails.instructor_trades}}";
      //          trades = trades.split(',');
      //          selectedValues.length = 0;
      //          selectedValues = trades;
      //      }

 
   
      //      $('#officer_code1').select2();
      //      $('#officer_code1').val(selectedValues)
      //      $('#officer_code1').trigger('change');}


          
       </script>


<script>
  // $('#txtDate2').datepicker({
  //   dateFormat: 'dd/mm/yy',
  //   maxDate: 0
    
  // })


//     $(function(){
//      var dtToday = new Date();

//      var month = dtToday.getMonth() + 1;
//      var day = dtToday.getDate();
//      var year = dtToday.getFullYear();

//      if(month < 10)
//          month = '0' + month.toString();
//      if(day < 10)
//          day = '0' + day.toString();

//      var maxDate = year + '-' + month + '-' + day;    
//      $('#txtDate2').attr('max', maxDate);
//  });



$(function() {
    $('input[name="daterange1"]').daterangepicker({
        autoUpdateInput: false,
        autoApply: true,
        maxDate: new Date(),
        "opens": "left",
        locale: {
            cancelLabel: 'Clear'
        }
    });

    $('input[name="daterange1"]').on('apply.daterangepicker', function(ev, picker) {
      $(this).val(picker.startDate.format('DD/MM/YY') + ' to ' + picker.endDate.format('DD/MM/YY'));
      
      if(picker.startDate.format('DD/MM/YY') == picker.endDate.format('DD/MM/YY')){
          $(this).val(picker.startDate.format('DD/MM/YY'))
        }
        else{
          $(this).val(picker.startDate.format('DD/MM/YY') + ' to ' + picker.endDate.format('DD/MM/YY'));
        
        }
      
      $('.applyButtonClasses').click()

    });

    $('input[name="daterange1"]').on('cancel.daterangepicker', function(ev, picker) {
        $(this).val('');
    });

});




function setTitle() {

  let zone = $('#zone').val()
  let division = $('#division').val()
  let department = $('#department').val()
  let txtDate = $('#txtDate2').val()
  let user = '{{desig}}'
  let title = 'Inspection of'
  //alert(zone+'----'+ user +'----'+department)

  
  var x = document.getElementById("location");
  x.value = x.value.toUpperCase();

  if(zone==null){
    alert('Please select Rly/Org')
    return false;
  }
  
  if(division == '' || division == null){
    $('#titleinsp').val(title+' '+x.value+' '+zone +' by '+user+' date: '+txtDate)
  }
  else{
    $('#titleinsp').val(title+' '+x.value+'  '+zone +'/'+division+' by '+user+' date: '+txtDate)
  }
  
}

// $('#zone').change(function(){
//   $('#titleinsp').val('')
// })
// $('#division').change(function(){
//   $('#titleinsp').val('')
// })
// $('#department').change(function(){
//   $('#titleinsp').val('')
// })
// $('#location').change(function(){
//   $('#titleinsp').val('')
// })








</script>
<script>
$('#zone').change(function() {
        var rly=$('#zone').val();
        console.log("zone",rly)
    
            data={
                'rly_data': JSON.stringify(rly)
                
              }
    
              $.ajax({
                type : 'GET',
                url : "{% url 'getdiv_rly' %}",
                dataType : 'json',
                data : data,
    
                success : function(response){
                  division=response.division;
                              $('#division').empty();
                              $('#division').append(`<option value="" disabled>NA</option>`);
                              for (let i = 0; i < division.length; i++) {
                              $('#division').append(`<option value="${division[i].location_code}">${division[i].location_code}</option>`);
                    }
                }
              })
      });




function changeColorBtn(el){
  let val = el.id
  if (val == 'addheading'){
    document.getElementById('addheading').style.backgroundColor = "#3333ff";
    document.getElementById('addmech').style.backgroundColor = "#337AB7";
    document.getElementById('addSubmech').style.backgroundColor = "#337AB7";
  }
  else if(val == 'addmech'){
    document.getElementById('addheading').style.backgroundColor = "#337AB7";
    document.getElementById('addmech').style.backgroundColor = "#3333ff";
    document.getElementById('addSubmech').style.backgroundColor = "#337AB7";
  }
  else if(val == 'addSubmech'){
    document.getElementById('addheading').style.backgroundColor = "#337AB7";
    document.getElementById('addmech').style.backgroundColor = "#337AB7";
    document.getElementById('addSubmech').style.backgroundColor = "#3333ff";
  }

}


</script>

<script>
  $("textarea").each(function () {
  this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
    }).on("input", function () {
      this.style.height = "auto";
      this.style.height = (this.scrollHeight) + "px";
    });


    window.setTimeout(function() {

      $(".alert-remove").slideUp(100, function() {
          $(this).remove();
      });
    }, 2000);


   
</script>

    
<script>

  

 var globalfavlst=[];
 
 function getOption(e){
     //alert('ffffffff')
    let id=e.substring(5,e.length);
    var options = document.getElementById(e).selectedOptions;
    var values = Array.from(options).map(({ value }) => value);
    //alert(values)
    let tooltipid='tooltip'+ id.replaceAll('.','a');
    let markofficer='markeofficer'+ id;
    let desgnbtn = 'desgnbtn'+id
    //alert(desgnbtn)
    //document.getElementById(desgnbtn).click()
    let lt='desgninp'+id;
    let notexist=[], altext=document.getElementById(lt).value;
    altext=altext.split(',');
    
    var myInput = document.getElementById(markofficer);
    var officer_id=myInput.getAttribute('custom-offic');
   
    if(officer_id.length!=0)
    {
      officer_id=officer_id.split(',');
    }
    else
    {
      officer_id=[];
    }

    officer_id=[...new Set(officer_id.concat(values))]
    
    for(let i=0;i<altext.length;i++)
    {
      if(values.includes(String(altext[i])))
      {
        continue;
      }
      else
      {
            var index = officer_id.indexOf(altext[i]);
            if (index !== -1) {
              officer_id.splice(index, 1);
            }
      }
          
    }

    document.getElementById(lt).value=values;
    //console.log('oooooo', values)
    data={
        'officer_id': JSON.stringify(values),
        'csrfmiddlewaretoken': '{{csrf_token}}'
      }

      $.ajax({
        type : 'POST',
        url : "{% url 'desig_changecode' %}",
        dataType : 'json',
        data : data,

        success : function(response){
          marked_id=JSON.parse(response.marked_id);
          marked_desig=response.marked_desig;
          marked_key=JSON.parse(response.marked_key);

          document.getElementById(markofficer).value=marked_desig;
          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-offic', marked_id);
          // let x = document.getElementById(markofficer).scrollHeight;
          // document.getElementById(markofficer).style.height =(10+x)+"px";

          const tx = document.getElementsByTagName("textarea");
          for (let i = 0; i < tx.length; i++) {
            tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
            tx[i].addEventListener("input", OnInput, false);
          }

          function OnInput() {
            this.style.height = 0;
            this.style.height = (this.scrollHeight) + "px";
          }
          $("textarea").trigger("input");
          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-key',JSON.stringify(marked_key));

         
          myInput = document.getElementById(tooltipid);
          
          if(marked_desig.length==0)
          {
            marked_desig='Add From Dropdown'
          }
          myInput.innerHTML=truncateString(marked_desig,10);
          marked_desig=marked_desig.replaceAll(',',', ')
          myInput.title=marked_desig;
          $('#'+tooltipid).tooltip();
        }
      })



}



function addDesigBy(el){
  let id = el.id.substr(5)
    getOption(`desgn${id}`)
  
}




function copyToOption1(){
      let des_no = `{{des_id|safe}}`;
      let nedata = JSON.parse(des_no)
    
      $(".demo").removeClass("dropdown");
      var button,d_id,officer_val;
      for(i in nedata)
      {
        
        d_id =  nedata[i].replace('.','a');
        
        let tooltipid='tooltip'+ d_id.replaceAll('a','.');
        //alert(tooltipid)
        
        button = $(`#divdesgn${d_id} .bs-actionsbox .btn-group`);
        button.append(`<button hidden type="button" id="savebtn${nedata[i]}" class="btn btn-default btn-light" onclick="getOption('desgn${nedata[i]}')">Save</button>`);
        button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForPreview();">Close</button>`)
        button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='officer${nedata[i]}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);
        button.append(`<button type="button" id="btndel${d_id}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)
        
      
        
        officer_val = document.getElementById('markeofficer'+nedata[i]).getAttribute('custom-offic');
        var officer_desig = document.getElementById('markeofficer'+nedata[i]).value;
        officer_desig = officer_desig.split(',')
        officer_val=officer_val.split(',')
        
        $(`.desgn${d_id}`).selectpicker('val', officer_val);
        
        let toltip_id = 'tooltip'+d_id
        
        document.getElementById('markeofficer'+nedata[i]).value=officer_desig;
        getOption(`desgn${nedata[i]}`)
        $(`#${toltip_id}`).tooltip();
        
      
      } 
}

function removePopupForPreview(){
    $('#demo-copy .bootstrap-select').removeClass('show')
  }




  $('.demo-copy').selectpicker()
      $(".demo-copy").removeClass("dropdown");
      var button = $(`#copy_divdesgn .bs-actionsbox .btn-group`);
      button.append(`<button hidden type="button" class="btn btn-default btn-light" onclick="copyToOption();">Save</button>`)
      button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopup();">Close</button>`)
      button.append(`<button type="button" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)
      button.append(`<button id="Copy To" class="btn btn-default btn-light" value="Copy To" data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setCopyValue();"><i class="fas fa-search"></i></button>`)
      let cop = $('#copyto').attr('custom-offic')
      
      $(".demo-copy").on("changed.bs.select", function(clickedIndex, isSelected, oldValue) {
      //console.log('b'+this.id);
        copyToOption(cop)
        // console.log('cop', cop)
    
  });

  function removePopup(){
    $('#demo-copy .bootstrap-select').removeClass('show')
  }

  $(document).ready(function(){
    let cop = $('#copyto').attr('custom-offic')
    let new_cop = cop.split(',')
    $('.demo-copy').selectpicker('val', new_cop)
  })
 
  
  function copyToOption(cop){
    
    
    // let id=e.substring(5,e.length);
    var options = document.getElementById('copy_desgn').selectedOptions;
    var values = Array.from(options).map(({ value }) => value);
    
    let lt='copy_desgninp';
    let notexist=[], altext=document.getElementById(lt).value;
    altext=altext.split(',');

    let markofficer='copyto';
    var myInput = document.getElementById(markofficer);
    var officer_id=myInput.getAttribute('custom-offic');
    if(values.length==0 && officer_id.length==0)
    {
      //alert('Please select Designation to Add');
      return false;
    }
    if(officer_id.length!=0)
    {
      officer_id=officer_id.split(',');
    }
    else
    {
      officer_id=[];
    }

    officer_id=[...new Set(officer_id.concat(values))]
    
    for(let i=0;i<altext.length;i++)
    {
      if(values.includes(String(altext[i])))
      {
        continue;
      }
      else
      {
            var index = officer_id.indexOf(altext[i]);
            if (index !== -1) {
              officer_id.splice(index, 1);
            }
      }
          
    }
    document.getElementById(lt).value=values;
    //console.log('rrrrrrrrrrrrrr', officer_id)
    
    
        data={
          'officer_id': JSON.stringify(officer_id),
          'csrfmiddlewaretoken': '{{csrf_token}}'
        }
        
        $.ajax({
          type : 'POST',
          url : "{% url 'desig_changecode' %}",
          dataType : 'json',
          data : data,

          success : function(response){
            marked_id=JSON.parse(response.marked_id);
            marked_desig=response.marked_desig;
            marked_key=JSON.parse(response.marked_key);
          
            document.getElementById(markofficer).value=marked_desig;
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-offic', marked_id);
            // let x = document.getElementById(markofficer).scrollHeight;
            // document.getElementById(markofficer).style.height =(10+x)+"px";
            if (values ==''){
              myInput.setAttribute('custom-offic', '')
              document.getElementById(markofficer).value='';
              myInput.setAttribute('custom-key','');
              
            }

            const tx = document.getElementsByTagName("textarea");
            for (let i = 0; i < tx.length; i++) {
              tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
              tx[i].addEventListener("input", OnInput, false);
            }

            function OnInput()
            {
              this.style.height = 0;
              this.style.height = (this.scrollHeight) + "px";
            }
        
            $("textarea").trigger("input");
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-key',JSON.stringify(marked_key));
            
          }
        })
      
   
    }
    $('.demo').selectpicker();


    //button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${hli}');">Close</button>`)

// function copyToOption12(el){
  
//   let id = '#'+el.dataset.id
//   console.log(id)
//   let lastid = el.dataset.id.replace('desgn', '')
//   alert(lastid)
//   $(id).on("changed.bs.select", function(clickedIndex, isSelected, oldValue) {
//     alert('fsdfdsf')
//     console.log(clickedIndex, isSelected, oldValue);
//     getOption(el.dataset.id)
//   });
//   document.getElementById('markeofficer'+lastid)

//         let officer_val = document.getElementById('markeofficer'+lastid).getAttribute('custom-offic');
//         console.log(officer_val)
//         officer_val=officer_val.split(',')
//         $(id).selectpicker('val', officer_val);

//         //$('#'+tooltipid).tooltip();
// }





</script>

<script>
  //  $(window).bind('beforeunload', function(){
  //         // let save = $('#draft').val()
  //         // alert(save)
  //         //Save as draft
  //       return 'Are you sure you want to leave?';
  //     });
  
  //ADD $('#submit1').show() INSIDE ADD HEADING AND ADD MECH FUNCTION TO SHOW THE OTP BUTTON 
  //ADD  MODAL INSIDE CREATE INSPECTION FORM otpModalCenter 
  $(document).ready(function(){
    let lenOfarr = full_array.length
    if (lenOfarr > 0){
      $('#submit2').show()
    }
    else{
      $('#submit2').hide()
    }
  })
  
  let timerOn = true;
  function timer(remaining) {
    var m = Math.floor(remaining / 60);
    var s = remaining % 60;
    
    m = m < 10 ? '0' + m : m;
    s = s < 10 ? '0' + s : s;
    document.getElementById('timer').innerHTML = m + ':' + s;
    remaining -= 1;
    
    if(remaining >= 0 && timerOn) {
      setTimeout(function() {
          timer(remaining);
      }, 1000);
      return;
    }
  
    if(!timerOn) {
      // Do validate stuff here
      return;
    }
    
    // Do timeout stuff here
    alert('Timeout for otp');
  }
  
  function chkvalidation()
  {
              var zone=$("#zone").val();
              var division=$("#division").val();
              var location=$("#location").val();
              var department=$('#department').val();
              var inspection_date=$('#txtDate2').val();
       
              if(full_array.length == 0){
                alert('Please Enter Inspection Details')
                return false;
              }
              for(let i=1; i<=hli; i++){
                
                for(let j=0; j<full_array.length; j++){
                  
                  if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.'){
                    let temp = full_array[j].split('.')
                    
                    
                    if(temp.length == 1){
                      let hid='heading'+ full_array[j];
                      var val = document.getElementById(hid).value;
                      
      
                      if(val == ''){
                        alert('Please fill some data in inspection para')
                        return false;
                      }
                      
                      if(full_array.includes(String(full_array[j]+'.1')))
                      {
                        a=1;
                                 
                      }
                      else{
                          
                          let td = 'targetdate' + full_array[j];
                          let mf = 'markeofficer' + full_array[j];
                          let chk = 'check'+ full_array[j]
      
                      
                          var tddate = document.getElementById(td).value;
                      
                          let chk_val = document.getElementById(chk)
                            
                          
                            if (chk_val.checked == true){
                                var checkbox = '1'
                               
                                
                            }
                            else if (chk_val.checked == false){
  
                              checkbox = '0'
                              
                              
                            }
                          var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                          if(officer_val == ''){
                            alert('Please Add mark officers')
                            return false;
                          }
                  
                      }
                      
                    }
                    else if(temp.length == 2){
                      let sid='observation'+full_array[j];
                      let td = 'targetdate' + full_array[j];
                      let mf = 'markeofficer' + full_array[j];
                      let chk = 'check'+ full_array[j]
                      var val1 = document.getElementById(sid).value;
                      var tddate = document.getElementById(td).value;
                      let chk_val = document.getElementById(chk)
                        // alert(chk_val)
                        if (chk_val.checked == true){
                            var checkbox = '1'
                            //alert(checkbox)
                        }
                        else if (chk_val.checked == false){
  
                          checkbox = '0'
                          //alert(checkbox)
                        }
      
                      var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                      
                     
                    } 
                    else{
                      let ssid='subdes'+full_array[j];
                      var val2 = document.getElementById(ssid).value;
                      if(val2 == ''){
                        alert('Please add description')
                        return false;
                      }
                      
                    }
                    
                  }
                }

              }
    
          if(zone =='' || zone==null){
            alert("Please fill Rly/Org ")
            return false;
          }
          
          if(inspection_date=='' || inspection_date==undefined){
              alert("Please fill date of inspection ")
              return false;
          }
          if($('#titleinsp').val()==''){
            alert("Please fill title of inspection ")
            return false;
          }
          
            
          for(x in full_array){
            let spid = full_array[x].split('.')
            
            if(spid.length == 2){
              let offid = 'markeofficer'+full_array[x]
              let offVal = document.getElementById(offid).value
              
              if(offVal == ''){
                alert('Please Add mark officers')
                return false;
              }
            }
          }
         
          document.getElementById('submit1').click();
  }
  function saveByOtp(el){
    
    $('#otpModalCenter').modal({
          backdrop: 'static',
          keyboard: false
      })
    $.ajax({
          type : 'GET',
          url : "{% url 'saveByOtp_ajax' %}",
          dataType : 'json',
          success : function(response){
           //OTP SENDED TO DATA BASE
            let time_count =  parseInt(response.timer)
            alert(response.newotp)
            timer(time_count);
           
  
           
          }
    });
  
  }
  
  function verify_my_otp(){
    
    const myotp = document.getElementById('your_otp').value;
    document.getElementById('verify_otp').disabled = true
    
    $.ajax({
          type : 'POST',
          url : "{% url 'verify_my_otp_ajax' %}",
          dataType : 'json',
          data: {'myotp': myotp, csrfmiddlewaretoken: '{{csrf_token}}'},
          success : function(response){
            document.getElementById('verify_otp').disabled = false
            if(response.ret == 'True'){
              $('#submit').click();
              let html = `<div class="alert alert-success" role="alert">
                Form submited
              </div>`
              $('#otpcurrent').html(html)
            }else if(response.ret == 'False'){
              let html = `<div class="alert alert-danger" role="alert">
                OTP didn't match
              </div>`
              $('#otpcurrent').html(html)
              
            }
            
           
          },
          error: function(err){
            document.getElementById('verify_otp').disabled = false
          }
    });
  }

  
  
  var digitPeriodRegExp = new RegExp('\\d|\\.');
  var input1 = document.getElementById('your_otp');
  var input2 = document.getElementById('input2');
  
  input1.addEventListener('keydown', function(event) {
      if(event.ctrlKey // (A)
      || event.altKey // (A)
      || typeof event.key !== 'string' // (B)
      || event.key.length !== 1) { // (C)
          return;
      }
      if(!digitPeriodRegExp.test(event.key)) {
          console.log(1);
          event.preventDefault();
      }
  }, false);
  
  
  function truncateString(str, num) {
  if (str.length > num) {
    return str.slice(0, num) + "...";
  } else {
    return str;
  }
}


$("#accompany").select2({
        minimumInputLength: 1,
        language: {
            inputTooShort: function() {
              return 'Search Designation';
            }
          },
        tags: [],
        ajax: {
            url: '{% url "fetchAccompany" %}',
            dataType: 'json',
            type: "GET",
            quietMillis: 50,
            data: function (term) {
                return {
                    last_val: term.term
                };
                console.log(term.term)
            },
            processResults: function (data) {
              return {
                    results: $.map(data, function (item) {
                      console.log(item)
                        return{
                          text: item.designation,
                          
                          id: item.designation,
                        }
                    })
                };
              },
            
            
        }
    });
  


    $('#locationType').select2()
 


    $("#location").select2({
        minimumInputLength: 1,
        language: {
            inputTooShort: function() {
              return 'Please Add One or More Location';
            }
          },
       
        ajax: {
            url: '{% url "autoFetchLocation" %}',
            dataType: 'json',
            type: "GET",
            quietMillis: 50,
            data: function (term) {
              let stype = JSON.stringify($('#locationType').val())
              let rly_zone = JSON.stringify($('#zone').val())
              let division_id = JSON.stringify($('#division').val())
                return {
                    last_val: term.term,
                    stype: stype,
                    rly_zone: rly_zone,
                    division_id : division_id
                };
                
                
            },
            processResults: function (data) {
              
                return {
                    results: $.map(data, function (item) {
                      //console.log(item)
                        return{
                          text: item.city,
                          
                          id: item.city+'#'+item.table_from+'#'+ item.loc_code,
                          
                        }
                    })
                };
              
              },
            
            
        }
    });

  
  </script>
{% endblock %}  