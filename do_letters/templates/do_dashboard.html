{% extends 'base.html' %}

{% load static %}
{% block content %}

<head>

    
    <script type="text/javascript" src="{% static '/js/numscroll.js'%}"></script>
    <script type="text/javascript" src="{% static '/js/jquery.waypoints.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/js/jquery.animateNumber.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/js/jquery.easing.1.3.js'%}"></script>

    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">  


  <style>
      .modal-content{
  border: rgb(247, 242, 242) !important;
  border-width: 1px !important;
}
.modal-header{
  background-color: #0066cc !important;
  color: #fff;
  border-radius: inherit;
}
.close span{
  color: #fff !important;
}
.close span:hover{
  color: #fff !important;
}
    .modal.left .modal-dialog,
    .modal.right .modal-dialog {
      position: fixed;
      margin: auto;
      width: 1200px;
      height: 100%;
      -webkit-transform: translate3d(0%, 0, 0);
      -ms-transform: translate3d(0%, 0, 0);
      -o-transform: translate3d(0%, 0, 0);
      transform: translate3d(0%, 0, 0);
    }

    .modal.left .modal-content,
    .modal.right .modal-content {
      height: 100%;
      overflow-y: auto;
    }

    .modal.left .modal-body,
    .modal.right .modal-body {
      padding: 15px 15px 80px;
    }

    /*Left*/
    .modal.left.fade .modal-dialog {
      left: -320px;
      -webkit-transition: opacity 0.3s linear, left 0.3s ease-out;
      -moz-transition: opacity 0.3s linear, left 0.3s ease-out;
      -o-transition: opacity 0.3s linear, left 0.3s ease-out;
      transition: opacity 0.3s linear, left 0.3s ease-out;
    }

    .modal.left.fade.show .modal-dialog {
      left: 0;
    }

    /*Right*/
    .modal.right.fade .modal-dialog {
      right: -320px;
      -webkit-transition: opacity 0.3s linear, right 0.3s ease-out;
      -moz-transition: opacity 0.3s linear, right 0.3s ease-out;
      -o-transition: opacity 0.3s linear, right 0.3s ease-out;
      transition: opacity 0.3s linear, right 0.3s ease-out;
    }

    .modal.right.fade.show .modal-dialog {
      right: 0;
    }

    /* ----- MODAL STYLE ----- */
    .modal-content {
      border-radius: 0;
      border: none;
    }

    .modal-header {
      border-bottom-color: #EEEEEE;
      background-color: #FAFAFA;
    }

    .modal-lg {
      max-width: 70% !important;
    }

    .modal {
      pointer-events: none;
    }

    .modal-backdrop {
      display: none;
    }

    .card{
        box-shadow: 0 15px 25px rgba(129, 124, 124, 0.2);
                border-radius: 5px;
                backdrop-filter: blur(14px);
      }
  
      .stats-header{
        font-weight: 700;
        font-size: 25px;
        margin-bottom: 0%;
      }
      .stats-value{
        font-weight: 700;
        font-size: 40px;
      }



  .readmore {
    margin-top: -11px;

  }

  #more {
    display: none;
  }

  #myBtn {
    border: none;
    background-color: white;
  }

  .button1 {
    float: right;
    margin-right: 2%;
    border: none;
    background-color: #89CFF0;
    font-weight: 500;
    color: black;
    padding-left: 1%;
  }



  .button2 {
    float: right;
    margin-right: 4%;
    border: none;
    background-color: #89CFF0;
    font-weight: 500;
    color: black;
    padding-left: 2%;
  }


  .button3 {
    float: right;
    margin-right: 4%;
    margin-top: 10%;
    border: none;
    background-color: #89CFF0;
    font-weight: 500;
    color: black;
    padding-left: 2%;
    margin-bottom: 0%;
  }



  .butt {
    padding-left: 12%;
    width: 50%;
    background-color: white;
    border: none;
    color: black;
    font-weight: 500;
  }


    
  </style>
</head>

<body>

  <div class="container-fluid">
    <div class="row mb-3">
      <!-- <div class="col-3"></div> -->
      <div class="col-12">
        <h3 class="report_heading" style="font-size: 28px;">
          <center>D.O. Letters </center>
        </h3>
      </div>
      <!-- <div class="col-3"></div> -->
    </div>

    <div class="row mb-5" style="margin-right: 2em;">
        <div class="col-3 text-center">
            <div class="card text-white" style="border-radius: 15px;" >
                <div class="card-body" style="background: radial-gradient(circle at 12.3% 19.3%, rgb(97, 100, 246) 0%, rgb(95, 209, 249) 100.2%);padding-bottom: 0%;" onclick="clicknum('yesterday')">
                    <div class="card-top">  
                        <p class="stats-header">Yesterday</p>
                    </div>
                    <div class="card-text">
                        <p class="stats-value statsfig">{{letter_yesterday}}</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-3 text-center">
            <div class="card text-white" style="margin-left: 1%;">
                <div class="card-body" style="background: linear-gradient(110.1deg, rgb(41, 222, 41) 2.9%, rgb(158, 241, 50) 90.3%);padding-bottom: 0%;" onclick="clicknum('week')">
                    <div class="card-top">  
                        <p class="stats-header">Last 7 days</p>
                    </div>
                    <div class="card-text">
                        <p class="stats-value statsfig">{{letter_week}}</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-3 text-center">
            <div class="card text-white" style="margin-left: 1%;">
                <div class="card-body" style="background: radial-gradient(circle at 10% 20%, orange, rgb(247, 193, 65) 90%);padding-bottom: 0%;" onclick="clicknum('month')">
                    <div class="card-top">  
                        <p class="stats-header">Last 1 month</p>
                    </div>
                    <div class="card-text">
                        <p class="stats-value statsfig">{{letter_month}}</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-3 text-center">
            <div class="card text-white" style="margin-left: 1%;">
                <div class="card-body" style="background: linear-gradient(to right, rgb(241, 80, 52), rgb(240, 118, 96));padding-bottom: 0%;" onclick="clicknum('year')">
                    <div class="card-top">  
                        <p class="stats-header">Last 1 Year</p>
                    </div>
                    <div class="card-text">
                        <p class="stats-value statsfig">{{letter_year}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>

 
    <div class="container" id="adjustfilter">
      <div class="inpt-container" id="container1" style="padding-bottom:10px;">  
      <form action="" method="POST">
        {% csrf_token %}


        <div class="row" id="row1" style="font-family: 'Lato', sans-serif;font-size: 1em; margin-left: 2em;">

        <div class="col">
          <label for="location" class="lbl-caption">Date Range</label>
          <input id="date_range" class="form-control" name="date_range" autocomplete="off" placeholder="dd/mm/yyyy">
        </div>
        <div class="col">
          <label for='subject' class="lbl-caption">Subject</label>
          <input class="form-control " name="subject" placeholder="Enter Subject">
        </div>
        <div class="col">
          
          <label for='action_by' class="lbl-caption">Marked Officers</label>
          <div class="multi_select_box">
            <input type="text" id="action_by_test" name="action_by_test" hidden>
            <select id="action_by" name="action_by" class="form-control" data-live-search="true" multiple
              data-actions-box="true" multiple data-selected-text-format="count > 2" multiple>

              {% for i in officers %}
              <option style="width:20px" value="{{i.designation_code}}" data-tokens="{{i.designation}}">
                {{i.designation}}</option>
              {% endfor %}

            </select>
          </div>
        </div>
        <div class="col">
            <div class="btn-toolbar" role="toolbar">
              <div class="btn-group mr-2" role="group" style="margin-top:30px;" >
          <button type="submit" id="submit" class="btn btn-warning btn-sm" >Continue</button>
          <button type="button" class="btn btn-secondary btn-sm" id="insp_clear"><a
              href="{% url 'do_dashboard'  %}" style="color:white">Reset</a></button>&nbsp;
                </div>
            </div>

        </div>

        <div class="col" style="text-align:center" id="docreate">
            <a id="docreate1" href="#" data-toggle="modal" data-toggle="tooltip"
        title="Upload New D.O Letters" data-target="#upload_modal" class="btnchart btn btn-primary" role="button"  style="margin-top:30px;background-color: rgb(0, 123, 255);color:white"><b> <i class='bx bx-plus-medical'></i>  Create New letters </b></a>
        </div>
        
      
      
      </div>
      
   
    </form>
  </div>
  </div>

  <br>
  <div class="container" style="font-family:'Lato', sans-serif; overflow-x: auto;">
      <table class="table table-striped table-bordered table-sm table-data " id="view_table">
       
        <thead>
          <!-- <th style="width: 3%;"> S.No.</th> -->
          <th style="width: 8%;">D.O. Date</th>
          <th style="width: 15%;">Letter No.</th>
          <th style="width: 40%;">Subject</th>
          <th style="width: 37%;">Marked To</th>
        </thead>
        <tbody>
          {% if letters %}
          {% for i in letters %}
          <tr>
            <!-- <td style="width: 3%;"> {{forloop.counter}}</td> -->
            <td style="width: 8%;">{{i.do_letter_date }}</td>
            <td style="width: 15%;"><a href="" class="stretched-link" onclick="open_do('{{i.id}}'); return false;"
                title="Click to view D.O. PDF"> {{i.do_letter_no}}</a>
              </td>
            <td style="width: 40%;">{{i.subject}}</td>

            <td style="width: 37%;">
              {% for j in i.marked_to %}
              {% if j.abc is True %}
              <p style="color: green;">{{j.xyz}}</p>
              <!-- <b> <p ><a  href="" class="stretched-link"  data-toggle="modal" data-target="#reply_view"  onclick="reply_view('{{i.id}}', '{{j.ofc}}');" style="color: green;"  title="Click to view reply">{{j.xyz}} </a> </p> </b> -->
              {% else %}
              <p style="color: red;">{{j.xyz}}</p>
              {% endif %}
              {% endfor %}
            </td>
          </tr>
          {% endfor %}
          {% endif %}
        </tbody>
      </table>
  </div>
    
 
  <br>
  <br>
  <!-- <div class="col-6">
            <iframe id="iframetest"  style="width:718px; height:700px;" frameborder="0"></iframe>
           </div> -->


  <!-- Modal -->
  <!-- <div class="modal left fade" id="pdf_view" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header"> -->
  <div class="modal right fade" id="pdf_view" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">

        <div class="modal-header">

          <h5 class="modal-title" id="myModalLabel"><label id="dodetails"></label></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="pdfclose"
            onclick="funpdfclose()"><span aria-hidden="true">&times;</span></button>

        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6">
              <textarea class="form-control mb-2 mr-sm-2" id="piframetest" style="width: 100%; height:100%" readonly></textarea>
              <a style="float: right;" class="btn btn-primary" target="_blank" id="aiframetest"><i class="fas fa-arrow-right" ></i></a>
              <br>
              <iframe id="iframetest" style="width:100%; height:720px;" frameborder="0"></iframe>

            </div>
            <div class="col-md-6">
              <div class="row">
                <div class="col-md-12">
                <table id="dotbl" class="table-data">
                  <thead>
                    <th style="width: 30%;">Action By</th>
                    <th style="width: 10%;">Date</th>
                    <th style="width: 50%;">Reply Rec'd(Yes/No)</th>
                    <th style="width: 10%;">Attachement</th>
                  </thead>
                  <tbody>

                  </tbody>
                </table>
              </div>
              </div>
              <br>
              <div class="row">
                <div class="col-md-12">
                  <a style="float: right;" class="btn btn-primary" target="_blank" id="aiframetest1"><i
                      class="fas fa-arrow-right" aria-hidden="true"></i></a>
                  <br>
                  <iframe id="iframetest1" style="width:100%; height:500px;" frameborder="0"></iframe>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="reply_view" tabindex="-1" role="dialog" aria-labelledby="reply_view" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered " role="document">
      <div class="modal-content">
        <div class="modal-header ">
          <h5 class="modal-title" id="pdf_view">Reply</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <textarea id="remark" style="width:100%" readonly></textarea>
          <!-- <iframe id="iframetest1"  style="width:718px; height:700px;" frameborder="0"></iframe> -->
        </div>
      </div>
    </div>
  </div>
  <button type="button" hidden id="btnpdfshow" data-toggle="modal" data-target="#pdf_view">
    Right Sidebar Modal</button>
  <!-- <div class="col-6">
            <iframe id="iframetest"  style="width:718px; height:700px;" frameborder="0"></iframe>
           </div> -->


  <!-- Modal -->
  <!-- <div class="modal left fade" id="pdf_view" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header"> -->
            <div class="modal right fade" id="pdf_view" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
        
                <div class="modal-header">
        
                  <h5 class="modal-title" id="myModalLabel"><label id="dodetails"></label></h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="pdfclose"
                    onclick="funpdfclose()"><span aria-hidden="true">&times;</span></button>
        
                </div>
                <div class="modal-body">
                  <div class="row">
                    <div class="col-md-6">
                      <textarea class="form-control mb-2 mr-sm-2" id="piframetest" style="width: 100%; height:100%" readonly></textarea>
                      <a style="float: right;" class="btn btn-primary" target="_blank" id="aiframetest"><i class="fas fa-arrow-right" ></i></a>
                      <br>
                      <iframe id="iframetest" style="width:100%; height:720px;" frameborder="0"></iframe>
        
                    </div>
                    <div class="col-md-6">
                      <div class="row">
                        <div class="col-md-12">
                        <table id="dotbl" border="1" width="100%">
                          <thead>
                            <th style="width: 30%;">Action By</th>
                            <th style="width: 10%;">Date</th>
                            <th style="width: 50%;">Reply Rec'd(Yes/No)</th>
                            <th style="width: 10%;">Attachement</th>
                          </thead>
                          <tbody>
        
                          </tbody>
                        </table>
                      </div>
                      </div>
                      <br>
                      <div class="row">
                        <div class="col-md-12">
                          <a style="float: right;" class="btn btn-primary" target="_blank" id="aiframetest1"><i
                              class="fas fa-arrow-right" aria-hidden="true"></i></a>
                          <br>
                          <iframe id="iframetest1" style="width:100%; height:500px;" frameborder="0"></iframe>
                        </div>
                      </div>
                    </div>
                  </div>
        
                </div>
              </div>
            </div>
          </div>
        
          <div class="modal fade" id="reply_view" tabindex="-1" role="dialog" aria-labelledby="reply_view" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered " role="document">
              <div class="modal-content">
                <div class="modal-header ">
                  <h5 class="modal-title" id="pdf_view">Reply</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <textarea id="remark" style="width:100%" readonly></textarea>
                  <!-- <iframe id="iframetest1"  style="width:718px; height:700px;" frameborder="0"></iframe> -->
                </div>
              </div>
            </div>
          </div>
          <button type="button" hidden id="btnpdfshow" data-toggle="modal" data-target="#pdf_view">
            Right Sidebar Modal</button>

    <!-- Apeksha modal for upload window -->
<div class="modal fade" id="upload_modal" tabindex="-1" role="dialog" aria-labelledby="uploadModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Upload D.O. Letter</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col" style="background-color: white;">
              <form action="" method="POST" class="form-group" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="row ">
  
                  <div class="col-md-4 " style="padding-top: 2%;">
                    <label for='do_letter_no' class="mr-sm-2">D.O. Letter No.</label><span
                      style="color:red;font-weight:bold">*</span>
                  </div>
  
                  <div class="col-md-8">
                    <input type='text' class="form-control mb-2 mr-sm-2" name="do_letter_no"
                      placeholder="Enter Letter No." required>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <label for='date' class="mr-sm-2">D.O. Letter Date</label><span
                      style="color:red;font-weight:bold">*</span>
                  </div>
                  <div class="col-md-8">
  
  
                    <input type="text" class="form-control mb-2 mr-sm-2" autocomplete="off" name="date"
                      style="background-color: #fff;" placeholder="Select Date" id="email" required readonly>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <label for='subject' class="mr-sm-2">Subject</label><span style="color:red;font-weight:bold">*</span>
                  </div>
                  <div class="col-md-8">
                    <textarea class="form-control mb-2 mr-sm-2" name="subject" placeholder="Enter Subject"
                      required></textarea>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <label for='action_by2' class="mr-sm-2">Address To</label><span
                      style="color:red;font-weight:bold">*</span>
                  </div>
                  <div class="col-md-8">
  
  
                    <!-- <select id="desig" name="desig" placeholder="--Select--" required style="height: 35px; width:180px">
                              
                                  <option value="" selected disabled hidden>--Select--</option>
                                    {% for i in officers %}
                                    <option value="{{i.designation}}">{{i.designation}}</option>
                                    {% endfor %}
                                </select>  -->
                    <div class="multi_select_box">
                      <input type="text" id="action_by_test2" name="action_by_test2" hidden>
                      <select id="action_by2" name="action_by2" class="form-control" style="width: 100%;"
                        placeholder="--Select Officers--" data-live-search="true" multiple data-actions-box="true"
                        multiple data-selected-text-format="count > 2" multiple>
  
                        {% for i in officers %}
                        <option style="width:20px" value="{{i.designation}}" data-tokens="{{i.designation}}">
                          {{i.designation}}</option>
                        {% endfor %}
  
                      </select>
                      <!-- <input type="button" id="desgnbtn${item}" value="Ok" onclick="getOption('desgn${item}')">
                                  <input type="text" id="desgninp${item}" value="" hidden> -->
  
                    </div>
  
                  </div>
                </div>
                <br>
                <div class="row">
                  <div class="col-md-4">
                    <label for='action_by2' class="mr-sm-2">Copy To</label>
                  </div>
                  <div class="col-md-8">
                    <div class="multi_select_box">
                      <input type="text" id="copy_to_test" name="copy_to_test" hidden>
                      <select id="copy_to" name="copy_to" class="form-control" style="width: 100%;"
                        placeholder="--Select Officers--" data-live-search="true" multiple data-actions-box="true"
                        multiple data-selected-text-format="count > 2" multiple>
  
                        {% for i in officers %}
                        <option style="width:20px" value="{{i.designation}}" data-tokens="{{i.designation}}">
                          {{i.designation}}</option>
                        {% endfor %}
  
                      </select>
                    </div>
  
                  </div>
                </div>
  
                <div class="row mt-2">
                  <div class="col-md-4">
                    <input type="text" name="savetype" value="upload" hidden>
                  </div>
                  <div class="form-group col-md-4">
                    <input type="radio" name="cat" value="upload" onclick="fun_check('single')" checked>
                    <label for="upload">Upload D.O.</label><br>
                  </div>
                  <div class="form-group col-md-4">
                    <input type="radio" name="cat" value="text" onclick="fun_check('radall')">
                    <label for="dotext">D.O. Text</label><br>
                  </div>
                </div>
                <div class="row mt-2" id="radsingle">
                  <div class="col-md-4">
                    <label for='do_pdf' class="mr-sm-2">Upload D.O. letter</label><span
                      style="color:red;font-weight:bold">*</span>
                  </div>
                  <div class="col-md-8">
                    <input name="do_file" type="file" accept="application/pdf" style="width: 100%;" id="do_file"
                      onchange="Filevalidation()" />
                    <p style="color: blue;">Accepted types: .pdf <br> File size should not exceed 200kB </p>
                  </div>
                </div>
                <div class="row mt-2" id="radall">
                  <!-- <div class="col-md-4" >
                              <label for ='do_text' class="mr-sm-2">DO Text</label><span style="color:red;font-weight:bold">*</span>
                          </div> -->
                  <div class="col-md-12">
                    <textarea class="form-control mb-2 mr-sm-2" id="do_text" name="do_text" placeholder="Enter D.O. Text"
                      rows="5" maxlength="300" onkeyup="Filevalidation1(this.value)"></textarea>
  
                  </div>
                </div>
                <div class="row">
                  <div class="col-4"></div>
                  <div class="col-4 mr-3">
                    <button type="submit" id="submit2" class="btn btn-success" disabled
                      style=" width: 100%;">Submit</button>
                  </div>
                  <div class="col-4"></div>
                </div>
              </form>
  
            </div>
          </div>
  
        </div>
        <!-- <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div> -->
      </div>
    </div>
  </div>
  <!-- end here  -->
  <!-- Apeksha modal for reply status modal window -->
<div class="modal left fade" id="replyStatus_modal" tabindex="-1" role="dialog" aria-labelledby="replyStatusModal"
aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLongTitle"><label id="dodetails"></label></h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">

      <div class="container-fluid">
        <div class="row">
          <div class="col-md-6">
            <table class="table table-light table-striped" name="replyStatus_table" id="replyStatus_table">
              <thead style="background-color: #343a40;white-space: nowrap; color:white;">
                <tr>
                  <th style="width: 20%;">Marked Officers</th>
                  <th style="width: 70%;">Reply Rec'd(Yes/No)</th>
                  <th style="width: 10%;">Attachment</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
            <a  style="float: right;" class="btn btn-primary" target="_blank" id="aiframetest11" >Open</a>
            <iframe id="iframetest11"  style="width:100%; height:600px;" frameborder="0" ></iframe>
          </div>
          <div class="col-md-6">
            <a style="float: right;" class="btn btn-primary" target="_blank" id="aiframetest1"><i
                class="fas fa-arrow-right" aria-hidden="true"></i></a>
            <br>
            <iframe id="iframetest1" style="width:100%; height:800px;" frameborder="0"></iframe>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
</div>
<!-- end here  -->
</body>
<script>
function clicknum(val1){
    let datetoday = moment().format('DD/MM/YYYY');
    const yesterdayDate = moment(new Date().setDate(new Date().getDate() - 1)).format('DD/MM/YYYY');
    const sevenDaysBeforeDate = moment(new Date().setDate(new Date().getDate() - 7)).format('DD/MM/YYYY');
    const monthDate = moment().subtract('months', 1).format('DD/MM/YYYY');
    const yearDate = moment().subtract('months', 12).format('DD/MM/YYYY');
    
    if (val1 === 'yesterday'){
        document.getElementById("date_range").value = yesterdayDate + " - " + yesterdayDate;
        $('#submit').click();
        // document.getElementById("date_range").value = datetoday + " - " + sevenDaysBeforeDate;
      
    }
    if (val1 === 'week'){
        document.getElementById("date_range").value = sevenDaysBeforeDate + " - " + datetoday;
        $('#submit').click();
    }
    if (val1 === 'month'){
        document.getElementById("date_range").value = monthDate + " - " + datetoday;
        $('#submit').click();
    }
    if (val1 === 'year'){
        document.getElementById("date_range").value = yearDate + " - " + datetoday;
        $('#submit').click();
    }
    

    
}
 function scrollCounter()
{
$('.statsfig').each(function () {
 $(this).prop('Counter', 0).animate({
   Counter: Number($(this).text()) },
 {
   duration: 500,
   easing: 'swing',
   step: function (now) {
     $(this).text(Math.ceil(now));
 }
});
});
}
$(document).ready(function()
{
scrollCounter();
});
  var pdfmodal = 0;
  function funpdfclose() {
    pdfmodal = 0;
    $('#adjustdiv').show();
    $('#adjustfilter').show();
  }
  $(document).ready(function () {
    $('#view_table').DataTable();
    $('#adjustdiv').show();
    $('#adjustfilter').show();
  });

var table=$('#view_table').DataTable({

    "language": {
      "search": "Keyword search:"
    },

  });
  table.$('tr').tooltip({
    placement: '',
    html: true
  })
  var table1;
  function open_do(id) {
    if (pdfmodal == 0) {
      document.getElementById('btnpdfshow').click();
      $('#adjustdiv').hide();
      $('#adjustfilter').hide();
    }
    $('#piframetest').show();
      $('#iframetest').show();
      $('#aiframetest').show();
    pdfmodal = 1;
    data = {
      'id': id

    }
    $.ajax
      ({
        url: "{% url 'view_ajax2' %}",
        method: "GET",
        dataType: "JSON",
        async: false,
        data: data,
        success: function (response) {
          if (table1 instanceof $.fn.dataTable.Api) {
            table1.destroy();
          }
          console.log(response.letters[0].do_letter_no)
          data = '<b>Letter No.</b>-' + response.letters[0].do_letter_no + '        <b>Date</b>- ' + response.letters[0].do_letter_date + '       <b>Issued by</b>- ' + response.letters[0].created_by_id;
          document.getElementById('dodetails').innerHTML = data;
          file = "/media/" + response.do_file;

          if(response.do_text == null)
          {
            $('#piframetest').hide();
            $('#iframetest').show();
            $('#aiframetest').show();
            $('#iframetest').attr('src', file);
            $('#aiframetest').attr('href', file);
          }
          else 
          {
            
            file = "/do_pdf_create/" + response.id;
            
            $('#piframetest').hide();
            $('#iframetest').show();
            $('#aiframetest').show();
            $('#iframetest').attr('src', file);
            $('#aiframetest').attr('href', file);
            document.getElementById('piframetest').innerHTML=response.do_text;
            
          }

          var row = '';
          $('#dotbl tbody').empty();
          $('#iframetest1').hide();
          $('#aiframetest1').hide();
          for (i = 0; i < (response.letters[0].marked_to).length; i++) {
            if (response.letters[0].marked_to[i].abc == true) {
              row += '<tr><td style="color: green;"><b>' + response.letters[0].marked_to[i].xyz + '</b></td>';
              row += '<td>' + response.letters[0].marked_to[i].date + '</td>'
              row += '<td>Yes</td>';
              reply_file = "/media/" + response.letters[0].marked_to[i].reply_path;
              if (reply_file != '/media/')
                row += `<td style="text-align: center;"><button type="submit2" name="submit2" class="b1" value="${reply_file}" onclick="funopenreply(this.value)"><i class="fa fa-paperclip" style="font-size:20px;color:rgb(64, 112, 243)"></i></button></td></tr>`;
              else
                row += '<td>Noted</td></tr>'
              //row+='<td><i class="fa fa-paperclip" aria-hidden="true"></i></td>'
              // reply_file = "/media/" + response.letters[0].marked_to[i].reply_path;
              // if (response.letters[0].marked_to[i].reply_path){
              //   row+=`<td><div class="rectangle m-3" id="preiew_div">
              //   <iframe  src="${reply_file}" style="width:100%; height:300px;" frameborder="0" ></iframe>
              //   <br>
              //   <a  style="float: right;" href="${reply_file}" class="btn btn-primary" target="_blank" >Open</a></div></td></tr>`
              // }
              // else 
              //   row+='<td>-</td></tr>';
            }else if (response.letters[0].marked_to[i].abc == false) {
              row += '<tr><td style="color: red;"><b>' + response.letters[0].marked_to[i].xyz + '</b></td>';
              row += '<td>-</td>'
              row += '<td>No</td>';
              reply_file = "/media/" + response.letters[0].marked_to[i].reply_path;
              if (reply_file != '/media/')
                row += `<td style="text-align: center;"><button type="submit2" name="submit2" class="b1" value="${reply_file}" onclick="funopenreply(this.value)"><i class="fa fa-paperclip" style="font-size:20px;color:rgb(64, 112, 243)"></i></button></td></tr>`;
              else
                row += '<td>-</td></tr>'
              //row+='<td><i class="fa fa-paperclip" aria-hidden="true"></i></td>'
              // reply_file = "/media/" + response.letters[0].marked_to[i].reply_path;
              // if (response.letters[0].marked_to[i].reply_path){
              //   row+=`<td><div class="rectangle m-3" id="preiew_div">
              //   <iframe  src="${reply_file}" style="width:100%; height:300px;" frameborder="0" ></iframe>
              //   <br>
              //   <a  style="float: right;" href="${reply_file}" class="btn btn-primary" target="_blank" >Open</a></div></td></tr>`
              // }
              // else 
              //   row+='<td>-</td></tr>';
            }
            // else {
            //   row += '<tr><td style="color: red;"><b>' + response.letters[0].marked_to[i].xyz + '</b></td>';
            //   row += '<td>-</td><td>-</td><td>-</td></tr>';
            // }

          }
          $('#dotbl tbody').append(row);
          table1 = $('#dotbl').DataTable({
            "lengthChange": false,
            pageLength: 5,
            "bFilter": false,
            "bInfo": false, language: {
              paginate: {
                next: '<i class="fa fa-arrow-right"></i>', 
                previous: '<i class="fa fa-arrow-left"></i>'
              }
            }
          });


        }
      });
  }
  function funopenreply(val) {
    if (val != '/media/') {
      $('#iframetest1').attr('src', val);
      $('#aiframetest1').attr('href', val);
      $('#iframetest1').show();
      $('#aiframetest1').show();
    }
  }
  $(function () {

    $('input[name="date_range"]').daterangepicker({
      autoUpdateInput: false,
      autoApply: true,
      maxDate: new Date(),
      locale: {
        cancelLabel: 'Clear'
      }
    });

    $('input[name="date_range"]').on('apply.daterangepicker', function (ev, picker) {
      $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
      $('.applyButtonClasses').click()


    });

    $('input[name="date_range"]').on('cancel.daterangepicker', function (ev, picker) {
      $(this).val('');
    });



  });

  function reply_view(id, ofc) {
    data = {
      'id': id,
      'ofc': ofc
    };
    $.ajax
      ({
        url: "{% url 'reply_view'  %}",
        method: "GET",
        dataType: "JSON",
        async: false,
        data: data,
        success: function (response) {
          reply23 = response.reply;
          $('#remark').val(reply23);
        }
      });
  }

  $('#action_by').select2({ placeholder: "Select Designation" })

  $(document).ready(function () {
    $('#submit').click(function () {
      var selected = $("#action_by :selected").map((_, e) => e.value).get();
      document.getElementById('action_by_test').value = selected;
      //alert(document.getElementById('action_by_test').value)


    });
  });

</script>
<script>
  $(function () {

    $('input[name="date"]').daterangepicker({
      autoUpdateInput: false,
      singleDatePicker: true,
      autoApply: true,
      maxDate: new Date(),
      "opens": "left",
      locale: {
        cancelLabel: 'Clear'
      }
    });

    $('input[name="date"]').on('apply.daterangepicker', function (ev, picker) {
      $(this).val(picker.startDate.format('DD-MM-YY'));


    });


  });

  
  $('#action_by2').select2();
  $('#copy_to').select2()
  $(document).ready(function () {
    $('#submit2').click(function () {
      var selected = $("#action_by2 :selected").map((_, e) => e.value).get();
      document.getElementById('action_by_test2').value = selected;

      selected = $("#copy_to :selected").map((_, e) => e.value).get();
      document.getElementById('copy_to_test').value = selected;
    });
  });


  $('#radsingle').show();
  $('#radall').hide();
  function fun_check(value) {
  
    document.getElementById('submit2').disabled = true;
    if (value == 'single') {
      $('#do_text').val('');
      $('#radsingle').show();
      $('#radall').hide();

    }
    else {
      $('#do_file').val('');
      $('#radsingle').hide();
      $('#radall').show();
    }
  }


  function Filevalidation1(val) {
    if (val.length > 0)
      document.getElementById('submit2').disabled = false;
    else
      document.getElementById('submit2').disabled = true;
  }

  
  function upload_do() {

data = {
  csrfmiddlewaretoken: '{{csrf_token}}'
};
$.ajax
  ({
    url: "{% url 'upload-do' %}",
    method: "POST",
    dataType: "JSON",
    async: false,
    data: data,
    success: function (response) {
      let row = '';
      row += '<option selected disabled hidden value=""> Select To Mark</option>';
      for (let i = 0; i < response.length; i++) {
        row += '<option value=">' + response[i].designation + '">' + response[i].designation + '</option>';
        console.log(response[i]);
      }

      $('#desig').append(row);
    }
  });

}

Filevalidation = () => {
    const fi = document.getElementById('do_file');

    // Check if any file is selected.
    if (fi.files.length > 0) {
      for (const i = 0; i <= fi.files.length - 1; i++) {

        const fsize = fi.files.item(i).size;
        const file = Math.round((fsize / 1024));
        // The size of the file.
        if (file >= 500) {
          alert("File too Big, please select a file less than 200KB");
        }
        else {
          // document.getElementById('size').innerHTML = '<b>'
          // + file + '</b> KB';
          
          document.getElementById('submit2').disabled = false;
          
        }
      }
    }
  }

  function reply_status(id) {
    console.log(id)
    $('#iframetest11').hide();
            $('#aiframetest11').hide();
    data = {
      'id': id
    };
    $.ajax
      ({
        url: "{% url 'view_ajax2'  %}",
        method: "GET",
        dataType: "JSON",
        async: false,
        data: data,
        success: function (response) {

          if (table11 instanceof $.fn.dataTable.Api) {
            table11.destroy();
          }
          console.log(response.letters[0].do_letter_no)
          data = '<b>D.O. Letter No.</b>-' + response.letters[0].do_letter_no + '        <b>Date</b>- ' + response.letters[0].do_letter_date;
          document.getElementById('dodetails').innerHTML = data;
          file = "/media/" + response.do_file;


          if (response.do_text == null) {
            $('#iframetest1').attr('src', file);
            $('#aiframetest1').attr('href', file);
          }
          else {
            file = "/do_pdf_create/" + response.id;

            $('#iframetest1').attr('src', file);
            $('#aiframetest1').attr('href', file);
          }
          var row = '';
          $('#replyStatus_table tbody').empty();
          for (i = 0; i < (response.letters[0].marked_to).length; i++) {
            if (response.letters[0].marked_to[i].abc == true) {
              row += '<tr><td style="color: green;"><b>' + response.letters[0].marked_to[i].xyz + '</b></td>';


              row += '<td>Yes</td>';

              reply_file = "/media/" + response.letters[0].marked_to[i].reply_path;
              if (reply_file != '/media/')
                row += `<td style="text-align: center;"><button type="submit" name="submit2" class="b1" value="${reply_file}" onclick="funopenreply(this.value)"><i class="fa fa-paperclip" style="font-size:20px;color:rgb(64, 112, 243)"></i></button></td></tr>`;
              else
                row += '<td>-</td></tr>'
            }
          }
          $('#replyStatus_table tbody').empty()
          $('#replyStatus_table tbody').append(row)
          table11 = $('#replyStatus_table').DataTable({
            "language": {
              "search": "Search:"
            }
          });

        }
      });
  }
  
  


</script>
{% endblock %}