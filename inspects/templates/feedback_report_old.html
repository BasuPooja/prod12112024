{% extends 'base.html' %} 
 {% block content %}
{% load static %}

<head>
    <title>Feedback Report</title>
    <script src="{% static '/js/autosize.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">  
    <link rel="stylesheet" type="text/css" href="{% static '/css/datatables/jquery.dataTables.min.css' %}" />
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>  
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>  
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.flash.min.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script> 
     <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>  
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.html5.min.js"></script>  
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.print.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.3/css/jquery.dataTables.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.3.5/css/buttons.dataTables.min.css"/>
 <style>
    h3{
        text-align: center;

    };
    #submit{
        position:'absolute';
        right:50%;
    }
 </style>
</head>

<body>
<h3>Feedback Report</h3>
<br><br><br><br>
<div class="container">
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group col-md-6">
              <label for="inputState">Email</label>
              <input type="text" class="form-control" id="inputCity" value = '{{email}}' readonly>
            </div>
            <div class="form-group col-md-6">
              <label for="inputState">Designation</label>
              <input type="text" class="form-control" id="Designation" value="{{desig}}" readonly>
              <input type="hidden" class="form-control" id="Designation1" name="desig" value="{{desig_code}}" readonly>
            </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="inputState">Railway</label>
            <input type="text" class="form-control" id="Railway" value = '{{rly}}' readonly>
          </div>
          <div class="form-group col-md-6">
            <label for="inputState">Division</label>
            <input type="text" class="form-control" id="Division" value="{{div}}" readonly>
          </div>
      </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="inputState">Category</label>
            <select id="category" class="form-control" name="category">
              <option selected disabled>Choose...</option>
              {% for i in category %}
              <option value="{{i.m_id}}">{{i.menu}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group col-md-6">
            <label for="inputState">Sub Category</label>
                <select id="sub_category" class="form-control" name="sub_category">
                <option selected disabled>Choose...</option>
                {% for i in sub_category %}
                <option value="{{i}}" >{{i}}</option>
                {% endfor %}
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="inputAddress">Issue Details</label>
          <textarea class="form-control" name="issue_detials" id="" cols="30" rows="5"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="inputCity">Images</label>
            <input type="file" class="form-control" id="image" name = 'image' accept="image/jpeg,">
          </div>
        </div>
        <button id = 'submit' type="submit" class="btn btn-primary">Submit</button>
      </form>
</div>
<br><br><br>
<!-- TABLE TO SHOW DATA -->
<div class="container">
  
    <table id="tableid" name="tableid" class="table table-data table-bordered" cellspacing="0">
          <thead style="background-color:#d85c64; text-align: left;">
            
          <tr>
              <th>S.NO.</th>
              <th>Category</th>
              <th>Sub Category</th>
              <th>Issue Details</th>
              <th>Document Attached</th>
              <th>Date Of Report</th>
              <th>CRIS Remarks</th>                          
              <th>Status</th>   

          </tr>
          </thead>
  
          <tbody>
            {% for i in data %}
                <tr>
                    <td>{{forloop.counter}}</td>
                    <td>{{i.category}}</td>
                    <td>{{i.sub_category}}</td>
                    <td>{{i.description}}</td>
                    {% if i.images == '' or i.images == None %}
                    <td>
                      Not Uploaded
                    </td>
                      {% else %}
                      <td>
                        <a href="{{i.images.url}}" target="_blank">Reported Images</a>
                      </td>
                      {% endif %}
                
                    <td>{{i.reported_date|date:'d-m-Y'}}</td>
                    <td>{{i.cris_remarks|default:'NA'}}</td>
                    {% if i.status == 0 %}
                    <td>Pending</td>
                    {% elif i.status == 1 %}
                    <td>Resolved</td>
                    {% elif i.status == 2 %}
                    <td>In Progress</td>
                    {% elif i.status == 3 %}
                    <td>Not Feasible</td>
                    {%endif%}
                </tr>
            {% endfor %}

          </tbody>
          <tfoot>
          </tfoot>
    </table>

</div>
  
<script>

    $("#category").change(function(){
        let category = $("#category").val()
        $.ajax({
           type : 'GET',
           url : "{% url 'feedback_report' %}",
           dataType : 'json',
           data : {'category':category,'ajaxname':'getsubcategory'},

           success : function(response){
            console.log(response.sub_category[0])
            let sub_category = ''
            $("#sub_category").empty()
            for(let i = 0;i < response.sub_category.length;i++){

                sub_category += '<option>'+response.sub_category[i]+'</option>'
            }
            console.log(sub_category)
            $("#sub_category").append(sub_category)
           }
        });
    })


   
    var table=$('#tableid').DataTable({
        "iDisplayLength": 15,
        'order':[
          [1,'desc']
        ],
        // "ordering": false,
        "lengthChange": true,
        "lengthMenu": [15, 30, 50, 75, 100],
        dom: 'Blfrtip',
        
        buttons: [
        {
            extend: 'excel',
            title: function (e) {
                var e1 = $('#datefrom').val()
                console.log("datefrom",e1)
                var e2 = $('#dateto').val()
                var stre = 'Inspection Report from ' + e1 + ' to ' + e2;
                return stre
            },
            // orientation: 'landscape',
            // pageSize: 'LEGAL',
            
        },
        {
            extend:'pdfHtml5',
            title: function (e) {
                var e1 = $('#datefrom').val()
                var e2 = $('#dateto').val()
                console.log("datefrom1",e1)
                console.log("datefrom1",datefrom)
                var stre = 'Inspection Report from ' + e1 + ' to ' + e2;
                console.log('insode inspection report',stre)
                return stre
            },
            exportOptions: {
                alignment: 'right',
                },
            customize: function ( doc ) {
                console.log("doc",doc)
                console.log("doc",doc.defaultStyle)
                console.log("doc2",doc.styles.tableBodyEven)
                console.log("doc3",doc.styles.tableBodyOdd)
                doc.content.splice(0,1);
                
                doc.styles.tableBodyEven.alignment = 'center';
                doc.styles.tableBodyOdd.alignment = 'center';
              },
              text :'Pdf',
              title:"Inspection Report ",
                        fontSize : 'LEGAL'
            
        },
        {
            extend: 'print',
            footer:true,
            title: function (e) {
                var s1 = $('#datefrom').val()
                var s2 = $('#dateto').val()
                var str = 'Inspection Report from ' + s1 + ' to ' + s2 +' for '+mydata;
                return str
            },
            customize: function ( doc ) {
                 $(doc.document.body).find('tableid').css('text-align', 'center');

                //  $(doc.document.body).find('table').css('border', '1px solid #000');
                //  $(doc.document.body).find('table td').css('border-left', '1px solid #000');
                //  $(doc.document.body).find('table td').css('border-top', '1px solid #000');
                //  $(doc.document.body).find('table td').css('border-right', '1px solid #000');
                //  $(doc.document.body).find('table td').css('border-bottom', '1px solid #000');
                },
                "pagingType": "simple",
                "sEmptyTable": 'No data available in table',

                // "bSort": true,

                "oLanguage": {
                    "sInfoEmpty": "Page 0 of 0 ",
                },
                "language": {
                    "info": "Page _PAGE_ of _PAGES_",
                    "paginate": {
                        "previous": "Prev",
                    },
                },
        },
        ],
      });
      
</script>
</body>


{% endblock content %}