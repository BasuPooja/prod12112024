{% extends 'base.html' %} 
{% block content %}

{% load static %}

<head>
  <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">
  		
<link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">	
<script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<script type="text/javascript">
  $(".sidebar").addClass('close');
</script> 

<style>
  .bootstrap-select.btn-group .dropdown-menu.inner,	
 .dropdown-menu.open {	
   min-height: 70vh !important;} 
 
   .btn-save {	
   align-items: center;	
   background-clip: padding-box;	
   background-color: #fa6400;	
   border: 1px solid transparent;	
   border-radius: .25rem;	
   box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;	
   box-sizing: border-box;	
   color: #fff;	
   cursor: pointer;	
   display: inline-flex;	
   font-family: system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;	
   font-size: 16px;	
   font-weight: 600;	
   justify-content: center;	
   line-height: 1.25;	
   margin: 0;	
   min-height: 3rem;	
   padding: calc(.875rem - 1px) calc(1.5rem - 1px);	
   position: relative;	
   text-decoration: none;	
   transition: all 250ms;	
   user-select: none;	
   -webkit-user-select: none;	
   touch-action: manipulation;	
   vertical-align: baseline;	
   width: auto;	
 }	
 .btn-save:hover,	
 .btn-save:focus {	
   background-color: #fb8332;	
   box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;	
 }	
 .btn-save:hover {	
   transform: translateY(-1px);	
 }	
 .btn-save:active {	
   background-color: #c85000;	
   box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;	
   transform: translateY(0);	
 }	
 .btn-draft {	
   align-items: center;	
   background-clip: padding-box;	
   background-color: #666699;	
   border: 1px solid transparent;	
   border-radius: .25rem;	
   box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;	
   box-sizing: border-box;	
   color: #fff;	
   cursor: pointer;	
   display: inline-flex;	
   font-family: system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;	
   font-size: 16px;	
   font-weight: 600;	
   justify-content: center;	
   line-height: 1.25;	
   margin: 0;	
   min-height: 3rem;	
   padding: calc(.875rem - 1px) calc(1.5rem - 1px);	
   position: relative;	
   text-decoration: none;	
   transition: all 250ms;	
   user-select: none;	
   -webkit-user-select: none;	
   touch-action: manipulation;	
   vertical-align: baseline;	
   width: auto;	
 }	
 .btn-draft:hover,	
 .btn-draft:focus {	
   background-color: #666699;	
   box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;	
 }	
 .btn-draft:hover {	
   transform: translateY(-1px);	
 }	
 .btn-draft:active {	
   background-color: #666699;	
   box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;	
   transform: translateY(0);	
 }	
 .modal-title	
 {	
   font-size:1rem;	
   font-weight:600;	
 }	
 .copy-link	
 {	
   cursor:pointer;	
   text-decoration: none;	
   font-weight:600;	
   color:#0059b3;	
   font-size:13px;	
 }	
 .table-inpt-fields td {padding:0px;border:0px;padding-left:10px;}
 
 
   * {
   box-sizing: border-box;
 }
 /* The Close Button */
 .close {
   color: white;
   float: right;
   font-size: 28px;
   font-weight: bold;
 }
 
 .close:hover,
 .close:focus {
   color: #000;
   text-decoration: none;
   cursor: pointer;
 }
 * {
   box-sizing: border-box;
 }
 
 /* Style the search field */
 form.example input[type=text] {
   padding: 8px;
   font-size: 17px;
   border: 1px solid grey;
   float: left;
   width: 60%;
   background: #f1f1f1;
 }
 
 /* Style the submit button */
 form.example button {
   float: left;
   width: 15%;
   padding: 8px;
   background: #2196F3;
   color: white;
   font-size: 17px;
   border: 1px solid grey;
   border-left: none; /* Prevent double borders */
   cursor: pointer;
 }
 
 form.example button:hover {
   background: #0b7dda;
 }
 
 /* Clear floats */
 form.example::after {
   content: "";
   clear: both;
   display: table;
 }        
 </style>
 
 <style>
  
  
 #s2id_desig .select2-default {
   color: rgb(89, 255, 0) !important;
 }
 
 .autocomplete {
   /*the container must be positioned relative:*/
   position: relative;
   display: inline-block;
 }
 
 .autocomplete-items {
   position: absolute;
   border: 1px solid #d4d4d4;
   border-bottom: none;
   border-top: none;
   z-index: 99;
   /*position the autocomplete items to be the same width as the container:*/
   top: 100%;
   left: 0;
   right: 0;
 }
 .autocomplete-items div {
   padding: 10px;
   cursor: pointer;
   background-color: #fff;
   border-bottom: 1px solid #d4d4d4;
 }
 .autocomplete-items div:hover {
   /*when hovering an item:*/
   background-color: #e9e9e9;
 }
 .autocomplete-active {
   /*when navigating through the items using the arrow keys:*/
   background-color: DodgerBlue !important;
   color: #ffffff;
 }
 
 .select2-selection__choice__remove{
   border: none;
 }
 
 .multi_select_box{
   width: 150px;
   margin: 1px auto;
 }
 .multi_select_box select{
   width: 100%;
 }
 .multi_select_box button{
   background-color: darkslategray !important;
   color: #fff !important;
 }
 
 .home-section .home-content .text{
     font-size: 15px;
     font-weight: 400;
   }
 
  
   .bootstrap-select.form-control-sm .dropdown-toggle {
     height: 2.8em;
   }
 
   /* .select2-search--inline {
     display: contents; 
     this will make the container disappear, making the child the one who sets the width of the element
 } */
 
 .select2-search__field:placeholder-shown {
     width: 100% !important; /*makes the placeholder to be 100% of the width while there are no options selected*/
 }
 
   .mycls{
     display: inline-flex;
   }
     
 
   .strikeout  {
position: relative;
-webkit-text-decoration-line: line-through; /* Safari */
text-decoration-line: line-through;
text-decoration-thickness: 0.2rem;
text-decoration-color: red;
}

.strikeoutbg  {
background-color: lightyellow;
-webkit-text-decoration-line: line-through; /* Safari */
text-decoration-line: line-through;
text-decoration-thickness: 0.2rem;
text-decoration-color: red;
}
 
 /* Popup container - can be anything you want */
 .popup {
   position: relative;
   display: inline-block;
   cursor: pointer;
   -webkit-user-select: none;
   -moz-user-select: none;
   -ms-user-select: none;
   user-select: none;
 }
 
 /* The actual popup */
 .popup .popuptext {
  visibility: hidden;
  width: 200px;
  background-color:white;
  color: #fff;
  text-align: left;
  border-radius: 6px;
  padding: 8px 0;
  position: absolute;
  z-index: 1;
  bottom: 0%;
  left: -110%;
  margin-left: -150px;
}

.popuptext input {
  border: 0px;
  font-size: 14px;
}
 
 /* Popup arrow */
 /* .popup .popuptext::after {
   content: "";
   position: absolute;
   top: 100%;
   left: 50%;
   margin-left: -5px;
   border-width: 5px;
   border-style: solid;
   border-color: #555 transparent transparent transparent;
 } */
 
 /* Toggle this class - hide and show the popup */
 .popup .show {
   visibility: visible;
   -webkit-animation: fadeIn 1s;
   animation: fadeIn 1s;
 }
 
 .sethover:hover {
  background-color: lightblue;
  cursor: -webkit-grab; 
  cursor: grab;
  font-size: 140%;
}

 /* Add animation (fade in the popup) */
 @-webkit-keyframes fadeIn {
   from {opacity: 0;} 
   to {opacity: 1;}
 }
 
 @keyframes fadeIn {
   from {opacity: 0;}
   to {opacity:1 ;}
 }
 
 .sethover:hover {
   background-color: yellow;
   cursor: -webkit-grab; 
   cursor: grab;
 }
 
 </style>
 

<style>
  .modal-dialog-marks
 {
     width: 50% !important;
     height: 70% !important;
     margin: 10% !important;
     margin-left: 30% !important;
     padding: 3% !important;
     max-width:none !important;
     text-align: center !important;
     /* top: 25%;
     right: 15%;
     bottom: 25%;
     left: 45%; */
     background-color:white ;
 }
 .modal-content-marks
 {
     height: auto !important;
     min-height: 100% !important;
     border-radius: 0 !important; 
     width: 100% !important;
     /* text-align: center !important;   */
 }
 .modal-header-marks
 {
     border-bottom: 0px solid #9ea2a2 !important;
 }
 .modal-footer-marks
 {
     border-top: 0px solid #9ea2a2 !important;
 }
</style>
<style>
.icon-user-div{
 position: relative;
}
.icon-user {
position: absolute;
right: 0px;
top: 1px;
}
.wrap.active {
display: block;
visibility: visible;
box-shadow: 2px 3px 16px silver;
transition: all 600ms;
transform: translateY(0px);
transition: all 0.5s;
}
.wrap {
position: fixed;
overflow: hidden;
top: 10%;
right: 10%;
bottom: 85px;
left: 10%;
padding: 12px;
display: block !important;
border-radius: 4px;
transform: translateY(20px);
transition: all 0.5s;
visibility: hidden;
z-index: 9999;
height: 85vh;
}

.wrap-1.active {
display: block;
visibility: visible;
box-shadow: 2px 3px 16px silver;
transition: all 600ms;
transform: translateY(0px);
transition: all 0.5s;
}
.wrap-1 {
position: fixed;
overflow: hidden;
top: 10%;
right: 10%;
bottom: 85px;
left: 10%;
padding: 12px;
display: block !important;
border-radius: 4px;
transform: translateY(20px);
transition: all 0.5s;
visibility: hidden;
z-index: 9999;
height: 85vh;
}
.wrap.active .content,.wrap-1.active .content  {
position: relative;
z-index: 1;
opacity: 1;
transition: all 600ms cubic-bezier(0.55, 0.055, 0.675, 0.19);
}
.wrap .content, .wrap-1 .content {
opacity: 0;
}
.wrap.active:before, .wrap-1.active:before {
height: 2000px;
width: 2000px;
border-radius: 50%;
top: 50%;
left: 50%;
margin-left: -1000px;
margin-top: -1000px;
display: block;
-webkit-transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
}
.wrap:before, .wrap-1:before {
position: fixed;
width: 1px;
height: 1px;
background: white;
content: "";
bottom: 10px;
left: 50%;
top: 95%;
color: #fff;
border-radius: 50%;
-webkit-transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
}
.wrap::-webkit-scrollbar, .wrap-1::-webkit-scrollbar {
width: 10px;  /* Remove scrollbar space */
background: #dedede;
}
/* Optional: show position indicator in red */
.wrap::-webkit-scrollbar-thumb,.wrap-1::-webkit-scrollbar-thumb {
background: #FF0000;
}
</style>
<style>
.button{
width:98px;
height:75px;
margin-top:2px;
cursor: pointer;
}

.button{
width:98px;
height:75px;
margin-top:2px;
cursor: pointer;
}

.button:hover {
box-shadow: inset 0 0 .125em rgba(#fff, .75);
background:
linear-gradient(#f8e7e8, #e30001, #bc0000) content-box,
linear-gradient(-80deg, #f11f20, #9c1c1c, #f11f20) 0/ 37% 100% border-box;

}

.button1:hover {
box-shadow: inset 0 0 .125em rgba(#fff, .75);
background:
linear-gradient(#81fc6e, #1cb804 50%) content-box,
linear-gradient(#1cb804,#1cb804) border-box;

}
.button2:hover {
box-shadow: inset 0 0 .125em rgba(#fff, .75);
background:
linear-gradient(#F0FF42, #82CD47, #54B435) content-box,
linear-gradient(#82CD47,#82CD47) border-box;

}
.button3:hover {
box-shadow: inset 0 0 .125em rgba(#fff, .75);
background:
linear-gradient(Yellow, #FFA500 33%) content-box,
linear-gradient(orange, #FFA500) border-box;

}
.button4:hover {
box-shadow: inset 0 0 .125em rgba(#fff, .75);
background:
linear-gradient(#3ba1e9, #3996db 50%) content-box,
linear-gradient(#317bb5, #2499e6) border-box;

}
.button5:hover {
box-shadow: inset 0 0 .125em rgba(#fff, .75);
background:
linear-gradient(to right top, #fff 50%, rgba(#fff, 0) 61%) 0 100%/ 50% $arr-h no-repeat,
linear-gradient(to left top, #fff 50%, rgba(#fff, 0) 61%) 100% 100%/ 50% $arr-h no-repeat,
linear-gradient(#e9e9e9 $box-r, #f0f0f0 43%, #9d9d9f);

}


.button:active {
transform: translateY(0.5em);
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
}
</style>
<style>
.extra-css{
 background-color: white;
 border: 0px;
}
.bootstrap-select.btn-group .dropdown-menu.inner,	
.dropdown-menu.open {	
min-height: 70vh !important;} 

.btn-save {	
align-items: center;	
background-clip: padding-box;	
background-color: #fa6400;	
border: 1px solid transparent;	
border-radius: .25rem;	
box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;	
box-sizing: border-box;	
color: #fff;	
cursor: pointer;	
display: inline-flex;	
font-family: system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;	
font-size: 16px;	
font-weight: 600;	
justify-content: center;	
line-height: 1.25;	
margin: 0;	
min-height: 3rem;	
padding: calc(.875rem - 1px) calc(1.5rem - 1px);	
position: relative;	
text-decoration: none;	
transition: all 250ms;	
user-select: none;	
-webkit-user-select: none;	
touch-action: manipulation;	
vertical-align: baseline;	
width: auto;	
}	
.btn-save:hover,	
.btn-save:focus {	
background-color: #fb8332;	
box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;	
}	
.btn-save:hover {	
transform: translateY(-1px);	
}	
.btn-save:active {	
background-color: #c85000;	
box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;	
transform: translateY(0);	
}	
.btn-draft {	
align-items: center;	
background-clip: padding-box;	
background-color: #666699;	
border: 1px solid transparent;	
border-radius: .25rem;	
box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;	
box-sizing: border-box;	
color: #fff;	
cursor: pointer;	
display: inline-flex;	
font-family: system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;	
font-size: 16px;	
font-weight: 600;	
justify-content: center;	
line-height: 1.25;	
margin: 0;	
min-height: 3rem;	
padding: calc(.875rem - 1px) calc(1.5rem - 1px);	
position: relative;	
text-decoration: none;	
transition: all 250ms;	
user-select: none;	
-webkit-user-select: none;	
touch-action: manipulation;	
vertical-align: baseline;	
width: auto;	
}	
.btn-draft:hover,	
.btn-draft:focus {	
background-color: #666699;	
box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;	
}	
.btn-draft:hover {	
transform: translateY(-1px);	
}	
.btn-draft:active {	
background-color: #666699;	
box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;	
transform: translateY(0);	
}	
.modal-title	
{	
font-size:1rem;	
font-weight:600;	
}	
.copy-link	
{	
cursor:pointer;	
text-decoration: none;	
font-weight:600;	
color:#0059b3;	
font-size:13px;	
}	
.table-inpt-fields td {padding:0px;border:0px;padding-left:10px;}


* {
box-sizing: border-box;
}
/* The Close Button */
.close {
color: white;
float: right;
font-size: 28px;
font-weight: bold;
}

.close:hover,
.close:focus {
color: #000;
text-decoration: none;
cursor: pointer;
}
* {
box-sizing: border-box;
}

/* Style the search field */
form.example input[type=text] {
padding: 8px;
font-size: 17px;
border: 1px solid grey;
float: left;
width: 60%;
background: #f1f1f1;
}

/* Style the submit button */
form.example button {
float: left;
width: 15%;
padding: 8px;
background: #2196F3;
color: white;
font-size: 17px;
border: 1px solid grey;
border-left: none; /* Prevent double borders */
cursor: pointer;
}

form.example button:hover {
background: #0b7dda;
}

/* Clear floats */
form.example::after {
content: "";
clear: both;
display: table;
}        
</style>

<style>


#s2id_desig .select2-default {
color: rgb(89, 255, 0) !important;
}

.autocomplete {
/*the container must be positioned relative:*/
position: relative;
display: inline-block;
}

.autocomplete-items {
position: absolute;
border: 1px solid #d4d4d4;
border-bottom: none;
border-top: none;
z-index: 99;
/*position the autocomplete items to be the same width as the container:*/
top: 100%;
left: 0;
right: 0;
}
.autocomplete-items div {
padding: 10px;
cursor: pointer;
background-color: #fff;
border-bottom: 1px solid #d4d4d4;
}
.autocomplete-items div:hover {
/*when hovering an item:*/
background-color: #e9e9e9;
}
.autocomplete-active {
/*when navigating through the items using the arrow keys:*/
background-color: DodgerBlue !important;
color: #ffffff;
}

.select2-selection__choice__remove{
border: none;
}

.multi_select_box{
width: 150px;
margin: 1px auto;
}
.multi_select_box select{
width: 100%;
}
.multi_select_box button{
background-color: #4B7BF5 !important;
color: #fff !important;
}

.home-section .home-content .text{
 font-size: 15px;
 font-weight: 400;
}


.bootstrap-select.form-control-sm .dropdown-toggle {
 height: 2.8em;
}

/* .select2-search--inline {
 display: contents; 
 this will make the container disappear, making the child the one who sets the width of the element
} */

.select2-search__field:placeholder-shown {
 width: 100% !important; /*makes the placeholder to be 100% of the width while there are no options selected*/
}

.mycls{
 display: inline-flex;
}
 

.strikeout  {
position: relative;
-webkit-text-decoration-line: line-through; /* Safari */
text-decoration-line: line-through;
text-decoration-thickness: 0.2rem;
text-decoration-color: red;
}

.strikeoutbg  {
background-color: lightyellow;
-webkit-text-decoration-line: line-through; /* Safari */
text-decoration-line: line-through;
text-decoration-thickness: 0.2rem;
text-decoration-color: red;
}


/* Popup container - can be anything you want */
.popup {
position: relative;
display: inline-block;
cursor: pointer;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}

/* The actual popup */
.popup .popuptext {
visibility: hidden;
width: 200px;
background-color:white;
color: #fff;
text-align: left;
border-radius: 6px;
padding: 8px 0;
position: absolute;
z-index: 1;
bottom: 0%;
left: -110%;
margin-left: -150px;
}

.popuptext input {
border: 0px;
font-size: 14px;
}

/* Popup arrow */
/* .popup .popuptext::after {
content: "";
position: absolute;
top: 100%;
left: 50%;
margin-left: -5px;
border-width: 5px;
border-style: solid;
border-color: #555 transparent transparent transparent;
} */

/* Toggle this class - hide and show the popup */
.popup .show {
visibility: visible;
-webkit-animation: fadeIn 1s;
animation: fadeIn 1s;
}



.sethover:hover {
background-color: lightblue;
cursor: -webkit-grab; 
cursor: grab;
font-size: 140%;
}

#addworkmech tr{
height:50px;
}
</style>

<!-- auto update  toggle button -->
<style>
.switch {
position: relative;
display: inline-block;
width: 90px;
height: 34px;
}

.switch input {display:none;}

.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #ca2222;
-webkit-transition: .4s;
transition: .4s;
border-radius: 34px;
}

.slider:before {
position: absolute;
content: "";
height: 26px;
width: 26px;
left: 4px;
bottom: 4px;
background-color: white;
-webkit-transition: .4s;
transition: .4s;
border-radius: 50%;
}

input:checked + .slider {
background-color: #2ab934;
}

input:focus + .slider {
box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
-webkit-transform: translateX(26px);
-ms-transform: translateX(26px);
transform: translateX(55px);
}

/*------ ADDED CSS ---------*/
.slider:after
{
content:'OFF';
color: white;
display: block;
position: absolute;
transform: translate(-50%,-50%);
top: 50%;
left: 50%;
font-size: 10px;
font-family: Verdana, sans-serif;
}

input:checked + .slider:after
{  
content:'ON';
}


#message_container {

/* to position it at bottom-left (dependent on the parent) */
position: fixed;
bottom: 3%;
left:45%;

/* to position the contents within the box (ie the message text) */
display: flex;
justify-content: center;
align-items: center;

/* to style the message box in particular ways */
background-color: #000;
color: white;
/* padding: 2em; */
border-radius: 20px;
box-shadow: 4px 4px 20px rgba(0,0,0,0.3);
width: 100%;
max-width: 250px;
height: 25px;
}

/*--------- END --------*/
</style>

<!-- for fi page  -->
<style>
.heading1{

text-shadow: #6e6b6b;
text-decoration-line: underline;
text-align: center;
border: 1 rem;
margin: 20px ;
padding: 10 px;
color: #f4f4f4;
font-weight: bold;
}
.containerField{
align-items: center;
margin-left: 10px;
}
.content{
max-width: 800px;
margin: 0 auto;
}



.department-wise-row {
border-radius: 5px;

margin-bottom: 20px;
padding: 30px;
width: 49%;
max-width: 49%;

}

.category-wise-row {
border-radius: 5px;
margin-bottom: 20px;
margin-right: 10px;


margin-bottom: 20px;
margin-right: 10px;
padding: 30px;
width: 49%;
max-width: 49% ;
}

.pc1{
background: linear-gradient(to right, #FF90BB, rgba(125, 55, 163, 0.703));
}

.pc2{
background: linear-gradient(to right, rgba(141, 125, 229, 0.868), rgba(93, 58, 188, 0.795));
}
.card-title {
font-weight: bold;
margin-bottom: 10px;
}
.title
{
  text-align: center;
  font-weight:700;
  color:#000;
  font-size:1rem;
  padding:1rem;
  text-align: center;
}

.parent-card {

  color: #fff;
  margin: 2px;
  padding: 8px;
  margin-top: 3px;
  border-radius: 5px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  width: 105%;
 
  max-height: 400px;
  max-width: 400px;
  border: 1px solid black;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  margin-bottom: 15px;
  position: relative;
}


.child-card {
background-color: rgba(255, 255, 255, 0.9);
margin: 5px;
padding: 10px;
border-radius: 5px;
box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
display: none;
color: #707887;
overflow: visible;
}

.parent-card:hover,
.parent-card.open {
        background: linear-gradient(to right, #5769b7, #8b58bf);
        cursor: pointer;
       
    }
    .parent-card.open .child-card {
display: block;
}
.marginleft{
margin-left: 20px;
}
.card-container {
display: flex;
flex-wrap: wrap;
justify-content: space-between;
margin-top: 20px;
margin-bottom: 20px;
}


.wrapRow{
 
  margin-right: 20px;
  margin-left: 20px;
    display: flex;
    justify-content: center;
    background: linear-gradient(109.6deg, rgb(204, 228, 247) 11.2%, rgb(237, 246, 250) 100.2%);
    border-style: groove;
    border: 2px solid #817373;
  }


</style>
<style>
.sectionsRow thead tr th {
 width: 10%;
}

.select2-results__option[aria-selected=true] { 
background-color: #dff0c3 !important;
color:#000 !important;
}

.select2-selection--multiple:before {
 content: "";
 position: absolute;
 right: 7px;
 top: 42%;
 border-top: 5px solid #888;
 border-left: 4px solid transparent;
 border-right: 4px solid transparent;
}


</style>
<style>
  .textareashowhide{
    min-height:2em;
    display:none;
  }

  .textareashowhide_h{
    min-height:2em;
    
  }
 
.plswait_overlay{
 width: 100%;
 height: 100%;
 background: rgba(0,0,0,.35);
 color:white;
 line-height: 700px;
 position: absolute;
 top:0px;
 right:0px;
 bottom:0px;
 left:0px;
 text-align: center;
 font-size: 25px;
 font-weight: bold;
 z-index: 1000000;
 opacity: 0;
}


.modal-open {
 overflow: initial;
}

</style>

 
</head>


<body>
    <input type="hidden" id="inspection_id_edit" value="{{mom_no}}">
    <input type="hidden" id="ins_flag_edit" value="{{ins_flag}}">

      <div class="container">
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == 'success' %}
                  <div class="alert alert-success">
                    <strong>Success </strong>{{ message }}
                  </div>
                {% elif message.tags == 'error' %}
                  <div class="alert alert-danger">
                    <strong>Error </strong>{{ message }}
                  </div>
                {% elif message.tags == 'info' %}
                  <div class="alert alert-info">
                    <strong>Info </strong>{{ message }}
                  </div>
                {% else %}
                
                {% endif %}
               
            
            {% endfor %}
        {% endif %}
      </div>
    
      <h3 class="report_heading">Create Minutes of Meeting</h3><br>
      {% if ins_flag != 1 %}
      <div style="margin-right: 10%;">
       <label style="padding-left: 82%">Click To Enable Auto Save</label>
      <label class="switch" style="float: right;" title="Switch On For Auto Update">
        <input type="checkbox" onclick="getOnOffStatus()" id='onOffIdForAutoUpdate' >
        <span class="slider round"></span>
      </label>
    </div>
    {% endif %}
      <br>
      <br>
   
   

    <div class="container">
      <select class="form-control" id="zone" name="zone"  style="max-width:100%;" hidden><option value="{{Zone11}}" hidden selected>{{Zone11}}</option></select>
      <select class="form-control" id="division" data-placeholder="Select division.." name="division" style="max-width:100%;"  hidden><option value="" hidden selected>{{Zone11}}</option></select>
      <div class="container inpt-container" id="container1" style="margin-bottom:3% ; padding-bottom: 10px; ">
        {% if option_val == 'edit' %}
        <div class="row">

          <div class="col-lg-10">
              <label for="mdate" class="lbl-caption">Title<span
                      style="color:red;font-weight:bold">*</span></label>
              <textarea class="form-control " maxlength="500"
                  placeholder="Enter title without date within 500 characters" id="titleMOM" name="titleMOM"
                  required>{{mom_data.0.mom_title}}</textarea>

              <span class="input-group-addon">
                  <i class="glyphicon glyphicon-calendar"></i>
              </span>
          </div>
          <div class="col-lg-2">
              <label for="type" class="lbl-caption">Meeting Type<span
                      style="color:red;font-weight:bold">*</span></label>
              <select class="form-control" name="type" id="type" class="custom-select" required>
                  {% for t in meeting %}
                  {% if t.meeting_type == mom_data.0.meeting_type %}
                  <option value="{{t.meeting_type}}" selected>{{t.meeting_type}}</option>
                  {% else %}
                  <option value="{{t.meeting_type}}">{{t.meeting_type}}</option>
                  {% endif %}
                  {% endfor %}
              </select>
              <p style="font-size: 12px;">Note: To add a new Meeting Type, type the value in the search box and enter.</p>
          </div>

          <div class="col-lg-10">
              <label for="officer" class="lbl-caption">Member(s) Present<span
                      style="color:red;font-weight:bold">*</span></label><br>
              <select class="form-control" id="officer" name="officer" multiple required>
                  {% for o in officer %}
                  {% if o.designation in mem_desig %}
                  <option value="{{o.designation}}" selected>{{o.designation}}</option>
                  {% else %}
                  <option value="{{o.designation}}">{{o.designation}}</option>
                  {% endif %}
                  {% endfor %}
                  {% for m in mems %}
                  <option value="{{m.designation}}" selected>{{m.designation}}</option>
                  {% endfor %}
              </select>
              <p style="font-size: 12px;">Note: To add a new member, type the Designation in the search box and enter.</p>
          </div>

          <div class="col-lg-2">
              <label for="mdate" class="lbl-caption">Date of Meeting<span
                      style="color:red;font-weight:bold">*</span></label>
              <input type='text' style="background-color: #fff;" id='mdate' name="mdate" placeholder="dd/mm/yyyy"
                  class="form-control" readonly required value="{{mom_data.0.mom_date|date:'d/m/Y'}}">
              <span class="input-group-addon">
                  <i class="glyphicon glyphicon-calendar"></i>
              </span>
          </div>

        </div>
        {% else %}
        
        <div class="row">
            <div class="col-lg-10">
                <label for="mdate" class="lbl-caption">MOM Title<span style="color:red;font-weight:bold">*</span></label>
                <textarea class="form-control " maxlength="500"
                    placeholder="Enter title without date within 500 characters" id="titleMOM" name="titleMOM" required></textarea>
                <span class="input-group-addon">
                    <i class="glyphicon glyphicon-calendar"></i>
                </span>
            </div>
            <div class="col-lg-2">
                <label for="type" class="lbl-caption">Meeting Type<span
                        style="color:red;font-weight:bold">*</span></label>
                <select class="form-control" name="type" id="type" class="custom-select" required >
                    <option value="" selected disabled>Select Meeting Type</option>
                    {% for t in meeting %}
                    <option value="{{t.meeting_type}}">{{t.meeting_type}}</option>
                    {% endfor %}
                </select>
                <p style="font-size: 12px;">Note: To add a new Meeting Type, type the value in the search box and enter.</p>
            </div>
            <div class="col-lg-10">
                <label for="officer" class="lbl-caption">Member(s) Present<span
                        style="color:red;font-weight:bold">*</span></label><br>
                <select class="form-control" id="officer" name="officer" multiple required>
                    {% for o in officer %}
                    <option value="{{o.designation}}">{{o.designation}}</option>
                    {% endfor %}
                </select>
                <p style="font-size: 12px;">Note: To add a new member, type the Designation in the search box and enter.</p>

            </div>
            <div class="col-lg-2">
                <label for="mdate" class="lbl-caption">Date of Meeting<span
                        style="color:red;font-weight:bold">*</span></label>
                <input type='text' style="background-color: #fff;" id='mdate' name="mdate" placeholder="dd/mm/yyyy"
                    class="form-control" readonly required>
                <span class="input-group-addon">
                    <i class="glyphicon glyphicon-calendar"></i>
                </span>
            </div>
        </div>
        {% endif %} 
      </div>
    
    <br>
    
    <div class="container p-0">
    
      <form action="{% url 'create_inspection_form' %}" method="POST"> 
        {% csrf_token %}
        
              
              <table id="table1" class="table table-striped table-bordered center table-input">
                  <thead>
                    <tr style="margin-left: 5em;">
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;" hidden>Type</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5%;">S.NO.</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 40%;">	MINUTES OF MEETING</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 25%;">	DEALT BY</th>
                       <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 10%;">Target Date</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5%;">Priority</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 10%;">Action</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;" hidden>row id</th>
                    </tr>
                
                  </thead>
                  <tbody  id="addworkmech">
                  <!-- {% for i in item_data %}
                  <tr>
                    <td hidden>{{i.type}}</td>
                    <td style="text-align: center; width:5px; font-family:verdana;">{{i.des_id}}</td>
                    <td>
                    <div class="autocomplete1">

                    {% if i.type == 'P' %}
                    <textarea maxlength="3000" placeholder="Maximum character limit 3000" id='heading{{i.des_id_id}}'   autocomplete1=off  style="height:30px;" class="form-control">{{i.item_heading}}</textarea>
                    {% elif i.type == 'SP' %}
                    <textarea maxlength="3000"  placeholder="Maximum character limit 3000" id='heading{{i.des_id_id}}'   autocomplete1=off  style="height:30px;" class="form-control">{{i.item_subheading}}</textarea>
                    <br>
                    <textarea maxlength="5000"  placeholder="Add Sub Para Description (Optional).." style="height:5em;" id="description{{i.des_id_id}}" class="form-control">{% if i.item_description %}{{i.item_description}} {% endif %}</textarea>
                    {% else %}
                    <textarea maxlength="3000"  placeholder="Maximum character limit 3000" id='heading{{i.des_id_id}}'   autocomplete1=off  style="height:30px;" class="form-control">{{i.item_decision}}</textarea>
                    {% endif %}
                  
                    </div>
                    </td>
                    <td>
                        {% if i.type != 'SSP' %}
                      <div id="showhide{{i.des_id_id}}">
                        <div class="mycls">
                          <div class="multi_select_box" id="divdesgn{{i.des_id_id}}">	                 
                          
                          <select id="desgn{{i.des_id_id}}" class="desgn{{i.des_id_id}} demo w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true"  multiple>	
                            {% for j in desg_no %}
                              {% if j.designation_code in i.mark_officer %}
                              <option  value="{{j.designation_code}}" data-tokens="{{j.empnoser}}" selected>{{j.designation}}</option>
                              {% else %}
                              <option  value="{{j.designation_code}}" data-tokens="{{j.empnoser}}">{{j.designation}}</option>
                              {% endif %}
                            {% endfor %}
                            {% for j in i.extra_off %}
                            {% if j not in desg_no %}
                            <option  value="{{j.designation_code}}" data-tokens="{{j.empnoser}}" selected>{{j.designation}}</option>
                            {% endif %}
                            {% endfor %}
                          </select>
                          <input type="button" id="desgnbtn{{i.des_id_id}}" value="Ok" onclick="getOption('desgn{{i.des_id_id}}')" hidden>	
                          <input type="text" id="desgninp{{i.des_id_id}}" hidden >	
                                                    
                          </div>&nbsp;	
                          <div class="autocomplete1" id="divmarkeofficer{{i.des_id_id}}">	
                            &nbsp;	
                            <button type="button" id="cpy{{i.des_id_id}}" value="Copy" onclick="copy_mark_officer(this)" ><i class='fas fa-copy' style='font-size:24px;color:blue;'></i></button>
                            &nbsp;
                            <a  style="display:inline-block;	
                              width:130px;	
                              height:35px;	
                              margin-top:3px;	
                              color: white;	
                              background-color: darkslategray;	
                              padding: 5px 11px;	
                              border-style: 2px solid" id="tooltip{{i.des_id_id}}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title="Add From Dropdown" >Add From D...</a>  	
                        
                            <textarea hidden type="text" placeholder="Add officer" class="form-control" value="" custom-offic="" custom-key="" id='markeofficer{{i.des_id_id}}' class="autocomplete1" readonly></textarea>
                          </div>	
                          
                        </div>
                        <textarea maxlength="500" id='remarks{{i.des_id_id}}' placeholder="Add Remarks (Maximum Character Limit 500)" style="height:2em;" class="form-control mt-1">{{i.remarks}}</textarea>

                        </div>
                        {% else %}
                        <div id="showhide{{i.des_id_id}}">
                          <div class="mycls">
                            <div class="multi_select_box" id="divdesgn{{i.des_id_id}}">	                 
                            
                            <select id="desgn{{i.des_id_id}}" class="desgn{{i.des_id_id}} demo w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true"  multiple>	
                              {% for j in desg_no %}
                                {% if j.designation_code in i.mark_officer %}
                                <option  value="{{j.designation_code}}" data-tokens="{{j.empnoser}}" selected>{{j.designation}}</option>
                                {% else %}
                                <option  value="{{j.designation_code}}" data-tokens="{{j.empnoser}}">{{j.designation}}</option>
                                {% endif %}
                              {% endfor %}
                              {% for j in i.extra_off %}
                              {% if j not in desg_no %}
                              <option  value="{{j.designation_code}}" data-tokens="{{j.empnoser}}" selected>{{j.designation}}</option>
                              {% endif %}
                              {% endfor %}
                            </select>
                            <input type="button" id="desgnbtn{{i.des_id_id}}" value="Ok" onclick="getOption('desgn{{i.des_id_id}}')" hidden>	
                            <input type="text" id="desgninp{{i.des_id_id}}" hidden >	
                                                      
                            </div>&nbsp;	
                            <div class="autocomplete1" id="divmarkeofficer{{i.des_id_id}}">	
                              &nbsp;	
                              <button type="button" id="cpy{{i.des_id_id}}" value="Copy" onclick="copy_mark_officer(this)" ><i class='fas fa-copy' style='font-size:24px;color:blue;'></i></button>
                              &nbsp;
                              <a style="display:inline-block;	
                                width:130px;	
                                height:35px;	
                                margin-top:3px;	
                                color: white;	
                                background-color: darkslategray;	
                                padding: 5px 11px;	
                                border-style: 2px solid" id="tooltip{{i.des_id_id}}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title="Add From Dropdown" >Add From D...</a>  	
                          
                              <textarea hidden type="text" placeholder="Add officer" class="form-control" value="" custom-offic="" custom-key="" id='markeofficer{{i.des_id_id}}' class="autocomplete1" readonly></textarea>
                            </div>	
                          </div>
                          <textarea maxlength="500" id='remarks{{i.des_id_id}}' placeholder="Add Remarks (Maximum Character Limit 500)" style="height:2em;" class="form-control mt-1">{{i.remarks}}</textarea>

                          </div>
                                            
                        {% endif %}
                    </td>
                    <td>
                      {% if i.typ != 'SSP' %}
                    <div class="autocomplete1" id="divtargetdate{{i.des_id_id}}">
                      <input type="text"  class="form-control datepker" value='{{i.target_date}}' autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;background-color:white;" id='targetdate{{i.des_id_id}}' readonly>
                     </div>
                     {% else %}
                     <div class="autocomplete1" id="divtargetdate{{i.des_id_id}}">
                      <input type="text"  class="form-control datepker" value='{{i.target_date}}' autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;background-color:white;" id='targetdate{{i.des_id_id}}' readonly>
                     </div>
                     {% endif %}
                    </td>
                    
                    <td>
                      {% if i.typ != 'SSP' %}
                      <div class="autocomplete1" id="divcheckbox{{i.des_id_id}}">
                        {% if i.item_priority == '1' %}
                        <input type="checkbox" value="1" checked autocomplete="off" id='check{{i.des_id_id}}' >&nbsp; High 
                        {% else %}
                        <input type="checkbox" value="1"  autocomplete="off" id='check{{i.des_id_id}}' >&nbsp; High 
                        {% endif %}
                      
                      </div>
                      {% else %}
                      <div class="autocomplete1" id="divcheckbox{{i.des_id_id}}">
                        {% if i.item_priority == '1' %}
                        <input type="checkbox" value="1" checked autocomplete="off" id='check{{i.des_id_id}}' >&nbsp; High 
                        {% else %}
                        <input type="checkbox" value="1"  autocomplete="off" id='check{{i.des_id_id}}' >&nbsp; High 
                        {% endif %}
                      
                      </div>
                      {% endif %}
                    </td>
                    </tr>
                  {% endfor %} -->
                  </tbody>
                  
              </table>
           
               
            <div class="btn-group">
                  <button type="button" class="btn btn-primary btn-sm"  style="margin-left: 6em;"  id="addheading" onclick="addpara('P','-2');changeColorBtn(this);">Add Para</button> &nbsp;
                  <button  type="button"  class="btn btn-primary btn-sm" id="addmech" onclick="addpara('SP','-2');changeColorBtn(this);">Add Sub Para</button>&nbsp;
                  <button  type="button"  class="btn btn-primary btn-md" id="addSubmech" onclick="addpara('SSP','-2');changeColorBtn(this);">Add Sub Subpara</button>&nbsp;
                  <button  type="button"  name="addimage"  id="addimage" onclick="add_row_image()" class="btn btn-primary btn-md">Add Image</button>&nbsp;

                  <button type="button"  class="btn btn-danger btn-md"  onclick="delete_para()" >Delete</button> 
                    
            </div>

             <!-- image upload -->
             <br>
             <br>
             <table id="table_img" class="table table-striped table-bordered center table-input">
               <thead>
                 <tr>
                   <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 10%;">Reference No.</th>
                   <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 50%;">Select Image</th>
                   <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 20%;">Preview</th>
                   <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 20%;">Delete</th>
                 </tr>
               </thead>
             </table>
         
      </form>
          
    </div>
          
    <div class="container mt-1">
      <div class="row">
        <div class="col">
          <label for="sttninsp" class="lbl-caption">Station of Inspecting Officer<span style="color:red;font-weight:bold">*</span></label>
          <input maxlength="50"  class="form-control"  id="sttninsp"  name="sttninsp" {% if station_name != None %} value="{{station_name}}" {% else %} value="" {% endif %}></input>
        </div>
        <div class="col">
          <label for="sttninsp" class="lbl-caption">Designation of Inspecting Officer<span style="color:red;font-weight:bold">*</span></label>
          <input maxlength="50"  class="form-control"   id="desiginsp"  name="desiginsp" value="{{insp_desig}}"></input>
        </div>
        <div class="col">
          <label for="sttninsp" class="lbl-caption">Name of Inspecting Officer<span style="color:red;font-weight:bold">*</span></label>
          <input maxlength="100"  class="form-control"   id="ofcnameinsp"  name="ofcnameinsp" value="{{insp_ofc_name}}"></input>
        </div>
      </div>
    </div>
          
    <div class="container">
        <hr>
        <div class="row">
                    <div class="col-sm-12 col-md-12">
                        
                            <div class="input-group">                          
                            <table class="table-inpt-fields">	
                                <tr>	
                                <td>Copy To<td style="padding-left:1rem;"> 

                            <div class="multi_select_box" id="copy_divdesgn">
                
                                <select id="copy_desgn"  class="demo-copy w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true"  multiple>
                                  {% if option_val == 'edit' %}
                                      {% for j in copy_to %}
                                        {% if j.designation_code1 in new_mail_desig_code %}
                                        <option  value="{{j.designation_code}}" data-tokens="{{i.empnoser}}" selected>{{j.designation}}</option>
                                        {% else %}
                                        <option  value="{{j.designation_code}}" data-tokens="{{i.empnoser}}">{{j.designation}}</option>
                                        {% endif %}
                                      {% endfor %}
                                  {% else %}
                                  {% for i in copy_to %}
                                <option  value="{{i.designation_code}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
                                {% endfor %}
                                {% endif %}
                                </select>
                                <input type="button" id="copy_desgnbtn" value="Ok" onclick="copyToOption()" hidden>
                                <input type="text" id="copy_desgninp" hidden >
                            </div>
                            </td><td>	
                            <input type="text" class="form-control" custom-offic="" id="copyto" custom-key="" placeholder="Add officer(s) from the dropdown" autocomplete="off" style="width: 20em;" readonly>	
                            </td></tr></table>
                            </div>
                        
                    </div>
        </div>
        
        <div class="row">	
                    <div class="col-sm-12 col-md-12" align="right">	
                    <div class="btn-group">                  
                    <button type="button" id="draft_submit" name="draft" value="Save as draft" onclick="Savedraft_data('continue')" class="btn btn-draft btn-sm">Save as Draft & Continue</button>  
                    <button type="button" id="draft1" name="draft1" value="Save as draft1" onclick="Savedraft_data('exit')" class="btn btn-draft btn-sm">Save Draft & Exit</button>  
                    <button type="button" id="submit" name="submit" value="Submit"  class="btn btn-save btn-sm" onclick="Updatedraft_data1(this);" hidden>Submit</button> 
                    <button type="button" id="View_data" name="View_data" value="View_data" onclick="Updatedraft_data2(this)" class="btn btn-draft btn-sm" >Preview</button> &nbsp; 
                    <button type="button" id="submit2" class="btn btn-save btn-sm" onclick="chkvalidation();" {% if request.session.userrole == 'guest' %} disabled {% endif %}>Submit</button> 
                    &nbsp;<button type="button" class="btn btn-secondary btn-sm" onclick="compliance_alterdata();">Reset</button>
  
                  </div>
                    </div>
                
                    
        </div>

        <div class="row">
                    <div class="mt-2">	
                        <span style="color:red;font-weight:bold">*</span> <label class="lbl-caption">Required Fields in Forms</label>	
                    </div>
        </div>
    </div>
       

      
    </div>
   
       
<div class="modal" tabindex="-1" id="exampleModal" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog-modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="exampleModalLabel"><b> Mark Officers</b></h4>
              <button type="button" id="close1" class="btn btn-light btn-sm" data-dismiss="modal">&times;</button>
            </div>
           
            <div class="modal-body">
              <form   action="" method="POST" >
                {% csrf_token %}
               <input type="text" value="" id="mark_officersss" hidden/>

               
        <div class="inpt-container" style="padding:10px;">      
          <div class="row">
              <div class="col-md-3">
                  <label class="lbl-caption">Rly./Org.</label>
                  <select multiple class="form-control" data-placeholder="Select zone.." id="rly_1" name="rly_1" class="custom-select" style="width: 100%;"  multiple >
                      {% for i in Zone %}
                      <option >{{i}}</option>
                      {% endfor %}
          
                  </select>
              </div>
              <div class="col-md-3">
                  <label class="lbl-caption">Div./Unit</label>
                  <select class="form-control" id="div_1" data-placeholder="Select division.." name="div_1" class="custom-select" style="width: 100%;"  multiple onchange="getdivwisedata()">
                      {% for i in division %}
                      <option>{{i}}</option>
                      {% endfor %}
                  </select>
              </div>
              <div class="col-md-3">
                  <label class="lbl-caption"> Department</label>
                  <select multiple class="form-control" id="dept_1" data-placeholder="Select department.." name="dept_1" class="custom-select" style="width: 100%;"  onchange="getdivdeptdata()">
                      {% for i in department %}
                      <option value="{{i.department_name}}">{{i.department_name}}</option>
                      {% endfor %}        
                  </select>
              </div>
              <div class="col-md-3">
                  <label class="lbl-caption">Designation</label>
                  <select multiple class="form-control" id="desig" data-placeholder="Select designation.." name="desig" class="custom-select" style="width: 100%;"  onchange="getdesigdata();">
                      {% for i in alldesig %}
                      <option value="{{i.designation}}">{{i.designation}}</option>
                      {% endfor %}
                  </select>
              </div>
          </div></div><br>
          <div class="row">
            <div class="col">
                <input type="checkbox"  id="allgm" >
                <label class="lbl-caption"> All GM/ZR</label>
            </div>
            <div class="col">
                <input type="checkbox"  id="alldrm">
                <label class="lbl-caption"> All DRM</label>
               
            </div>
            <div class="col">
                <input type="checkbox"  id="allphod">
                <label class="lbl-caption"> All PHOD</label>
               
            </div>
            <div class="col">
                <input type="checkbox"  id="allboard">
                <label class="lbl-caption"> All Board Members</label>
               
            </div>
            <div class="col">
              <input type="checkbox"  id="allbo">
              <label class="lbl-caption"> All BO</label>
          </div>
          <div class="col">
            <input type="checkbox"  id="allpanel">
            <label class="lbl-caption">Panel</label>
        </div>
        </div>
        <br>
        <div class="row">
          <div class="col-md-6">
            <label class="lbl-caption">Selected Designation</label>
              <!-- <input type="text"  id="alltext" class="form-control" style="background-color: rgb(247, 218, 248);" > -->
              <textarea class="form-control" maxlength="150"   id="alltext"   readonly></textarea>
  
          </div>
          <div class="col-md-6" align="right">
            <div class="btn-group"></div>
            
            <button type="button" class="form-control  btn btn-info" onclick="add_save_marked_officers();">Add</button>
  
           
            <button type="button" class="form-control btn btn-danger" onclick="remove_save_marked_officers();">Remove</button>
  
          </div>
        </div>
        
         
      <hr/>
        <div class="row"></div>
          <div class="col-lg-12 col-sm-12">
            <label></label>
            <button type="button" class="form-control btn btn-save" onclick="save_marked_officers();">Save</button>
  
          </div>
          <div class="col-md-3">
            
          </div>
          </div>
          <br>
          <div class="row" id="showdiv1">
            <div class="col-md-6">
                  <table id="text" class="table table-striped table-bordered ">
                    <thead>
                      <tr><th></th>
                        <th></th></tr>
                    </thead>
                    <tbody>
                    </tbody>  
                </table>
            </div>
            <div class="col-md-6">
                  <table id="text1" class="table table-striped table-bordered ">
                    <thead>
                        <tr><th></th><th></th></tr>
                    </thead>
                    <tbody>
                      
                    </tbody>
                </table>
            </div>
          </div>
          <div class="row" id="showdiv2">
            <div class="col-md-6">
                  <table id="textdesig" class="table table-striped table-bordered ">
                    <thead>
                      <tr>
                        <th></th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>  
                  </table>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-5" hidden>
              <table id="textdesigselect" class="table table-striped table-bordered ">
                <thead>
                  <tr>
                    <th hidden></th>
                    <th>Selected Employee/Designation</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>  
              </table>
            </div>
          </div>
          <br>
  
          <input type="hidden" value="0" id="s1" name="s1">
          </form>
          </div>
            <div class="modal-footer">
              
              
            </div>
          </div>
</div>               
        
<div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h4 class="modal-title"><b> Target Date</b></h4></div>
            <div class="modal-body">    
                <div>
                  <label for="start" >Target Date</label><br><input type="date"  class="col-md-2" required class="form-control" style="height: 2em;margin-top:0.7em;" id="target_date" value="new Date()"  onkeydown='event.preventDefault()' requied>
                 </div>
              </div>
        </div>

    </div>
</div>
           
            
           
                
</body>

<button type="button" id="openofficeremodal"  data-toggle="modal" data-target="#openofficeremodal_get" hidden></button>
<div class="modal" tabindex="-1" id="openofficeremodal_get" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title" id="exampleModalLabel"><b> Select Options to Copy From</b></h4>
      <button type="button" class="btn btn-light  btn-sm" id="closeofficermodal" data-dismiss="modal">&times;</button>
      
    </div>
      <div class="modal-body">
        <table id="add_officer_tbl" style="width: 100%;">
          <tbody></tbody>
        </table>

      </div>
      <div class="modal-footer">
        <button type="button" name="submit" value="Copy_officer" 
                  class="btn btn-primary" onclick="Copy_marked_officer()">Copy</button>
        </button>
      </div>
    </div>
  </div>
</div>



<!-- added modal -->


<button type="button" id="addtablemodal"  data-toggle="modal" data-target="#tablerowcolumn" hidden></button>
<div class="modal" tabindex="-1" id="tablerowcolumn" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title" id="exampleModalLabel"><b> Give table rows and column</b></h4>
      <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" id="closespanid">
        <!-- <span aria-hidden="true">&times;</span> -->Close
    </button>
      <!-- <button type="button" class="btn btn-light  btn-sm" id="closespanid" data-dismiss="modal">&times;</button> -->
      
    </div>
      <div class="modal-body">
      <label>No of Rows</label>&nbsp;<input type="text" id="noofrows" onkeypress="return event.charCode > 47 && event.charCode < 58;" maxlength="2" placeholder="Numbers of rows should be Less than or equal to 50"><br>
      <label>No of Columns</label>&nbsp;<input type="text" id="noofcolumns" onkeypress="return event.charCode > 47 && event.charCode < 58;" maxlength="2" placeholder="Numbers of columns should be Less than or equal to 20"><br>
          
      </div>
      <div class="modal-footer">
        <button type="button" name="submit" value="Approved" 
                  class="btn btn-primary" onclick="setspantable()">Add Table</button>
        </button>
      </div>
    </div>
  </div>
</div>




<!-- table delete modal -->

<button type="button" id="deltablemodal"  data-toggle="modal" data-target="#tablerowcolumndel" hidden></button>
<div class="modal" tabindex="-1" id="tablerowcolumndel" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title" id="exampleModalLabel"><b> Select Options to Delete</b></h4>
      <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" id="closedelmodal">
        <!-- <span aria-hidden="true">&times;</span> -->Close
    </button>
      <!-- <button type="button" class="btn btn-light  btn-sm" id="closedelmodal" data-dismiss="modal">&times;</button> -->
      
    </div>
      <div class="modal-body">
        <input type="radio" id="table_checked" name="deletion_type" value="table" onclick="fun_set_del_table('table')" checked>
        <label>Delete Table</label><br>
        <input type="radio" name="deletion_type" value="row" onclick="fun_set_del_table('row')">
        <label>delete Row</label>&nbsp;<input class="form-control" readonly type="text" id="noofrowsdel" onkeypress="return event.charCode > 47 && event.charCode < 58;" placeholder="Enter Row No to Delete"><br>
        <input type="radio"  name="deletion_type" value="column" onclick="fun_set_del_table('column')">
        <label>Delete column</label>&nbsp;<input class="form-control" readonly type="text" id="noofcoldel" onkeypress="return event.charCode > 47 && event.charCode < 58;" placeholder="Enter Column No to Delete">


      </div>
      <div class="modal-footer">
        <button type="button" name="submit" value="delete" 
                  class="btn btn-primary" onclick="delete_table()">Delete</button>
        </button>
      </div>
    </div>
  </div>
</div>


<!-- table copy officer -->

<button type="button" id="openofficeremodal"  data-toggle="modal" data-target="#openofficeremodal_get" hidden></button>
<div class="modal" tabindex="-1" id="openofficeremodal_get" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title" id="exampleModalLabel"><b> Select Options to Copy From</b></h4>
      <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" id="closeofficermodal">
        <!-- <span aria-hidden="true">&times;</span> -->Close
    </button>
      <!-- <button type="button" class="btn btn-light  btn-sm" id="closeofficermodal" data-dismiss="modal">&times;</button> -->
      
    </div>
      <div class="modal-body">
        <table id="add_officer_tbl" style="width: 100%;">
          <tbody></tbody>
        </table>

      </div>
      <div class="modal-footer">
        <button type="button" name="submit" value="Copy_officer" 
                  class="btn btn-primary" onclick="Copy_marked_officer()">Copy</button>
        </button>
      </div>
    </div>
  </div>
</div>

        <!-- Modal for mark officers -->
        <button type="button" id="openModalOpenWrap" class="btn btn-secondary btn-sm" data-toggle="modal" data-target="#markofc" hidden>Reset</button>

        <div class="modal" id="markofc" tabindex="-1" role="dialog" aria-labelledby="markofcModallabel" aria-hidden="true" >
          <div class="modal-dialog-marks" role="document">
              <div class="modal-content-marks">
                  <div class="modal-header-marks">
                      <h3 class="report_heading" id="markofcModalLabel">Add Instructions</h3>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
    
                  <div class="modal-body" style="overflow-y:scroll; width: 100%; height: 100%;">
                    <div id="tasks m-0" width="100%">
                      <table id="mytable1" class="table table-striped table-bordered table-data" width="100%">
                          <thead>
                              <tr align="center">
                                <th style="display: none;">ID</th>
                                  <th style="width: 5%;">Sr. No</th>
                                  <th style="width: 45%;">Selected Officer</th>
                                  <th style="width: 30%;">Type</th>
                                  <th style="width: 15%;" hidden>Target Date (Optional)</th>
                                  <th style="width: 5%;" hidden>On Priority (Optional)</th>
                                 
                              </tr>
                          </thead>
                          <tbody>
                          </tbody>
                      </table>
                      <div class="row" style="width: 100%;">
                          <div class="autocomplete1" id="toHideAct" style="width: 100%;">
                            <table style="text-align: center; width: 100%;">
                              <tr>
                                <th style="width: 15%;"><label for="datepker" hidden class="lbl-caption">Target Date (Optional)</label></th>
                                <th style="width: 55%;"><input type="text" hidden class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 60%;background-color:white;" id='target_date_inpt' readonly></th>
                                <th style="width: 15%;"><label for="priority" hidden class="lbl-caption">On Priority (Optional)</label></th>
                                <th style="width: 15%; text-align: left;"><input hidden type="checkbox" value="1" autocomplete="off" id='checkbox_priority_inpt'></th>
                              </tr>
                            </table> 
                         </div>
                      </div>
                      
                  </div>
                      
                  </div>
                  <div class="modal-footer-marks">
                      <div class="btn-toolbar" role="toolbar" >
                          <div class="btn-group mr-2" role="group" >
                            <button type="button" class="btn btn-success" name="saveinfo" id="saveinfo"  onclick="save_info(this)" data-dismiss="modal">Save</button>&nbsp;
                            <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" id="closeforward" >Close</button>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>



      <!-- preview modal  -->

      <button type="button" id="viewmodalbtn" name="viewmodalbtn" value="viewmodalbtn"  hidden data-toggle="modal" data-target="#viewmodal" ></button> 
      <div class="modal" tabindex="-1" id="viewmodal" role="dialog" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog-modal-xl" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="report_heading" id="exampleModalLabel">Preview of MOM</h3>
            <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" id="previewClose">
          Close
            </button>      
          </div>
          <div id="printable">
            <div class="modal-body">

              <centre><h4 style="text-align: center;"><label id="head3"></label></h4></centre> <br>
              <h5 style="text-align: left;">Member(s) Present</h5>
              <h5 style="text-align: left;">Ms./Mr.</h5>
              <label id="acco"></label>
               
            
              <table border="1" id="table2" class="table table-striped table-bordered table-data" style="width:100%" >
        
                <thead >
                  <tr style="margin-left: 5em;">  
                    <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 10%;">S.NO.</th>
                    <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 60%;"> MINUTES OF MEETING</th>
                    <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 30%;"> DEALT BY</th>
                    
                   
                  </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <br>
            <div class="head8d">
              
              <h5 align="left">Note No: <label> (Year/Designation/Count) </label></h5>
              <h5 align="left">Dated: <label id="head5dated"></label></h5> 
              
            </div>
            <br>
                <div class="head8">
                  <h5 align="right"></h5>
                  <h5 align="right"><label id="head6"> </label></h5>
                  <h5 align="right"><label id="head5"></label></h5> 
                  <h5 align="right"><label id="head4"></label></h5>
                </div>
                <br>
                <h5>Copy To:</h5>
                <label id="insp_desig" name="copy to:"></label> 
            </div>
            <div id="imgViewShow">
            </div>
          </div>
            <div class="modal-footer">
              <div class="btn-toolbar" role="toolbar" style="margin-top:30px;">
                <div class="btn-group mr-2" role="group" >
                  <button type="button" class="btn btn-info" onclick="windowPrint()">Print/Save as PDF</button>&nbsp;
                  <button type="button" id="submit21" class="btn btn-save btn-sm" onclick="clickSubmit2();" {% if request.session.userrole == 'guest' %} disabled {% endif %}>Submit</button> 
                </div>
            </div>
            </div>
          </div>
        </div>
      </div>
      

      <!-- modal -->

<script>
  $("#rly_1").select2();
  $("#div_1").select2();
  $("#dept_1").select2();

  
</script>

<script>
      $("#type").select2(
        {
            tags: true,
    tokenSeparators: [','],
    maximumInputLength: 10
        }
    );
    $(function () {
        
        $('#mdate').daterangepicker
            ({
                autoclose: true,
                // clearBtn: true,
                singleDatePicker: true,
                showDropdowns: true,
                // format: 'dd/mm/yyyy',
                minDate: '0' ,
                autodateOnStart: false,
                singleClasses: "",
                maxDate: new Date(),
                "drops": "down",
                "autoApply": true,
                locale: {
                    format: 'DD/MM/YYYY',
                }
            },)
    });

    $("#officer").select2({
        tags: true,
    tokenSeparators: [','],
    maximumInputLength: 15
    });
</script>
<!-- add new globals -->
<script>

  var para_count = -1;
  var para_array = [], para_array_marked = [];
  var full_array = [];
  var del_array = [];
  var no_of_row = 0;
  var copy_offier_id,set_offier_id='';

</script>
<script>
    var hli = 0
    var sli = []
    var ssli = []
  </script>

<script>
set_option_val = [];
function set_option_value(id)
  {
    let tableid = document.getElementById('addworkmech');
    let id1 = id.substring(11,id.length),set_option;
    set_option = set_option_val[parseInt(id1)-1]
    if(set_option == 0)
    {
      set_option = 1;
      $('#'+id).empty();
      let row = '';
      row += `<option value="" selected disabled hidden>Select refrence number</option>`;
      for(let i =0; i<tableid.rows.length;i++)
      {
        if(((tableid.rows[i].cells[1].innerHTML).split('.')).length == 1)
          row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> ${tableid.rows[i].cells[1].innerHTML}</option>`;
        else if(((tableid.rows[i].cells[1].innerHTML).split('.')).length == 2)
          row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
        else 
            row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;&nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
      }
      $('#'+id).append(row);
    }
    set_option_val[parseInt(id1)-1] = set_option;
  }

</script>

<script>
    
    var globallistgm='';
    var globallistbm='';
    var globallistbo='';
    var globallistpanel='';
    var globallistdrm='';
    var globallistphod='';
    
    function auto(inp, arr) {
      var currentFocus;
      inp.addEventListener("input", function(e) {
          var a, b, i, val = this.value;
          closeAllLists();
          if (!val) { return false;}
          currentFocus = -1;
          a = document.createElement("DIV");
          a.setAttribute("id", this.id + "autocomplete-list");
          a.setAttribute("class", "autocomplete-items");
        
          this.parentNode.appendChild(a);
       
          for (i = 0; i < arr.length; i++) {
    
            if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
              
              b = document.createElement("DIV");
           
              b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
              b.innerHTML += arr[i].substr(val.length);
            
              b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
           
                  b.addEventListener("click", function(e) {
            
                  inp.value = this.getElementsByTagName("input")[0].value;
                  
                  closeAllLists();
                  
              });
              a.appendChild(b);
            }
          }
      });
    
      inp.addEventListener("keydown", function(e) {
          var x = document.getElementById(this.id + "autocomplete-list");
          if (x) x = x.getElementsByTagName("div");
          if (e.keyCode == 40) {
            
            currentFocus++;
            
            addActive(x);
          } else if (e.keyCode == 38) { 
          
            currentFocus--;
           
            addActive(x);
          } else if (e.keyCode == 13) {
         
            e.preventDefault();
            if (currentFocus > -1) {
            
              if (x) x[currentFocus].click();
            }
          }
      });
      function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
      
        x[currentFocus].classList.add("autocomplete-active");
      }
      function removeActive(x) {
       
        for (var i = 0; i < x.length; i++) {
          x[i].classList.remove("autocomplete-active");
        }
      }
      function closeAllLists(elmnt) {
       
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
          if (elmnt != x[i] && elmnt != inp) {
          x[i].parentNode.removeChild(x[i]);
        }
      }
    }
    
    document.addEventListener("click", function (e) {
        closeAllLists(e.target);
    });
    }
    
    
</script>
          
<script>
    function onlyUnique(value, index, array) {
      return array.indexOf(value) === index;
    }
    var globalarrid=[], main=[];
    function remove_save_marked_officers()
    {
      if(globalarrid.length==0)
      {
        alert('Nothing to Remove');
        return false;
      }
      globalarrid.pop();
      main.pop();
    
      document.getElementById('alltext').value=globalarrid;
        
    }
    function add_save_marked_officers(){
      var emp_no = ""
      var emp_no1 = ""
      var table = $('#text').DataTable();
      table.destroy();
      table = $('#text1').DataTable();
      table.destroy();
      var table = $('#text').DataTable();
      table.destroy();
      table = $('#textdesigselect').DataTable();
      table.destroy();
    
      
      let lst1='no';
      let lst2='no';
      $("input[type='checkbox'][name='chktext']:not(:checked)").each(function (){
        lst1='yes';
      });
      $("input[type='checkbox'][name='chktext1']:not(:checked)").each(function (){
        lst2='yes';
      });
      var rly_1=$('#rly_1').val();
      var div_1=$('#div_1').val();
      if(globallistgm!='' && lst1 == 'yes')
      { 
        globallistgm='';
      }
      if(globallistbm!='' && lst1 == 'yes')
      { 
        globallistbm='';
      }
      if(globallistphod!='' && lst1 == 'no')
      { 
          let x='';
          if(rly_1 == '')
            globallistphod=globallistphod;
            else{
          for(ii=0;ii<rly_1.length;ii++)
          {
            x=x+globallistphod+'/'+rly_1[ii]+', ';
          }
          globallistphod=x;}
      }
      else if(globallistphod!='' && lst1 == 'yes')
      { 
        globallistphod='';
      }
      if(globallistdrm!='' && lst2 == 'no')
      { let x='';
          if(rly_1 == '')
            globallistdrm=globallistdrm;
          else{
            for(ii=0;ii<rly_1.length;ii++)
            {
              x=x+globallistdrm+'/'+rly_1[ii]+', ';
            }
    
            globallistdrm=x;}
      }
      else if(globallistdrm!='' && lst2 == 'yes')
      { 
        globallistdrm='';
      }
      let chkdes=0,arrdemp=[],arrsemp=[];
      let g=0,d=0,p=0,b=0,chgdesig ='Y';
      
      $('.messageCheckbox:checkbox:checked').each(function(i){
        //val[i] = $(this).val();
        let oneOffic= $(this).val();
        let id = oneOffic.split(',')[0]
        let desig = oneOffic.split(',')[1]
        
        
        chkdes=0;
        if(desig.startsWith("DRM/") && chgdesig == 'Y')
        {
          chgdesig = 'N';
          if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }
        }
        if(globallistgm!='' )
        {
              $("input[type='checkbox'][name='chktext']:checked").each(function (){
                    if(desig == $(this).val().split(',')[1])
                    chkdes=1;
              });
              if(g==0)
              { 
                g=1;
                if(emp_no1!="")
                  emp_no1+=',';
              emp_no1 +=globallistgm;
    
              if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }
                      
            }
        }
        else if(globallistbm!=''  )
        {
                $("input[type='checkbox'][name='chktext']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                      chkdes=1;
                });
                if(g==0){ g=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistbm;
                if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
        else if(globallistphod!='' )
        {
          $("input[type='checkbox'][name='chktext']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                      chkdes=1;
                });
                if(p==0){ p=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistphod;
                if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
     
        if(globallistdrm!=''  && desig.startsWith("DRM/"))
        {
          $("input[type='checkbox'][name='chktext1']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                        chkdes=1;
                });
                if(d==0){ d=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistdrm;
               
                    if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
        if(chkdes == 0)
        {
          if(arrsemp.length != 0)
          {
            arrdemp.push(arrsemp);
          }
          arrsemp=[]
          if(emp_no1!="")
                    emp_no1+=',';
          emp_no1 +=desig;
         
          if(emp_no!="")
              emp_no+=',';
          emp_no +=id;
          arrsemp.push(id);
          
        }
        else
        {
          if(emp_no!="")
              emp_no+=',';
          emp_no +=id;
          arrsemp.push(id);
          
        }
        
      });
      arrdemp.push(arrsemp);
      if(emp_no == '')
      {
        alert('Select Checkbox To add');
        $('#text').DataTable();
        $('#text1').DataTable();
        $('#textdesigselect').DataTable();
        return false;
      }
      
        let chkemp_no1=emp_no1.split(',');
        let chkemp_no=emp_no.split(',');
    
        if(document.getElementById('alltext').value!='')
            globalarrid=(document.getElementById('alltext').value).split(',');
        // for(let ij=0;ij<chkemp_no1.length;ij++)
        // {
        //     if(globalarrid.includes(String(chkemp_no1[ij])))
        //     {
        //       alert(chkemp_no1[ij]+' is already previously added ..');
        //     }
        //     else
        //     {
        //       main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
        //       globalarrid.push(chkemp_no1[ij]);
        //     }
        // }
        // document.getElementById('alltext').value=globalarrid;
        

        
    //////////////////  changed
    let prevpost='',prevchk=0;

for(let ij=0;ij<chkemp_no1.length;ij++)
{
  //alert(chkemp_no1[ij]);
    if(globalarrid.includes(String(chkemp_no1[ij])))
    {
      if (prevpost!='')
        prevpost=prevpost+', ';
      prevpost=prevpost+chkemp_no1[ij];
      prevchk=1;
      //alert(chkemp_no1[ij]+' is already previously added ..');
    }
    
    else if(chkemp_no1[ij] == "All GM's/ZR")
    {
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm].substring(0,3)=='GM/')
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }

      }
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);

    }
    else if(chkemp_no1[ij].substring(0,3)=='GM/')
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All GM's/ZR")
        {
          chkcgm=1
        }

      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
          prevpost=prevpost+', ';
        prevpost=prevpost+chkemp_no1[ij];
        prevchk=1;
      }

    }

    else if(chkemp_no1[ij] == "All DRM's")
    {
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm].substring(0,4)=='DRM/')
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }
        else if(globalarrid[cgm].substring(0,10)=="All DRM's/")
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }

      }
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);

    }

    else if(chkemp_no1[ij].substring(0,4)=='DRM/')
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All DRM's")
        {
          chkcgm=1
        }
        else if(globalarrid[cgm].substring(0,10)=="All DRM's/")
        {
          for(drmi=0;drmi<main[cgm]['designation_code'].length;drmi++)
          {
            if(chkemp_no.includes(main[cgm]['designation_code'][drmi]))
            {
              chkcgm=1;
              break;
            }

          }
        }
      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
            prevpost=prevpost+', ';
          prevpost=prevpost+chkemp_no1[ij];
          prevchk=1;
      }
    }
    
    else if(chkemp_no1[ij].substring(0,10)=="All DRM's/")
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All DRM's")
        {
          chkcgm=1
        }
      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
            prevpost=prevpost+', ';
          prevpost=prevpost+chkemp_no1[ij];
          prevchk=1;
      }
    }
    else
    {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
    }
}



if(prevchk==1)
{
  alert('Following Post Are already Present '+prevpost);
}
for(let remi=globalarrid.length-1;remi>=0;remi--)
{
  if(globalarrid[remi].length==0 || globalarrid[remi]==' ')
        {
          globalarrid.splice(remi,1);
          main.splice(remi,1);
        }

}
//////////////////  changed
document.getElementById('alltext').value=globalarrid;


        
    
      ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            } 
    
      ele=document.getElementsByName('chk');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }
    
      ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            } 
  //////////////////  changed
            ele=document.getElementsByName('chkdesig');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        }
//////////////////  changed


      globallistdrm='';
      globallistgm='';
      globallistphod='';
      globallistbm='';
       globallistbo='';
     globallistpanel='';
      document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
      document.getElementById('allbo').checked=false;
      document.getElementById('allpanel').checked=false;
    
      document.getElementById('rly_1').value='';
      document.getElementById('div_1').value='';
      document.getElementById('dept_1').value='';
      document.getElementById('desig').value='';
        $('#text').DataTable();
        $('#text1').DataTable();
        $('#textdesigselect').DataTable();
      
    }

    function save_marked_officers(){
     let emp_no='',emp_no1='';
      for(i=0;i<main.length;i++)
      {
        if(emp_no1!="")
            emp_no1+=',';
          emp_no1+=main[i].desig;
        
        
        if(emp_no!="")
            emp_no+=',';
          emp_no+=main[i].designation_code;
      }
      let emono34 = emp_no.split(',');
     
      emp_no = '';
      for(let i =0;i<emono34.length;i++)
      {
        
            if(emono34[i] != 'undefined')
            {
              if(emp_no!="")
                  emp_no+=',';
              emp_no+=emono34[i];
            }

      }
    
      let mark_off = $('#mark_officersss').val();
    
      if(mark_off=='Copy To'){
        // alert(main)    
        document.getElementById('copyto').value=emp_no1;
        var myInput = document.getElementById('copyto');
            myInput.setAttribute('custom-offic', emp_no);
        let Y = document.getElementById('copyto').scrollHeight
        document.getElementById('copyto').style.height =(10+Y)+"px";
    
    
        var myInput = document.getElementById('copyto');
            myInput.setAttribute('custom-key', main);

      let cop = $('#copyto').attr('custom-offic')
      let new_cop = cop.split(',')
      $('#copy_desgn').selectpicker('val', new_cop)
    
      }
      else{
        markofficer='markeofficer'+ mark_off;
        
        document.getElementById(markofficer).value=emp_no1;
        var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-offic', emp_no);
    
            let x = document.getElementById(markofficer).scrollHeight;
            document.getElementById(markofficer).style.height =(10+x)+"px";
    
    
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-key', JSON.stringify(main));


                let test=mark_off.split('.');
                let testid='';
                for(let ii=0;ii<test.length;ii++)
                {
                  if(ii==0)
                    testid=String(test[ii]);
                  else
                    testid=testid+'a'+String(test[ii]);
                }
                id='btndel'+testid;
               
              document.getElementById(id).click();
              emp_no=emp_no.split(',');
              emp_no11=emp_no1.split(',');



              $(`#desgn${testid}`).selectpicker("destroy");
                for(let ij =0;ij<emp_no.length;ij++)
                {
                  if($(`#desgn${testid} option[value='${emp_no[ij]}']`).length <= 0)
                  {
                    
                    tkn = emp_no[ij].replace('/',' ');
                   if(emp_no11[ij] != undefined)
                    $(`#desgn${testid}`).append(`<option value="${emp_no[ij]}" data-tokens="${tkn}">${emp_no11[ij]}</option>`);
                    
                  }
                }
                var officer='officer'+testid;
                $(`.desgn${testid}`).selectpicker();	
                  $(`.desgn${testid}`).removeClass("dropdown");	
                  var button = $(`#divdesgn${testid} .bs-actionsbox .btn-group`);	
                  button.append(`<button type="button" id="bdesgn${testid}" class="btn btn-default btn-light" onclick="getOption('desgn${testid}')" hidden>Save</button>`)	
                  button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${testid}');">Go/Close</button>`)	
                  button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);	
                  button.append(`<button type="button" id="btndel${testid}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)	
                   
                  

                  $(`#desgn${testid}`).on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue){	
                    let his_id= this.id;
                      getOption(`${his_id}`);
                      });	
                  function removePopupForBtn(el){	
                      let idpattern = '#'+el +' '+'.bootstrap-select'	
                      $(idpattern).removeClass('show')	
                    };
              
             $(`.desgn${testid}`).selectpicker('val', emp_no);
            
      }
      $('#close1').click();
    }
          

</script>
   
<script>
    
        function select1(id){  
          var table = $('#text1').DataTable();
          table.destroy();
          if(id.checked)
          {
            var ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=true;  
            }  
            var table = $('#text1').DataTable();
          }
          else
          {
            var ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            var table = $('#text1').DataTable();
          }
        }  
        function select21(id){  
          var table = $('#text').DataTable();
          table.destroy();
          if(id.checked)
          {
            var ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=true;  
            }  
            var table = $('#text').DataTable();
          }
          else
          {
            var ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            var table = $('#text').DataTable();
          }
        }  
       
      
</script>
        
    <script>
    var globaldiv='';
    function setvalueIN(){
    
      $("#alltext").css({"height": "50px",});
      main=[];
      globalarrid=[];
    
      let zone = $('#zone').val();
      $('#rly_1').val(zone);
    
    var arrayArea = $('#department').val();
    $('#dept_1').select2({}).select2('val', arrayArea);
    $('#desig').val('');
    $('#desig').select2().trigger('change');
      if($('#division').val()!='')
        globaldiv=$('#division').val();
      $('#rly_1').select2().trigger('change');
    
    
      let mark_off = $('#mark_officersss').val();
      
    if(mark_off=='Copy To'){
        
        var myInput = document.getElementById('copyto');
        var officer_val11=myInput.getAttribute('custom-key');
        document.getElementById('alltext').value=document.getElementById('copyto').value;
    }
    else{
      
          markofficer='markeofficer'+ mark_off
          var myInput = document.getElementById(markofficer);
          var officer_val11=myInput.getAttribute('custom-key');
          document.getElementById('alltext').value=document.getElementById(markofficer).value;   
    }
    if((document.getElementById('alltext').value).length>0)
    {
      globalarrid=String(document.getElementById('alltext').value).split(',');
      main=JSON.parse(officer_val11);
    }
    
    
      
    }
    
    function setCopyValue()
    {
      $("#alltext").css({"height": "50px",});

      $('#mark_officersss').val('Copy To')
    
    }
    
    
    function hidetable(e){
    
      $('#text').show(); $('#text1').hide(); $('#table3').hide(); $('#table4').hide(); $('#table5').hide();
      $('#mark_officersss').val((e.id).substr(7));
    
    }
    
    var globaldesigid=[];
    
    
    function selordesel(id)
    {
          var table = $('#textdesig').DataTable();
          table.destroy();
          var table1 = $('#textdesigselect').DataTable();
          table1.destroy();
         
          if(id.checked)
          {
            globaldesigid=[];
            $('#textdesigselect tbody').empty();
            var row='';
            var ele=document.getElementsByName('chkdesig');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox') 
                   {
                    ele[i].checked=true; 
                    let id=ele[i].id;
                    val=ele[i].value;
                    val=val.split(',')
                    globaldesigid.push(id.substring(2,id.length));
                    row += "<tr id='trid"+id+"'>";  
                    row+=  '<td hidden><input checked type="checkbox" id="'+val[0]+'" class="messageCheckbox" value="'+(val[0]+','+val[1])+'" name="chk" ></td>';
                    row += '<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="'+val[0]+'" hidden>'+val[0]+'</td>';
                    row += '</tr>';
                
                   } 
            }  
            $('#textdesigselect tbody').append(row);
            var table1 = $('#textdesigselect').DataTable();
            var table = $('#textdesig').DataTable();
          }
          else 
          {
            var ele=document.getElementsByName('chkdesig');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            globaldesigid=[];
            $('#textdesigselect tbody').empty();
            var table1 = $('#textdesigselect').DataTable();
            var table = $('#textdesig').DataTable();
          }       
    }
    
    function selectdesig(val)
    {
      let id=val.id;
      val=val.value;
      
      var table = $('#textdesigselect').DataTable();
      table.destroy();
      val=val.split(',');
      var row='';
      if(document.getElementById(id).checked==true)
          {
            globaldesigid.push(id.substring(2,id.length));
              row += "<tr id='trid"+id+"'>";  
                  row+=  '<td hidden><input checked type="checkbox" id="'+val[0]+'" class="messageCheckbox" value="'+(val[0]+','+val[1])+'" name="chk" ></td>';
                row += '<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="'+(val[2]+','+val[1])+'" hidden>'+(val[2]+','+val[1])+'</td>';
                row += '</tr>';
                $('#textdesigselect tbody').append(row);
                var table = $('#textdesigselect').DataTable();
          }
          else 
          {
            let id1=id.substring(2,id.length);
            id='trid'+id;
    
                index = globaldesigid.indexOf(id1);
                if (index > -1) { 
                  globaldesigid.splice(index, 1);
                }
    
            var row = document.getElementById(id);
            row.parentNode.removeChild(row);
            var table = $('#textdesigselect').DataTable();
          }       
    }
    
    function getdesigdata()
    {
      let desig=$('#desig').val();
      $('#showdiv1').hide();
      $('#showdiv2').show();
      $('#textdesigselect').DataTable();
      var table = $('#textdesig').DataTable();
        table.destroy();
    
      data={
              'desig':desig,
          }
                $.ajax({
                    type: "GET",
                    url: "{% url 'designation_wise' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(mydata) {
                       let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="selordesel(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        
                        for (let i = 0; i < mydata.length; i++) {
                         
       
    
                          if(globaldesigid.includes(mydata[i]['designation']))
                           { 
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="ab${mydata[i]['designation_code']}"  value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chkdesig" onclick="selectdesig(this)"></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden >
                                ${mydata[i]['desig_longdesc']}</td>`;
                            
                              row += `</tr>`;
                           }
                           else
                           {
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox"  id="ab${mydata[i]['designation_code']}"  value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chkdesig" onclick="selectdesig(this)"></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden >
                                ${mydata[i]['desig_longdesc']}</td>`;
                            
                              row += `</tr>`;
                           }
    
                        }
                        
                        $('#textdesig thead').remove();
                        $('#textdesig tr').remove();
                        $('#textdesig').append(head);
                        $('#textdesig tbody').append(row);
                        
                        $('#textdesig').DataTable();
                          
           
                    },
               
                });
    
    }
    
    </script>
       
    <script>
    
    function getdivdeptdata()
    {
      $('#showdiv1').show();
      $('#showdiv2').hide();
      getdivwisedata();
      fungetzonedata();
    }
    
    function getdivwisedata()
    {
      $('#showdiv1').show();
      $('#showdiv2').hide();
      var table = $('#text1').DataTable();
        table.destroy();
        $('#text1').hide();
        var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1,
              'dept_1':dept_1,
              'div_1':div_1,
              
            }
                $.ajax({
                    type: "GET",
                    url: "{% url 'division_wise1' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                      mydata=response.divwise;
                       let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select1(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                            row += "<tr>";  
                              row+=  `<td><input type="checkbox" id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext1" ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                            
                            row += `</tr>`;
                        }
                        $('#text1 thead').remove();
                        $('#text1 tr').remove();
                        $('#text1').append(head);
                        $('#text1 tbody').append(row);
                        $('#text1').show();
                        $('#text1').DataTable();
                          
           
                    },
                });
      document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
      document.getElementById('allbo').checked=false;
      document.getElementById('allpanel').checked=false;
               
    }
    
        $('#allgm').click(function() {
          document.getElementById('allboard').checked=false;
          document.getElementById('allphod').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          data={
              'rly_1':rly_1,
              
          } 
          $('#showdiv1').show();
          $('#showdiv2').hide();
          globallistgm='';
           if(this.checked){
            globallistgm= "All GM's/ZR";
              $.ajax({
                    type: "GET",
                    url: "{% url 'gm_list_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allgm;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistgm='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
          });   
    
          
        $('#alldrm').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          var table = $('#text1').DataTable();
          table.destroy();
            var div_1=$('#rly_1').val();
              data={
                  'div_1':div_1,
                  
              }
              globallistdrm='';   
           if(this.checked){
            globallistdrm="All DRM's"
                $.ajax({
                    type: "GET",
                    url: "{% url 'drm_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                      mydata=response.alldrm;
                      let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select1(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext1"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text1 thead').remove();
                        $('#text1 tr').remove();
                        $('#text1').append(head);
                        $('#text1 tbody').append(row);
                        $('#text1').show();
                        $('#text1').DataTable();       
                    },
      
                });
    
                }
    
                else{
                  globallistdrm=''; 
                  var ele=document.getElementsByName('chktext1');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text1').DataTable();
                }
          });   
    
     
        $('#allphod').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allboard').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          data={
              'rly_1':rly_1,
          }
          globallistphod='';
           if(this.checked){
            globallistphod="All PHOD's";
              $.ajax({
                    type: "GET",
                    url: "{% url 'phod_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allphod;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistphod='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
        }); 
       
        $('#allboard').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allphod').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          data={
              'rly_1':rly_1,
              
          }
          globallistbm=''; 
          
           if(this.checked){
            
            globallistbm="All Board Member's"; 
              $.ajax({
                    type: "GET",
                    url: "{% url 'board_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allboard;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Board Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistbm='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
    }); 

    $('#allbo').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allphod').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          data={
              'rly_1':rly_1, 
              'div_1':div_1, 
          }
          globallistbo=''; 
          
           if(this.checked){
            
            globallistbo="All Branch Officers"; 
              $.ajax({
                    type: "GET",
                    url: "{% url 'branch_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allbo;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Branch Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistbm='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
    }); 
    
    $('#allpanel').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allphod').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          data={
              'rly_1':rly_1, 
              'div_1':div_1, 
          }
          globallistpanel=''; 
          
           if(this.checked){
            
            globallistpanel="All Panel Officers"; 
              $.ajax({
                    type: "GET",
                    url: "{% url 'panel_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allpanel;
                        
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Panel Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistpanel='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
    }); 
    
     function fungetzonedata()
     {
      $('#showdiv1').show();
      $('#showdiv2').hide();
          var table = $('#text').DataTable();
          table.destroy();
          $('#text').hide();
          var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1,
              'dept_1':dept_1,
              'div_1':div_1,
              
            }
                $.ajax({
                    type: "GET",
                    url: "{% url 'headqwise' %}",
                    data: data,
                    success: function(response) {
                      mydata=response.hqwise;
                      let row = "";
                      let head = `<tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr>`;
                        
                       
                          for (let i = 0; i < mydata.length; i++) {
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox" id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                          }
                        
                        $('#text thead').empty();
                        $('#text tbody').empty();
                        //$('#text tr').remove();
                        $('#text thead').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();      
                       
                    },
                    
                   
                });
                document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
      document.getElementById('allbo').checked=false;
      document.getElementById('allpanel').checked=false;
     }
            
    
      $('#rly_1').change(function() {
        var rly_1=$('#rly_1').val();
        if(rly_1 == []) 
          return false;
        let divdata=$('#div_1').val();
       
        // elif(dept_1 == [] && rly_1 == [])
        //   return false;
        // elif(dept_1 != [])
        //   return false;
        data={
            'rly_1':rly_1,
        }
      
        $.ajax({
          type : 'GET',
          url : "{% url 'division_by_rly1' %}",
          dataType : 'json',
          data : data,
    
          success : function(response){
            division=response.division;
            $('#div_1').empty();
            
              for (let i = 0; i < division.length; i++) {
                if(globaldiv.length!=0)
                {
                  if(globaldiv == division[i])
                    { 
                      $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
                    }
                  else
                    $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
                }
                else
                {
                  if(divdata.includes(division[i]))
                    { 
                      $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
                    }
                  else
                    $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
                }
    
              }
              globaldiv=[];
              fungetzonedata();
              $('#div_1').select2().trigger('change');          
          }
    
          
        })
              
      })  
    
    
    
    </script>


    <script>

    function changeColorBtn(el){
      let val = el.id
      if (val == 'addheading'){
        document.getElementById('addheading').style.backgroundColor = "#3333ff";
        document.getElementById('addmech').style.backgroundColor = "#337AB7";
        document.getElementById('addSubmech').style.backgroundColor = "#337AB7";
      }
      else if(val == 'addmech'){
        document.getElementById('addheading').style.backgroundColor = "#337AB7";
        document.getElementById('addmech').style.backgroundColor = "#3333ff";
        document.getElementById('addSubmech').style.backgroundColor = "#337AB7";
      }
      else if(val == 'addSubmech'){
        document.getElementById('addheading').style.backgroundColor = "#337AB7";
        document.getElementById('addmech').style.backgroundColor = "#337AB7";
        document.getElementById('addSubmech').style.backgroundColor = "#3333ff";
      }
    
    }
    
    
    </script>
    
<script>
$(function() {

$('input[name="daterange1"]').daterangepicker({
    autoUpdateInput: false,
    autoApply: true,
    maxDate: new Date(),
    "opens": "left",
    locale: {
        cancelLabel: 'Clear'
    }
});

$('input[name="daterange1"]').on('apply.daterangepicker', function(ev, picker) {
  $(this).val(picker.startDate.format('DD/MM/YY') + ' to ' + picker.endDate.format('DD/MM/YY'));
  
  if(picker.startDate.format('DD/MM/YY') == picker.endDate.format('DD/MM/YY')){
      $(this).val(picker.startDate.format('DD/MM/YY'))
    }
    else{
      $(this).val(picker.startDate.format('DD/MM/YY') + ' to ' + picker.endDate.format('DD/MM/YY'));
    
    }
  
  $('.applyButtonClasses').click()

  
});

$('input[name="daterange1"]').on('cancel.daterangepicker', function(ev, picker) {
    $(this).val('');
});

});
  
     $("textarea").each(function () {
      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
        }).on("input", function () {
          this.style.height = "auto";
          this.style.height = (this.scrollHeight) + "px";
        });
    </script>

    
<script>
 
  var globalfavlst=[];


  function getOption(e){
      let id=e.substring(5,e.length);
     
      var options = document.getElementById(e).selectedOptions;
      
      var values = Array.from(options).map(({ value }) => value);
      let tooltipid='tooltip'+ id.replaceAll('.','a');
      let markofficer='markeofficer'+ id;

      let lt='desgninp'+id;
      let notexist=[], altext=document.getElementById(lt).value;
      altext=altext.split(',');
      
      var myInput = document.getElementById(markofficer);
      var officer_id=myInput.getAttribute('custom-offic');
     
      if(officer_id.length!=0)
      {
        officer_id=officer_id.split(',');
      }
      else
      {
        officer_id=[];
      }
  
      officer_id=[...new Set(officer_id.concat(values))]
      
      for(let i=0;i<altext.length;i++)
      {
        if(values.includes(String(altext[i])))
        {
          continue;
        }
        else
        {
              var index = officer_id.indexOf(altext[i]);
              if (index !== -1) {
                officer_id.splice(index, 1);
              }
        }
            
      }

      document.getElementById(lt).value=values;
      
      data={
          'officer_id': JSON.stringify(values),
          'csrfmiddlewaretoken': '{{csrf_token}}'
        }
  
        $.ajax({
          type : 'POST',
          url : "{% url 'desig_changecode' %}",
          dataType : 'json',
          data : data,
  
          success : function(response){
            marked_id=JSON.parse(response.marked_id);
            marked_desig=response.marked_desig;
            marked_key=JSON.parse(response.marked_key);
  
            document.getElementById(markofficer).value=marked_desig;
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-offic', marked_id);
         
  
            const tx = document.getElementsByTagName("textarea");
            for (let i = 0; i < tx.length; i++) {
              tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
              tx[i].addEventListener("input", OnInput, false);
            }
  
            function OnInput() {
              this.style.height = 0;
              this.style.height = (this.scrollHeight) + "px";
            }
            $("textarea").trigger("input");
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-key',JSON.stringify(marked_key));

            myInput = document.getElementById(tooltipid);
            
            if(marked_desig.length==0)
            {
              marked_desig='Add From Dropdown'
            }
            myInput.innerHTML=truncateString(marked_desig,10);
            marked_desig=marked_desig.replaceAll(',',', ')
            myInput.title=marked_desig;
            $('#'+tooltipid).tooltip();
          }
        })
      }
  
  

  $('.demo-copy').selectpicker()
      $(".demo-copy").removeClass("dropdown");
      var button = $(`#copy_divdesgn .bs-actionsbox .btn-group`);
      button.append(`<button hidden type="button" class="btn btn-default btn-light" onclick="copyToOption();">Save</button>`)
      button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopup();">Close</button>`)
      button.append(`<button type="button" id="copybtndel" class="actions-btn bs-deselect-all btn btn-default btn-light" onclick="copyTofungettest()" hidden >Remove</button>`)
      button.append(`<button id="copytobtn" class="btn btn-default btn-light" value="Copy To" data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setCopyValue(); setvalueIN()" ><i class="fas fa-search"></i></button>`)
      $(".demo-copy").on("changed.bs.select", function(clickedIndex, isSelected, oldValue) {
      copyToOption();
       
  });

  function removePopup(){
    $('#demo-copy .bootstrap-select').removeClass('show')
  }
  
  
  function copyToOption(){
    
    var options = document.getElementById('copy_desgn').selectedOptions;
    var values = Array.from(options).map(({ value }) => value);
    
    
    let lt='copy_desgninp';
    let notexist=[], altext=document.getElementById(lt).value;
    altext=altext.split(',');

    let markofficer='copyto';
    var myInput = document.getElementById(markofficer);
   
    var officer_id=[];
    officer_id=[...new Set(officer_id.concat(values))]
    
    for(let i=0;i<altext.length;i++)
    {
      if(values.includes(String(altext[i])))
      {
        continue;
      }
      else
      {
            var index = officer_id.indexOf(altext[i]);
            if (index !== -1) {
              officer_id.splice(index, 1);
            }
      }
    }
    document.getElementById(lt).value=values;
    data={
        'officer_id': JSON.stringify(officer_id),
        'csrfmiddlewaretoken': '{{csrf_token}}'
      }

      $.ajax({
        type : 'POST',
        url : "{% url 'desig_changecode' %}",
        dataType : 'json',
        data : data,

        success : function(response){
          marked_id=JSON.parse(response.marked_id);
          marked_desig=response.marked_desig;
          marked_key=JSON.parse(response.marked_key);

          document.getElementById(markofficer).value=marked_desig;
          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-offic', marked_id);
       

          const tx = document.getElementsByTagName("textarea");
          for (let i = 0; i < tx.length; i++) {
            tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
            tx[i].addEventListener("input", OnInput, false);
          }

          function OnInput() {
            this.style.height = 0;
            this.style.height = (this.scrollHeight) + "px";
          }
          $("textarea").trigger("input");

          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-key',JSON.stringify(marked_key));
          
        }
      })



    }

 
    function fungettest(id)
      {
              id='btndel'+String(id).substring(8,(String(id)).length);
              document.getElementById(id).click();
             

      }

function truncateString(str, num) {
  if (str.length > num) {
    return str.slice(0, num) + "...";
  } else {
    return str;
  }
}

</script>
<script>

  $(document).ready(function(){
    $('#submit2').hide()
  })
  
  let timerOn = true;
  function timer(remaining) {
    var m = Math.floor(remaining / 60);
    var s = remaining % 60;
    
    m = m < 10 ? '0' + m : m;
    s = s < 10 ? '0' + s : s;
    document.getElementById('timer').innerHTML = m + ':' + s;
    remaining -= 1;
    
    if(remaining >= 0 && timerOn) {
      setTimeout(function() {
          timer(remaining);
      }, 1000);
      return;
    }
  
    if(!timerOn) {
      
      return;
    }
    
    alert('Timeout for otp');
  }
  


  var digitPeriodRegExp = new RegExp('\\d|\\.');
  // var input1 = document.getElementById('your_otp');
  // var input2 = document.getElementById('input2');
  
  // input1.addEventListener('keydown', function(event) {
  //     if(event.ctrlKey // (A)
  //     || event.altKey // (A)
  //     || typeof event.key !== 'string' // (B)
  //     || event.key.length !== 1) { // (C)
  //         return;
  //     }
  //     if(!digitPeriodRegExp.test(event.key)) {
          
  //         event.preventDefault();
  //     }
  // }, false);
  

  
  </script>




<!-- add new code  -->

<script>

Array.prototype.insert = function ( index, ...items ) {
    this.splice( index, 0, ...items );
};

var dealt = JSON.parse('{{dealt|safe}}')

function addpara(typ_id , tbl_row_count)
{
                    var table = document.getElementById("addworkmech");
                    // var dealt = JSON.parse('{{dealt|safe}}')
                   
                    if(table.rows.length == 0 && typ_id == 'SP' && tbl_row_count === '-2')
                    {
                      alert('Add para first before adding sub Para');
                      return true;
                    }
                    else if(typ_id == 'SSP' && tbl_row_count === '-2')
                    {
                      let index_1 = table.rows.length - 1;
                      if(index_1 <0)
                      {
                        alert('Add para first');
                        return true;
                      }
                      let tp_1 = table.rows[index_1].cells[0].textContent;
                      if(tp_1 == 'P')
                      {
                        alert('Add sub para first before adding sub subPara');
                        return true;
                      }
                    }
                    para_count ++;
                    for(let ok1=0;ok1<set_option_val.length;ok1++)
                            set_option_val[ok1] = 0;
                    $('#submit2').show()
                    
                    if(tbl_row_count == '-2')
                        tbl_row_count = table.rows.length;
                        
                    var row1 = table.insertRow(tbl_row_count);
                    
                    var index = para_array.indexOf(tbl_row_count);
                    if (index == -1) 
                    {
                      para_array.push(para_count);
                    }
                    else
                    {
                      para_array.insert(tbl_row_count, para_count);
                    }
                    var cell0 = row1.insertCell(0);
                    var cell1 = row1.insertCell(1);
                    var cell2 = row1.insertCell(2);
                    var cell3 = row1.insertCell(3);
                    var cell4 = row1.insertCell(4);
                    var cell5 = row1.insertCell(5);
                    var cell6 = row1.insertCell(6);
                    var cell7 = row1.insertCell(7);
                    
                      var row1Count = 1;
                      hli++;
                      sli.push(0)
                      full_array.push(String(para_count))

                      var heading1='heading'+para_count;
                      var descrip='description'+para_count;
                      addid = 'add' + para_count;
                      delid11 = 'del' + para_count;
                      spanid = 'span' +para_count;
                      var officer='officer'+para_count;
                      var markeofficer='markeofficer'+para_count
                      var targetdate='targetdate'+para_count;
                      var divofficer='divofficer'+para_count;
                      var divmarkeofficer='divmarkeofficer'+para_count;
                      var divtargetdate='divtargetdate'+para_count;
                      var divcheckbox='divcheckbox'+para_count;
                      var checkbox='check'+para_count;

                      let delid='del1'+String(para_count);

                      cell0.innerHTML = typ_id;
                      cell0.style.display = 'none';
                      cell1.innerHTML= para_count;
                      cell1.style = "text-align: center; width:5px; font-family:verdana;"
                      if(typ_id != 'SP'){ 
                        cell2innerHTML ='<td><div class="autocomplete1"><textarea maxlength="3000" placeholder="Maximum character limit 3000" id='+heading1+'  autocomplete1=off  style="height:30px;" class="form-control" /></textarea></div>'; 
                          
                          cell2innerHTML +='<button type="button" hidden class="btn btn-outline-success btn-sm" id="'+addid+'" value="'+ para_count+'" onclick="get_table_data(this);" ><i class="fa fa-table " aria-hidden="true" title="Click to Add table"></i></button>'
                          cell2innerHTML +='<button type="button" hidden class="btn btn-outline-danger btn-sm" id="'+delid11+'" value="'+ para_count+'" onclick="remove_table_data(this);"><i class="fa fa-minus " aria-hidden="true" title="Click to modify/alter table"></i></button>'
                          cell2innerHTML +='<span id="'+spanid+'"></span>';

                          cell2innerHTML +='</td>'
                        cell2.innerHTML =cell2innerHTML;
                        $("textarea").each(function () {	
                            this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");	
                              }).on("input", function () {	
                                this.style.height = "auto";	
                                this.style.height = (this.scrollHeight) + "px";	
                              });	
                          }
                      else{
                        cell2innerHTML =`<td>
                          <div class="autocomplete1">
                            <textarea maxlength="3000" placeholder="Maximum character limit 3000" id="${heading1}"  autocomplete1=off  style="height:30px;" class="form-control" /></textarea>
                            <br><textarea maxlength="5000"  placeholder="Add Sub Para Description (Optional).." style="height:5em;" id="${descrip}" class="form-control"/></textarea>
                            </div>`; 
                            cell2innerHTML +='<button type="button" hidden class="btn btn-outline-success btn-sm" id="'+addid+'" value="'+ para_count+'" onclick="get_table_data(this);" ><i class="fa fa-table " aria-hidden="true" title="Click to Add table"></i></button>'
                          cell2innerHTML +='<button type="button" hidden class="btn btn-outline-danger btn-sm" id="'+delid11+'" value="'+ para_count+'" onclick="remove_table_data(this);"><i class="fa fa-minus " aria-hidden="true" title="Click to modify/alter table"></i></button>'
                          cell2innerHTML +='<span id="'+spanid+'"></span>';
                        cell2innerHTML +='</td>'
                        cell2.innerHTML =cell2innerHTML;
                        $("textarea").each(function () {	
                            this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");	
                              }).on("input", function () {	
                                this.style.height = "auto";	
                                this.style.height = (this.scrollHeight) + "px";	
                              });	
                      }
                    if(typ_id != 'SSP')
                    {
                      para_array_marked.push(para_count)

                        data_add = `<td> 	
                          <div id="showhide${para_count}">
                          <div class="mycls" style="display: block;">
                          <div class="multi_select_box" id="divdesgn${para_count}" style="display:inline-block;">	
                  
                            <select id="desgn${para_count}" class="desgn${para_count} demo w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true"  multiple>	
                              `    	
                              for (var i = 0; i < dealt.length; i++) { data_add+= '<option value="' + dealt[i]['designation_code'] + '">' + dealt[i]['designation'] + '</option>' }
                              data_add+= `</select>	
                            <input type="button" id="desgnbtn${para_count}" value="Ok" onclick="getOption('desgn${para_count}')" hidden>	
                            <input type="text" id="desgninp${para_count}" hidden >	
                          
                          </div>&nbsp;	
                          <div class="autocomplete1" id="${divmarkeofficer}" style="display:inline-block;">	
                            &nbsp;	
                            <button hidden type="button" id="cpy${para_count}" value="Copy" hidden onclick="copy_mark_officer(this)" ><i class='fas fa-copy' style='font-size:24px;color:blue;'></i></button>  
                            &nbsp;
                          <a hidden style="display:inline-block;	
                              width:130px;	
                              height:35px;	
                              margin-top:3px;	
                              color: white;	
                              background-color: darkslategray;	
                              padding: 5px 11px;	
                              border-style: 2px solid" id="tooltip${para_count}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title="Add From Dropdown" >Add From D...</a>  	
                          
                              <button type="button" class="btn btn-success btn-sm ml-0 mt-1" title="Click to add instructions" id="instdesgn${para_count}" onclick="open_wrap(this)" ><i class="fa fa-tasks" aria-hidden="true"></i></button>
                              <textarea hidden type="text" placeholder="Add officer" class="form-control" value="" custom-offic="" custom-info="" custom-key="" id='${markeofficer}' class="autocomplete1" readonly></textarea>
                            
                          </td>
                        </div>
                        <div style="display: block;"><textarea  maxlength="500" id="remarks${para_count}"  placeholder="Add Remarks (Maximum Character Limit 500)"  class="form-control mt-1 textareashowhide"/></textarea></div>`	
                        cell3.innerHTML = data_add;	

                  $(`#tooltip${para_count}`).tooltip();	
                  $('.demo').selectpicker();	
                  $(".demo").removeClass("dropdown");	
                  var button = $(`#divdesgn${para_count} .bs-actionsbox .btn-group`);	
                  button.append(`<button type="button" id="bdesgn${para_count}" class="btn btn-default btn-light" onclick="getOption('desgn${para_count}')" hidden>Save</button>`)	
                  button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${para_count}');">Close</button>`)	
                  button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);	
                  button.append(`<button type="button" id="btndel${para_count}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)	
                   
                  $(`#desgn${para_count}`).on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue){	
                    let his_id= this.id;
                      getOption(`${his_id}`);
                      });	
                  function removePopupForBtn(el){	
                      let idpattern = '#'+el +' '+'.bootstrap-select'	
                      $(idpattern).removeClass('show')	
                    };	
                        cell4.innerHTML ='<td><div class="autocomplete1" id="'+divtargetdate+'"><input type="text"  class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;background-color:white;" id='+targetdate+' readonly> </div></td>'; 	
                          
                        cell5.innerHTML ='<td><div class="autocomplete1" id="'+divcheckbox+'"><input type="checkbox" value="1" autocomplete="off" id='+checkbox+' >&nbsp; High </div></td>'; 	

             
                        $(".datepker").datepicker({	
                          showOn: 'focus',	
                          dateFormat: 'dd/mm/y',	
                          showButtonPanel: true,	
                          closeText: 'Clear', 	
                          minDate: 0,	
                          onClose: function () {	
                            var event = arguments.callee.caller.caller.arguments[0];	
                            if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {	
                                $(this).val('');	
                            }	
                          },	
                          onSelect: function(selectedDate) {	
                            
                        }	
                        });	
                          
                        }
                    else{
                      para_array_marked.push(para_count)

                        data_add = `<td> 	
                          <div id="showhide${para_count}">
                          <div class="mycls" style="display: block;">
                          <div class="multi_select_box" id="divdesgn${para_count}" style="display:inline-block;">	
                  
                            <select id="desgn${para_count}" class="desgn${para_count} demo w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true"  multiple>	
                              `    	
                              for (var i = 0; i < dealt.length; i++) { data_add+= '<option value="' + dealt[i]['designation_code'] + '">' + dealt[i]['designation'] + '</option>' }
                              data_add+= `</select>	
                            <input type="button" id="desgnbtn${para_count}" value="Ok" onclick="getOption('desgn${para_count}')" hidden>	
                            <input type="text" id="desgninp${para_count}" hidden >	
                          
                          </div>&nbsp;	
                          <div class="autocomplete1" id="${divmarkeofficer}" style="display:inline-block;">	
                            &nbsp;	
                            <button hidden type="button" id="cpy${para_count}" value="Copy" onclick="copy_mark_officer(this)" ><i class='fas fa-copy' style='font-size:24px;color:blue;'></i></button>  
                            &nbsp;
                          <a hidden style="display:inline-block;	
                              width:130px;	
                              height:35px;	
                              margin-top:3px;	
                              color: white;	
                              background-color: darkslategray;	
                              padding: 5px 11px;	
                              border-style: 2px solid" id="tooltip${para_count}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title="Add From Dropdown" >Add From D...</a>  	
                              <button type="button" class="btn btn-success btn-sm ml-0 mt-1" title="Click to add instructions" id="instdesgn${para_count}" onclick="open_wrap(this)" ><i class="fa fa-tasks" aria-hidden="true"></i></button>
                              <textarea hidden type="text" placeholder="Add officer" class="form-control" value="" custom-offic="" custom-info="" custom-key="" id='${markeofficer}' class="autocomplete1" readonly></textarea>

                          </td>
                        </div>
                        <div style="display: block;"><textarea maxlength="500" id="remarks${para_count}"  placeholder="Add Remarks (Maximum Character Limit 500)"  class="form-control mt-1 textareashowhide"/></textarea></div>`	
                        cell3.innerHTML = data_add;	

                  $(`#tooltip${para_count}`).tooltip();	
                  $('.demo').selectpicker();	
                  $(".demo").removeClass("dropdown");	
                  var button = $(`#divdesgn${para_count} .bs-actionsbox .btn-group`);	
                  button.append(`<button type="button" id="bdesgn${para_count}" class="btn btn-default btn-light" onclick="getOption('desgn${para_count}')" hidden>Save</button>`)	
                  button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${para_count}');">Close</button>`)	
                  button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);	
                  button.append(`<button type="button" id="btndel${para_count}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)	
                   
                  $(`#desgn${para_count}`).on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue){	
                    let his_id= this.id;
                      getOption(`${his_id}`);
                      });	
                  function removePopupForBtn(el){	
                      let idpattern = '#'+el +' '+'.bootstrap-select'	
                      $(idpattern).removeClass('show')	
                    };	
                        cell4.innerHTML ='<td><div class="autocomplete1" id="'+divtargetdate+'"><input type="text"  class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;background-color:white;" id='+targetdate+' readonly> </div></td>'; 	
                          
                        cell5.innerHTML ='<td><div class="autocomplete1" id="'+divcheckbox+'"><input type="checkbox" value="1" autocomplete="off" id='+checkbox+' >&nbsp; High </div></td>'; 	

             
                        $(".datepker").datepicker({	
                          showOn: 'focus',	
                          dateFormat: 'dd/mm/y',	
                          showButtonPanel: true,	
                          closeText: 'Clear', 	
                          minDate: 0,	
                          onClose: function () {	
                            var event = arguments.callee.caller.caller.arguments[0];	
                            if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {	
                                $(this).val('');	
                            }	
                          },	
                          onSelect: function(selectedDate) {	
                            
                        }	
                        });	
                    }
                    
                    let add7 =''; 
                          // <button type="button"  value="${para_count}" onclick="del_complete(this.id)"><i class="fas fa-trash-alt fa-3x" aria-hidden="true" style="color:red;" title="Click to Complete Delete"></i></button>&nbsp;
                          add7 +=`<td>
                        <div class="popup">
                          <button type="button" class="btn btn-outline-info btn-sm chkbtnclass CLOSEALLOPTIONS" id="popupbutton${para_count}" onmouseleave="funccloseallspan()"  onmouseenter="myFunction('myPopup${para_count}')" onclick="myFunction('myPopup${para_count}')">
                            
                            <i class="fas fa-tools fa-2x" title="Click to Add"></i>
                            
                            </button>
                          
                                  <span class="popuptext" id="myPopup${para_count}" onclick="myFunction(this.id)" onmouseleave="funccloseallspan1()" onmouseenter="funccloseallspanset()">
                                  
                                  </span>
                          </div>&nbsp;`
                          add7 += '<button hidden class="btn btn-outline-danger btn-sm" type="button" id="'+delid+'" value="'+ para_count+'" onclick="get_del_id(this)"><i class="fa fa-trash fa-2x" aria-hidden="true" title="Click to Delete or undo Delete"></i></button>&nbsp;</td>'
                        
                       
                        cell6.innerHTML = add7;

                        cell7.innerHTML = para_count;
                        cell7.style.display = 'none';
                    set_para_no(table);
                    }    
     
function set_para_no(table)
{
  let tbl_r_count = table.rows.length, tbl_p=0,tbl_sp=0,tbl_ssp=0, tbl_typ_id,val,chk_mrk ='Y';
  for(let i=0;i<tbl_r_count;i++)
  {
      value = table.rows[i].cells[0].innerHTML;
      if( value == 'P')
      {
        tbl_p++;
        tbl_sp=0;
        tbl_ssp=0;
        tbl_typ_id = String(tbl_p);

          table.rows[i].cells[1].innerHTML = tbl_typ_id;
          $(`#showhide${para_array[i]}`).show();
          $(`#divtargetdate${para_array[i]}`).show();
          $(`#divcheckbox${para_array[i]}`).show();
      }
      else if(value == 'SP')
      {
        tbl_sp++;
        tbl_ssp=0;
        tbl_typ_id = String(tbl_p)+'.'+String(tbl_sp);
        table.rows[i].cells[1].innerHTML = tbl_typ_id;
        for(let j=i;j<tbl_r_count;j++)
        {
          val =para_array[j];
          
          if(table.rows[j].cells[0].innerHTML != 'P')
          {
            if((table.rows[j].cells[0].innerHTML == 'SP' || table.rows[j].cells[0].innerHTML == 'SSP') && del_array.includes(val))
            {
              chk_mrk = 'N';
            }
            else
            {
              chk_mrk = 'Y';
              break;
            }
          }
          
        }
        if(table.rows[i-1].cells[0].innerHTML == 'P' && chk_mrk == 'Y' )
          {
            $(`#showhide${para_array[i-1]}`).hide();
            $(`#divtargetdate${para_array[i-1]}`).hide();
            $(`#divcheckbox${para_array[i-1]}`).hide();
          }
      }
      else{
        tbl_ssp++;
        tbl_typ_id = String(tbl_p)+'.'+String(tbl_sp)+'.'+String(tbl_ssp);
        table.rows[i].cells[1].innerHTML = tbl_typ_id;
      }   
  }
}

function delete_para()
{
      for(let ok1=0;ok1<set_option_val.length;ok1++)
            set_option_val[ok1] = 0;
      var rowCount = document.getElementById("addworkmech").rows.length;
        if(rowCount == 0)
        {
          alert('Nothing to Delete');
          return false;
        }
        if(confirm('Are You sure to Delete The Last Row'))
        {
            var table = document.getElementById("addworkmech"); 
            a = para_array.pop();
            index = del_array.indexOf(a);
            if (index > -1) { 
              del_array.splice(index, 1); 
            }
            no_of_row -= 1;

            index = para_array_marked.indexOf(a);
            if (index > -1) { 
              para_array_marked.splice(index, 1); 
            }
            // var tbldel = document.getElementById('tblspan'+a);
            // if(tbldel) tbldel.parentNode.removeChild(tbldel);
            // index = table_data.indexOf(a);
            // if (index > -1) { 
            //   table_data.splice(index, 1); 
            // }

            document.getElementById("addworkmech").deleteRow(-1);
            set_para_no(table)
        }

}

function get_del_id(th)
        {
          let val = parseInt(th.value),index,typ,typ1,index1,val1;
          let tableid = document.getElementById('addworkmech');
          index = para_array.indexOf(val);
          typ = tableid.rows[index].cells[0].innerHTML;
          if(del_array.includes(val))
          {
              if(index > 0)
                {
                  if(typ == 'SSP')
                  {
                    index1 = index - 1;
                    typ1 = tableid.rows[index1].cells[0].innerHTML;
                    if(typ1 == 'SP')
                    {
                      val1 = para_array[index1];
                      if(del_array.includes(val1))
                      {
                        alert('This item cannot be Undo please undo parent item');
                        return true;
                      }
                    }
                  }
                  else if(typ == 'SP')
                  {
                    for(let i = index-1;i>=0;i--)
                    {
                      typ1 = tableid.rows[i].cells[0].innerHTML;
                      if(typ1 == 'P')
                      {
                        val1 = para_array[i];
                        if(del_array.includes(val1))
                        {
                          alert('This item cannot be Undo please undo parent item');
                          return true;
                        }
                      }
                    }
                  }
                  
                }


              if(typ == 'SSP')
              {
                $(tableid.rows[index].cells[1]).removeClass("strikeout");
                $(tableid.rows[index].cells[2]).removeClass("strikeout");
                $(tableid.rows[index].cells[2]).find('textarea').removeClass("strikeoutbg");
                index1 = del_array.indexOf(val);
                if (index1 > -1) { 
                  del_array.splice(index1, 1); 
                }
              }
              else if(typ == 'SP')
              {
                $(tableid.rows[index].cells[1]).removeClass("strikeout");
                $(tableid.rows[index].cells[2]).removeClass("strikeout");
                $(tableid.rows[index].cells[2]).find('textarea').removeClass("strikeoutbg");
                index1 = del_array.indexOf(val);
                if (index1 > -1) { 
                  del_array.splice(index1, 1); 
                }
                for(let i=index+1;i<tableid.rows.length;i++)
                {
                  typ1 = tableid.rows[i].cells[0].innerHTML;
                  if(typ1 == 'SSP')
                  {
                    val = para_array[i]
                    $(tableid.rows[i].cells[1]).removeClass("strikeout");
                    $(tableid.rows[i].cells[2]).removeClass("strikeout");
                    $(tableid.rows[i].cells[2]).find('textarea').removeClass("strikeoutbg");
                    index1 = del_array.indexOf(val);
                    if (index1 > -1) { 
                      del_array.splice(index1, 1); 
                    }
                  }
                  else
                  {
                    break;
                  }
                }
              }
              else if(typ == 'P')
              {
                $(tableid.rows[index].cells[1]).removeClass("strikeout");
                $(tableid.rows[index].cells[2]).removeClass("strikeout");
                $(tableid.rows[index].cells[2]).find('textarea').removeClass("strikeoutbg");
                index1 = del_array.indexOf(val);
                if (index1 > -1) { 
                  del_array.splice(index1, 1); 
                }
                for(let i=index+1;i<tableid.rows.length;i++)
                {
                  typ1 = tableid.rows[i].cells[0].innerHTML;
                  if(typ1 != 'P')
                  {
                    val = para_array[i]
                    $(tableid.rows[i].cells[1]).removeClass("strikeout");
                    $(tableid.rows[i].cells[2]).removeClass("strikeout");
                    $(tableid.rows[i].cells[2]).find('textarea').removeClass("strikeoutbg");
                    index1 = del_array.indexOf(val);
                    if (index1 > -1) { 
                      del_array.splice(index1, 1); 
                    }
                  }
                  else
                  {
                    break;
                  }
                }
              }
          }
          else
          {
            if(typ == 'SSP')
            {
              del_array.push(val);
              $(tableid.rows[index].cells[1]).addClass("strikeout");
              $(tableid.rows[index].cells[2]).addClass("strikeout");
              $(tableid.rows[index].cells[2]).find('textarea').addClass("strikeoutbg");
            }
            else if(typ == 'SP')
            {
              del_array.push(val);
              $(tableid.rows[index].cells[1]).addClass("strikeout");
              $(tableid.rows[index].cells[2]).addClass("strikeout");
              $(tableid.rows[index].cells[2]).find('textarea').addClass("strikeoutbg");
              for(let i=index+1;i<tableid.rows.length;i++)
              {
                typ1 = tableid.rows[i].cells[0].innerHTML;
                if(typ1 == 'SSP')
                {
                  val = para_array[i]
                  del_array.push(val);
                  $(tableid.rows[i].cells[1]).addClass("strikeout");
                  $(tableid.rows[i].cells[2]).addClass("strikeout");
                  $(tableid.rows[i].cells[2]).find('textarea').addClass("strikeoutbg");
                }
                else
                {
                  break;
                }
              }
            }
            else if(typ == 'P')
            {
              del_array.push(val);
              $(tableid.rows[index].cells[1]).addClass("strikeout");
              $(tableid.rows[index].cells[2]).addClass("strikeout");
              $(tableid.rows[index].cells[2]).find('textarea').addClass("strikeoutbg");
              for(let i=index+1;i<tableid.rows.length;i++)
              {
                typ1 = tableid.rows[i].cells[0].innerHTML;
                if(typ1 != 'P')
                {
                  val = para_array[i]
                  del_array.push(val);
                  $(tableid.rows[i].cells[1]).addClass("strikeout");
                  $(tableid.rows[i].cells[2]).addClass("strikeout");
                  $(tableid.rows[i].cells[2]).find('textarea').addClass("strikeoutbg");
                }
                else
                {
                  break;
                }
              }
            }
          }
          del_array = del_array.filter(onlyUnique);
          set_para_no(tableid)
        }

function Copy_marked_officer()
{
    /// get idselected and clicked
    if(set_offier_id == '')
    {
      alert('Nothing is selected, please select');
      return false;
    }
    
    let testid = (copy_offier_id).substring(3,(copy_offier_id).length);
    
    let idsel = set_offier_id;
    let idmark = 'markeofficer'+idsel;
    let officer_val = document.getElementById(idmark).getAttribute('custom-offic');
    if(officer_val == '')
    {
        alert('Nothing is Selected in Marked Officer');
        return false;
    }
    officer_val = officer_val.split(',')
    let values=[]
    for(i=0;i<officer_val.length;i++)
    {
      values.push(officer_val[i])
    }
    
    emp_no = values;
    let tooltipid='tooltip'+ testid.replaceAll('.','a');
    let markofficer='markeofficer'+ testid;  
   
    data={
        'officer_id': JSON.stringify(values),
        'csrfmiddlewaretoken': '{{csrf_token}}'
      }
      $.ajax({
                  type : 'POST',
                  url : "{% url 'copy_get_marked_officers' %}",
                  dataType : 'json',
                  data : data,
          
                  success : function(response)
                  {


                    $(`#desgn${testid}`).selectpicker("destroy");
                    for(let ij =0;ij<response.length;ij++)
                    {
                      if($(`#desgn${testid} option[value='${response[ij].designation_code}']`).length <= 0)
                      {
                        
                        $(`#desgn${testid}`).append(`<option value="${response[ij].designation_code}" data-tokens="${response[ij].empnoser}">${response[ij].designation}</option>`);
                      }
                    }

                    var officer='officer'+testid;
                    $(`.desgn${testid}`).selectpicker();	
                    $(`.desgn${testid}`).removeClass("dropdown");	
                    var button = $(`#divdesgn${testid} .bs-actionsbox .btn-group`);	
                    button.append(`<button type="button" id="bdesgn${testid}" class="btn btn-default btn-light" onclick="getOption('desgn${testid}')" hidden>Save</button>`)	
                    button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${testid}');">Close</button>`)	
                    button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);	
                    button.append(`<button type="button" id="btndel${testid}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)	
                    
                    $(`#desgn${testid}`).on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue){	
                      let his_id= this.id;
                      getOption(`${his_id}`);
                        });	
                    function removePopupForBtn(el){	
                        let idpattern = '#'+el +' '+'.bootstrap-select'	
                        $(idpattern).removeClass('show')	
                      };
                    $(`.desgn${testid}`).selectpicker('val', emp_no);
              },
              error: function(data)
              {
                alert('Some error exist, contact Adminstrator')
              }
            })
    document.getElementById('closeofficermodal').click();              
}

function copy_mark_officer(th)
{
    copy_offier_id = th.id;
    let copy_id = parseInt((copy_offier_id).substring(3,(copy_offier_id).length));
    let tableid = document.getElementById('addworkmech'), typ,val,id,itm;
    if(para_array.length == 0)
    {
      alert('Nothing is present to Copy from');
      return false;
    }
    $('#add_officer_tbl tbody').empty();
    let row='<tr><td><label style="font-weight:bold;"> Select From Paragraph</label><br>';
    for(let j=0;j<tableid.rows.length;j++)
    {
      typ = tableid.rows[j].cells[0].innerHTML;
      itm = tableid.rows[j].cells[1].innerHTML;
      val = para_array[j];
      id='showhide'+String(val);
      if(!$('#'+id).is(':hidden') && typ == 'P' && copy_id != val)
        {  
          row += `<input type="radio" name="deletion_type" value="${val}" onclick="fun_set_officer_copy('${val}')">
                  <label>Para ${itm}</label>&nbsp;`;
        }
      
    }
    row += '</td></tr><tr><td><label style="font-weight:bold;"> Select From Sub Paragraph</label><br>'
    for(let j=0;j<tableid.rows.length;j++)
    {
      typ = tableid.rows[j].cells[0].innerHTML;
      itm = tableid.rows[j].cells[1].innerHTML;
      val = para_array[j];
      id='showhide'+String(val);
      if(!$('#'+id).is(':hidden') && typ == 'SP' && copy_id != val)
        {  
          row +=`<input type="radio" name="deletion_type" value="${val}" onclick="fun_set_officer_copy('${val}')">
            <label>Subpara ${itm}</label>&nbsp;`
        }
    }
    row += '</td></tr>';
    $('#add_officer_tbl tbody').append(row);
    document.getElementById('openofficeremodal').click();
}

function fun_set_officer_copy(val)
{
  set_offier_id = val;
}


var option_val_edit = '{{option_val|safe}}';
$(document).ready(function(){


    if(option_val_edit == 'edit')
    {
      var table_7 = document.getElementById("addworkmech");
      var detailsdata = JSON.parse('{{detailsdata|safe}}');
      detailsdata = decryptWithAES(detailsdata)
      detailsdata =  JSON.parse(detailsdata)
      for(let i=0;i<detailsdata.length;i++)
      {
          let paraType =  detailsdata[i]['type']
          addpara(paraType,'-2');

          let marked_id=JSON.parse(detailsdata[i]['marked_id']);
          let marked_desig=detailsdata[i]['marked_desig'];
          let marked_key=JSON.parse(detailsdata[i]['marked_key']);
          let markofficer = 'markeofficer'+String(i), tooltipid = 'tooltip'+String(i);

          document.getElementById(markofficer).value=marked_desig;
          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-offic', marked_id);

          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-key',JSON.stringify(marked_key));

           myInput = document.getElementById(tooltipid);
            
            if(marked_desig.length==0)
            {
              marked_desig='Add From Dropdown'
            }
            myInput.innerHTML=truncateString(marked_desig,10);
            marked_desig=marked_desig.replaceAll(',',', ')
            myInput.title=marked_desig;
            $('#'+tooltipid).tooltip();
            marked_id = detailsdata[i]['d_id_str']
       
            $(`.desgn${String(i)}`).selectpicker('val', marked_id);

            if(detailsdata[i]['target_date'] != '')
            {
              $('#targetdate'+String(i)).val(detailsdata[i]['target_date'])
            }
            if(detailsdata[i]['item_priority'] == '1')
            {
              $('#check'+String(i)).prop('checked', true)
            }

            if(paraType == 'P')
            {
              $('#heading'+String(i)).val(detailsdata[i]['item_heading'])
                if(detailsdata[i]['del_flag'] == 1)
                {
                 
                  $(table_7.rows[i].cells[1]).addClass("strikeout");
                  $(table_7.rows[i].cells[2]).addClass("strikeout");
                  $(table_7.rows[i].cells[2]).find('textarea').addClass("strikeoutbg");
                  del_array.push(i); 
                }
               

              
            }
            if(paraType == 'SP')
            {
              $('#heading'+String(i)).val(detailsdata[i]['item_subheading']);
              $('#description'+String(i)).val(detailsdata[i]['item_description'])

              if(detailsdata[i]['del_flag'] == 1)
                {
                 
                  $(table_7.rows[i].cells[1]).addClass("strikeout");
                  $(table_7.rows[i].cells[2]).addClass("strikeout");
                  $(table_7.rows[i].cells[2]).find('textarea').addClass("strikeoutbg");
                  del_array.push(i); 
                }
            }
            if(paraType == 'SSP')
            {
              $('#heading'+String(i)).val(detailsdata[i]['item_decision']);
              if(detailsdata[i]['del_flag'] == 1)
                {
                 
                  $(table_7.rows[i].cells[1]).addClass("strikeout");
                  $(table_7.rows[i].cells[2]).addClass("strikeout");
                  $(table_7.rows[i].cells[2]).find('textarea').addClass("strikeoutbg");
                  del_array.push(i); 
                }
              
            }
            if(detailsdata[i]['remarks'] != null )
            {
              $('#remarks'+String(i)).val(detailsdata[i]['remarks']);
              $('#remarks'+String(i)).removeClass('textareashowhide');
              $('#remarks'+String(i)).addClass('textareashowhide_h');
            }

            let tbl_tbl = detailsdata[i]['_tbl_tbl'];
            if(tbl_tbl.length > 0)
            {
            let curr_span_id = i;
            let idtbl = 'tblspan'+curr_span_id;
            let obj1='<table border="1" id="'+idtbl+'">';
            for(let k = 0;k<tbl_tbl.length;k++)
            {
                obj1+='<tr>';
                for(k1=0;k1<tbl_tbl[k].length;k1++)
                {
                  
                  id_data='tblspan'+curr_span_id+String(k)+String(k1);
                  obj1+='<td><input type="text" id="'+id_data+'" value="'+tbl_tbl[k][k1]+'"></td>';
                }
                obj1+='</tr>';
              
              
            }
            table_data.push(String(curr_span_id));
            document.getElementById('span'+String(i)).innerHTML = obj1;
          }
 

      }
      
      if(table_7.rows.length > 0)
      {
        $('#submit2').show();
      }

      var img_path_json = JSON.parse('{{img_path|safe}}');

      for(let i6=0;i6<img_path_json.length;i6++)
    {
      file = '/'+img_path_json[i6]['path']
      sno = img_path_json[i6]['id']
      add_row_image();
      id = img_count;
      let do_file = 'ipfile_'+id, sel_id = 'select_img_'+id;
      set_option_value(sel_id);
      let btn_do_file = 'btn_img_'+id, txt_img = 'img_text_'+id,frameid='frame'+id,btn_reset = 'btn_img_r'+id;
      document.getElementById(btn_do_file).style.backgroundColor='green';
      document.getElementById(txt_img).value = file;
      document.getElementById(frameid).src = file;
      document.getElementById(btn_do_file).disabled = true;
      document.getElementById(btn_reset).disabled = false;
      document.getElementById(sel_id).value=sno;
      preview_img(id);
    }

      copyToOption();
 }
  console.log(table_data)
});
</script>



<script>
        
  $(document).ready(function () {
$("#submit2").on("click", function() {
  // $(this).attr("disabled", "disabled");
  $(this).attr("hidden", "hidden");
  doWork(); //this method contains your logic
});
});


function doWork() {
// alert("doing work");
//actually this function will do something and when processing is done the button is enabled by removing the 'disabled' attribute
//I use setTimeout so you can see the button can only be clicked once, and can't be clicked again while work is being done
setTimeout('$("#submit2").removeAttr("hidden")', 15000);
}
</script>

<script>


var boolclose = true;
function funccloseallspanset()
{
  boolclose = false;
}
    function funccloseallspan()
    {
      setTimeout(() => {
        if(boolclose)
          $('.popuptext').removeClass('show');

        boolclose = true;
        
      }, 5);
      
    }

    function funccloseallspan1()
    {
      $('.popuptext').removeClass('show');
      boolclose = true;
    }

    var editLocationData =  $('#location').val();




    
function myFunction(id) {
  let r_count = id.substring(7,id.length),prev_index,next_index,prev_typ='N',next_typ='N';
  var popup = document.getElementById(id);
  $('.popuptext').removeClass('show');
  var a = popup.classList.toggle("show");
  
 
  if( a == true)
  {
    for(let i =0;i<para_array.length;i++)
    {
      if(parseInt(r_count) == para_array[i])
      {
       
        let tbl_span_id = 'myPopup'+r_count;
        $('#'+tbl_span_id).empty();
        index = i;
        if(i == 0)
        {
          prev_index = -1;
        }
        else
        {
          prev_index = i - 1;
        }
        if(i+1 < para_array.length)
        {
          next_index = i + 1;
        }
        else
        {
          next_index = -1;
        }
        if(prev_index != -1)
        {
          prev_typ =document.getElementById("addworkmech").rows[prev_index].cells[0].innerHTML;
        }
        if(next_index != -1)
        {
          next_typ =document.getElementById("addworkmech").rows[next_index].cells[0].innerHTML;
        }
        
        curr_typ =document.getElementById("addworkmech").rows[index].cells[0].innerHTML;
        // let row = '';
        //   row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-table extra-css"  ></i></span><input type="text" onclick="addTableDropDown('add${r_count}');" value="Add Table" class="sethover"> </div>` ;
        //   row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-cut extra-css"  ></i></span><input type="text" onclick="removeTableDropDown('del${r_count}');" value="Remove Table" class="sethover"> </div>`;
        //   row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-copy extra-css"  ></i></span><input type="text" onclick="addOfficerDropDown('cpy${r_count}');" value="Copy Officer" class="sethover"></div>`;
        //   row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-trash extra-css"  ></i></span><input type="text" onclick="deleteRowDropDown('del1${r_count}');" value="Delete Row" class="sethover"> </div>` ;
        //   row +='<hr>';
        let row = '';
        row += `<button class="button button2"  type="button" id="save_btn"  class="btn btn-success" align="center" onclick="addTableDropDown('add${r_count}');"><i class="fa fa-table extra-css"></i><br>Add Table</button> `;
        row += `<button class="button button3"  type="button" id="save_btn"  class="btn btn-success" align="center" onclick="removeTableDropDown('del${r_count}');"><i class="fa fa-cut extra-css"></i><br>Remove Table</button> `;
        row += `<button class="button button4"  type="button" id="save_btn"  class="btn btn-success" align="center" onclick="addOfficerDropDown('cpy${r_count}');"><i class="fa fa-copy extra-css"></i><br>Copy Officer</button> `;  
        row += `<button class="button button5"  type="button" id="save_btn"  class="btn btn-success" align="center" onclick="deleteRowDropDown('del1${r_count}');"><i class="fa fa-trash extra-css"></i><br>Delete Row</button> `;  
        row +='<hr>'
        row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addRemarksFunction('${r_count}');" value="Add/Remove Remarks" class="sethover"> </div>` ;

        
      if (curr_typ == 'P'){
        if(prev_typ=='S' || prev_typ == 'N')
        { 
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i});" value="Add para Above" class="sethover"> </div>` ;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index});" value="Add para Below" class="sethover"> </div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index});" value="Add Sub-para Below" class="sethover"></div>`;
        }
        else if(prev_typ=='P')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
        }
        else if(prev_typ=='SP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
        }
        else if(prev_typ=='SSP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
        }
      }
        
      else if(curr_typ == 'SP')
        {
          if(prev_typ=='P')
          {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          }
          else if(prev_typ=='SP')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
          }
          else if(prev_typ=='SSP')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
          }
          if(next_typ == 'N' || next_typ == 'S')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
          }
          else if(next_typ == 'P')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
          }
          else if(next_typ == 'SP')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
          }
          else if(next_typ == 'SSP')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
          }
        }
      
      else if(curr_typ == 'SSP')
      {
        if(prev_typ=='SP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
        }
        else if(prev_typ=='SSP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
        }
        if(next_typ == 'N' || next_typ == 'S')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
        }
        else if(next_typ == 'P')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
        }
        else if(next_typ == 'SP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
        }
        else if(next_typ == 'SSP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
        }
      }
        
      $('#'+tbl_span_id).append(row);
        break;
      }
    } 
  }
}


function addRemarksFunction(id)
{
  var x = document.getElementById('showhide'+id);
  id = 'remarks'+id;
 
 if(x.style.display == 'none')
 {
  alert('cannot give remarks for these item');
  return true;
 }
  if($("#"+id).hasClass("textareashowhide"))
  {
    $("#"+id).removeClass("textareashowhide");
    $("#"+id).addClass('textareashowhide_h');
  }
  else {
    $("#"+id).addClass('textareashowhide');
    $("#"+id).removeClass('textareashowhide_h');
  }
  
}

function addTableDropDown(id)
{
  document.getElementById(id).click();
}
function removeTableDropDown(id)
{
  document.getElementById(id).click();
}

function compliance_alterdata()
{
    window.location.reload();
}
</script>


<script>

  var curr_span_id='',table_data=[];
  function get_table_data(val)
    {
              id = val.id;
              id1=id.substring(3,id.length)
              spanid = 'span'+id1;
              curr_span_id = spanid;
              if(table_data.includes(id1))
              {
                alert('Table already Present');
                return false;
              }
              document.getElementById('addtablemodal').click();       
    }
  ////   start table delete code
  var global_tblid,global_id1,delete_type;
    function open_modal_delete()
    {
      document.getElementById("noofrowsdel").readOnly = true;
      document.getElementById("noofcoldel").readOnly = true;
      document.getElementById("noofrowsdel").value = '';
      document.getElementById("noofcoldel").value = '';
      document.getElementById("table_checked").checked = true;
      document.getElementById('deltablemodal').click();
  
    }
    function fun_set_del_table(val)
    {
      delete_type = val;
      document.getElementById("noofrowsdel").readOnly = true;
      document.getElementById("noofcoldel").readOnly = true;
      document.getElementById("noofrowsdel").value = '';
      document.getElementById("noofcoldel").value = '';
      if(val == 'row')
        document.getElementById("noofrowsdel").readOnly = false;
      else if(val == 'column')
        document.getElementById("noofcoldel").readOnly = false;
    }
    function delete_table()
    {
      if(!confirm('Are you sure to delete'))
      {
        return false;
      }
  
      var tbldel = document.getElementById(global_tblid);
      var row_len = tbldel.rows.length;
      var col_len = tbldel.rows[0].cells.length;
  
      if(delete_type == 'table')
      {
            if(tbldel == null)
              alert('Nothing to delete')
            if(tbldel) tbldel.parentNode.removeChild(tbldel);
            index = table_data.indexOf(global_id1);
            if (index > -1) { 
              table_data.splice(index, 1); 
            }
      }
      else if(delete_type == 'row')
      {
          let noofrows = document.getElementById('noofrowsdel').value;
          if(noofrows == '')
          {
            alert('Enter No of Rows');
            return false;
          }
          if(parseInt(noofrows)<=0)
          {
            alert('Row should be greater than zero');
            return false;
          }
          if(parseInt(noofrows) > row_len)
          {
            alert('Row should not be greater than Number of Rows');
            return false;
          }
          tbldel.deleteRow(parseInt(noofrows)-1);
          if(row_len == 1)
          {
            if(tbldel == null)
              alert('Nothing to delete')
            if(tbldel) tbldel.parentNode.removeChild(tbldel);
            index = table_data.indexOf(global_id1);
            if (index > -1) { 
              table_data.splice(index, 1); 
            }
          }
      }
      else
      {
        let noofcolumns = document.getElementById('noofcoldel').value;
        if(noofcolumns == '')
          {
            alert('Enter No of Columns');
            return false;
          }
          if(parseInt(noofcolumns)<=0)
          {
            alert('Column should be greater than zero');
            return false;
          }
          if(parseInt(noofcolumns) > col_len)
          {
            alert('Column should not be greater than Number of Column');
            return false;
          }
  
          for (var i = 0; i < row_len; i++) 
          {
            tbldel.rows[i].deleteCell(parseInt(noofcolumns)-1);
          }
  
  
          if(col_len == 1)
          {
            if(tbldel == null)
              alert('Nothing to delete')
            if(tbldel) tbldel.parentNode.removeChild(tbldel);
            index = table_data.indexOf(global_id1);
            if (index > -1) { 
              table_data.splice(index, 1); 
            }
          }
      }
      document.getElementById('closedelmodal').click();
      document.getElementById("global_tblid").style.width = "100%";
  
    }
  
    function remove_table_data(val)
    {
            id = val.id;
            id1=id.substring(3,id.length)
            spanid = 'span'+id1;
            curr_span_id = spanid;
            idtbl = 'tbl'+curr_span_id;
  
            var tbldel = document.getElementById(idtbl);
            if(tbldel == null)
            {
              alert('Nothing to delete');
              return false;
            }
            global_tblid = idtbl;
            global_id1 = id1;
            delete_type = 'table';
            open_modal_delete();
  
            // var tbldel = document.getElementById(idtbl);
            // if(tbldel == null)
            //   alert('Nothing to delete')
            // if(tbldel) tbldel.parentNode.removeChild(tbldel);
            // index = table_data.indexOf(id1);
            // if (index > -1) { 
            //   table_data.splice(index, 1); 
            // }
    }
  
  ////   end table delete code
  
  function addOfficerDropDown(id)
{
  document.getElementById(id).click();
}
function deleteRowDropDown(id)
{
  document.getElementById(id).click();
}


  function setspantable()
    {
          noofrows = document.getElementById('noofrows').value;
          noofcolumns = document.getElementById('noofcolumns').value;
          id1=curr_span_id.substring(4,curr_span_id.length)
          if(noofrows == '')
          {
            alert('Enter No of Rows');
            return false;
          }
          if(noofcolumns == '')
          {
            alert('Enter No of Columns');
            return false;
          }
          if(parseInt(noofrows)<=0)
          {
            alert('Row should be greater than zero');
            return false;
          }
          if(parseInt(noofcolumns)<=0)
          {
            alert('Column should be greater than zero');
            return false;
          }
          if(parseInt(noofrows)>50)
          {
            alert('Row should be Less than 50');
            return false;
          }
          if(parseInt(noofcolumns)>20)
          {
            alert('Column should be Less than 20');
            return false;
          }
          table_data.push(id1);
          
          idtbl = 'tbl'+curr_span_id;
          obj1='<table border="1" id="'+idtbl+'">';
          noofrows =parseInt(noofrows);
          noofcolumns =parseInt(noofcolumns);
          for(i=0;i<noofrows;i++)
          {
            obj1+='<tr>';
            for(j=0;j<noofcolumns;j++)
            {
              id_data='tbl'+curr_span_id+String(i)+String(j);
              obj1+='<td><input type="text" id="'+id_data+'"></td>';
            }
            obj1+='</tr>';
          }
          document.getElementById(curr_span_id).innerHTML = obj1;
          document.getElementById('closespanid').click();
          
        }
  


  function open_wrap(e){
  
  var id=e.id.substr(4)
  var desigs=$("#"+id).val()
  var no=e.id.substr(9)
  markid='markeofficer'+no
  var info_id = document.getElementById(markid).getAttribute('custom-info');
  
  if(info_id!=''){
  info_id=JSON.parse(info_id)
  
  }
 
  if(desigs == '')
  {
    alert("Select Officer First")
    return false;
  }
  document.getElementById('openModalOpenWrap').click();
  data={
    'id':id,
    'desigs':JSON.stringify(desigs),
    csrfmiddlewaretoken: '{{ csrf_token }}'
  }
  
  $.ajax({
    type : 'POST',
    url : "{% url 'officertask_mom' %}",
    dataType : 'json',
    data : data,
    success : function(response)
    {
      var idsss='saveinfo'+response.id
      // alert(idsss)
      var myEle = document.getElementById("saveinfo")
      if(myEle) {
        document.getElementById("saveinfo").name =idsss ;
      }
      table=$('#mytable1').DataTable();
      table.destroy();
        $('#mytable1 tbody').empty();
        if(response.designations){
         
          row=''
          for(var i=0;i<response.designations.length;i++){
            row+=`
            <tr>
                        <td style="display:none">${response.designations[i]['designation_code']}</td>
                        <td>${i+1}</td>
                        <td style="text-align:center"><input hidden id="designation${response.designations[i]['designation_code']}" value="${response.designations[i]['designation']}">${response.designations[i]['designation']}</td>
                        <td> <div class="form-check">
                            <input class="form-check-input" value="info" type="radio" name="flexRadioDefault${response.designations[i]['designation_code']}" id="type${response.designations[i]['designation_code']}"  onclick="disable_boxes(this)">
                            <label class="form-check-label" for="info">
                              For Information
                            </label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" value="action" type="radio" name="flexRadioDefault${response.designations[i]['designation_code']}" id="type1${response.designations[i]['designation_code']}" checked onclick="disable_boxes(this)">
                            <label class="form-check-label" for="action">
                              For Compliance
                            </label>
                          </div></td>
                          <td hidden><div class="autocomplete1" id="divtargetdate${response.designations[i]['designation_code']}">
                                
                                <input type="text"  class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;background-color:white;" id='targetdate${response.designations[i]['designation_code']}' readonly> 
                               </div></td>
                               <td hidden><div class="autocomplete1 mt-1" id="divcheckbox${response.designations[i]['designation_code']}"><input type="checkbox" value="1" autocomplete="off" id='checkbox${response.designations[i]['designation_code']}'>&nbsp; <label for="priority" class="lbl-caption"></label> </div></td>
                    </tr>
            `
          }
          
          $('#mytable1 tbody').append(row);
          
          
          
          $('#mytable1').DataTable({
            pageLength:4,
            dom: 'Bfrtip',
            "bSort": false,
            "pagingType": "simple",
            "lengthChange":false,
            "sEmptyTable": 'Please Select Officers First',
              "language":{
                  "search": "Keyword search:"
                  
              }
            })
            
            
            
            $(".datepker").datepicker({	
                showOn: 'focus',	
                dateFormat: 'dd/mm/y',	
                showButtonPanel: true,	
                closeText: 'Clear', 	
                minDate: 0,	
                onClose: function () {	
                var event = arguments.callee.caller.caller.arguments[0];	
                if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {	
                    $(this).val('');	
                }	
                },	
                onSelect: function(selectedDate) {
            }	
            });	
            set_values_info(e)
          }
      }
      
      })
}



function set_values_info(e){
  let prior = document.getElementById("checkbox_priority_inpt");
  prior.checked = false
  document.getElementById("target_date_inpt").value="";
  var no=e.id.substr(9)
  markid='markeofficer'+no
  var info_id = document.getElementById(markid).getAttribute('custom-info');
  if(info_id!=''){
    table=$('#mytable1').DataTable();
      table.destroy();
        
  info_id=JSON.parse(info_id)
  var table = document.getElementById("mytable1");
  let tbl_r_count = table.rows.length;
  if (tbl_r_count !=0 && info_id.length){
    for (let j=0;j<info_id.length;j++){
      for(let i=0;i<tbl_r_count;i++){
        
        value = table.rows[i].cells[0].innerHTML;
        if( value != info_id[j]['DesignationCode'])
          continue
        else{
          if (info_id[j]['selected_action'] == 'info' || info_id[j]['selected_action'] == 1)
            {
              var info = "type"+value;
              let action_val = document.getElementById(info);                          
              action_val.checked = true;
              var priorityid = "#checkbox"+value;
              $(priorityid).hide();
              var tgtdate = "#targetdate"+value;
              $(tgtdate).hide();
            }
            else
            {
              if (info_id[j]['priority'] == 1){
                var priorityid = "checkbox"+value
                let prior = document.getElementById("checkbox_priority_inpt");
                prior.checked = true
              }
              if (info_id[j]['tddate'] != '-1'){
                var tgtdate = "targetdate"+value
                document.getElementById("target_date_inpt").value=info_id[j]['tddate'];
              }
        }
      }
      }
    }
  }



  $('#mytable1').DataTable({
            pageLength:4,
            dom: 'Bfrtip',
            "bSort": false,
            "pagingType": "simple",
            "lengthChange":false,
            "sEmptyTable": 'Please Select Officers First',
              "language":{
                  "search": "Keyword search:"
                  
              }
            })
            
}
}



function save_info(e){
  var id = e.name.substr(13)
  
  markid='markeofficer'+id
  var officer_val = document.getElementById(markid).getAttribute('custom-offic');
  officer_val = officer_val.split(',')
  table=$('#mytable1').DataTable();
  table.destroy();
  var info_val=[];
  for (var i=0;i<officer_val.length;i++){
    var selected_action;
    var priority = 0; 
    var tddate = "-1"   
    var info = "type"+officer_val[i]
    let action_val = document.getElementById(info);
    var des = "designation" + officer_val[i];
    desig = document.getElementById(des).value;
    if (action_val.checked == true){
       selected_action= "info"
    }
    else{
      selected_action= "action"
    }
    if (selected_action == "action"){
      tddate = document.getElementById("target_date_inpt").value;
      if (tddate == '')
        tddate='-1'
      let prior = document.getElementById("checkbox_priority_inpt");
        
      if (prior.checked == true){
        priority= 1
      }
    }
    info_val.push({'DesignationCode':officer_val[i],'selected_action':selected_action,'priority':priority,'tddate':tddate,'Designation':desig})
  }
  var myInput = document.getElementById(markid);
  myInput.setAttribute('custom-info', JSON.stringify(info_val));
  
}

function disable_boxes(e){
  id=e.id;
  info=e.value
  if (info=='info'){
    id_s=id.substr(4);
    let tardate='#targetdate'+id_s;
    let prior='#divcheckbox'+id_s;
    $(tardate).hide()
    $(prior).hide()
  }
  else{
    id_s=id.substr(5);
    let tardate='#targetdate'+id_s;
    let prior='#divcheckbox'+id_s;
    let pr = '#checkbox'+id_s
    $(tardate).show()
    $(prior).show()
    $(pr).show()
  }
  // alert(info)
}

var globalTimerIDAutoSave ='';
function getOnOffStatus()
{
  var zone=$("#zone").val();
  var inspection_date=$('#txtDate2').val();
  
           
if(document.getElementById('onOffIdForAutoUpdate').checked == true)
{
      document.getElementById('onOffIdForAutoUpdate').checked = false;
            var present = $('#officer').val();
            var mom_date = $('#mdate').val();
           
            var titleMOM = $('#titleMOM').val();
            var type = $('#type').val();
            
            if (titleMOM == '' || titleMOM == null) {
                alert("Please enter title for this MOM!")
                return false;
            }
            if (type == '' || type == null) {
                alert("Please Select Type of MOM!")
                return false;
            }
            
            if (present == '' || present == null) {
            alert("Please Select Officer's present in MOM!")
            return false;
            }

            if (mom_date == '' || mom_date == undefined) {
                alert("Please fill Date of MOM!")
                return false;
            }
        
        document.getElementById('onOffIdForAutoUpdate').checked = true;
        
        globalTimerIDAutoSave = setInterval(function() {
          autoSaveFunction();
            }, 20 * 1000); 
}	
  else
  {
    clearInterval(globalTimerIDAutoSave);
  }
}

function autoSaveFunction()
{
  ResetTimers();
  Savedraft_data('autosave');

}
  </script>

  
<!-- saving scripts new -->
<script>
 
  function Updatedraft_data1(el)
      { 
              del_array = del_array.filter(onlyUnique);
              var table = document.getElementById("addworkmech");
              var present = $('#officer').val();
              var mom_date = $('#mdate').val();
              var copyto = $('#copyto').val();
              var titleMOM = $('#titleMOM').val();
              var type = $('#type').val();
  
              if (titleMOM == '' || titleMOM == null) {
                  alert("Please enter title for this MOM!")
                  return false;
              }
              if (type == '' || type == null) {
                  alert("Please Select Type of MOM!")
                  return false;
              }
              
              if (present == '' || present == null) {
              alert("Please Select Officer's present in MOM!")
              return false;
              }
  
              if (mom_date == '' || mom_date == undefined) {
                  alert("Please fill Date of MOM!")
                  return false;
              }
              let sttninsp = $('#sttninsp').val();   
              let desiginsp = $('#desiginsp').val();
              let ofcnameinsp = $('#ofcnameinsp').val();
              if (sttninsp == '') {
                  alert("Please fill Station")
                  return false;
              }
              if (desiginsp == '') {
                  alert("Please fill Designation")
                  return false;
              }
              if (ofcnameinsp == '') {
                  alert("Please fill Name")
                  return false;
              }
              
                hli = 0,full_array=[];
                let paradata;
                
      
                let ar1 = {};
                let myarr2 = {};
           
                let head = 0,shead, sshead,headid='',count=0;
  
                hli = 0,full_array=[],full_array_del=[];
                for(let i=0;i<table.rows.length;i++)
                {
                  if(table.rows[i].cells[0].innerHTML == 'P')
                    hli++;
                  full_array.push(table.rows[i].cells[1].innerHTML)

                  if(table.rows[i].cells[1].classList.contains('strikeout'))
                  {
                    full_array_del.push(table.rows[i].cells[1].innerHTML)
                  }
                }
                
                for(let i=1; i<=hli; i++){
                  shead =0;
                  sshead=0;
                  let ar ={}
                  let myar1 = []
                  
                  for(let j=0; j<full_array.length; j++)
                  {
                    paradata = para_array[j] 
                      
                      if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.')
                      { 
                          if(full_array_del.includes(full_array[j]))
                             continue
                          let temp = full_array[j].split('.')
                          if(temp.length == 1){
                            
                            shead =0;
                            sshead =0;
                            head++;
                            headid = String(head);
                            let hid='heading'+ String(paradata);
                            let hid1='heading'+ headid;
                            var val = document.getElementById(hid).value;
                            ar[hid1]=val
                            d1_test = full_array[j]+'.'
                            
                            let table_det=[];
                            if(table_data.includes(String(paradata)))
                            {
                                  let tableid = 'tblspan'+String(paradata);
                                  var oTable = document.getElementById(tableid);
                                  var rowLength = oTable.rows.length;
                                  for (ig = 0; ig < rowLength; ig++){
                                    table_det1=[]
                                    var oCells = oTable.rows.item(ig).cells;
                                    var cellLength = oCells.length;
                                    for(var jg = 0; jg < cellLength; jg++){
                                        var cellVal = oCells.item(jg).children[0].value;
                                        table_det1.push(cellVal);
                                        // if(cellVal =='')
                                        // {
                                        //   alert('Please fill Table Data');
                                        //   return false;
                                        // }
                                    }
                                    table_det.push(table_det1)
                                  }
                            }
                            let tableid='table'+ headid;
                            ar[tableid]=table_det;



                          d2_test = 'Yes'
                          for(iv=j+1;iv<table.rows.length;iv++)
                            {
                              if(table.rows[iv].cells[0].innerHTML == 'P')
                              {
                                break;
                              }
                              if(del_array.includes(para_array[iv]))
                              {
                                d2_test = 'Yes'
                              }
                              else
                              {
                                d2_test ='No'
                                break
                              }
                            }
  
                            if(d2_test == 'No')
                            {
                              a=1;
                            }
                            else
                            {
      
      
                                let td = 'targetdate' + String(paradata);
                                let mf = 'markeofficer' + String(paradata);
                                let chk = 'check' + String(paradata);
                                let remark = 'remarks' + String(paradata);
                                var tddate = document.getElementById(td).value;
                                let chk_val = document.getElementById(chk)
                                var remarkss = document.getElementById(remark).value;
  
                                if (chk_val.checked == true){
                                    var checkbox = '1'
                                }
                                else if (chk_val.checked == false){
      
                                  checkbox = '0'
                                }
                                
                                var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                                
                                let custom_info = document.getElementById(mf).getAttribute('custom-info');
                                let myinfo = []
                                if(custom_info !='')
                                    {
                                      (JSON.parse(custom_info)).forEach(element => {
                                        myinfo.push(element.selected_action)
                                      });
                                    }
                                
                                
                                let td1 = 'targetdate' + headid;
                                let mf1 = 'markeofficer' + headid;
                                let chk1 = 'check' + headid;
                                let rem1 = 'remarks' + headid;
                                ar[td1]=tddate
                                ar[mf1]=officer_val
                                ar[chk1]=checkbox 
                                ar[rem1]=remarkss  
                                rem1 = 'myinfo' + headid;
                            ar[rem1]=myinfo;     
                            }
    
                          }
                          else if(temp.length == 2){
                            sshead=0;
                            shead++;
                            headid = String(head)+'.'+String(shead);
                            let sid='heading'+String(paradata);
                            let desct='description'+String(paradata);
                            let td = 'targetdate' + String(paradata);
                            let mf = 'markeofficer' + String(paradata);
                            let chk = 'check' + String(paradata);
                            let remark = 'remarks' + String(paradata);
  
                            var remarkss = document.getElementById(remark).value;
                            var descripts = document.getElementById(desct).value;
                            var val1 = document.getElementById(sid).value;
                            var tddate = document.getElementById(td).value;
                            let chk_val = document.getElementById(chk)
                            if (chk_val.checked == true){
                                var checkbox = '1'
                            }
                            else if (chk_val.checked == false){
      
                              checkbox = '0'
                            }
  
                            var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                            let custom_info = document.getElementById(mf).getAttribute('custom-info');
                            let myinfo = []
                            if(custom_info !='')
                                {
                                  (JSON.parse(custom_info)).forEach(element => {
                                    myinfo.push(element.selected_action)
                                  });
                                }
                              
                            
                            let table_det=[];
                            if(table_data.includes(String(paradata)))
                            {
                                  let tableid = 'tblspan'+String(paradata);
                                  var oTable = document.getElementById(tableid);
                                  var rowLength = oTable.rows.length;
                                  for (ig = 0; ig < rowLength; ig++){
                                    table_det1=[]
                                    var oCells = oTable.rows.item(ig).cells;
                                    var cellLength = oCells.length;
                                    for(var jg = 0; jg < cellLength; jg++){
                                        var cellVal = oCells.item(jg).children[0].value;
                                        table_det1.push(cellVal);
                                        // if(cellVal =='')
                                        // {
                                        //   alert('Please fill Table Data');
                                        //   return false;
                                        // }
                                    }
                                    table_det.push(table_det1)
                                  }
                            }
                            let tableid='table'+ headid;
                            ar[tableid]=table_det;


                            let sid1='observation'+headid;
                            let td1 = 'targetdate' + headid;
                            let mf1 = 'markeofficer' + headid;
                            let chk1 = 'check' + headid;
                            let rem1 = 'remarks' + headid;
                            let desc1 = 'description' + headid;
                            ar[rem1]=remarkss    
                            ar[sid1]=val1
                            ar[td1]=tddate
                            ar[mf1]=officer_val
                            ar[chk1]=checkbox
                            ar[desc1]=descripts
                            rem1 = 'myinfo' + headid;
                            ar[rem1]=myinfo;
                          } 

                          else
                          {
                            sshead++;
                            headid = String(head)+'.'+String(shead)+'.'+String(sshead);
                            let ssid='heading'+String(paradata);
                            let td = 'targetdate' + String(paradata);
                            let mf = 'markeofficer' + String(paradata);
                            let chk = 'check' + String(paradata);
                            let remark = 'remarks' + String(paradata);
  
                            var val2 = document.getElementById(ssid).value;
                            var remarkss = document.getElementById(remark).value;
                            var tddate = document.getElementById(td).value;
                            let chk_val = document.getElementById(chk)
                            if (chk_val.checked == true){
                                var checkbox = '1'
                            }
                            else if (chk_val.checked == false){
      
                              checkbox = '0'
                            }
  
                            var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                            let custom_info = document.getElementById(mf).getAttribute('custom-info');
                            let myinfo = []
                            if(custom_info !='')
                                {
                                  (JSON.parse(custom_info)).forEach(element => {
                                    myinfo.push(element.selected_action)
                                  });
                                }
                            
                                
                            let table_det=[];
                            if(table_data.includes(String(paradata)))
                            {
                                  let tableid = 'tblspan'+String(paradata);
                                  var oTable = document.getElementById(tableid);
                                  var rowLength = oTable.rows.length;
                                  for (ig = 0; ig < rowLength; ig++){
                                    table_det1=[]
                                    var oCells = oTable.rows.item(ig).cells;
                                    var cellLength = oCells.length;
                                    for(var jg = 0; jg < cellLength; jg++){
                                        var cellVal = oCells.item(jg).children[0].value;
                                        table_det1.push(cellVal);
                                        // if(cellVal =='')
                                        // {
                                        //   alert('Please fill Table Data');
                                        //   return false;
                                        // }
                                    }
                                    table_det.push(table_det1)
                                  }
                            }
                            let tableid='table'+ headid;
                            ar[tableid]=table_det;


                            let ssid1='subdes'+headid;
                            let td1 = 'targetdate' + headid;
                            let mf1 = 'markeofficer' + headid;
                            let chk1 = 'check' + headid;
                            let rem1 = 'remarks' + headid;
                            ar[rem1]=remarkss    
                            ar[td1]=tddate
                            ar[mf1]=officer_val
                            ar[chk1]=checkbox
                            ar[ssid1]=val2
                            rem1 = 'myinfo' + headid;
                            ar[rem1]=myinfo;
                          }
                          
                          myar1.push(String(headid))
                      }
                    }
                  if(myar1.length == 0)
                    continue;
                  count++;
                  ar1[String(count)]=ar
                  myarr2[String(count)]=myar1
                }
           
              var final_p=JSON.stringify(ar1)
              var id_final = JSON.stringify(myarr2)
              let final_img=[],temp_img=[];
              for(let jk=0;jk<img_ref_no.length;jk++)
              {
                temp_img=[]
                let sel_id, txt_id;
                sel_id = document.getElementById('select_img_'+img_ref_no[jk]).value;
                txt_id = document.getElementById('img_text_'+img_ref_no[jk]).value;
                if(sel_id == '')
                {
                  alert('select Reference number')
                  $('#select_img_'+img_ref_no[jk]).focus();
                  return false;
                }
                if(txt_id == '')
                {
                  alert('select Image')
                  $('#img_text_'+img_ref_no[jk]).focus();
                  return false;
                }
                if(!full_array.includes(sel_id))
                {
                  alert('select Proper reference number')
                  $('#select_img_'+img_ref_no[jk]).focus();
                  return false;
                }
                temp_img.push(sel_id);
                temp_img.push(txt_id);
                final_img.push(temp_img);
              }
              final_img = JSON.stringify(final_img);
             
              let data1 = {
                present: JSON.stringify($('#officer').val()),
                mdate: $('#mdate').val(),
                type: type,
                titleMOM: encryptWithAES(titleMOM),
                final_partinspected:encryptWithAES(final_p),
                id_partinspected:id_final,
                send_to: document.getElementById('copyto').getAttribute('custom-offic'),
                send_desig: document.getElementById('copyto').value,
                del_array_data:JSON.stringify(full_array_del),
                inspection_no : $('#inspection_id_edit').val(),
                final_img: final_img,
                sttninsp: sttninsp,
                desiginsp : desiginsp,
                ofcnameinsp : ofcnameinsp,
                csrfmiddlewaretoken: '{{ csrf_token }}'
              };
            
                    $.ajax({
                              type: 'POST',
                              url: "{% url 'create_rbmom_details' %}",
                              dataType: 'json',
                              data: data1,
                                success: function (response) {
                                  alert("Record Saved with MOM Note No: " + response.note_no);
                                  $("#submit").attr("disabled", false);
                                  window.location.href = '{% url "mom_doneby_list1" %}';
                              },
                              error: function (exception) {
                                  alert("An error occured while saving the record!");
                                  $("#submit").attr("disabled", false);
                              }
                  
              }); 
       
        
            }
       
  
  
function chkvalidation()
    {
              del_array = del_array.filter(onlyUnique);
              var table = document.getElementById("addworkmech");
              var present = $('#officer').val();
              var mom_date = $('#mdate').val();
              var copyto = $('#copyto').val();
              var titleMOM = $('#titleMOM').val();
              var type = $('#type').val();
  
              if (titleMOM == '' || titleMOM == null) {
                  alert("Please enter title for this MOM!")
                  return false;
              }
              if (type == '' || type == null) {
                  alert("Please Select Type of MOM!")
                  return false;
              }
              
              if (present == '' || present == null) {
              alert("Please Select Officer's present in MOM!")
              return false;
              }
  
              if (mom_date == '' || mom_date == undefined) {
                  alert("Please fill Date of MOM!")
                  return false;
              }
              
                hli = 0,full_array=[];
                let paradata;
                
      
                let ar1 = {};
                let myarr2 = {};
           
                let head = 0,shead, sshead,headid='',count=0;
  
                hli = 0,full_array=[],full_array_del=[];
                for(let i=0;i<table.rows.length;i++)
                {
                  if(table.rows[i].cells[0].innerHTML == 'P')
                    hli++;
                  full_array.push(table.rows[i].cells[1].innerHTML)

                  if(table.rows[i].cells[1].classList.contains('strikeout'))
                  {
                    full_array_del.push(table.rows[i].cells[1].innerHTML)
                  }
                }
                
                for(let i=1; i<=hli; i++){
                  shead =0;
                  sshead=0;
                  let ar ={}
                  let myar1 = []
                  
                  for(let j=0; j<full_array.length; j++)
                  {
                    paradata = para_array[j] 
                      
                      if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.')
                      { 
                          let temp = full_array[j].split('.')
                          if(temp.length == 1){
                            
                            shead =0;
                            sshead =0;
                            head++;
                            headid = String(head);
                            let hid='heading'+ String(paradata);
                            let hid1='heading'+ headid;
                            var val = document.getElementById(hid).value;
                            if(val.trim() == '')
                            {
                              alert("Heading can't be empty");
                              return false;
                            }
                            ar[hid1]=val
                            d1_test = full_array[j]+'.'
                            
                            let table_det=[];
                            if(table_data.includes(String(paradata)))
                            {
                                  let tableid = 'tblspan'+String(paradata);
                                  var oTable = document.getElementById(tableid);
                                  var rowLength = oTable.rows.length;
                                  for (ig = 0; ig < rowLength; ig++){
                                    table_det1=[]
                                    var oCells = oTable.rows.item(ig).cells;
                                    var cellLength = oCells.length;
                                    for(var jg = 0; jg < cellLength; jg++){
                                        var cellVal = oCells.item(jg).children[0].value;
                                        table_det1.push(cellVal);
                                        if(cellVal =='')
                                        {
                                          alert('Please fill Table Data');
                                          return false;
                                        }
                                    }
                                    table_det.push(table_det1)
                                  }
                            }
                            let tableid='table'+ headid;
                            ar[tableid]=table_det;



                          d2_test = 'Yes'
                          for(iv=j+1;iv<table.rows.length;iv++)
                            {
                              if(table.rows[iv].cells[0].innerHTML == 'P')
                              {
                                break;
                              }
                              if(del_array.includes(para_array[iv]))
                              {
                                d2_test = 'Yes'
                              }
                              else
                              {
                                d2_test ='No'
                                break
                              }
                            }
  
                            if(d2_test == 'No')
                            {
                              a=1;
                            }
                            else
                            {
      
      
                                let td = 'targetdate' + String(paradata);
                                let mf = 'markeofficer' + String(paradata);
                                let chk = 'check' + String(paradata);
                                let remark = 'remarks' + String(paradata);
                                var tddate = document.getElementById(td).value;
                                let chk_val = document.getElementById(chk)
                                var remarkss = document.getElementById(remark).value;
  
                                if (chk_val.checked == true){
                                    var checkbox = '1'
                                }
                                else if (chk_val.checked == false){
      
                                  checkbox = '0'
                                }
                                
                                var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                                
                                let custom_info = document.getElementById(mf).getAttribute('custom-info');
                                let myinfo = []
                                if(custom_info !='')
                                    {
                                      (JSON.parse(custom_info)).forEach(element => {
                                        myinfo.push(element.selected_action)
                                      });
                                    }
                                
                                
                                let td1 = 'targetdate' + headid;
                                let mf1 = 'markeofficer' + headid;
                                let chk1 = 'check' + headid;
                                let rem1 = 'remarks' + headid;
                                ar[td1]=tddate
                                ar[mf1]=officer_val
                                ar[chk1]=checkbox 
                                ar[rem1]=remarkss  
                                rem1 = 'myinfo' + headid;
                            ar[rem1]=myinfo;     
                            }
    
                          }
                          else if(temp.length == 2){
                            sshead=0;
                            shead++;
                            headid = String(head)+'.'+String(shead);
                            let sid='heading'+String(paradata);
                            let desct='description'+String(paradata);
                            let td = 'targetdate' + String(paradata);
                            let mf = 'markeofficer' + String(paradata);
                            let chk = 'check' + String(paradata);
                            let remark = 'remarks' + String(paradata);
  
                            var remarkss = document.getElementById(remark).value;
                            var descripts = document.getElementById(desct).value;
                            var val1 = document.getElementById(sid).value;
                            if(val1.trim() == '')
                            {
                              alert("Sub-heading can't be empty");
                              return false;
                            }
                            var tddate = document.getElementById(td).value;
                            let chk_val = document.getElementById(chk)
                            if (chk_val.checked == true){
                                var checkbox = '1'
                            }
                            else if (chk_val.checked == false){
      
                              checkbox = '0'
                            }
  
                            var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                            let custom_info = document.getElementById(mf).getAttribute('custom-info');
                            let myinfo = []
                            if(custom_info !='')
                                {
                                  (JSON.parse(custom_info)).forEach(element => {
                                    myinfo.push(element.selected_action)
                                  });
                                }
                              
                            
                            let table_det=[];
                            if(table_data.includes(String(paradata)))
                            {
                                  let tableid = 'tblspan'+String(paradata);
                                  var oTable = document.getElementById(tableid);
                                  var rowLength = oTable.rows.length;
                                  for (ig = 0; ig < rowLength; ig++){
                                    table_det1=[]
                                    var oCells = oTable.rows.item(ig).cells;
                                    var cellLength = oCells.length;
                                    for(var jg = 0; jg < cellLength; jg++){
                                        var cellVal = oCells.item(jg).children[0].value;
                                        table_det1.push(cellVal);
                                        if(cellVal =='')
                                        {
                                          alert('Please fill Table Data');
                                          return false;
                                        }
                                    }
                                    table_det.push(table_det1)
                                  }
                            }
                            let tableid='table'+ headid;
                            ar[tableid]=table_det;


                            let sid1='observation'+headid;
                            let td1 = 'targetdate' + headid;
                            let mf1 = 'markeofficer' + headid;
                            let chk1 = 'check' + headid;
                            let rem1 = 'remarks' + headid;
                            let desc1 = 'description' + headid;
                            ar[rem1]=remarkss    
                            ar[sid1]=val1
                            ar[td1]=tddate
                            ar[mf1]=officer_val
                            ar[chk1]=checkbox
                            ar[desc1]=descripts
                            rem1 = 'myinfo' + headid;
                            ar[rem1]=myinfo;
                          } 

                          else
                          {
                            sshead++;
                            headid = String(head)+'.'+String(shead)+'.'+String(sshead);
                            let ssid='heading'+String(paradata);

                            let td = 'targetdate' + String(paradata);
                            let mf = 'markeofficer' + String(paradata);
                            let chk = 'check' + String(paradata);
                            let remark = 'remarks' + String(paradata);
  
                            var val2 = document.getElementById(ssid).value;
                            if(val2.trim() == '')
                            {
                              alert("Sub Sub-heading can't be empty");
                              return false;
                            }
                            var remarkss = document.getElementById(remark).value;
                            var tddate = document.getElementById(td).value;
                            let chk_val = document.getElementById(chk)
                            if (chk_val.checked == true){
                                var checkbox = '1'
                            }
                            else if (chk_val.checked == false){
      
                              checkbox = '0'
                            }
  
                            var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                            let custom_info = document.getElementById(mf).getAttribute('custom-info');
                            let myinfo = []
                            if(custom_info !='')
                                {
                                  (JSON.parse(custom_info)).forEach(element => {
                                    myinfo.push(element.selected_action)
                                  });
                                }
                            
                                
                            let table_det=[];
                            if(table_data.includes(String(paradata)))
                            {
                                  let tableid = 'tblspan'+String(paradata);
                                  var oTable = document.getElementById(tableid);
                                  var rowLength = oTable.rows.length;
                                  for (ig = 0; ig < rowLength; ig++){
                                    table_det1=[]
                                    var oCells = oTable.rows.item(ig).cells;
                                    var cellLength = oCells.length;
                                    for(var jg = 0; jg < cellLength; jg++){
                                        var cellVal = oCells.item(jg).children[0].value;
                                        table_det1.push(cellVal);
                                        if(cellVal =='')
                                        {
                                          alert('Please fill Table Data');
                                          return false;
                                        }
                                    }
                                    table_det.push(table_det1)
                                  }
                            }
                            let tableid='table'+ headid;
                            ar[tableid]=table_det;


                            let ssid1='subdes'+headid;
                            let td1 = 'targetdate' + headid;
                            let mf1 = 'markeofficer' + headid;
                            let chk1 = 'check' + headid;
                            let rem1 = 'remarks' + headid;
                            ar[rem1]=remarkss    
                            ar[td1]=tddate
                            ar[mf1]=officer_val
                            ar[chk1]=checkbox
                            ar[ssid1]=val2
                            rem1 = 'myinfo' + headid;
                            ar[rem1]=myinfo;
                          }
                          
                          myar1.push(String(headid))
                        }
                    }
                  if(myar1.length == 0)
                    continue;
                  count++;
                  ar1[String(count)]=ar
                  myarr2[String(count)]=myar1
                }
           
                 
          document.getElementById('submit').click();
    }
  

function Savedraft_data(saveType)
{ 
  
  
              del_array = del_array.filter(onlyUnique);
              var table = document.getElementById("addworkmech");
              var present = $('#officer').val();
              var mom_date = $('#mdate').val();
              var copyto = $('#copyto').val();
              var titleMOM = $('#titleMOM').val();
              var type = $('#type').val();
  
              if (titleMOM == '' || titleMOM == null) {
                  alert("Please enter title for this MOM!")
                  return false;
              }
              if (type == '' || type == null) {
                  alert("Please Select Type of MOM!")
                  return false;
              }
              
              if (present == '' || present == null) {
              alert("Please Select Officer's present in MOM!")
              return false;
              }
  
              if (mom_date == '' || mom_date == undefined) {
                  alert("Please fill Date of MOM!")
                  return false;
              }
              let sttninsp = $('#sttninsp').val();   
              let desiginsp = $('#desiginsp').val();
              let ofcnameinsp = $('#ofcnameinsp').val();
              
                hli = 0,full_array=[];
                let paradata;
                
      
                let ar1 = {};
                let myarr2 = {};
           
                let head = 0,shead, sshead,headid='',count=0;
  
                hli = 0,full_array=[],full_array_del=[];
                for(let i=0;i<table.rows.length;i++)
                {
                  if(table.rows[i].cells[0].innerHTML == 'P')
                    hli++;
                  full_array.push(table.rows[i].cells[1].innerHTML)

                  if(table.rows[i].cells[1].classList.contains('strikeout'))
                  {
                    full_array_del.push(table.rows[i].cells[1].innerHTML)
                  }
                }
                
                for(let i=1; i<=hli; i++){
                  shead =0;
                  sshead=0;
                  let ar ={}
                  let myar1 = []
                  
                  for(let j=0; j<full_array.length; j++)
                  {
                    paradata = para_array[j] 
                      
                      if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.')
                      { 
                          let temp = full_array[j].split('.')
                          if(temp.length == 1){
                            
                            shead =0;
                            sshead =0;
                            head++;
                            headid = String(head);
                            let hid='heading'+ String(paradata);
                            let hid1='heading'+ headid;
                            var val = document.getElementById(hid).value;
                            ar[hid1]=val
                            d1_test = full_array[j]+'.'
                            
                            let table_det=[];
                            if(table_data.includes(String(paradata)))
                            {
                                  let tableid = 'tblspan'+String(paradata);
                                  var oTable = document.getElementById(tableid);
                                  var rowLength = oTable.rows.length;
                                  for (ig = 0; ig < rowLength; ig++){
                                    table_det1=[]
                                    var oCells = oTable.rows.item(ig).cells;
                                    var cellLength = oCells.length;
                                    for(var jg = 0; jg < cellLength; jg++){
                                        var cellVal = oCells.item(jg).children[0].value;
                                        table_det1.push(cellVal);
                                        // if(cellVal =='')
                                        // {
                                        //   alert('Please fill Table Data');
                                        //   return false;
                                        // }
                                    }
                                    table_det.push(table_det1)
                                  }
                            }
                            let tableid='table'+ headid;
                            ar[tableid]=table_det;



                          d2_test = 'Yes'
                          for(iv=j+1;iv<table.rows.length;iv++)
                            {
                              if(table.rows[iv].cells[0].innerHTML == 'P')
                              {
                                break;
                              }
                              if(del_array.includes(para_array[iv]))
                              {
                                d2_test = 'Yes'
                              }
                              else
                              {
                                d2_test ='No'
                                break
                              }
                            }
  
                            if(d2_test == 'No')
                            {
                              a=1;
                            }
                            else
                            {
      
      
                                let td = 'targetdate' + String(paradata);
                                let mf = 'markeofficer' + String(paradata);
                                let chk = 'check' + String(paradata);
                                let remark = 'remarks' + String(paradata);
                                var tddate = document.getElementById(td).value;
                                let chk_val = document.getElementById(chk)
                                var remarkss = document.getElementById(remark).value;
  
                                if (chk_val.checked == true){
                                    var checkbox = '1'
                                }
                                else if (chk_val.checked == false){
      
                                  checkbox = '0'
                                }
                                
                                var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                                
                                let custom_info = document.getElementById(mf).getAttribute('custom-info');
                                let myinfo = []
                                if(custom_info !='')
                                    {
                                      (JSON.parse(custom_info)).forEach(element => {
                                        myinfo.push(element.selected_action)
                                      });
                                    }
                                
                                
                                let td1 = 'targetdate' + headid;
                                let mf1 = 'markeofficer' + headid;
                                let chk1 = 'check' + headid;
                                let rem1 = 'remarks' + headid;
                                ar[td1]=tddate
                                ar[mf1]=officer_val
                                ar[chk1]=checkbox 
                                ar[rem1]=remarkss  
                                rem1 = 'myinfo' + headid;
                            ar[rem1]=myinfo;     
                            }
    
                          }
                          else if(temp.length == 2){
                            sshead=0;
                            shead++;
                            headid = String(head)+'.'+String(shead);
                            let sid='heading'+String(paradata);
                            let desct='description'+String(paradata);
                            let td = 'targetdate' + String(paradata);
                            let mf = 'markeofficer' + String(paradata);
                            let chk = 'check' + String(paradata);
                            let remark = 'remarks' + String(paradata);
  
                            var remarkss = document.getElementById(remark).value;
                            var descripts = document.getElementById(desct).value;
                            var val1 = document.getElementById(sid).value;
                            var tddate = document.getElementById(td).value;
                            let chk_val = document.getElementById(chk)
                            if (chk_val.checked == true){
                                var checkbox = '1'
                            }
                            else if (chk_val.checked == false){
      
                              checkbox = '0'
                            }
  
                            var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                            let custom_info = document.getElementById(mf).getAttribute('custom-info');
                            let myinfo = []
                            if(custom_info !='')
                                {
                                  (JSON.parse(custom_info)).forEach(element => {
                                    myinfo.push(element.selected_action)
                                  });
                                }
                              
                            
                            let table_det=[];
                            if(table_data.includes(String(paradata)))
                            {
                                  let tableid = 'tblspan'+String(paradata);
                                  var oTable = document.getElementById(tableid);
                                  var rowLength = oTable.rows.length;
                                  for (ig = 0; ig < rowLength; ig++){
                                    table_det1=[]
                                    var oCells = oTable.rows.item(ig).cells;
                                    var cellLength = oCells.length;
                                    for(var jg = 0; jg < cellLength; jg++){
                                        var cellVal = oCells.item(jg).children[0].value;
                                        table_det1.push(cellVal);
                                        // if(cellVal =='')
                                        // {
                                        //   alert('Please fill Table Data');
                                        //   return false;
                                        // }
                                    }
                                    table_det.push(table_det1)
                                  }
                            }
                            let tableid='table'+ headid;
                            ar[tableid]=table_det;


                            let sid1='observation'+headid;
                            let td1 = 'targetdate' + headid;
                            let mf1 = 'markeofficer' + headid;
                            let chk1 = 'check' + headid;
                            let rem1 = 'remarks' + headid;
                            let desc1 = 'description' + headid;
                            ar[rem1]=remarkss    
                            ar[sid1]=val1
                            ar[td1]=tddate
                            ar[mf1]=officer_val
                            ar[chk1]=checkbox
                            ar[desc1]=descripts
                            rem1 = 'myinfo' + headid;
                            ar[rem1]=myinfo;
                          } 

                          else
                          {
                            sshead++;
                            headid = String(head)+'.'+String(shead)+'.'+String(sshead);
                            let ssid='heading'+String(paradata);
                            let td = 'targetdate' + String(paradata);
                            let mf = 'markeofficer' + String(paradata);
                            let chk = 'check' + String(paradata);
                            let remark = 'remarks' + String(paradata);
  
                            var val2 = document.getElementById(ssid).value;
                            var remarkss = document.getElementById(remark).value;
                            var tddate = document.getElementById(td).value;
                            let chk_val = document.getElementById(chk)
                            if (chk_val.checked == true){
                                var checkbox = '1'
                            }
                            else if (chk_val.checked == false){
      
                              checkbox = '0'
                            }
  
                            var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                            let custom_info = document.getElementById(mf).getAttribute('custom-info');
                            let myinfo = []
                            if(custom_info !='')
                                {
                                  (JSON.parse(custom_info)).forEach(element => {
                                    myinfo.push(element.selected_action)
                                  });
                                }
                            
                                
                            let table_det=[];
                            if(table_data.includes(String(paradata)))
                            {
                                  let tableid = 'tblspan'+String(paradata);
                                  var oTable = document.getElementById(tableid);
                                  var rowLength = oTable.rows.length;
                                  for (ig = 0; ig < rowLength; ig++){
                                    table_det1=[]
                                    var oCells = oTable.rows.item(ig).cells;
                                    var cellLength = oCells.length;
                                    for(var jg = 0; jg < cellLength; jg++){
                                        var cellVal = oCells.item(jg).children[0].value;
                                        table_det1.push(cellVal);
                                        // if(cellVal =='')
                                        // {
                                        //   alert('Please fill Table Data');
                                        //   return false;
                                        // }
                                    }
                                    table_det.push(table_det1)
                                  }
                            }
                            let tableid='table'+ headid;
                            ar[tableid]=table_det;


                            let ssid1='subdes'+headid;
                            let td1 = 'targetdate' + headid;
                            let mf1 = 'markeofficer' + headid;
                            let chk1 = 'check' + headid;
                            let rem1 = 'remarks' + headid;
                            ar[rem1]=remarkss    
                            ar[td1]=tddate
                            ar[mf1]=officer_val
                            ar[chk1]=checkbox
                            ar[ssid1]=val2
                            rem1 = 'myinfo' + headid;
                            ar[rem1]=myinfo;
                          }
                          
                          myar1.push(String(headid))
                        }
                    }
                  if(myar1.length == 0)
                    continue;
                  count++;
                  ar1[String(count)]=ar
                  myarr2[String(count)]=myar1
                }
           
                var final_p=JSON.stringify(ar1)
                var id_final = JSON.stringify(myarr2)
               
                let final_img=[],temp_img=[];
                for(let jk=0;jk<img_ref_no.length;jk++)
                {
                  temp_img=[]
                  let sel_id, txt_id;
                  sel_id = document.getElementById('select_img_'+img_ref_no[jk]).value;
                  txt_id = document.getElementById('img_text_'+img_ref_no[jk]).value;
                  if(sel_id == '')
                  {
                    
                    $('#select_img_'+img_ref_no[jk]).focus();
                    continue;
                  }
                  if(txt_id == '')
                  {
                   
                    $('#img_text_'+img_ref_no[jk]).focus();
                    continue;
                  }
                  if(!full_array.includes(sel_id))
                  {
                   
                    $('#select_img_'+img_ref_no[jk]).focus();
                    continue;
                  }
                  temp_img.push(sel_id);
                  temp_img.push(txt_id);
                  final_img.push(temp_img);
                }
                final_img = JSON.stringify(final_img);
        
              
            // return false;
              let data1 = {
                present: JSON.stringify($('#officer').val()),
                mdate: $('#mdate').val(),
                type: type,
                titleMOM: encryptWithAES(titleMOM),
                final_partinspected:encryptWithAES(final_p),
                id_partinspected:id_final,
                send_to: document.getElementById('copyto').getAttribute('custom-offic'),
                send_desig: document.getElementById('copyto').value,
                del_array_data:JSON.stringify(full_array_del),
                inspection_no : $('#inspection_id_edit').val(),
                final_img: final_img,
                sttninsp: sttninsp,
                desiginsp : desiginsp,
                ofcnameinsp : ofcnameinsp,
                csrfmiddlewaretoken: '{{ csrf_token }}'
              };
            
                    $.ajax({
                              type: 'POST',
                                url: "{% url 'draft_rbmom_details' %}",
                                dataType: 'json',
                                data: data1,
                                success: function (response) {
                                  $('#inspection_id_edit').val(response.note_no)
                                  if(saveType == 'continue')
                                    alert("Record Saved as Draft");
                                  else if(saveType == 'exit')
                                  {
                                    alert("Record Saved as Draft");
                                    window.location.href = '{% url "draft_mom_doneby_list" %}';
                                  }
                              },
                              error: function (exception) {
                                  alert("An error occured while saving the record!");
                                  $("#draft_submit").attr("disabled", false);
                                  // window.location.reload();
                              }
                  
              });      
        }
  
  </script>
  

<!-- image upload -->
<script>

  $('#table_img').hide();
  
  var img_ref_no = [],img_count=0, set_option_val = [];
  function set_option_value(id)
    {
      let tableid = document.getElementById('addworkmech');
      let id1 = id.substring(11,id.length),set_option;
      set_option = set_option_val[parseInt(id1)-1]
      if(set_option == 0)
      {
        set_option = 1;
        $('#'+id).empty();
        let row = '',ref_no='';
        row += `<option value="" selected disabled hidden>Select refrence number</option>`;
        for(let i =0; i<tableid.rows.length;i++)
        {
          if(tableid.rows[i].cells[0].innerHTML == 'S'){
          
            ref_no = tableid.rows[i].cells[2].innerHTML;
            continue;
          
          }
          if(ref_no!='')
          {
          if(((tableid.rows[i].cells[2].innerHTML).split('.')).length == 1)
            row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> ${ tableid.rows[i].cells[1].innerHTML}</option>`;
          else if(((tableid.rows[i].cells[1].innerHTML).split('.')).length == 2)
            row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
          else 
              row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;&nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
          }
          else{
            if(((tableid.rows[i].cells[2].innerHTML).split('.')).length == 1)
            row += `<option value="${ tableid.rows[i].cells[1].innerHTML}"> ${tableid.rows[i].cells[1].innerHTML}</option>`;
          else if(((tableid.rows[i].cells[1].innerHTML).split('.')).length == 2)
            row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
          else 
              row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;&nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
          }
          }
        $('#'+id).append(row);
      }
      set_option_val[parseInt(id1)-1] = set_option;
    }
  function preview_img(id)
  {
    let id1 = 'frame'+id;
    var x = document.getElementById(id1);
    if (x.style.display === "none") {
      x.style.display = "block";
    } else {
      x.style.display = "none";
    }
  }
  function preview(id)
  {
    // upload_img_r(id);
    let id1 = 'frame'+id;
    let do_file = 'ipfile_'+id,btn_do_file = 'btn_img_'+id
    document.getElementById(id1).src="";
    const fi = document.getElementById(do_file);
  
      if (fi.files.length > 0) {
        for (let i = 0; i <= fi.files.length - 1; i++) {
  
          const fsize = fi.files.item(i).size;
          const file = Math.round((fsize / 1024));
          if (file > 100) {
            document.getElementById(do_file).value='';
            alert("File too Big, please select a file less than 100KB");
          }
          else {
            // let btn_do_file = 'btn_img_'+id, sel_text = 'ipfile_'+id,txt_img = 'img_text_'+id,frameid='frame'+id,file = "";
            // document.getElementById(btn_do_file).style.backgroundColor='blue';
            // document.getElementById(sel_text).value = file;
            // document.getElementById(txt_img).value = file;
            // //document.getElementById(frameid).src = file;
            // document.getElementById(btn_do_file).disabled = false;
            document.getElementById(btn_do_file).style.backgroundColor='blue';
            document.getElementById(btn_do_file).disabled = false;
            document.getElementById(id1).style.display = "none";
      
            document.getElementById(id1).src=URL.createObjectURL(event.target.files[0]);
          }
        }
      }
  }
  function add_row_image()
   {
      let tableid = document.getElementById('addworkmech');
      let img_row_count = document.getElementById('table_img').rows.length;
      if(img_row_count == 6)
      {
        alert(' Maximum Number of image to add is 5');
        return false;
      }
  
      img_count ++;
      set_option_val.push(0);
      
      let row = '<tr>';
      row += `<td style="width:10%"><select id="select_img_${img_count}" onclick="set_option_value(this.id)" style="height:40px;"><option value="" selected disabled hidden>Select refrence number</option>`;
      for(let i =0; i<tableid.rows.length;i++)
      {
          if(((tableid.rows[i].cells[1].innerHTML).split('.')).length == 1)
            row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> ${tableid.rows[i].cells[1].innerHTML}</option>`;
          else if(((tableid.rows[i].cells[1].innerHTML).split('.')).length == 2)
            row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
          else 
              row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;&nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
      }
      row += `</select></td>`;
      row += `<td style="width:40%"> 
        <div class="row form-group">
          <div class="col-9">
        <input type="file" id="ipfile_${img_count}" name="ipfile_${img_count}" class="form-control" onchange="preview('${img_count}')" accept="image/jpeg, image/x-png" >
        </div> <div class="col-3">
        <input type="button" id="btn_img_${img_count}" class="form-control" onclick="upload_img('${img_count}')" style="background-color:blue;height:40px;width:100%;" value="Upload Image" >          
      </div></div>
        <p style="color: blue;">Accepted types:  .png, .jpeg, .jpg and max file size: 100 KB</p>           
                  
                  
                  <input type="button" id="btn_img_r${img_count}" onclick="upload_img_r('${img_count}')" style="background-color:red;" value="Reset Image" hidden disabled>
  
                   <input type="text" id="img_text_${img_count}" value="" hidden>
                   
              </td>
              <td style="width:30%"> 
                
                   <img class="imgFrame" id="frame${img_count}"  src="" width="400px" height="280px" style="display:none;"/>
                 
                   <input type="button" onclick="preview_img('${img_count}')" style="background-color:blue;" value="Preview" hidden>
              </td>
              <td style="width:20%"> 
                   <input type="button" id="delete_img_${img_count}" class="form-control" onclick="delete_img(this)" style="background-color:red;height:40px;width:100%;" value="Delete">
              </td>
              `
      row += '</tr>';
      $('#table_img').append(row);
      //preview_img(img_count);
      img_ref_no.push(String(img_count));
      img_row_count = document.getElementById('table_img').rows.length;
      if(img_row_count > 1)
      {
        $('#table_img').show();
      }
    
   }
  function delete_img(btn) {
   
    
    let id=btn.id, id1 = id.substring(11,id.length);
    let img_row_count = document.getElementById('table_img').rows.length;
    if(img_row_count == 1)
    {
      alert(' Nothing to delete');
      return false;
    }
    
    for(let ij=0;ij<img_ref_no.length;ij++)
    { 
      if(id1 == String(img_ref_no[ij]))
      {
        let txt_img = 'img_text_'+id1,file_name = document.getElementById(txt_img).value;
        if(file_name != '')
              {
              var data= new FormData();
              data.append('file',file_name)
              data.append('csrfmiddlewaretoken',"{{csrf_token}}");
              data.append('op',"delete");
              $.ajax({
                  method: "POST",
                  url: "{% url 'upload_img' %}",
                  dataType: 'json',
                  processData:false,
                  contentType: false,
                  mimeType: 'multipart/form-data',
                  data: data,
                  success: function (response) {
                      file = "";
                  }
              });
            }
            break;
        
      }
  
    }
  
    var row = btn.parentNode.parentNode;
    row.parentNode.removeChild(row);
    img_row_count = document.getElementById('table_img').rows.length;
    if(img_row_count == 1)
      {
        $('#table_img').hide();
      }
      index = img_ref_no.indexOf(id1);
      if (index > -1) { 
        img_ref_no.splice(index, 1); 
      }
      
  }
  function upload_img_r(id)
  {
    let do_file = 'img_text_'+id, file_name = document.getElementById(do_file).value,sel_text = 'ipfile_'+id;
    let btn_do_file = 'btn_img_'+id, txt_img = 'img_text_'+id,frameid='frame'+id,btn_reset = 'btn_img_r'+id;
    if(file_name == '')
    {
      alert('Nothing to reset');
      return false;
    }
    var data= new FormData();
    data.append('file',file_name)
    data.append('csrfmiddlewaretoken',"{{csrf_token}}");
    data.append('op',"delete");
    $.ajax({
        method: "POST",
        url: "{% url 'upload_img' %}",
        dataType: 'json',
        processData:false,
        contentType: false,
        mimeType: 'multipart/form-data',
        data: data,
        success: function (response) {
            document.getElementById(btn_do_file).style.backgroundColor='blue';
            file = "";
            document.getElementById(sel_text).value = file;
            document.getElementById(txt_img).value = file;
            document.getElementById(frameid).src = file;
            document.getElementById(btn_do_file).disabled = false;
            document.getElementById(btn_reset).disabled = true;   
        }
    });
  
  }
  function upload_img(id)
  {
    let do_file = 'ipfile_'+id;
    let refNoId = 'select_img_'+id;
    if($('#'+refNoId).val() == null)
    {
      alert('Select Reference Number');
      return false;
    }
    if(document.getElementById(do_file).value == '')
    {
      alert('Select Image First');
      return false;
    }
    let btn_do_file = 'btn_img_'+id, txt_img = 'img_text_'+id,frameid='frame'+id,btn_reset = 'btn_img_r'+id;
    var data= new FormData();
    data.append('file',$('#'+do_file)[0].files[0])
    data.append('csrfmiddlewaretoken',"{{csrf_token}}");
    data.append('op',"upload");
    $.ajax({
        method: "POST",
        url: "{% url 'upload_img' %}",
        dataType: 'json',
        processData:false,
        contentType: false,
        mimeType: 'multipart/form-data',
        data: data,
        success: function (response) {
            alert("Image uploaded Successfully");
            document.getElementById(btn_do_file).style.backgroundColor='green';
            file = "/media/Inspection/" + response.file;
            document.getElementById(txt_img).value = file;
            document.getElementById(frameid).src = file;
            document.getElementById(btn_do_file).disabled = true;
            document.getElementById(btn_reset).disabled = false;
            preview_img(id);
  
            
            
        }
    });
  
  }
  
  
  
  </script>
  
  <script>
    function Updatedraft_data2(th)
    {
            del_array = del_array.filter(onlyUnique);
              var table = document.getElementById("addworkmech");
              var present = $('#officer').val();
              var mom_date = $('#mdate').val();
              var copyto = $('#copyto').val();
              var titleMOM = $('#titleMOM').val();
              var type = $('#type').val();
              let full_array_del=[],row='',head = 0,shead = 0, sshead = 0;
              for(let i=0;i<table.rows.length;i++)
                {
                  if(table.rows[i].cells[1].classList.contains('strikeout'))
                  {
                    full_array_del.push(table.rows[i].cells[1].innerHTML)
                  }
                }
         
              for(let i=0;i<table.rows.length;i++)
              {
                let count = table.rows[i].cells[7].innerHTML;
                console.log(count)
                let slno = table.rows[i].cells[1].innerHTML;
                let slno_length = slno.split('.'),hid,did,rem,td,pr,off,tbl;
                if(!full_array_del.includes(slno))
                {   
                  row +='<tr>';
                    hid = 'heading'+String(count);
                    did = 'description'+String(count);
                    rem = 'remarks'+String(count);
                    td = 'targetdate'+String(count);
                    pr = 'check'+String(count);
                    off = 'markeofficer'+String(count); 
                    tbl = 'tblspan'+String(count);
                  if(slno_length.length == 1)
                  {
                    head++;
                    shead = 0;
                    sshead = 0;
                    row +=`<td>${String(head)}</td>`;
                    row +=`<td>`;
                    try
                    {
                      row += document.getElementById(hid).value;
                    }
                    catch
                    {
                      row += ''
                    }
                    try
                    {
                      row += `<br> <br> Description : <br> ` + document.getElementById(did).value;
                    }
                    catch
                    {
                      row += ''
                    }

                    try
                    {
                 
                      let oTable = document.getElementById(tbl);
                      let rowLength = oTable.rows.length;
                      row +=`<table>`;
                      for (ig = 0; ig < rowLength; ig++)
                      {
                        row +=`<tr>`;
                        table_det1=[]
                        let oCells = oTable.rows.item(ig).cells;
                        let cellLength = oCells.length;
                        for(let jg = 0; jg < cellLength; jg++)
                        {
                          row +=`<td>${oCells.item(jg).children[0].value}</td>`;
                        }
                        row +=`</tr>`;
                        
                      }
                      row +=`</table>`
                    }
                    catch 
                    {
                      row +='';
                    }


                    try
                    {
                      if(document.getElementById(td).value != '')
                        row += `<br> <br> Target Date: ` + document.getElementById(td).value;
                      
                    }
                    catch
                    {
                      row += ''
                    }
                    try
                    {
                      
                      if(document.getElementById(pr).checked == true)
                        row += `<br> On Priority` ;
                    }
                    catch
                    {
                      row += ''
                    }
                  
                    row +=`</td><td>`;
                     
                      try
                    {
                       
                      
                      let custom_info = document.getElementById(off).getAttribute('custom-info');
                      let custom_key = JSON.parse(document.getElementById(off).getAttribute('custom-key'));
                      if(custom_info == '')
                      {
                        if(custom_key.length > 0){
                        row += 'For Action:'
                        for(let of1 = 0; of1<custom_key.length;of1++)
                        {
                          row += '<br>' + custom_key[of1]['desig']
                          if(of1 < custom_key.length -1)
                            row += ',';
                        }
                      }
                      } 
                      else 
                      {
                        let selected = ['info']
                        custom_info = JSON.parse(custom_info);
                        const info = custom_info.filter(({selected_action}) => selected.includes(selected_action));
                        selected = ['action']
                        const action = custom_info.filter(({selected_action}) => selected.includes(selected_action));
                        row += 'For Information:'
                        for(let of1 = 0; of1<info.length;of1++)
                        {
                          row += '<br>' + info[of1]['Designation']
                          if(of1 < info.length - 1)
                            row += ',';
                        }
                        row += '<br> For Action:'
                        for(let of1 = 0; of1<action.length;of1++)
                        {
                          row += '<br>' + action[of1]['Designation']
                          if(of1 < action.length - 1)
                            row += ',';
                        }

                      }
                      
                    }
                    catch
                    {
                      row += ''
                    }
                    
                    try
                    {
                      if(document.getElementById(rem).value != '')
                        row += `<br> Remarks: <br> ${document.getElementById(rem).value}`;
                      
                    }
                    catch
                    {
                      row += ''
                    }
                   
                    row +=`</td>`;
                  }
                  
                  else if(slno_length.length == 2)
                  {
                    
                    shead++;
                    sshead = 0;
                    row +=`<td>${String(head)+'.'+String(shead)}</td>`;
                    row +=`<td>`;
                    try
                    {
                      row += document.getElementById(hid).value;
                    }
                    catch
                    {
                      row += ''
                    }
                    try
                    {
                      if(document.getElementById(did).value != '')
                      row += `<br> <br> Description : <br> ` + document.getElementById(did).value;
                    }
                    catch
                    {
                      row += ''
                    }

                    try
                    {
                 
                      let oTable = document.getElementById(tbl);
                      let rowLength = oTable.rows.length;
                      row +=`<table>`;
                      for (ig = 0; ig < rowLength; ig++)
                      {
                        row +=`<tr>`;
                        table_det1=[]
                        let oCells = oTable.rows.item(ig).cells;
                        let cellLength = oCells.length;
                        for(let jg = 0; jg < cellLength; jg++)
                        {
                          row +=`<td>${oCells.item(jg).children[0].value}</td>`;
                        }
                        row +=`</tr>`;
                        
                      }
                      row +=`</table>`
                    }
                    catch 
                    {
                      row +='';
                    }


                    try
                    {
                      if(document.getElementById(td).value != '')
                        row += `<br> <br> Target Date: ` + document.getElementById(td).value;
                      
                    }
                    catch
                    {
                      row += ''
                    }

                    try
                    {
                      
                      if(document.getElementById(pr).checked == true)
                        row += `<br> On Priority` ;
                    }
                    catch
                    {
                      row += ''
                    }
                  
                   
                    row +=`</td><td>`;
                     
                      try
                    {
                       
                      
                      let custom_info = document.getElementById(off).getAttribute('custom-info');
                      let custom_key = JSON.parse(document.getElementById(off).getAttribute('custom-key'));
                      if(custom_info == '')
                      {
                        if(custom_key.length > 0){
                        row += 'For Action:'
                        for(let of1 = 0; of1<custom_key.length;of1++)
                        {
                          row += '<br>' + custom_key[of1]['desig']
                          if(of1 < custom_key.length -1)
                            row += ',';
                        }
                      }
                      } 
                      else 
                      {
                        let selected = ['info']
                        custom_info = JSON.parse(custom_info);
                        const info = custom_info.filter(({selected_action}) => selected.includes(selected_action));
                        selected = ['action']
                        const action = custom_info.filter(({selected_action}) => selected.includes(selected_action));
                        row += 'For Information:'
                        for(let of1 = 0; of1<info.length;of1++)
                        {
                          row += '<br>' + info[of1]['Designation']
                          if(of1 < info.length - 1)
                            row += ',';
                        }
                        row += '<br> For Action:'
                        for(let of1 = 0; of1<action.length;of1++)
                        {
                          row += '<br>' + action[of1]['Designation']
                          if(of1 < action.length - 1)
                            row += ',';
                        }

                      }
                      
                    }
                    catch
                    {
                      row += ''
                    }
                    
                    try
                    {
                      if(document.getElementById(rem).value != '')
                        row += `<br> Remarks: <br> ${document.getElementById(rem).value}`;
                      
                    }
                    catch
                    {
                      row += ''
                    }
                   
                    row +=`</td>`;
                  }
                  
                  else
                  {
                    
                    
                    sshead++;
                    row +=`<td>${String(head)+'.'+String(shead)+'.'+String(sshead)}</td>`;
                    row +=`<td>`;
                    try
                    {
                      row += document.getElementById(hid).value;
                    }
                    catch
                    {
                      row += ''
                    }
                    try
                    {
                      row += `<br> <br> Description : <br> ` + document.getElementById(did).value;
                    }
                    catch
                    {
                      row += ''
                    }

                    try
                    {
                 
                      let oTable = document.getElementById(tbl);
                      let rowLength = oTable.rows.length;
                      row +=`<table>`;
                      for (ig = 0; ig < rowLength; ig++)
                      {
                        row +=`<tr>`;
                        table_det1=[]
                        let oCells = oTable.rows.item(ig).cells;
                        let cellLength = oCells.length;
                        for(let jg = 0; jg < cellLength; jg++)
                        {
                          row +=`<td>${oCells.item(jg).children[0].value}</td>`;
                        }
                        row +=`</tr>`;
                        
                      }
                      row +=`</table>`
                    }
                    catch 
                    {
                      row +='';
                    }


                    try
                    {
                      if(document.getElementById(td).value != '')
                        row += `<br> <br> Target Date: ` + document.getElementById(td).value;
                      
                    }
                    catch
                    {
                      row += ''
                    }

                    try
                    {
                      
                      if(document.getElementById(pr).checked == true)
                        row += `<br> On Priority` ;
                    }
                    catch
                    {
                      row += ''
                    }
                  
                   
                    row +=`</td><td>`;
                     
                    try
                    {
                       
                      
                      let custom_info = document.getElementById(off).getAttribute('custom-info');
                      let custom_key = JSON.parse(document.getElementById(off).getAttribute('custom-key'));
                      if(custom_info == '')
                      {
                        if(custom_key.length > 0){
                        row += 'For Action:'
                        for(let of1 = 0; of1<custom_key.length;of1++)
                        {
                          row += '<br>' + custom_key[of1]['desig']
                          if(of1 < custom_key.length -1)
                            row += ',';
                        }
                      }
                      } 
                      else 
                      {
                        let selected = ['info']
                        custom_info = JSON.parse(custom_info);
                        const info = custom_info.filter(({selected_action}) => selected.includes(selected_action));
                        selected = ['action']
                        const action = custom_info.filter(({selected_action}) => selected.includes(selected_action));
                        row += 'For Information:'
                        for(let of1 = 0; of1<info.length;of1++)
                        {
                          row += '<br>' + info[of1]['Designation']
                          if(of1 < info.length - 1)
                            row += ',';
                        }
                        row += '<br> For Action:'
                        for(let of1 = 0; of1<action.length;of1++)
                        {
                          row += '<br>' + action[of1]['Designation']
                          if(of1 < action.length - 1)
                            row += ',';
                        }

                      }
                      
                    }
                    catch
                    {
                      row += ''
                    }
                    
                    try
                    {
                      if(document.getElementById(rem).value != '')
                        row += `<br> Remarks: <br> ${document.getElementById(rem).value}`;
                      
                    }
                    catch
                    {
                      row += ''
                    }
                   
                    row +=`</td>`;
                  }
                  
                  
                  row +='</tr>';
                }

                //count++;
              }

              $('#table2 tbody').empty();
              $('#table2 tbody').append(row);
              $('#head3').html(titleMOM);
              let accompany=$('#officer').val(),row1 = '';
              for(let i=0;i<accompany.length;i++)
              {
                row1 +=`${accompany[i]}`
                if(i < accompany.length -1)
                  row1+= ',<br>'
              }
              
              $('#acco').html(row1);

              accompany = $('#copyto').val(),row1 = '';
              if(accompany != '')
              {
                accompany = accompany.split(',')
                for(let i=0;i<accompany.length;i++)
                {
                  row1 +=`${accompany[i]}`
                  if(i < accompany.length -1)
                    row1 += ',<br>'
                }
              }
              $('#insp_desig').html(row1);

              $('#head6').html($('#ofcnameinsp').val());
              $('#head5').html('('+$('#desiginsp').val()+')');
              $('#head4').html($('#sttninsp').val());

              
              let imgId,imgSrc,imgDet='',imgSelId,imgFrame = document.querySelectorAll('.imgFrame'),counti=0,dataval;
              $('#imgViewShow').empty();
    
              for(let i =0; i<imgFrame.length;i++)
              {
                  imgId = $(imgFrame[i]).attr('id');
                  imgSelId = 'select_img_'+imgId.substring(5,imgId.length)
                  
                  if(document.getElementById(imgId).value != '' && !full_array_del.includes($("#"+imgSelId+" option:selected").text().trim()))
                  {
                    if(counti%2 == 0)
                      imgDet +=`<div class="container-fluid row text-center">`;

                      imgSrc = $(imgFrame[i]).attr('src');
                      dataval = $("#"+imgSelId+" option:selected").text().trim();
                      imgDet += `<div class="col-lg-6 text-center">
                      <img src=${imgSrc} width="600px" height="400px" />
                      <h5>Pic:${(i+1)} with reference to S.No. ${dataval}</h5>
                      </div>`

                    if(counti%2 != 0)
                      imgDet +=`</div>`;
                      counti++;
                    
                  }
              }
              $('#imgViewShow').append(imgDet);
              
              $('#head5dated').html($('#mdate').val());
           
      document.getElementById('viewmodalbtn').click();
    }

    function windowPrint(){ 
    var pCon = $('#printable').html();
    w=window.open();
    w.document.write(pCon);
    w.print();
    w.close();
 
  } 

  function clickSubmit2()
{
  document.getElementById('previewClose').click();
  document.getElementById('submit2').click();
}
  </script>

  <script>
    function encryptWithAES(message)
{
    var key ='AAAAAAAAAAAAAAAA'
    key = CryptoJS.enc.Utf8.parse(key);
    var iv = CryptoJS.enc.Utf8.parse('BBBBBBBBBBBBBBBB')
    var encrypted = CryptoJS.AES.encrypt(message, key, { iv: iv, mode: CryptoJS.mode.CBC});
    encrypted =encrypted.toString();
    return (encrypted)
}

function decryptWithAES(Base64CBC)
{
    var iv = CryptoJS.enc.Utf8.parse('BBBBBBBBBBBBBBBB');
    var key ='AAAAAAAAAAAAAAAA'
    key = CryptoJS.enc.Utf8.parse(key);
    var decrypted =  CryptoJS.AES.decrypt(Base64CBC, key, { iv: iv, mode: CryptoJS.mode.CBC});
    decrypted = decrypted.toString(CryptoJS.enc.Utf8);
    return (decrypted);   
}
  </script>
  
  
{% endblock %}  