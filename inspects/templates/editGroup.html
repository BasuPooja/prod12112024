{% load static %}

<head>
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">  
    <style>
        .wrap.active {
        display: block;
        visibility: visible;
        box-shadow: 2px 3px 16px silver;
        transition: all 600ms;
        transform: translateY(0px);
        transition: all 0.5s;
    }
    .wrap {
        position: fixed;
        overflow: hidden;
        top: 10%;
        right: 10%;
        bottom: 85px;
        left: 10%;
        padding: 12px;
        display: block !important;
        border-radius: 4px;
        transform: translateY(20px);
        transition: all 0.5s;
        visibility: hidden;
        z-index: 9999;
        height: 85vh;
    }
    
    .wrap-1.active {
        display: block;
        visibility: visible;
        box-shadow: 2px 3px 16px silver;
        transition: all 600ms;
        transform: translateY(0px);
        transition: all 0.5s;
    }
    .wrap-1 {
        position: fixed;
        overflow: hidden;
        top: 10%;
        right: 10%;
        bottom: 85px;
        left: 10%;
        padding: 12px;
        display: block !important;
        border-radius: 4px;
        transform: translateY(20px);
        transition: all 0.5s;
        visibility: hidden;
        z-index: 9999;
        height: 85vh;
    }
    .wrap.active .content,.wrap-1.active .content  {
        position: relative;
        z-index: 1;
        opacity: 1;
        transition: all 600ms cubic-bezier(0.55, 0.055, 0.675, 0.19);
    }
    .wrap .content, .wrap-1 .content {
        opacity: 0;
    }
    .wrap.active:before, .wrap-1.active:before {
        height: 2000px;
        width: 2000px;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        margin-left: -1000px;
        margin-top: -1000px;
        display: block;
        -webkit-transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
        transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
    }
    .wrap:before, .wrap-1:before {
        position: fixed;
        width: 1px;
        height: 1px;
        background: white;
        content: "";
        bottom: 10px;
        left: 50%;
        top: 95%;
        color: #fff;
        border-radius: 50%;
        -webkit-transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
        transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
    }
    .wrap::-webkit-scrollbar, .wrap-1::-webkit-scrollbar {
        width: 10px;  /* Remove scrollbar space */
        background: #dedede;
    }
    /* Optional: show position indicator in red */
    .wrap::-webkit-scrollbar-thumb,.wrap-1::-webkit-scrollbar-thumb {
        background: #FF0000;
    }
      </style>
      <style>
        
        .table-form td, th{
            border: none !important;
        }
        .sectionsRow thead tr th {
          width: 10%;
        }
      
        .select2-results__option[aria-selected=true] { 
        background-color: #dff0c3 !important;
        color:#000 !important;
       }
       
        .select2-selection--multiple:before {
          content: "";
          position: absolute;
          right: 7px;
          top: 42%;
          border-top: 5px solid #888;
          border-left: 4px solid transparent;
          border-right: 4px solid transparent;
      }
      
      .select2-selection__choice__remove{
        border: none;
    }
        .select2-search__field:placeholder-shown {
            width: 100% !important; 
        }
      </style>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{%static '/bootstrap-4.0.0/dist/css/bootstrap.min.css'%}"/> 
    <meta charset="UTF-8" />
    <meta name = "keywords" content = "Inspection, einspection, e-inspection, railway inspection, " />
    <meta name = "description" content = "einspection for IR officials" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% include 'inspects_staticProvider.html' %}
</head>
<body>
    <div class="container-fluid">
        
        <div class="inpt-container" id="container1" style="padding-bottom: 10px;">
            <div class="row ml-2">
                <h3 class="report_heading">{{frame_title}} {{group_names}}</h3>
                <!-- <input type="textarea" style="width:5%;text-align: center;background-color:aliceblue;height: 2.2em; width: 15%;" id="item" value="{{group_names}}" disabled></input> -->
                <input type="textarea" id="group_id" value="{{group_id}}" hidden ></input>
            </div>
            <br>
            <div class="row" style="text-align: left; margin-left: 2em;">
                <div class="col">
                    <label for="zone">Rly./Org.</label>
                    <select class="form-control" id="zone" name="zone"  style="max-width:100%;" data-placeholder="Select Zone.."  multiple onchange="zone_change();newChanges()">
                        {% for z in all_zones %}
                            {% if z.rly_unit_code in selected_zones %}
                            <option value="{{z.rly_unit_code}}" selected>{{z.location_description}}</option>
                            {%  else %}
                            <option value="{{z.rly_unit_code}}">{{z.location_description}}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="col">
                    <label for="division">Div./Unit</label>
                    <select class="form-control" id="division" name="division"  style="max-width:100%;" data-placeholder="Select Division.."  multiple onchange="newChanges()">
                        {% for z in all_division %}
                            {% if z.rly_unit_code in selected_division %}
                            <option value="{{z.rly_unit_code}}" selected>{{z.location_description}}</option>
                            {%  else %}
                            <option value="{{z.rly_unit_code}}">{{z.location_description}}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="col">
                    <label for="dept">Department</label>
                    <select class="form-control" id="dept" name="dept"  style="max-width:100%;" data-placeholder="Select Departments.."  multiple onchange="newChanges()">
                        {% for z in all_departments %}
                            {% if z in selected_departments%}
                            <option value="{{z}}" selected>{{z}}</option>
                            {% else %}
                            <option value="{{z}}">{{z}}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="col">
                    <label for="pc_level">Level</label>
                    <select class="form-control" id="pc_level" name="pc_level"  style="max-width:100%;" data-placeholder="Select Level.."  multiple onchange="newChanges()">
                        {% for z in all_pc_level %}
                            {% if z in selected_pc_level%}
                            <option value="{{z}}" selected>{{z}}</option>
                            {% else %}
                            <option value="{{z}}">{{z}}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="col">
                    <label for="grade">Grade</label>
                    <select class="form-control" id="grade" name="grade"  style="max-width:100%;" data-placeholder="Select Grade.."  multiple onchange="newChanges()">
                        {% for z in all_grade %}
                            {% if z in selected_grade%}
                            <option value="{{z}}" selected>{{z}}</option>
                            {% else %}
                            <option value="{{z}}">{{z}}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>
            <br>
            <div class="row" id="new_group_row">
                
                <div class="col ml-2" >
                    <input type='text' maxlength="200" class="form-control mb-2 mr-sm-2" id="group_name" name="group_name" placeholder="Enter Group Name in not more than 200 characters" required>
                </div>
                <div class="col">
                    <button class="btn btn-warning" onclick="setGroup()">&nbsp;&nbsp; Generate Group &nbsp;&nbsp;</button>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <table id="designation_table" class="table table-striped table-bordered table-data">
                    <thead>
                        <tr>
                            <th>S.No.</th>
                            <th>Officer Designation</th>
                            <th>Rly./Org.</th>
                            <th>Div./Unit</th>
                            <th>Department</th>
                            <th>Level</th>
                            <th>Grade</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for d in final_list_selected_designations %}
                        <tr>
                            <td><input class='previouslySelectedOfficersCheckbox' type="checkbox" checked id="officer{{d.designation_code}}" value="{{d.designation_code}}"></td>
                            <td>{{d.designation}}</td>
                            <td>{{d.hq_id__location_description}}</td>
                            <td>{{d.div_id__location_description}}</td>
                            <td>{{d.department}}</td>
                            <td>{{d.pc7_levelmax}}</td>
                            <td>{{d.d_level}}</td>
                        </tr>
                        {% endfor %}
                    </tbody>  
                </table>
            </div>
        </div>
    </div>
</body>
<script>

    $( document ).ready(function(){
        $('#zone').select2();
        $('#division').select2();
        $('#dept').select2();
        $('#grade').select2();
        $('#pc_level').select2();
        zone_change();
        $('#new_group_row').hide();
        var designation_table = $('#designation_table').DataTable();
    });

    let division_data = JSON.parse('{{division_data|safe}}');

    function zone_change(){
        var selected_divisions = $('#division').val();
        var selected_zones = $('#zone').val();

        $('#division').empty()
        $('#division').append(`<option value="">Select division</option>`);
        for (let j = 0; j < division_data.length; j++) {
            if (selected_zones.includes(division_data[j]['parent_rly_unit_code'])){
                if (selected_divisions.includes(String(division_data[j]['rly_unit_code'])))
                    $('#division').append(`<option value="${division_data[j]['rly_unit_code']}" selected> ${division_data[j]['location_description']}</option>`);
                else
                    $('#division').append(`<option value="${division_data[j]['rly_unit_code']}"> ${division_data[j]['location_description']}</option>`);
            }
            
        }
    }
    function setGroup()
    {
    $.ajax({
          type : 'POST',
          url : "{% url 'createGroup' %}",
          dataType : 'json',
          data: {
            csrfmiddlewaretoken: '{{csrf_token}}',
            'zone': JSON.stringify($('#zone').val()), 
            'division': JSON.stringify($('#division').val()), 
            'dept': JSON.stringify($('#dept').val()), 
            'pc_level': JSON.stringify($('#pc_level').val()), 
            'grade': JSON.stringify($('#grade').val()), 
            'group_name': $('#group_name').val(), 
            'call_type' : 'edit_group'
          },
          success : function(response){
            value = response.value
            alert(value)
            // if (value == 'True'){
            //     alert('Group Created Succesfully')
            // }
            // else{
            //     alert('oops error!!')
            // }
          }
    })
    }
function newChanges(){
    $('#new_group_row').show();
    $.ajax({
          type : 'POST',
          url : "{% url 'editGroup' %}",
          dataType : 'json',
          data: {
            csrfmiddlewaretoken: '{{csrf_token}}',
            'zone': JSON.stringify($('#zone').val()), 
            'division': JSON.stringify($('#division').val()), 
            'dept': JSON.stringify($('#dept').val()), 
            'pc_level': JSON.stringify($('#pc_level').val()), 
            'grade': JSON.stringify($('#grade').val()), 
            // 'group_id': JSON.stringify($('#group_id').val()), 
          },
          success : function(response){
            let designations = response.final_list_selected_designations;
            $('#designation_table').DataTable().destroy();
            $('#designation_table').hide();
            row=''
            
            for (var i=0;i<designations.length; i++){ 
                row+=`
                    <tr>
                        <td>${i+1}</td>
                        <td>${designations[i]['designation']}</td>
                        <td>${designations[i]['hq_id__location_description']}</td>
                        <td>${designations[i]['div_id__location_description']}</td>
                        <td>${designations[i]['department']}</td>
                        <td>${designations[i]['pc7_levelmax']}</td>
                        <td>${designations[i]['d_level']}</td>
                    </tr>
                `
            }
            $('#designation_table tbody').empty();
            $('#designation_table tbody').append(row);
            $('#designation_table').show();
            designation_table = $('#designation_table').DataTable({});
          }
    })
}
</script>