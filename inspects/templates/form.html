{% extends 'base.html' %} 
{% block content %}

{% load static %}

<meta charset="utf-8">
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"> </script>
<link href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
<link href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">   
  {% comment %} <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" /> 
  {% endcomment %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/choices.min.css">
  <script src="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/choices.min.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->
  <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
    <style>
      .bootstrap-select.btn-group .dropdown-menu.inner,
.dropdown-menu.open {
  min-height: 70vh !important;
}
      * {
      box-sizing: border-box;
    }
    /* The Close Button */
    .close {
      color: white;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }
    * {
      box-sizing: border-box;
    }
    
    /* Style the search field */
    form.example input[type=text] {
      padding: 8px;
      font-size: 17px;
      border: 1px solid grey;
      float: left;
      width: 60%;
      background: #f1f1f1;
    }
    
    form.example button:hover {
      background: #0b7dda;
    }
    
    /* Clear floats */
    form.example::after {
      content: "";
      clear: both;
      display: table;
    }  
    .select2-choices {
    min-height: 200px;
    max-height: 200px;
    overflow-y: hidden;
   }      
    </style>
    
    <style>
     
      
    .autocomplete {
      /*the container must be positioned relative:*/
      position: relative;
      display: inline-block;
    }
    
    .autocomplete-items {
      position: absolute;
      border: 1px solid #d4d4d4;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      /*position the autocomplete items to be the same width as the container:*/
      top: 100%;
      left: 0;
      right: 0;
    }
    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      background-color: #fff;
      border-bottom: 1px solid #d4d4d4;
    }
  
    .autocomplete-active {
      /*when navigating through the items using the arrow keys:*/
      background-color: DodgerBlue !important;
      color: #ffffff;
    }
    .select2-selection__choice__remove{
      border: none;
    }
    .select2-dropdown.increasezindex{
      z-index:99999;
    }
    .select2-search--inline {
    display: contents; /*this will make the container disappear, making the child the one who sets the width of the element*/
}
    .multi_select_box{
      width: 150px;
      margin: 1px auto;
    }
    .multi_select_box select{
      width: 100%;
    }
    .multi_select_box button{
      background-color: darkslategray !important;
      color: #fff !important;
    }
    
    .home-section .home-content .text{
              font-size: 15px;
              font-weight: 400;
            }
            
            home-section .home-content .text{
              font-size: 15px;
              font-weight: 400;
            }
          
            
            .bootstrap-select.form-control-sm .dropdown-toggle {
              height: 2.6em;
            }
            .select2-search--inline {
    display: contents; /*this will make the container disappear, making the child the one who sets the width of the element*/
}

.select2-search__field:placeholder-shown {
    width: 100% !important; /*makes the placeholder to be 100% of the width while there are no options selected*/
}
            
            .mycls{
              display: inline-flex;
            }
           
  .btn-save {	
  align-items: center;	
  background-clip: padding-box;	
  background-color: #fa6400;	
  border: 1px solid transparent;	
  border-radius: .25rem;	
  box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;	
  box-sizing: border-box;	
  color: #fff;	
  cursor: pointer;	
  display: inline-flex;	
  font-family: system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;	
  font-size: 16px;	
  font-weight: 600;	
  justify-content: center;	
  line-height: 1.25;	
  margin: 0;	
  min-height: 3rem;	
  padding: calc(.875rem - 1px) calc(1.5rem - 1px);	
  position: relative;	
  text-decoration: none;	
  transition: all 250ms;	
  user-select: none;	
  -webkit-user-select: none;	
  touch-action: manipulation;	
  vertical-align: baseline;	
  width: auto;	
}	
.btn-save:hover,	
.btn-save:focus {	
  background-color: #fb8332;	
  box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;	
}	
.btn-save:hover {	
  transform: translateY(-1px);	
}	
.btn-save:active {	
  background-color: #c85000;	
  box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;	
  transform: translateY(0);	
}	
.btn-draft {	
  align-items: center;	
  background-clip: padding-box;	
  background-color: #666699;	
  border: 1px solid transparent;	
  border-radius: .25rem;	
  box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;	
  box-sizing: border-box;	
  color: #fff;	
  cursor: pointer;	
  display: inline-flex;	
  font-family: system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;	
  font-size: 16px;	
  font-weight: 600;	
  justify-content: center;	
  line-height: 1.25;	
  margin: 0;	
  min-height: 3rem;	
  padding: calc(.875rem - 1px) calc(1.5rem - 1px);	
  position: relative;	
  text-decoration: none;	
  transition: all 250ms;	
  user-select: none;	
  -webkit-user-select: none;	
  touch-action: manipulation;	
  vertical-align: baseline;	
  width: auto;	
}	
.btn-draft:hover,	
.btn-draft:focus {	
  background-color: #666699;	
  box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;	
}	
.btn-draft:hover {	
  transform: translateY(-1px);	
}	
.btn-draft:active {	
  background-color: #666699;	
  box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;	
  transform: translateY(0);	
}

/* .truncate {
  white-space: nowrap; 
  width: 60%; 
  overflow: hidden;
  text-overflow: ellipsis;
  position: relative;
  line-height: 40px;
  pointer-events:none;
} */
.truncate {
  max-width: 100px; /* Adjust the width as needed */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  cursor: pointer;
}



</style>


<script>
  $(document).ready(function(){
    var multipleCancelButton = new Choices('#choices-multiple-remove-button', {
       removeItemButton: true,
      //  maxItemCount:5,
       searchResultLimit:5,
       renderChoiceLimit:5
     }); 
    
    
});
  function get_accompany()
  {
    var rly=$('#rly_1').val();
       let divisiondata = $('#div_1').val();
          data={
              'rly_data': String(rly)
            }
                $.ajax({	
                        type: 'GET',	
                          url: "{% url 'zone_get_accompany_officers' %}",	
                          dataType: 'json',	
                          data: data,
                          success: function (response) {
                            
                            $('#accompany').empty();
                            data_add=``
                            for(ii=0;ii<response.length;ii++)	
                              {	
                              data_add +=  '<option  value="'+response[ii].designation+'" data-tokens="'+response[ii].designation+'">'+response[ii].designation+'</option>';	
                              }
                            
                            $('#accompany').append(data_add);
                    }
                  })

  }

  var arr_for_hour = [];
  var arr_for_min = [];

</script>

<body >
    <div class="container" style="overflow-y:hidden;">
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == 'success' %}
                  <div class="alert alert-success">
                    <strong>Success </strong>{{ message }}
                  </div>
                {% elif message.tags == 'error' %}
                  <div class="alert alert-danger">
                    <strong>Error </strong>{{ message }}
                  </div>
                {% elif message.tags == 'info' %}
                  <div class="alert alert-info">
                    <strong>Info </strong>{{ message }}
                  </div>
                {% else %}
                
                {% endif %}
               
            
            {% endfor %}
        {% endif %}
        
        <div>
          <h3 id="h6" class="report_heading">Schedule Inspection</h3>
        </div>
        <div class="nav nav-tabs" style="margin-bottom: 20px;">
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
                <!-- <a class="nav-link active" data-toggle="tab" onclick="openCity('mainForm', this, '')">Create Schedule</a> -->
                <a class=" nav-link active" data-toggle="tab" onclick="openCity('mainForm', this, '')" id="defaultOpen">Create Schedule</a>

            </li>
            <li class="nav-item">
              <a class="nav-link" id="drafts_page_view" data-toggle="tab" onclick="openCity('show_drafts', this, '')">Drafts({{drafts_count}})</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" onclick="openCity('outbox', this, '')">Outbox({{count_outbox}})</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" onclick="openCity('approved', this, '')">Approved({{count_accepted}})</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" onclick="openCity('rejected', this, '')">Rejected({{count_rejected}})</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" onclick="openCity('inbox', this, '')">Inbox({{count_inbox}})</a>
            </li>
        </ul>
          <!-- <button class="btn tablink" onclick="openCity('mainForm', this, 'grey')" id="defaultOpen">Create Schedule</button>
          <button class="btn tablink" onclick="openCity('show_drafts', this, 'grey')">Draft</button>
          <button class="btn tablink" onclick="openCity('outbox', this, 'grey')">Outbox</button>
          <button class="btn tablink" onclick="openCity('approved', this, 'grey')">Approved</button>
          <button class="btn tablink" onclick="openCity('rejected', this, 'grey')">Rejected</button>
          <button class="btn tablink" onclick="openCity('inbox', this, 'grey')">Inbox</button> -->
      </div>
        <div id="mainForm" class="tabcontent">
        
     
        

        <div class="container">
          <div class="inpt-container" style="padding:10px;">
            <table id="myTable">
              <col style="width:120px">
              <col style="width:120px">
              <col style="width:120px">
              <div class="row">
                <div class="col">
                  
                  <label class="lbl-caption">Rly./Org.<span style="color:red;font-weight:bold">*</span></label>
                    <select class="form-control" data-placeholder="Select zone.." id="rly_1" name="rly_1" class="custom-select" style="width: 100%;"  multiple onchange="get_accompany();">
                        {% for i in Zone %}
                        {% if draft_details.is_exists == True %}
                          {% if i in draft_details.rail %}
                            <option value="{{i}}" selected>{{i}}</option>
                          {% else %}
                            <option value="{{i}}" >{{i}}</option>
                          {% endif %}
                        {% else %}
                        <option value="{{i}}" >{{i}}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                  
                </div>
                <div class="col">
                  <label class="lbl-caption">Div./Unit</label>
                    <select class="form-control" id="div_1" data-placeholder="Select division.." name="div_1" class="custom-select" style="width: 100%;"  multiple onclick="getdivwisedata();">                 
                        {% if draft_details.is_exists == True %}
                          {% for i in draft_details.div %}
                            <option value="{{i}}" selected>{{i}}</option>
                          
                          {% endfor %}
                        <option value="{{i}}" >{{i}}</option>
                        {% endif %}
                    </select>
                </div>
                <!-- <div class="col">
                    <label for="division" class="lbl-caption">Location type</label>
                    <select class="form-control" id="location_type1" data-placeholder="Select location type.."  name="location_type1" multiple>
                      {% for i in location_array %}
                      <option value="{{i.type_code}}" >{{i.type}}</option>
                      {% endfor %}
                    </select>
                </div> -->
                <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">	
                <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
                <div class="col">
                  <label for="division" class="lbl-caption">Location type</label>
                  <select id="locationType"  class="form-control custom-select" data-placeholder="Select Location type"  multiple>
                  <!-- <select class="form-control" id="locationType"  class="custom-select"  name="locationType"  data-placeholder="Select Location type" multiple> -->
                    <!-- <option value="" hidden selected style="color: #464646;">Select location type</option> -->
                      {% for i in location_array %}
                        {% if draft_details.is_exists == True %}
                          {% if i.type_code in draft_details.loc_type %}
                            <option value="{{i.type_code}}" selected>{{i.type}}</option>
                          {% else %}
                            <option value="{{i.type_code}}" >{{i.type}}</option>                
                          {% endif %}
                        {% else %}
                        <option value="{{i.type_code}}" >{{i.type}}</option>
                        {% endif %}
                      {% endfor %}
                  </select>
                  <script>
                    $("#locationType").select2({
                        // tags: true,  
                        tokenSeparators: [','],  
                        maximumInputLength: 10
                    });
          
                  </script>
                </div>
                <div class="col">
                    <label for="division" class="lbl-caption">Location Name</label>
                    <select name="location" id="displayValue" data-placeholder="Select location.." class="form-control" multiple>
                      <option value="" disabled hidden>select</option>
                      {% if draft_details.is_exists == True %}
                        {% for i in draft_details.loc %}
                          {% if i != "" %}
                          <option value="{{i}}" selected>{{i}}</option>
                          {% endif %}
                        {% endfor %}
                      {% endif %}
                      <!-- <option value="select" >select</option>
                      <option value="select" >select</option> -->
                      
                    </select>
                    <!-- <select class="form-control" id="displayValue"  class="custom-select"  name="department"  data-placeholder="Select Location" required> -->
                    
                </div>
                
                <script>
                  $("#displayValue").select2({
                        minimumInputLength: 0,
                        language: {
                            inputTooShort: function() {
                              console.log("HI THEREEEEEEEEEEEE");
                              return 'Please Add One or More Location';
                            }
                          },
                         
                        ajax: {
                            url: '{% url "autoFetchLocationForInspectionForm" %}',
                            dataType: 'json',
                            type: "GET",
                            quietMillis: 50,
                            data: function (term) {
                              console.log("HI ");
                              let stype = JSON.stringify($('#locationType').val())
                              let rly_zone = JSON.stringify($('#rly_1').val())
                              let division_id = JSON.stringify($('#div_1').val())
                                return {
                                    last_val: term.term,
                                    stype: stype,
                                    rly_zone: rly_zone,
                                    division_id : division_id
                                };
                                
                                
                            },
                            processResults: function (data) {
                              
                                return {
                                    results: $.map(data, function (item) {
                                
                                        return{
                                          text: item.city,
                                          
                                          id: item.city,
                                          
                                        }
                                    })
                                };
                              
                              },
                            
                            
                        }
                    });
                </script>
                
                <div class="col">
                  <br>
                  <label  class="lbl-caption" hidden>Continue</label>
                  <button class="btn btn-warning btn-sm mt-1" onclick="setTitle()">Continue</button>
                  
                  <label  class="lbl-caption" hidden>Reset</label>
                  <button class="btn btn-warning btn-sm mt-1" onclick="setTitle()">Reset</button>
                </div>
                
              </div>
              
            </table>
          </div>
        </div>

        <div class="row" style="margin-left: 5px; margin-right: 5px;">
          <div class="col">
            <div class="form-group">
              <label for="event" class="lbl-caption" >Description<span style="color:red;font-weight:bold">*</span></label>
              <textarea  type="text" id="description"  name="description" maxlength="100" class="form-control" placeholder="Enter Inspection Details" class="custom-select">{% if draft_details.is_exists == True %}{{draft_details.description}}{% endif %}</textarea>
            </div> 
          </div>
          <div class="col">
            <div class="form-group">
              <label for="event" class="lbl-caption" >Accompanied By</label>
              
              <select id="accompany"  class="form-control custom-select" data-placeholder="Search Designation.."  multiple>
                {% if draft_details.is_exists == True %}
                  {% for i in draft_details.accompanied_by %}
                    {% if i != "" %}
                    <option value="{{i}}" selected>{{i}}</option>
                    {% endif %}
                  {% endfor %}
                  
                  {% for i in desg_no %}
                    {% if i.designation not in draft_details.accompanied_by %}
                      <option value="{{i.designation}}">{{i.designation}}</option>
                    {% endif %}
                  {% endfor %}
                {% else %}

                  {% for i in desg_no %}
                      <option  value="{{i.designation}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
                  {% endfor %}

                {% endif %}
              </select>
            </div> 
          </div>
        </div>
        <script>
          $("#accompany").select2({
              tags: true,
              tokenSeparators: [','],  
              maximumInputLength: 50
          });

        </script>

        <div class="container">
          <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;" id="tb">
            <!-- <col style="width:130px"> -->
            <!-- <col style="width:80px"> -->
            <!-- <col style="width:120px"> -->
            <thead id="mainTable" class="">
              <tr>
                <th scope="col" colspan="3" style="text-align: center;">From</th>
                <th scope="col" colspan="3" style="text-align: center;">To</th>
                <th scope="col" colspan="3" style="text-align: center;"></th>
              </tr>
                <tr>
                  <th scope="col" style="text-align: center;">दिनांक<br>Start Date<span style="color:red;font-weight:bold">*</span></th>
                  <th scope="col" style="text-align: center;">प्रस्थान समय<br>Dep Time</th>
                  <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                  <th scope="col" style="text-align: center;">दिनांक<br>End Date<span style="color:red;font-weight:bold">*</span></th>
                  <th scope="col" style="text-align: center;">आगमन समय<br>Arr Time</th>
                  <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                  <th scope="col" style="text-align: center;">माद्यम<br>Mode</th>
                  <th scope="col" style="text-align: center;">संख्या<br>No.</th>                          
                  <th scope="col" style="text-align: center;">उद्देश्य<br>Purpose<span style="color:red;font-weight:bold">*</span></th>
                </tr>    
                      <!-- NOTE  -->
                {% if draft_details.is_exists == True and draft_details.tour_count != 0 %}

                {% for k in draft_details.tour_details %}
                {% with x=forloop.counter %}
                <tr>
                  <input id="tour_detail_id{{x}}" hidden value="{{k.tour_id}}"></input>
                  <td id="col1" ALIGN="left">
                      <input id="date{{x}}_0" type="text" style="background-color: #fff;" class="form-control datepker " name="date_to_act" placeholder="dd-mm-yyyy" value="{{k.date}}" required readonly style="height:34px;">
                  </td>
                  <td style="width: 80px;">
                    <input style="height:100%; justify-content: center;" class="" placeholder="hour" type="text" id="dep-hour{{x}}" name="dep-hour" onfocus="settime(this)">
                  </td>
                  <td>
                    <select name="location{{x}}_0" id="location{{x}}_0" data-placeholder="Select-Location" class="form-control" style="width:150px; height:34px;">
                      {% if k.from != None %}
                      <option value="{{k.from}}" selected>{{k.from}}</option>
                      {% endif %}
                    </select>
                  </td>
                  <td id="col1" ALIGN="left" style="width: 130px;">
                    <input id="date{{x}}_1" type="text" style="background-color: #fff;" class="form-control datepker " name="date_to_act" placeholder="dd-mm-yyyy" required readonly style="height:34px;" value="{{k.date1}}">
                  </td>

                  <td style="width: 80px;">
                    <input style="height:100%;" placeholder="hour" type="text" id="arr-hour{{x}}" name="arr-hour" onfocus="settime(this)">
                  </td>
                  
                  <td>
                    <select name="location{{x}}_1" id="location{{x}}_1" data-placeholder="Select-Location" class="form-control" style="width:150px; height:34px;">    
                      {% if k.to != None %}
                      <option value="{{k.to}}" selected>{{k.to}}</option>
                      {% endif %}
                    </select>
                  </td> 
           

                  <td id="col0" class = "select">
                    <select class="form-control" id="mode{{x}}" size="0" name="mode{{x}}" onchange="railway__1(this.id)" style="width:100%; height:100%;" data-placeholder="Select one mode" required>
                      <option value="" selected disabled hidden >Select</option>
                      <option value="flight">Flight</option>
                      <option value="rail">Rail</option>
                      <option value="stay">Stay</option>
                    </select>
                    <script>
                      var selectElement = document.getElementById("mode{{x}}");
                      if("{{k.mode}}" == "flight"){
                        selectElement.selectedIndex = 1;
                      }
                      else if("{{k.mode}}" == "rail"){
                        selectElement.selectedIndex = 2;
                      }
                      else if("{{k.mode}}" == "stay"){
                        selectElement.selectedIndex = 3;
                      }
                      
                    </script>
                  </td>
                  <td style="width: 75px;">
                    <input style="width:100%; height:100%;" placeholder="Enter travel no." id="num{{x}}" type="number" name="num{{x}}">
                  </td>
                  <script>
                    // console.log("{{k.id}}");
                    var selectElement = document.getElementById("num{{x}}");
                    selectElement.value = "{{k.no}}";
                  </script>
                  
                  <script>
                    var selectElement = document.getElementById("dep-hour{{x}}");
                    if("{{k.dep_hour}}"!="None"){
                      
                      var timeString = "{{k.dep_hour}}";
                      // Convert to 24-hour format
                      var convertedTime = moment(timeString, "h:mm A").format("HH:mm");

                      selectElement.value = convertedTime;
                    }
                    
                  </script>

                         
                  
                  <script>
                    var selectElement = document.getElementById("arr-hour{{x}}");
                    if("{{k.arr_hour}}"!="None"){
                      
                      var timeString = "{{k.arr_hour}}";
                      // Convert to 24-hour format
                      var convertedTime = moment(timeString, "h:mm A").format("HH:mm");

                      selectElement.value = convertedTime;
                    }
                    
                  </script>

                  <script>
                  
                    arr_for_hour.push("#arr-hour{{x}}");
                    arr_for_hour.push("#dep-hour{{x}}");
                    arr_for_min.push("#arr-min{{x}}");
                    arr_for_min.push("#dep-min{{x}}");
              </script>

                   
                  
                  

                  <script>
                    $("#location{{x}}_0").select2({
                        
                        minimumInputLength: 1,
                        language: {
                            inputTooShort: function() {
                              return 'Please Add Location';
                            }
                          },
                        tags: [],
                        ajax: {
                            url: '{% url "autoFetchLocation1" %}',
                            dataType: 'json',
                            type: "GET",
                            quietMillis: 50,
                            data: function (term) {
                                return {
                                    last_val: term.term
                                };
                              
                                
                            },
                            processResults: function (data) {
                              return {
                                    results: $.map(data, function (item) {
                                    
                                      
                                        return{
                                          text: item.city,
                                          
                                          id: item.city,
                                        }
                                    })
                                };
                              },
                        }
                    });
                    $("#location{{x}}_1").select2({
                      
                      minimumInputLength: 1,
                      language: {
                          inputTooShort: function() {
                            return 'Please Add Location';
                          }
                        },
                      tags: [],
                      ajax: {
                          url: '{% url "autoFetchLocation1" %}',
                          dataType: 'json',
                          type: "GET",
                          quietMillis: 50,
                          data: function (term) {
                              return {
                                  last_val: term.term
                              };
                            
                              
                          },
                          processResults: function (data) {
                            return {
                                  results: $.map(data, function (item) {
                                  
                                    
                                      return{
                                        text: item.city,
                                        
                                        id: item.city,
                                      }
                                  })
                              };
                            },
                      }
                  });
                  </script>

                  <td>
                    <div class="form-group">
                      <select id="purpose{{x}}"  class="form-control" data-placeholder="Select a purpose" >
                          <option value="none" selected disabled hidden>Select an Option</option>
                          <option value="Annual Inspection">Annual  inspection</option>
                        <option value="Coach Inspection">Coach Inspection</option>
                        <option value="Coaching depot Inspection">Coaching depot Inspection</option>
                        <option value="Footplate Inspection">Footplate Inspection</option>
                        <option value="General Inspection">General Inspection</option>
                        <option value="Institute Inspection">Institute Inspection</option>           
                        <option value="OBHS Inspection">OBHS Inspection</option>
                        <option value="Rake Inspection">Rake Inspection</option>
                        <option value="Railway siding Inspection">Railway Siding Inspection</option>
                        <option value="RCD Inspection">RCD inspection</option>
                        <option value="Safety Inspection">Safety Inspection</option>
                        <option value="Section Inspection">Section Inspection</option>
                        <option value="Station Inspection">Station Inspection</option>
                        <option value="Track Inspection">Track Inspection</option>
                        <option value="Train Inspection">Train Inspection</option>            
                        <option value="Weigh bridge Inspection">Weigh Bridge Inspection</option>
                        <option value="Workshop inspection">Workshop Inspection</option>
                        <option value="Wagon depot Inspection">Wagon Depot Inspection</option>
                        <option value="travelling">Travelling</option>
                        <option value="Other">Other</option>
                      </select>
                      <script>
                        $("#purpose{{x}}").select2({
                            tags: true,
                            tokenSeparators: [','],  
                            maximumInputLength: 10
                        });
                        $('#date{{x}}_1').datepicker({
                          dateFormat: 'dd-mm-yy',
                          minDate: 0,
                          
                          
                        });
                        $('#date{{x}}_0').datepicker({
                          dateFormat: 'dd-mm-yy',
                          minDate: 0,
                          
                          
                        })

                      </script>
                    </div>
                  </td>
                  <script>
                    var dropdown1 = document.getElementById("purpose{{x}}");
                    var selectedOption = "{{k.purpose}}";
                    var dropdown = $("#purpose{{x}}");
                    var flag = 0;

                    // dropdown.val(selectedOption).trigger("change");
                    for (var i = 0; i < dropdown1.options.length; i++) {
                        if (dropdown1.options[i].value === selectedOption) {
                          flag = 1;
                          break;
                        }
                    }
                      if(flag==0){
                        var newOption = new Option(selectedOption, selectedOption, true, true);
                        dropdown.append(newOption).trigger('change');
                      }else{
                        dropdown.val(selectedOption).trigger("change");
                      }
                    // console.log("hi", dropdown1.value);
                  </script>
                </tr> 
                {% endwith %}
                {% endfor %}
     
                
                {% else %}
                <tr>
                    <td id="col1" ALIGN="left" style="width: 130px;">
                        <input id="date1_0" type="text" style="background-color: #fff;" class="form-control datepker " name="date_to_act" placeholder="dd-mm-yyyy" required readonly style="height:34px;">
                    </td>
                    <td style="width: 80px;">
                      <input style="height:100%; justify-content: center;" placeholder="hour" type="text" id="dep-hour1" name="dep-hour" onfocus="settime(this)">
                      <!-- <input style="width:46%; height:100%;" placeholder="min" type="number" id="dep-min1" name="dep-min" min="0" max="59"> -->
                    </td>
                    <td>
                      <select name="location1_0" id="location1_0" data-placeholder="Select-Location" class="form-control" style="width:150px; height:34px;">  
                      </select>
                    </td> 
                    
                    <td id="col1" ALIGN="left" style="width: 130px;">
                      <input id="date1_1" type="text" style="background-color: #fff;" class="form-control datepker " name="date_to_act" placeholder="dd-mm-yyyy" required readonly style="height:34px;">
                    </td>
                    
                    <td style="width: 80px;">
                      <input style="height:100%;" placeholder="hour" type="text" id="arr-hour1" name="arr-hour" onfocus="settime(this)">
                    </td>

                    <script>
                      arr_for_hour.push("#arr-hour1");
                      arr_for_hour.push("#dep-hour1");
                      arr_for_min.push("#arr-min1");
                      arr_for_min.push("#dep-min1");
                     
                      

                    </script>

                    
                    
                    <td>
                      <select name="location1_1" id="location1_1" data-placeholder="Select-Location" class="form-control" style="width:150px; height:34px;">    
                      </select>
                    </td>
                    <td id="col0" class = "select">
                      <select class="form-control" id="mode1" size="0" name="mode1" onchange="railway__1(this.id)" style="width:100%; height:100%;" data-placeholder="Select one mode" required>
                        <option value="" selected disabled hidden >Select</option>
                        <option value="flight">Flight</option>
                        <option value="rail">Rail</option>
                        <option value="stay">Stay</option>
            
                      </select>
                    </td>
                    <td style="width: 75px;">
                      <input style="width:100%; height:100%;" placeholder="Enter no." id="num1" type="number" name="num0">
                    </td>
                    <td>
                      <div class="form-group">
                        <select id="purpose1"  class="form-control" data-placeholder="Select a purpose" >
                            <option value="none" selected disabled hidden>Select an Option</option>
                            <option value="Annual Inspection">Annual  inspection</option>
                          <option value="Coach Inspection">Coach Inspection</option>
                          <option value="Coaching depot Inspection">Coaching depot Inspection</option>
                          <option value="Footplate Inspection">Footplate Inspection</option>
                          <option value="General Inspection">General Inspection</option>
                          <option value="Institute Inspection">Institute Inspection</option>           
                          <option value="OBHS Inspection">OBHS Inspection</option>
                          <option value="Rake Inspection">Rake Inspection</option>
                          <option value="Railway siding Inspection">Railway Siding Inspection</option>
                          <option value="RCD Inspection">RCD inspection</option>
                          <option value="Safety Inspection">Safety Inspection</option>
                          <option value="Section Inspection">Section Inspection</option>
                          <option value="Station Inspection">Station Inspection</option>
                          <option value="Track Inspection">Track Inspection</option>
                          <option value="Train Inspection">Train Inspection</option>            
                          <option value="Weigh bridge Inspection">Weigh Bridge Inspection</option>
                          <option value="Workshop inspection">Workshop Inspection</option>
                          <option value="Wagon depot Inspection">Wagon Depot Inspection</option>
                          <option value="travelling">Travelling</option>
                          <option value="Other">Other</option>
                        </select>
                        <script>
                          $("#purpose1").select2({
                              tags: true,
                              tokenSeparators: [','],  
                              maximumInputLength: 10
                          });
                
                        </script>
                      </div>
                    </td>
                  </tr> 
                  <script>
                    $("#location1_0").select2({
                        
                        minimumInputLength: 1,
                        language: {
                            inputTooShort: function() {
                              return 'Please Add Location';
                            }
                          },
                        // tags: [],
                        ajax: {
                            url: '{% url "autoFetchLocation1" %}',
                            dataType: 'json',
                            type: "GET",
                            quietMillis: 50,
                            data: function (term) {
                                return {
                                    last_val: term.term
                                };
                              
                                
                            },
                            processResults: function (data) {
                              return {
                                    results: $.map(data, function (item) {
                                    
                                      
                                        return{
                                          text: item.city,
                                          
                                          id: item.city,
                                        }
                                    })
                                };
                              },
                        }
                    });
                    $("#location1_1").select2({
                      
                      minimumInputLength: 1,
                      language: {
                          inputTooShort: function() {
                            return 'Please Add Location';
                          }
                        },
                      // tags: [],
                      ajax: {
                          url: '{% url "autoFetchLocation1" %}',
                          dataType: 'json',
                          type: "GET",
                          quietMillis: 50,
                          data: function (term) {
                              return {
                                  last_val: term.term
                              };
                            
                              
                          },
                          processResults: function (data) {
                            return {
                                  results: $.map(data, function (item) {
                                  
                                    
                                      return{
                                        text: item.city,
                                        
                                        id: item.city,
                                      }
                                  })
                              };
                            },
                      }
                  });
                  </script>
                {% endif %}   
            </thead>
            <script>
              // const inputFields1 = document.querySelectorAll(arr_for_min.toString());
              // inputFields1.forEach(function(inputField) {
              //   inputField.addEventListener('input', function(event) {
              //     if (event.target.value < 0) {
              //       event.target.value = 0;
              //     }
              //     else if(event.target.value >59){
              //       event.target.value = 59;
              //     }
              //   });
              // });


              // const inputFields = document.querySelectorAll(arr_for_hour.toString());
              // inputFields.forEach(function(inputField) {
              //   inputField.addEventListener('input', function(event) {
              //     if (event.target.value < 0) {
              //       event.target.value = 0;
              //     }
              //     else if(event.target.value >23){
              //       event.target.value = 23;
              //     }
              //   });
              // });
              // inputFields.forEach(
                
              // );
                
            </script>

            <tbody id="addworkmech"> </tbody>
          </table>
          <div class="col-lg-12 col-md-12 col-sm-12">
            <button  class="btn btn-primary btn-md " id="addheading">Add Insp.Location</button> 
            <button title="delete officer"  class="btn btn-danger btn-md remove">Delete</button>
            <button  class="btn btn-secondary btn-md"   onclick="clear1();">Clear </button>
          </div>
          
        <input id="count_row" type="text" value="{{draft_details.tour_count}}" hidden>
        
        </div>
        
        <div class="container" style="margin-top: 20px;">
          
          <div class="col" style = "display: flex; gap: 50px; background-color: #f1f1f1; padding: 10px;">
            <label>Upload Documents(pdf, <200kb)</label>
            <input id="aFile_upload" type="File" name="file_upload" accept=".pdf">
            <button class="btn-info" id="preview_pdf" style="background-color: red; border-style:hidden;" onclick="myFunction()" disabled>Preview</button><p id="file_alert"></p>
          </div>
          <canvas id="pdfViewer" style="display:none; flex-direction: row;"></canvas>

        </div>
        
        <script>
          var pdfjsLib = window['pdfjs-dist/build/pdf'];
          // The workerSrc property shall be specified.
          pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://mozilla.github.io/pdf.js/build/pdf.worker.js';

          $("#aFile_upload").on("change", function(e){
            document.getElementById("preview_pdf").disabled = false;
            document.getElementById("preview_pdf").style.backgroundColor = "blue";
            var file = e.target.files[0]
            if(file.type == "application/pdf"){
              var fileReader = new FileReader();  
              fileReader.onload = function() {
                var pdfData = new Uint8Array(this.result);
                // Using DocumentInitParameters object to load binary data.
                var loadingTask = pdfjsLib.getDocument({data: pdfData});
                loadingTask.promise.then(function(pdf) {
                  console.log('PDF loaded');
                  
                  // Fetch the first page
                  var pageNumber = 1;
                  pdf.getPage(pageNumber).then(function(page) {
                  console.log('Page loaded');
                  
                  var scale = 1.5;
                  var viewport = page.getViewport({scale: scale});

                  // Prepare canvas using PDF page dimensions
                  var canvas = $("#pdfViewer")[0];
                  var context = canvas.getContext('2d');
                  canvas.height = viewport.height;
                  canvas.width = viewport.width;

                  // Render PDF page into canvas context
                  var renderContext = {
                    canvasContext: context,
                    viewport: viewport
                  };
                  var renderTask = page.render(renderContext);
                  renderTask.promise.then(function () {
                    console.log('Page rendered');
                  });
                  });
                }, function (reason) {
                  // PDF loading error
                  console.error(reason);
                });
              };
              fileReader.readAsArrayBuffer(file);
            }
          });
          function myFunction(){
            if(document.getElementById("pdfViewer").style.display == "block")
              document.getElementById("pdfViewer").style.display = "none";
            else
              document.getElementById("pdfViewer").style.display = "block";
          }
        </script>

        <script>
          var final_file_name = "";
          $('#aFile_upload').bind('change', function() {
            //this.files[0].size gets the size of your file.
            var filename = $('input[name="file_upload"]')[0].files[0];
            console.log(filename)
            if(this.files[0].size > 200000){
                alert("File size should be less than 200kb");
                document.getElementById("aFile_upload").value = "";
            }
            else{
              // alert("File uploaded successfully");
              let input_id = 'aFile_upload';
              
            
              var data = new FormData();
              
              data.append('file',$('#'+input_id)[0].files[0])
              data.append('csrfmiddlewaretoken',"{{csrf_token}}");
              data.append('op',"upload");

              $.ajax({
                method: "POST",
                url: "{% url 'upload_doc' %}",
                dataType: 'json',
                processData:false,
                contentType: false,
                mimeType: 'multipart/form-data',
                data: data,
                success: function(data){
                  final_file_name = data.file;
                  console.log(final_file_name);
                  alert("File uploaded successfully");
                },
                error: function(data){
                  alert("File upload failed");
                  document.getElementById("aFile_upload").value = "";
                }
              });
            }
            });
        </script>
        <style>
          .disabled-input {
            pointer-events: none;
            /* opacity: 0.6; Optional: To visually indicate the button is disabled */
            cursor: not-allowed; /* Optional: To change the cursor style */
            background-color: #d2d2d2;
            /* color: #000; */
            /* border: #000; */
          }
        </style>
        <div class="container  mt-5 mb-4">

          <!-- <div style="position:absolute;top:0;right:0;" >      
            <a href="/listofschedule/" class="btn btn-warning btn-sm mb-3 mt-3 mr-5"> View All Events</a>
          </div> -->

          <div class="inpt-container" style="margin-top: -20px;"><div class="row" style="display: flex; justify-content: space-around;">

            <!-- &nbsp;&nbsp;&nbsp; -->
            <div class="col-lg-3">
              <label class="lbl-caption">Looking after by</label>
              <select name="looking_after" id="looking_after" data-placeholder="Select-Location" class="form-control" style="width:250px; height:34px;">
                {% if draft_details.is_exists == True %}
                {% if draft_details.looking_after_officer != "" %}
                <option value="{{draft_details.looking_after_officer}}" selected>{{draft_details.looking_after_officer}}</option>
                {% endif %}
                {% endif %}
              </select>
            </div><br>

            <script>
              $("#looking_after").select2({
                  minimumInputLength: 1,
                  pattern: '',
                  language: {
                      inputTooShort: function() {
                        return 'Please Add Designation';
                      }
                    },
                  // tags: [],
                  ajax: {
                      url: '{% url "autoFetchDesig" %}',
                      dataType: 'json',
                      type: "GET",
                      quietMillis: 50,
                      data: function (term) {
                          return {
                              last_val: term
                          };
                          
                      },
                      processResults: function (data) {
                        return {
                              results: $.map(data, function (item) {
                                
                                
                                  return{
                                    text: item,
                                    id: item,
                                  }
                              })
                          };
                        },
                      
                  }
              });
            </script>
            
            <div class="col-lg-3">
              <label class="lbl-caption">Recommending Officer</label>
              <select name="recom_officer" id="recom_officer" data-placeholder="Select-Location" class="form-control" style="width: 250px; height:34px;">
                {% if draft_details.is_exists == True %}
                {% if draft_details.recommending_officer != "" %}
                <option value="{{draft_details.recommending_officer}}" selected>{{draft_details.recommending_officer}}</option>
                {% endif %}
                {% endif %}
              </select>
            </div><br>
            <script>
              $("#recom_officer").select2({
                  minimumInputLength: 1,
                  pattern: '',
                  language: {
                      inputTooShort: function() {
                        return 'Please Add Designation';
                      }
                    },
                  // tags: [],
                  ajax: {
                      url: '{% url "autoFetchDesig" %}',
                      dataType: 'json',
                      type: "GET",
                      quietMillis: 50,
                      data: function (term) {
                          return {
                              last_val: term
                          };
                          
                      },
                      processResults: function (data) {
                        return {
                              results: $.map(data, function (item) {
                                
                                
                                  return{
                                    text: item,
                                    id: item,
                                  }
                              })
                          };
                        },
                      
                  }
              });
            </script>
            
            <div class="col-lg-3">
              <label class="lbl-caption">Approving Authority</label>
              <select name="approve_auth" id="approve_auth" data-placeholder="Select-Location" class="form-control" style="width: 250px; height:34px;">
                {% if draft_details.is_exists == True %}
                {% if draft_details.approving_auth != "" %}
                <option value="{{draft_details.approving_auth}}" selected>{{draft_details.approving_auth}}</option>
                {% endif %}
                {% endif %}
              </select>
            </div><br>
            <script>
              $("#approve_auth").select2({
                  minimumInputLength: 1,
                  pattern: '',
                  language: {
                      inputTooShort: function() {
                        return 'Please Add Designation';
                      }
                    },
                  // tags: [],
                  ajax: {
                      url: '{% url "autoFetchDesig" %}',
                      dataType: 'json',
                      type: "GET",
                      quietMillis: 50,
                      data: function (term) {
                          return {
                              last_val: term
                          };
                          
                      },
                      processResults: function (data) {
                        return {
                              results: $.map(data, function (item) {
                                
                                
                                  return{
                                    text: item,
                                    id: item,
                                  }
                              })
                          };
                        },
                      
                  }
              });
            </script>
            <script>
              if("{{draft_details.is_modify}}"=='True'){
              var inputElement1 = document.getElementById("looking_after");
              var inputElement2 = document.getElementById("approve_auth");
              var inputElement3 = document.getElementById("recom_officer");

              inputElement1.disabled = true;
              inputElement2.disabled = true;
              inputElement3.disabled = true;
            }
            </script>
          </div>
          <br>
            </div>
            </div>
          
        </div>

        {% comment %} 
        <div class="container">
          <div class="row">
            <div class="col-sm-12 col-md-6">                
              <div class="input-group">
                <span class="input-group-btn">
                      <button class="btn btn-info" type="button" id="copytobtn" value="Copy To" data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setCopyValue()">Copy To</button>
                </span>
                <textarea type="text" class="form-control ml-2" id="copyto" placeholder="Add officer" autocomplete="off" readonly></textarea>
              </div>
            </div>
          </div> 
          {% endcomment %}

          
          <div class="col-sm-12 col-md-12 float-right text-right" style="display: flex;" id="all-buttons">
            <div class="col-lg-3">
              <label class="caption">For information</label>
              <select class="form-control" style="max-width:100%;height:2em;" id="info"  class="custom-select" name="for_info" data-placeholder="Select event" required>
                <option></option>
                <option value="Annual Inspection">Annual  inspection</option>
                <option value="Coach Inspection">Coach Inspection</option>
                <option value="Coaching depot Inspection">Coaching depot Inspection</option>
                <option value="Footplate Inspection">Footplate Inspection</option>
                <option value="General Inspection">General Inspection</option>
                <option value="Institute Inspection">Institute Inspection</option>           
                <option value="OBHS Inspection">OBHS Inspection</option>
                <option value="Rake Inspection">Rake Inspection</option>
                <option value="Railway siding Inspection">Railway Siding Inspection</option>
                <option value="Railway Unit Inspection">Railway Unit Inspection</option>
                <option value="RCD Inspection">RCD inspection</option>
                <option value="Safety Inspection">Safety Inspection</option>
                <option value="Section Inspection">Section Inspection</option>
                <option value="Station Inspection">Station Inspection</option>
                <option value="Track Inspection">Track Inspection</option>
                <option value="Train Inspection">Train Inspection</option>            
                <option value="Weigh bridge Inspection">Weigh Bridge Inspection</option>
                <option value="Workshop inspection">Workshop Inspection</option>
                <option value="Wagon depot Inspection">Wagon Depot Inspection</option>
                <option value="Other">Other </option>
              </select>
            </div>	
              <button type="button" value="Save as draft" name="draft" id="draft" class="btn btn-draft btn-md {% if draft_details.is_modify == True %}disabled-button{% endif %}" style="color:white;" onclick="validation();">Save as Draft</button>
              <button type="button"   id ="submit" value="Submit"  class="btn btn-save btn-md" style="color:white;" onclick="validation1();">Submit</button>
          </div>
          
        </div>



   
    
    <div class="container">
    
      <form action="{% url 'form' %}" method="POST"> 
        {% csrf_token %}
       
      
         
        
      </form>
          
    </div>
          
          
           
        <div class="modal" tabindex="-1" id="exampleModal" role="dialog" aria-labelledby="exampleModalLabel"
          aria-hidden="true">
          <div class="modal-dialog-modal-xl" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel"><b> Mark Officers</b></h4>
                <button type="button" id="close1" class="btn btn-secondary" data-dismiss="modal">Close</button>
                 
              </div>
             
              <div class="modal-body">
                <form   action="" method="POST" >
                  {% csrf_token %}
                 <input type="text" value="" id="mark_officersss" hidden/>
                
            <div class="row">
                <div class="col-md-3">
                    <label>Railway/Org.</label>
                    <select multiple class="form-control" id="rly_1" name="rly_1" class="custom-select" style="width: 100%;" data-placeholder="Select one or more Zone..." multiple >
                        {% for i in Zone %}
                        <option >{{i}}</option>
                        {% endfor %}
            
                    </select>
                </div>
                <div class="col-md-3">
                    <label>Division/Unit</label>
                    <select class="form-control" id="div_1" name="div_1" class="custom-select" style="width: 100%;" data-placeholder="Select one or more Div..." multiple onchange="getdivwisedata()">
                        {% for i in division %}
                        <option>{{i}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label>Department</label>
                    <select multiple class="form-control" id="dept_1" name="dept_1" class="custom-select" style="width: 100%;" data-placeholder="Select one or more Department..." onchange="getdivdeptdata()">
                        {% for i in department %}
                        <option value="{{i.department_name}}">{{i.department_name}}</option>
                        {% endfor %}        
                    </select>
                </div>
                <div class="col-md-3">
                    <label>Designation</label>
                    <select multiple class="form-control" id="desig" name="desig" class="custom-select" style="width: 100%;" data-placeholder="Select one or more Designation..." onchange="getdesigdata();">
                        {% for i in alldesig %}
                        <option value="{{i.designation}}">{{i.designation}}</option>
                        {% endfor %}
                    </select>
                </div>
            </div><br>
          <div class="row">
              <div class="col-md-3">
                  <input type="checkbox"  id="allgm" >
                  <label>Select All GM/ZR</label>
              </div>
              <div class="col-md-3">
                  <input type="checkbox"  id="alldrm">
                  <label>Select All DRM</label>
                 
              </div>
              <div class="col-md-3">
                  <input type="checkbox"  id="allphod">
                  <label>Select All PHOD</label>
                 
              </div>
              <div class="col-md-3">
                  <input type="checkbox"  id="allboard">
                  <label>Select All Board Members</label>
                 
              </div>
          </div>
          <br>
          <div class="row">
            <div class="col-md-6">
              <label>Selected Designation</label>
                <textarea class="form-control" maxlength="150" id="alltext" readonly></textarea>
    
            </div>
            <div class="col-md-1">
              <label></label>
              <button type="button" class="form-control  btn btn-primary" onclick="add_save_marked_officers();">Add</button>
    
            </div>
            <div class="col-md-1">
              <label></label>
              <button type="button" class="form-control btn btn-primary" onclick="remove_save_marked_officers();">Remove</button>
    
            </div>
            <div class="col-md-1">
              <label></label>
              <button type="button" class="form-control btn btn-primary" onclick="save_marked_officers();">Save</button>
    
            </div>
            <div class="col-md-3">
                     
            </div>
            </div>
            <br>
            <div class="row" id="showdiv1">
              <div class="col-md-6">
                    <table id="text" class="table table-striped table-bordered ">
                      <thead>
                        <tr><th></th>
                          <th></th></tr>
                      </thead>
                      <tbody>
                      </tbody>  
                  </table>
              </div>
              <div class="col-md-6">
                    <table id="text1" class="table table-striped table-bordered ">
                      <thead>
                          <tr><th></th><th></th></tr>
                      </thead>
                      <tbody>
                        
                      </tbody>
                  </table>
              </div>
            </div>
            <div class="row" id="showdiv2">
              <div class="col-md-6">
                    <table id="textdesig" class="table table-striped table-bordered ">
                      <thead>
                        <tr>
                          <th></th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>  
                    </table>
              </div>
              <div class="col-md-1"></div>
              <div class="col-md-5" hidden>
                <table id="textdesigselect" class="table table-striped table-bordered ">
                  <thead>
                    <tr>
                      <th hidden></th>
                      <th>Selected Employee/Designation</th>
                    </tr>
                  </thead>
                  <tbody>
                  </tbody>  
                </table>
              </div>
            </div>
            <br>
    
            <input type="hidden" value="0" id="s1" name="s1">
            </form>
            </div>
              <div class="modal-footer">
                
                
              </div>
            </div>
          </div>
      
        </div>
      
        <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b> Target Date</b></h4>
              
            </div>
           
              <div class="modal-body">
              <div><label for="start" >Target Date</label><br><input type="date"  class="col-md-2" required class="form-control" style="height: 2em;margin-top:0.7em;" id="target_date" value="new Date()"  onkeydown='event.preventDefault()' requied>
               
               
               </div>
    
            </div>
           
                
             
              </div>
             
              </div>
    
          </div>
        </div>
      </div>
    </div>
      
      
      <div id="show_drafts" class="tabcontent" style="display: none;">
        <div id="all_designation" class="container-fluid  tab-pane active"><br>
          <div id="div-all-desig">
              <table class="table table-striped table-bordered" style="width: 100%;" id="zonetable">
                  <thead style="background-color: #0066cc;white-space: nowrap;font-size: 1rem; color:white;text-align: center;">
                      <tr>
                          <th>S.No.</th>
                          <th>Description</th>
                          <th>Created On</th>
                          <th>From</th>
                          <th>To</th>
                          <th>Duration</th>
                          <th>Rly./Div.</th>
                          <th>Location</th>
                          <th>Action</th>
                      </tr>
                  </thead>
                  <tbody>
                    

                      {% for i in all_drafts %}
                      
                      <tr>
                          <td id="drafts_id" style="text-align: center">{{forloop.counter}}</td> 

                          <td class="truncate" title="{{i.description}}" style="text-align: center">{{i.description}}</td>
                          <td style="text-align: center">{{i.created_on}}</td>
                          <td style="text-align: center">{{i.from}}</td>
                          <td style="text-align: center">{{i.to}}</td>
                          <td style="text-align: center">{{i.number_of_days}}</td>
                          <td class="truncate" title="{{i.rail}}">
                            {{i.rail}}
                          </td>
                          <td class="truncate" title="{{i.location}}">
                            {{i.location}}
                          </td>
                          <td style="text-align: center;">
                            <button type="button" class="btn btn-outline-primary btn-sm" id="{{i.id}}"
                            onclick="open_inspection('{{i.id}}')"><i class="far fa-edit"></i></button> &nbsp;
                            <button type="button" class="btn btn-outline-danger btn-sm" id="{{i.id}}"
                            onclick="delete_inspection('{{i.id}}')"><i class="fas fa-trash-alt"></i></button>
                          </td>
                      </tr>
                      {% endfor %}
                      <script>
                        function open_inspection(e) {
                          // var ins_id = e.id;
                          window.location.href = "/form?draft_id=" + e;
                        }
                        function delete_inspection(e) {
                          // console.log(e);
                          window.location.href = "/delete_draft/?draft_id=" + e;
                        }
                      </script>
                  
                  </tbody>
              </table>
          </div>
        </div>
      </div>
      
      <div id="outbox" class="tabcontent" style="display: none;">
        <div id="all_designation" class="container-fluid  tab-pane active"><br>
          <div id="div-all-desig">
              <table class="table table-striped table-bordered table-sm" style="width: 100%;" id="outboxTable">
                  <thead style="background-color: #0066cc;white-space: nowrap;font-size: 1rem; color:white;text-align: center;">
                      <tr>
                        <th colspan="6"></th>
                        <th colspan="2">Action Taken</th>
                        <!-- <th colspan="1">Action Taken By</th> -->
                        <th></th>
                      </tr>
                      <tr>
                          <th>Letter No.</th>
                          <th>Description</th>
                          <th>From</th>
                          <th>To</th>
                          <th>Duration</th>
                          <th>Rly./Div.</th>
                          <th>Sent On</th>
                          <!-- <th>Rejected On</th>
                          <th>Approved On</th> -->
                          <th>Sent to</th>
                          <!-- <th>Approved by</th>
                          <th>Rejected by</th> -->
                          <th>Action</th>
                      </tr>
                  </thead>
                  <tbody>
                    <style>
                      /* .open-modal {
                        background: #20c997;
                        color: #fff;
                        border: none;
                        padding: 20px 40px;
                        font-size: 48px;
                        border-radius: 100px;
                        cursor: pointer;
                        transition: all 0.3s;
                        outline: none;
                      }
                      .open-modal:active {
                        transform: translateY(-17px);
                      } */
                      .modal-content {
                        position:absolute;
                        margin-left: 30%;
                        background: #ccc;
                        width: 500px;
                        padding: 20px;
                        border-radius: 10px;
                        z-index: 99;
                        box-shadow: 0 0 0 9999px #000000b0;
                      }

                      .modal-header {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 16px;
                        color: #000;
                        /* font-size: 30px; */
                      }

                      .close-modal {
                        background: transparent;
                        border: none;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        height: 20px;
                        width: 20px;
                        /* font-size: 40px; */
                        
                      }

                      .close-modal:hover {
                        color: #fa5252;
                      }

                      .modal-body p {
                        /* font-size: 22px;
                        line-height: 1.5; */
                      }

                      .hidden-modal {
                        display: none;
                      }

                      .blur-bg {
                        background: rgba(0, 0, 0, 0.5);
                        position: fixed;
                        top: 0;
                        right: 0;
                        bottom: 0;
                        left: 0;
                      }

                      .hidden-blur {
                        display: none;
                      }
                    </style>
                      {% for i in all_outbox %}
                      <tr>
                          <td style="text-align: center">
                            {{i.letter_no}}
                          </td>
                          <td class="truncate" title="{{i.description}}" style="text-align: center">{{i.description }}</td>
                          <td style="text-align: center">{{i.from}}</td>
                          <td style="text-align: center">{{i.to}}</td>
                          <td style="text-align: center">{{i.number_of_days}}</td>

                          <td title="{{i.rail}}" class="truncate" style="text-align: center">{{i.rail}}
                          </td>
                          
                          <td style="text-align: center">{{i.remarks}}</td>
                          <td style="text-align: center">{{i.sent_to}}</td>
                          <td>
                              <button type="button" name="{{i.id}}" style="border-style: none; margin-left: 30%;" onclick="hideRowsOutbox(this)">
                                  <i class="fas fa-angle-double-down" style="font-size:24px;color:rgb(105, 174, 238)"
                                      title="Click To Expand/Shrink Details"></i>
                              </button>
                          </td>
                      </tr>
                      
                      {% endfor %}
                  </tbody>
              </table>

              {% for i in all_outbox %}
              <div class="inpt-container hidden-row" style="padding:10px; border-style:solid; border-width: 1px;" id="displayContentOutbox{{i.id}}">
                
                <h5 style="text-align: center;">CURRENT SCHEDULE INFO</h5>
                <table>
                  <div class="row">
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Rly./Org</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Div./Unit</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Location type</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label for="division" class="lbl-caption">Location Name</label>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col" style="text-align: center;">
                      {{i.only_rail}}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.only_div != '' %}
                      {{i.only_div}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.loc_type != '' %}
                      {{i.loc_type}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.loc != '' %}
                      {{i.loc}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                  </div>
                </table>
                <div class="row" style="margin-left: 5px; margin-right: 5px;">
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Description</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{i.description}}
                      </div>
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Accompanied By</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {% if i.accompanied_by != '' %}
                          {{i.accompanied_by}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>   
                    </div> 
                  </div>
                </div>

                <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;" id="tb">
                  <col style="width:120px">
                  <col style="width:80px">
                  <col style="width:120px">
                  <thead>
                    <tr>
                      <th scope="col" colspan="3" style="text-align: center;">From</th>
                      <th scope="col" colspan="3" style="text-align: center;">To</th>
                      <th scope="col" colspan="3" style="text-align: center;"></th>
                    </tr>
                      <tr>
                        <th scope="col" style="text-align: center;">दिनांक<br>Start Date</th>
                        <th scope="col" style="text-align: center;">प्रस्थान समय<br>Dep Time</th>
                        <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                        <th scope="col" style="text-align: center;">दिनांक<br>End Date</th>
                        <th scope="col" style="text-align: center;">आगमन समय<br>Arr Time</th>
                        <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                        <th scope="col" style="text-align: center;">माद्यम<br>Mode</th>
                        <th scope="col" style="text-align: center;">संख्या<br>No.</th>                          
                        <th scope="col" style="text-align: center;">उद्देश्य<br>Purpose</th>
                      </tr>
                  </thead>
                  <tbody>
                    {% for j in i.tour %}
                    <tr>
                      <td style="text-align: center;">{{j.date}}</td>
                      <td style="text-align: center;">{{j.dep_time}}</td>
                      <td style="text-align: center;">{{j.from}}</td>
                      <td style="text-align: center;">{{j.end_date}}</td>
                      <td style="text-align: center;">{{j.arr_time}}</td>
                      <td style="text-align: center;">{{j.to}}</td>
                      <td style="text-align: center;">{{j.mode}}</td>
                      <td style="text-align: center;">{{j.no}}</td>
                      <td style="text-align: center;">{{j.purpose}}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <div class="row" style="margin-left: 5px; margin-right: 5px;">
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Looking After By</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{ i.looking_after_officer }}
                      </div>
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Recommending Officer</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{ i.recommending_officer }}
                      </div>   
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Approving Authority</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{i.approving_officer}}
                      </div>   
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >For information</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        N/A
                      </div>   
                    </div> 
                  </div>
                </div>
                {% for j in i.previous_schedules %}
                <div style="margin-top: 50px; margin-bottom: 50px; padding: 10px; background-color: #a16666b0;">
                  <h5 style="text-align: center; width: 100%;">PAST SCHEDULE INFO-{{j.counter}}</h5>
                  <table>
                    <div class="row">
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Rly./Org</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Div./Unit</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Location type</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label for="division" class="lbl-caption">Location Name</label>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col" style="text-align: center;">
                        {{j.only_rail}}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.only_div != '' %}
                        {{j.only_div}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.loc_type != '' %}
                        {{j.loc_type}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.location != '' %}
                        {{j.location}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                    </div>
                  </table>
                  <div class="row" style="margin-left: 5px; margin-right: 5px;">
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Description</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{j.description}}
                        </div>
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Accompanied By</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {% if j.accompanied_by != '' %}
                            {{j.accompanied_by}}
                          {% else %}
                          N/A
                          {% endif %}
                        </div>   
                      </div> 
                    </div>
                  </div>
  
                  <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;" id="tb">
                    <col style="width:120px">
                    <col style="width:80px">
                    <col style="width:120px">
                    <thead>
                      <tr>
                        <th scope="col" colspan="3" style="text-align: center;">From</th>
                        <th scope="col" colspan="3" style="text-align: center;">To</th>
                        <th scope="col" colspan="3" style="text-align: center;"></th>
                      </tr>
                        <tr>
                          <th scope="col" style="text-align: center;">दिनांक<br>Start Date</th>
                          <th scope="col" style="text-align: center;">प्रस्थान समय<br>Dep Time</th>
                          <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                          <th scope="col" style="text-align: center;">दिनांक<br>End Date</th>
                          <th scope="col" style="text-align: center;">आगमन समय<br>Arr Time</th>
                          <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                          <th scope="col" style="text-align: center;">माद्यम<br>Mode</th>
                          <th scope="col" style="text-align: center;">संख्या<br>No.</th>                          
                          <th scope="col" style="text-align: center;">उद्देश्य<br>Purpose</th>
                        </tr>
                        <!-- <tr>
                          <th scope="col">From</th>
                          <th scope="col">To</th>
                        </tr>
                        <tr>
                          <th scope="col" style="text-align: center;">दिनांक<br>Date</th>
                          <th scope="col" style="text-align: center;">प्रस्थान<br>Dep</th>
                          <th scope="col" style="text-align: center;">से<br>From</th>
                          <th scope="col" style="text-align: center;">दिनांक<br>Date</th>
                          <th scope="col" style="text-align: center;">आगमन<br>Arrival</th>
                          <th scope="col" style="text-align: center;">तक<br>To</th>
                          <th scope="col" style="text-align: center;">माद्यम<br>Mode</th>
                          <th scope="col" style="text-align: center;">संख्या<br>No.</th>                          
                          <th scope="col" style="text-align: center;">उद्देश्य<br>Purpose</th>
                        </tr> -->
                    </thead>
                    <tbody>
                      {% for k in j.tour %}
                      <tr>
                        <td style="text-align: center;">{{k.date}}</td>
                        <td style="text-align: center;">{{k.dep_time}}</td>
                        <td style="text-align: center;">{{k.from}}</td>
                        <td style="text-align: center;">{{k.end_date}}</td>
                        <td style="text-align: center;">{{k.arr_time}}</td>
                        <td style="text-align: center;">{{k.to}}</td>
                        <td style="text-align: center;">{{k.mode}}</td>
                        <td style="text-align: center;">{{k.no}}</td>
                        <td style="text-align: center;">{{k.purpose}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  <div class="row" style="margin-left: 5px; margin-right: 5px;">
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Looking After By</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{ j.looking_after_officer }}
                        </div>
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Recommending Officer</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{ j.recommending_officer }}
                        </div>   
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Approving Authority</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{j.approving_officer}}
                        </div>   
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >For information</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          N/A
                        </div>   
                      </div> 
                    </div>
                  </div>
                </div>
                {% endfor %}
                <br>
                 <h5 style="text-align: center;">STATUS HISTORY<h5>
                  <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;">
                    <thead>
                      <tr>
                        <th>Remark Date</th>
                        <th>Operation</th>
                        <th>Given By</th>
                        <th>Remarks</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for j in i.remarks_data %}
                      <tr>
                        <td>{{j.rem_date}}</td>
                        <td>{{j.remarks}}</td>
                        <td>{{j.given_by}}</td>
                        <td>{{j.remarks_by_officer}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
              </div>
             
              {% endfor %}
              <script>
                function hideRowsOutbox(button) {
                  // var table = document.getElementById("inboxTable");
                  letter_no = "displayContentOutbox"+button.name;
                  var row = button.parentNode.parentNode;
                  var table = document.getElementById("outboxTable");
                  var rows = table.getElementsByTagName("tr");
                  
                  if (rows.length == 3){
                    if(document.getElementById(letter_no).classList.contains('hidden-row')){
                      document.getElementById(letter_no).classList.remove("hidden-row");
                    }
                    else{
                      document.getElementById(letter_no).classList.add("hidden-row");
                    }
                    return;
                  }
                  
                  for (var j = 2; j< rows.length; j++){
                    if( rows[j].classList.contains("hidden-row")){
                      // console.log('hi');
                      for (var i = 2; i < rows.length; i++) {
                        
                          rows[i].classList.remove("hidden-row");
                          if(document.getElementById(letter_no).classList.contains('hidden-row')){
                            continue;
                          }
                          else{
                            document.getElementById(letter_no).classList.add("hidden-row");
                          }
                      }
                      return;
                    }
                  }
                  for (var i = 2; i < rows.length; i++) {
                    // console.log('hi');
                          if (rows[i] !== row) {
                              rows[i].classList.add("hidden-row");
                          }
                          else{
                            document.getElementById(letter_no).classList.remove("hidden-row");
                          }
                      }
                }
              </script>

          </div>
        </div>
      </div>
      
      <div id="approved" class="tabcontent" style="display: none;">
        <div id="all_designation" class="container-fluid  tab-pane active"><br>
          <div id="div-all-desig">
              <table class="table table-striped table-bordered table-sm " style="width: 100%;" id="acceptedTable">
                  <thead style="background-color: #0066cc;white-space: nowrap;font-size: 1rem; color:white;text-align: center;">
                      <tr>
                        <th colspan="7"></th>
                        <th colspan="2">Action Taken</th>
                        <!-- <th colspan="3">Action Taken By</th> -->
                        <th></th>
                      </tr>
                      <tr>
                          <th>Letter No.</th>
                          <th>Description</th>
                          <th>Date of Submission</th>
                          <th>From</th>
                          <th>To</th>
                          <th>Duration</th>
                          <th>Rly./Div.</th>
                          <th>Approved On</th>
                          <th>Approved by</th>
                          <th>Action</th>
                      </tr>
                  </thead>
                  <tbody>
                      <style>
                        .success{
                          background-color: #52ad52;
                        }
                        .fail{
                          background-color: #ff4d4d;
                        }
                      </style>
                      {% for i in all_accepted %}
                      <tr class=" {% if i.status == 4 %} table-success {% endif %}{% if i.status == 7 %} table-danger {% endif %}">
                          <td style="text-align: center;" >{{ i.letter_no }}</td>
                          <td class="truncate" title="{{i.description}}" style="text-align: center;">{{i.description}}</td>
                          <td style="text-align: center;">{{i.date}}</td>
                          <td style="text-align: center">{{i.from}}</td>
                          <td style="text-align: center">{{i.to}}</td>
                          <td style="text-align: center">{{i.number_of_days}}</td>
                          <td class="truncate" title="{{i.rail}}" style="text-align: center;">{{i.rail}}</td>
                          <td style="text-align: center;">{{i.approved_on}}</td>
                          <td style="text-align: center;">{{i.approved_by }}</td>
                          <!-- <td>{{i.official_email_ID | default:'' }}</td> -->
                          <td>
                            <button type="button" name="{{ i.id }}" style="border-style: none; margin-left: 30%;" onclick="hideRowsAccepted(this)">
                              <i class="fas fa-angle-double-down" style="font-size:24px;color:rgb(105, 174, 238)"
                                  title="Click To Expand/Shrink Details"></i>
                          </button>
                          </td>
                      </tr>
                      {% endfor %}
                  </tbody>
                  <style>
                    .disabled-button {
                      pointer-events: none;
                      opacity: 0.6; /* Optional: To visually indicate the button is disabled */
                      cursor: not-allowed; /* Optional: To change the cursor style */
                      background-color: #d2d2d2;
                      color: #000;
                      border: #000;
                    }
                  </style>
              </table>
              {% for i in all_accepted %}
              <div class="inpt-container hidden-row" name="{{ i.letter_no }}" style="padding:10px; border-style:solid; border-width: 1px;" id="displayContentAccepted{{i.id}}">
                
                <h5 style="text-align: center;">CURRENT SCHEDULE INFO</h5>
                <table>
                  <div class="row">
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Rly./Org</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Div./Unit</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Location type</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label for="division" class="lbl-caption">Location Name</label>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col" style="text-align: center;">
                      {{i.only_rail}}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.only_div != '' %}
                      {{i.only_div}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.loc_type != '' %}
                      {{i.loc_type}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.location != '' %}
                      {{i.location}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                  </div>
                </table>
                <div class="row" style="margin-left: 5px; margin-right: 5px;">
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Description</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{i.description}}
                      </div>
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Accompanied By</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {% if i.accompanied_by != '' %}
                          {{i.accompanied_by}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>   
                    </div> 
                  </div>
                </div>

                <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;" id="tb">
                  <col style="width:120px">
                  <col style="width:80px">
                  <col style="width:120px">
                  <thead>
                    <tr>
                      <th scope="col" colspan="3" style="text-align: center;">From</th>
                      <th scope="col" colspan="3" style="text-align: center;">To</th>
                      <th scope="col" colspan="3" style="text-align: center;"></th>
                    </tr>
                      <tr>
                        <th scope="col" style="text-align: center;">दिनांक<br>Start Date</th>
                        <th scope="col" style="text-align: center;">प्रस्थान समय<br>Dep Time</th>
                        <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                        <th scope="col" style="text-align: center;">दिनांक<br>End Date</th>
                        <th scope="col" style="text-align: center;">आगमन समय<br>Arr Time</th>
                        <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                        <th scope="col" style="text-align: center;">माद्यम<br>Mode</th>
                        <th scope="col" style="text-align: center;">संख्या<br>No.</th>                          
                        <th scope="col" style="text-align: center;">उद्देश्य<br>Purpose</th>
                      </tr>
                  </thead>
                  <tbody>
                    {% for j in i.tour %}
                    <tr>
                      <td style="text-align: center;">{{j.date}}</td>
                      <td style="text-align: center;">{{j.dep_time}}</td>
                      <td style="text-align: center;">{{j.from}}</td>
                      <td style="text-align: center;">{{j.end_date}}</td>
                      <td style="text-align: center;">{{j.arr_time}}</td>
                      <td style="text-align: center;">{{j.to}}</td>
                      <td style="text-align: center;">{{j.mode}}</td>
                      <td style="text-align: center;">{{j.no}}</td>
                      <td style="text-align: center;">{{j.purpose}}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <div class="row" style="margin-left: 5px; margin-right: 5px;">
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Looking After By</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{ i.looking_after_officer }}
                      </div>
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Recommending Officer</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{ i.recommending_officer }}
                      </div>   
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Approving Authority</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{i.approving_officer}}
                      </div>   
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >For information</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        N/A
                      </div>   
                    </div> 
                  </div>
                </div>
                {% for j in i.previous_schedules %}
                <div style="margin-top: 50px; margin-bottom: 50px; padding: 10px; background-color: #a16666b0;">
                  <h5 style="text-align: center;">PAST SCHEDULE INFO-{{j.counter}}</h5>
                  <table>
                    <div class="row">
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Rly./Org</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Div./Unit</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Location type</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label for="division" class="lbl-caption">Location Name</label>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col" style="text-align: center;">
                        {{j.only_rail}}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.only_div != '' %}
                        {{j.only_div}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.loc_type != '' %}
                        {{j.loc_type}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.location != '' %}
                        {{j.location}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                    </div>
                  </table>
                  <div class="row" style="margin-left: 5px; margin-right: 5px;">
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Description</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{j.description}}
                        </div>
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Accompanied By</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {% if j.accompanied_by != '' %}
                            {{j.accompanied_by}}
                          {% else %}
                          N/A
                          {% endif %}
                        </div>   
                      </div> 
                    </div>
                  </div>
  
                  <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;" id="tb">
                    <col style="width:120px">
                    <col style="width:80px">
                    <col style="width:120px">
                    <thead>
                      <tr>
                        <th scope="col" colspan="3" style="text-align: center;">From</th>
                        <th scope="col" colspan="3" style="text-align: center;">To</th>
                        <th scope="col" colspan="3" style="text-align: center;"></th>
                      </tr>
                        <tr>
                          <th scope="col" style="text-align: center;">दिनांक<br>Start Date</th>
                          <th scope="col" style="text-align: center;">प्रस्थान समय<br>Dep Time</th>
                          <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                          <th scope="col" style="text-align: center;">दिनांक<br>End Date</th>
                          <th scope="col" style="text-align: center;">आगमन समय<br>Arr Time</th>
                          <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                          <th scope="col" style="text-align: center;">माद्यम<br>Mode</th>
                          <th scope="col" style="text-align: center;">संख्या<br>No.</th>                          
                          <th scope="col" style="text-align: center;">उद्देश्य<br>Purpose</th>
                        </tr>
                    </thead>
                    <tbody>
                      {% for k in j.tour %}
                      <tr>
                        <td style="text-align: center;">{{k.date}}</td>
                        <td style="text-align: center;">{{k.dep_time}}</td>
                        <td style="text-align: center;">{{k.from}}</td>
                        <td style="text-align: center;">{{k.end_date}}</td>
                        <td style="text-align: center;">{{k.arr_time}}</td>
                        <td style="text-align: center;">{{k.to}}</td>
                        <td style="text-align: center;">{{k.mode}}</td>
                        <td style="text-align: center;">{{k.no}}</td>
                        <td style="text-align: center;">{{k.purpose}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  <div class="row" style="margin-left: 5px; margin-right: 5px;">
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Looking After By</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{ j.looking_after_officer }}
                        </div>
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Recommending Officer</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{ j.recommending_officer }}
                        </div>   
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Approving Authority</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{j.approving_officer}}
                        </div>   
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >For information</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          N/A
                        </div>   
                      </div> 
                    </div>
                  </div>
                </div>
                <!-- <br> -->
                {% endfor %}
                <br>
                 <h5 style="text-align: center;">STATUS HISTORY<h5>
                  <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;">
                    <thead>
                      <tr>
                        <th>Remark Date</th>
                        <th>Operation</th>
                        <th>Given By</th>
                        <th>Remarks</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for j in i.remarks_data %}
                      <tr>
                        <td>{{j.rem_date}}</td>
                        <td>{{j.remarks}}</td>
                        <td>{{j.given_by}}</td>
                        <td>{{j.remarks_by_officer}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  
                  <div style="display: flex; gap: 10px;justify-content: flex-end;" name="{{i.id}}">
                    <button type="button" class="btn btn-primary {% if i.status == 4 or i.status == 7 %}disabled-button{% endif %}" onclick="modifySchedule(this)">Modify</button>
                    <button type="button" class="btn btn-outline-success {% if i.status == 4 or i.status == 7 %}disabled-button{% endif %}" onclick="markAsCompleted(this)" >Mark as Completed</button>
                    <button type="button" class="btn btn-outline-danger {% if i.status == 4 or i.status == 7 %}disabled-button{% endif %}" onclick="markAsCancelled(this)">Mark as Cancelled</button>                              
                  </div>

              </div>
             
              {% endfor %}
              <script>
                function modifySchedule(btn){
                  id = btn.parentNode.getAttribute("name");
                  window.location.href = '/form?modify_schedule_id=' + id;
                  // data = {
                  //   "id": id,
                  //   csrfmiddlewaretoken: '{{csrf_token}}'
                  // };
                  // $.ajax({
                  //   type: "POST",
                  //   url: "/schedule/modify",
                  //   data: data,
                  //   dataType: "json",

                  //   success: function(data){
                  //     if(data.status == "success"){
                  //       alert("Redirecting to modify page");
                  //       // window.location.reload();
                  //     }
                  //     else{
                  //       alert("Something went wrong");
                  //     }
                  //   }
                  // });
                }

                function markAsCompleted(btn){
                  id = btn.parentNode.getAttribute("name");
                  action = "completed";
                  data = {
                    "id": id,
                    "action": action,
                    csrfmiddlewaretoken: '{{csrf_token}}'
                  };
                  $.ajax({
                    type: "POST",
                    url: "/tour/update/",
                    data: data,
                    dataType: "json",

                    success: function(data){
                      if(data.status == "success"){
                        alert("Tour marked as completed");
                        window.location.reload();
                      }
                      else{
                        alert("Something went wrong");
                      }
                    }
                  });
                }

                function markAsCancelled(btn){
                  id = btn.parentNode.getAttribute("name");
                  action = "cancelled";
                  data = {
                    "id": id,
                    "action": action,
                    csrfmiddlewaretoken: '{{csrf_token}}'
                  };
                  $.ajax({
                    type: "POST",
                    url: "/tour/update/",
                    data: data,
                    dataType: "json",

                    success: function(data){
                      if(data.status == "success"){
                        alert("Tour marked as cancelled");
                        window.location.reload();
                      }
                      else{
                        alert("Something went wrong");
                      }
                    }
                  });
                }

                function hideRowsAccepted(btn) {
                  // var table = document.getElementById("inboxTable");
                  letter_no = "displayContentAccepted"+btn.name;
                  var row = btn.parentNode.parentNode;
                  var table = document.getElementById("acceptedTable");
                  var rows = table.getElementsByTagName("tr");
                  // console.log(rows);
                  if (rows.length == 3){
                    if(document.getElementById(letter_no).classList.contains('hidden-row')){
                      document.getElementById(letter_no).classList.remove("hidden-row");
                    }
                    else{
                      document.getElementById(letter_no).classList.add("hidden-row");
                    }
                    return;
                  }

                  for (var j = 2; j< rows.length; j++){
                    if( rows[j].classList.contains("hidden-row")){
                      // console.log('hi');
                      for (var i = 2; i < rows.length; i++) {
                        
                          rows[i].classList.remove("hidden-row");
                          if(document.getElementById(letter_no).classList.contains('hidden-row')){
                            continue;
                          }
                          else{
                            document.getElementById(letter_no).classList.add("hidden-row");
                          }
                      }
                      return;
                    }
                  }
                  for (var i = 2; i < rows.length; i++) {
                    // console.log('hi');
                          if (rows[i] !== row) {
                              rows[i].classList.add("hidden-row");
                          }
                          else{
                            document.getElementById(letter_no).classList.remove("hidden-row");
                          }
                      }
                }
              </script>
          </div>
        </div>
      </div>
      <div id="rejected" class="tabcontent" style="display: none;">
        <div id="all_designation" class="container-fluid  tab-pane active"><br>
          <div id="div-all-desig">
              <table class="table table-striped table-bordered table-sm" style="width: 100%;" id="rejectedTable">
                  <thead style="background-color: #0066cc;white-space: nowrap;font-size: 1rem; color:white;text-align: center;">
                      <tr>
                        <th colspan="4"></th>
                        <th colspan="2">Action Taken</th>
                        <!-- <th colspan="3">Action Taken By</th> -->
                        <th></th>
                      </tr>
                      <tr>
                          <th>Letter No.</th>
                          <th>Description</th>
                          <th>Date</th>
                          <th>Rly./Div.</th>
                          <!-- <th>Sent On</th> -->
                          <th>Rejected On</th>
                          <!-- <th>Approved On</th> -->
                          <!-- <th>Sent to</th> -->
                          <!-- <th>Approved by</th> -->
                          <th>Rejected by</th>
                          <th>Action</th>
                      </tr>
                  </thead>
                  <tbody>

                    {% for i in all_rejected %}
                    <tr>
                        <td style="text-align: center;">{{i.letter_no}}</td>
                        <td style="text-align: center;">{{i.description}}</td>
                        <td style="text-align: center;">{{i.date}}</td>

                        <td style="text-align: center;">{{i.rail}}</td>
                        <td style="text-align: center;">{{i.approved_on}}</td>
                        <td style="text-align: center;">{{i.approved_by }}</td>
                        <!-- <td>{{i.official_email_ID | default:'' }}</td> -->
                        <td>
                          <button type="button" style="border-style: none; margin-left: 30%;" name="{{i.id}}" onclick="hideRowsRejected(this)">
                            <i class="fas fa-angle-double-down" style="font-size:24px;color:rgb(105, 174, 238)"
                                title="Click To Expand/Shrink Details"></i>
                        </button>
                        </td>
                    </tr>
                    {% endfor %}
                  </tbody>
              </table>
              {% for i in all_rejected %}
              <div class="inpt-container hidden-row" style="padding:10px; border-style:solid; border-width: 1px;" id="displayContentRejected{{i.id}}">
                
                <h5 style="text-align: center;">CURRENT SCHEDULE INFO</h5>
                <table>
                  <div class="row">
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Rly./Org</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Div./Unit</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Location type</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label for="division" class="lbl-caption">Location Name</label>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col" style="text-align: center;">
                      {{i.only_rail}}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.only_div != '' %}
                      {{i.only_div}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.loc_type != '' %}
                      {{i.loc_type}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.location != '' %}
                      {{i.location}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                  </div>
                </table>
                <div class="row" style="margin-left: 5px; margin-right: 5px;">
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Description</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{i.description}}
                      </div>
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Accompanied By</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {% if i.accompanied_by != '' %}
                          {{i.accompanied_by}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>   
                    </div> 
                  </div>
                </div>

                <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;" id="tb">
                  <col style="width:120px">
                  <col style="width:80px">
                  <col style="width:120px">
                  <thead>
                    <tr>
                      <th scope="col" colspan="3" style="text-align: center;">From</th>
                      <th scope="col" colspan="3" style="text-align: center;">To</th>
                      <th scope="col" colspan="3" style="text-align: center;"></th>
                    </tr>
                      <tr>
                        <th scope="col" style="text-align: center;">दिनांक<br>Start Date</th>
                        <th scope="col" style="text-align: center;">प्रस्थान समय<br>Dep Time</th>
                        <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                        <th scope="col" style="text-align: center;">दिनांक<br>End Date</th>
                        <th scope="col" style="text-align: center;">आगमन समय<br>Arr Time</th>
                        <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                        <th scope="col" style="text-align: center;">माद्यम<br>Mode</th>
                        <th scope="col" style="text-align: center;">संख्या<br>No.</th>                          
                        <th scope="col" style="text-align: center;">उद्देश्य<br>Purpose</th>
                      </tr>
                  </thead>
                  <tbody>
                    {% for j in i.tour %}
                    <tr>
                      <td style="text-align: center;">{{j.date}}</td>
                      <td style="text-align: center;">{{j.dep_time}}</td>
                      <td style="text-align: center;">{{j.from}}</td>
                      <td style="text-align: center;">{{j.end_date}}</td>
                      <td style="text-align: center;">{{j.arr_time}}</td>
                      <td style="text-align: center;">{{j.to}}</td>
                      <td style="text-align: center;">{{j.mode}}</td>
                      <td style="text-align: center;">{{j.no}}</td>
                      <td style="text-align: center;">{{j.purpose}}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <div class="row" style="margin-left: 5px; margin-right: 5px;">
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Looking After By</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{ i.looking_after_officer }}
                      </div>
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Recommending Officer</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{ i.recommending_officer }}
                      </div>   
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Approving Authority</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{i.approving_officer}}
                      </div>   
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >For information</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        N/A
                      </div>   
                    </div> 
                  </div>
                </div>
                {% for j in i.previous_schedules %}
                <div style="margin-top: 50px; margin-bottom: 50px; padding: 10px; background-color: #a16666b0;">
                  <h5 style="text-align: center;">PAST SCHEDULE INFO-{{j.counter}}</h5>
                  <table>
                    <div class="row">
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Rly./Org</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Div./Unit</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Location type</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label for="division" class="lbl-caption">Location Name</label>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col" style="text-align: center;">
                        {{j.only_rail}}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.only_div != '' %}
                        {{j.only_div}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.loc_type != '' %}
                        {{j.loc_type}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.location != '' %}
                        {{j.location}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                    </div>
                  </table>
                  <div class="row" style="margin-left: 5px; margin-right: 5px;">
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Description</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{j.description}}
                        </div>
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Accompanied By</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {% if j.accompanied_by != '' %}
                            {{j.accompanied_by}}
                          {% else %}
                          N/A
                          {% endif %}
                        </div>   
                      </div> 
                    </div>
                  </div>
  
                  <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;" id="tb">
                    <col style="width:120px">
                    <col style="width:80px">
                    <col style="width:120px">
                    <thead>
                      <tr>
                        <th scope="col" colspan="3" style="text-align: center;">From</th>
                        <th scope="col" colspan="3" style="text-align: center;">To</th>
                        <th scope="col" colspan="3" style="text-align: center;"></th>
                      </tr>
                        <tr>
                          <th scope="col" style="text-align: center;">दिनांक<br>Start Date</th>
                          <th scope="col" style="text-align: center;">प्रस्थान समय<br>Dep Time</th>
                          <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                          <th scope="col" style="text-align: center;">दिनांक<br>End Date</th>
                          <th scope="col" style="text-align: center;">आगमन समय<br>Arr Time</th>
                          <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                          <th scope="col" style="text-align: center;">माद्यम<br>Mode</th>
                          <th scope="col" style="text-align: center;">संख्या<br>No.</th>                          
                          <th scope="col" style="text-align: center;">उद्देश्य<br>Purpose</th>
                        </tr>
                    </thead>
                    <tbody>
                      {% for k in j.tour %}
                      <tr>
                        <td style="text-align: center;">{{k.date}}</td>
                        <td style="text-align: center;">{{k.dep_time}}</td>
                        <td style="text-align: center;">{{k.from}}</td>
                        <td style="text-align: center;">{{k.end_date}}</td>
                        <td style="text-align: center;">{{k.arr_time}}</td>
                        <td style="text-align: center;">{{k.to}}</td>
                        <td style="text-align: center;">{{k.mode}}</td>
                        <td style="text-align: center;">{{k.no}}</td>
                        <td style="text-align: center;">{{k.purpose}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  <div class="row" style="margin-left: 5px; margin-right: 5px;">
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Looking After By</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{ j.looking_after_officer }}
                        </div>
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Recommending Officer</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{ j.recommending_officer }}
                        </div>   
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Approving Authority</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{j.approving_officer}}
                        </div>   
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >For information</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          N/A
                        </div>   
                      </div> 
                    </div>
                  </div>
                </div>
                <!-- <br> -->
                {% endfor %}
                <br>
                 <h5 style="text-align: center;">STATUS HISTORY<h5>
                  <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;">
                    <thead>
                      <tr>
                        <th>Remark Date</th>
                        <th>Operation</th>
                        <th>Given By</th>
                        <th>Remarks</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for j in i.remarks_data %}
                      <tr>
                        <td>{{j.rem_date}}</td>
                        <td>{{j.remarks}}</td>
                        <td>{{j.given_by}}</td>
                        <td>{{j.remarks_by_officer}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>

                 

              </div>
             
              {% endfor %}
              <script>
                function hideRowsRejected(btn) {
                  
                  letter_no = "displayContentRejected"+btn.name;
                  var row = btn.parentNode.parentNode;
                  var table = document.getElementById("rejectedTable");
                  var rows = table.getElementsByTagName("tr");
                  // console.log(rows);
                  if (rows.length == 3){
                    if(document.getElementById(letter_no).classList.contains('hidden-row')){
                      document.getElementById(letter_no).classList.remove("hidden-row");
                    }
                    else{
                      document.getElementById(letter_no).classList.add("hidden-row");
                    }
                    return;
                  }

                  for (var j = 2; j< rows.length; j++){
                    if( rows[j].classList.contains("hidden-row")){
                      // console.log('hi');
                      for (var i = 2; i < rows.length; i++) {
                        
                          rows[i].classList.remove("hidden-row");
                          if(document.getElementById(letter_no).classList.contains('hidden-row')){
                            continue;
                          }
                          else{
                            document.getElementById(letter_no).classList.add("hidden-row");
                          }
                      }
                      return;
                    }
                  }
                  for (var i = 2; i < rows.length; i++) {
                    // console.log('hi');
                          if (rows[i] !== row) {
                              rows[i].classList.add("hidden-row");
                          }
                          else{
                            document.getElementById(letter_no).classList.remove("hidden-row");
                          }
                      }
                }
              </script>
          </div>
        </div>
      </div>
      <style>
        .hidden-row {
            display: none;
        }
      </style>
      <div id="inbox" class="tabcontent" style="display: none;">
        <div id="all_designation" class="container-fluid  tab-pane active"><br>
          <div id="div-all-desig">
              <table class="table table-striped table-bordered table-sm" id="inboxTable" style="table-layout: fixed;">
                  <thead style="background-color: #0066cc;white-space: nowrap;font-size: 1rem; color:white;text-align: center;">
                      <tr>
                          <th>Letter No.</th>
                          <th>Description</th>
                          <th>Sent by</th>
                          <th>Remarks</th>
                          <th>Action</th>
                      </tr>
                  </thead>
                  <tbody>

                      {% for i in all_inbox %}
                      <tr>
                          <td style="text-align: center;">{{i.letter_no}}</td>
                          <td class="truncate" title="{{i.description}}" style="text-align: center;">{{i.description}}</td>
                          <td style="text-align: center;">{{i.sent_by}}</td>

                          <td style="text-align: center;">{{i.remark_to_be_shown}}</td>
                          <td>
                              <button type="button" name="{{i.id}}" onclick="hideRows(this)"
                                  style="border-style: none; margin-left: 30%;">
                                  <i class="fas fa-angle-double-down" style="font-size:24px;color:rgb(105, 174, 238)"
                                      title="Click To Expand/Shrink Details"></i>
                              </button>
                          </td>
                      </tr>
                      
                      {% endfor %}
                      
                  </tbody>
              </table>
              {% for i in all_inbox %}
              
              <div class="inpt-container hidden-row" style="padding:10px; border-style:solid; border-width: 1px;" id="displayContentInbox{{i.id}}">
                
                <h5 style="text-align: center;">CURRENT SCHEDULE INFO</h5>
                <table id="">
                  <div class="row">
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Rly./Org</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Div./Unit</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label class="lbl-caption">Location type</label>
                    </div>
                    <div class="col" style="text-align: center;">
                      <label for="division" class="lbl-caption">Location Name</label>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col" style="text-align: center;">
                      {{i.rail}}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.div != '' %}
                      {{i.div}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.loc_type != '' %}
                      {{i.loc_type}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                    <div class="col" style="text-align: center;">
                      {% if i.location != '' %}
                      {{i.location}}
                      {% else %}
                      N/A
                      {% endif %}
                    </div>
                  </div>
                </table>
                <div class="row" style="margin-left: 5px; margin-right: 5px;">
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Description</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{i.description}}
                      </div>
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Accompanied By</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {% if i.accompanied_by != '' %}
                          {{i.accompanied_by}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>   
                    </div> 
                  </div>
                </div>

                <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;" id="tb">
                  <col style="width:120px">
                  <col style="width:80px">
                  <col style="width:120px">
                  <thead>
                    <tr>
                      <th scope="col" colspan="3" style="text-align: center;">From</th>
                      <th scope="col" colspan="3" style="text-align: center;">To</th>
                      <th scope="col" colspan="3" style="text-align: center;"></th>
                    </tr>
                      <tr>
                        <th scope="col" style="text-align: center;">दिनांक<br>Start Date</th>
                        <th scope="col" style="text-align: center;">प्रस्थान समय<br>Dep Time</th>
                        <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                        <th scope="col" style="text-align: center;">दिनांक<br>End Date</th>
                        <th scope="col" style="text-align: center;">आगमन समय<br>Arr Time</th>
                        <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                        <th scope="col" style="text-align: center;">माद्यम<br>Mode</th>
                        <th scope="col" style="text-align: center;">संख्या<br>No.</th>                          
                        <th scope="col" style="text-align: center;">उद्देश्य<br>Purpose</th>
                      </tr>
                  </thead>
                  <tbody>
                    {% for j in i.tour %}
                    <tr>
                      <td style="text-align: center;">{{j.date}}</td>
                      <td style="text-align: center;">{{j.dep_time}}</td>
                      <td style="text-align: center;">{{j.from}}</td>
                      <td style="text-align: center;">{{j.end_date}}</td>
                      <td style="text-align: center;">{{j.arr_time}}</td>
                      <td style="text-align: center;">{{j.to}}</td>
                      <td style="text-align: center;">{{j.mode}}</td>
                      <td style="text-align: center;">{{j.no}}</td>
                      <td style="text-align: center;">{{j.purpose}}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>

                <div class="row" style="margin-left: 5px; margin-right: 5px;">
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Looking After By</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{ i.looking_after_officer }}
                      </div>
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Recommending Officer</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{ i.recommending_officer }}
                      </div>   
                    </div> 
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="event" class="lbl-caption" >Approving Authority</label>
                      <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                        {{i.approving_officer}}
                      </div>   
                    </div> 
                  </div>
                </div>

                {% for j in i.previous_schedules %}
                <div style="margin-top: 50px; margin-bottom: 50px; padding: 10px; background-color: #a16666b0;">
                  <h5 style="text-align: center;">PAST SCHEDULE INFO-{{j.counter}}</h5>
                  <table>
                    <div class="row">
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Rly./Org</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Div./Unit</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label class="lbl-caption">Location type</label>
                      </div>
                      <div class="col" style="text-align: center;">
                        <label for="division" class="lbl-caption">Location Name</label>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col" style="text-align: center;">
                        {{j.only_rail}}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.only_div != '' %}
                        {{j.only_div}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.loc_type != '' %}
                        {{j.loc_type}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                      <div class="col" style="text-align: center;">
                        {% if j.location != '' %}
                        {{j.location}}
                        {% else %}
                        N/A
                        {% endif %}
                      </div>
                    </div>
                  </table>
                  <div class="row" style="margin-left: 5px; margin-right: 5px;">
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Description</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{j.description}}
                        </div>
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Accompanied By</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {% if j.accompanied_by != '' %}
                            {{j.accompanied_by}}
                          {% else %}
                          N/A
                          {% endif %}
                        </div>   
                      </div> 
                    </div>
                  </div>
  
                  <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;" id="tb">
                    <col style="width:120px">
                    <col style="width:80px">
                    <col style="width:120px">
                    <thead>
                      <tr>
                        <th scope="col" colspan="3" style="text-align: center;">From</th>
                        <th scope="col" colspan="3" style="text-align: center;">To</th>
                        <th scope="col" colspan="3" style="text-align: center;"></th>
                      </tr>
                        <tr>
                          <th scope="col" style="text-align: center;">दिनांक<br>Start Date</th>
                          <th scope="col" style="text-align: center;">प्रस्थान समय<br>Dep Time</th>
                          <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                          <th scope="col" style="text-align: center;">दिनांक<br>End Date</th>
                          <th scope="col" style="text-align: center;">आगमन समय<br>Arr Time</th>
                          <th scope="col" style="text-align: center;">स्टेशन<br>Station</th>
                          <th scope="col" style="text-align: center;">माद्यम<br>Mode</th>
                          <th scope="col" style="text-align: center;">संख्या<br>No.</th>                          
                          <th scope="col" style="text-align: center;">उद्देश्य<br>Purpose</th>
                        </tr>
                    </thead>
                    <tbody>
                      {% for k in j.tour %}
                      <tr>
                        <td style="text-align: center;">{{k.date}}</td>
                        <td style="text-align: center;">{{k.dep_time}}</td>
                        <td style="text-align: center;">{{k.from}}</td>
                        <td style="text-align: center;">{{k.end_date}}</td>
                        <td style="text-align: center;">{{k.arr_time}}</td>
                        <td style="text-align: center;">{{k.to}}</td>
                        <td style="text-align: center;">{{k.mode}}</td>
                        <td style="text-align: center;">{{k.no}}</td>
                        <td style="text-align: center;">{{k.purpose}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  <div class="row" style="margin-left: 5px; margin-right: 5px;">
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Looking After By</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{ j.looking_after_officer }}
                        </div>
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Recommending Officer</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{ j.recommending_officer }}
                        </div>   
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >Approving Authority</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          {{j.approving_officer}}
                        </div>   
                      </div> 
                    </div>
                    <div class="col">
                      <div class="form-group">
                        <label for="event" class="lbl-caption" >For information</label>
                        <div contenteditable="false" style="background-color: #d2d2d2; padding: 10px; border-radius: 8px;">
                          N/A
                        </div>   
                      </div> 
                    </div>
                  </div>
                </div>
                <!-- <br> -->
                {% endfor %}

                <br>
                <h5 style="text-align: center;">STATUS HISTORY</h5>
                <table class="table table-hover table-data table-sm table-striped table-bordered" style="margin-top: 10px;">
                  <thead>
                    <tr>
                      <th>Remark Date</th>
                      <th>Operation</th>
                      <th>Given By</th>
                      <th>Remarks</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for j in i.remarks_data %}
                    <tr>
                      <td>{{j.rem_date}}</td>
                      <td>{{j.remarks}}</td>
                      <td>{{j.given_by}}</td>
                      <td>{{j.remarks_by_officer}}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>

                <br>
                <div style="display: flex; align-items: center; background-color: #CEE4FD; padding-top: 20px; padding-bottom: 20px; padding-left: 20px; padding-right: 20px; margin-left: -10px; margin-right: -10px;"  id="{{i.id}}">
                  <input type="text" id="remarks{{i.id}}" placeholder="Enter Remarks Here(if any)" style="margin-right: 10px; height: 50px;">
                  <button class="btn-primary" style="margin-right: 5px; height: 50px;" onclick="acceptSchedule(this)">Accept</button>
                  <button class="btn-danger" style="height: 50px;" onclick="rejectSchedule(this)">Reject</button>
                </div>
                
              </div>
              
              {% endfor %}

              <script>
                function acceptSchedule(btn){
                  schedule_id = btn.parentNode.id;
                  remarks = document.getElementById("remarks"+schedule_id).value;
                  data = {
                    schedule_id: schedule_id,
                    remarks: remarks,
                    csrfmiddlewaretoken: '{{csrf_token}}'
                  };

                  $.ajax({
                    type:'POST',
                    data: data,
                    url:'/accept_schedule/',
                    dataType:'json',
                    

                    success: function (response) {
                      alert('Schedule accepted Successfully!');
                      window.location.href="/form/";
                    }
                  })
                }

                function rejectSchedule(btn){
                  schedule_id = btn.parentNode.id;
                  remarks = document.getElementById("remarks"+schedule_id).value;
                  data = {
                    schedule_id: schedule_id,
                    remarks: remarks,
                    csrfmiddlewaretoken: '{{csrf_token}}'
                  };

                  $.ajax({
                    type:'POST',
                    data: data,
                    url:'/reject_schedule/',
                    dataType:'json',
                    

                    success: function (response) {
                      alert('Schedule rejected Successfully!');
                      window.location.href="/form/";
                    }
                  })
                }
              </script>

              <script>
                function hideRows(btn) {
                  letter_no = "displayContentInbox"+btn.name;
                  var row = btn.parentNode.parentNode;
                  var table = document.getElementById("inboxTable");
                  var rows = table.getElementsByTagName("tr");
                  if (rows.length == 2){
                    if(document.getElementById(letter_no).classList.contains('hidden-row')){
                      document.getElementById(letter_no).classList.remove("hidden-row");
                    }
                    else{
                      document.getElementById(letter_no).classList.add("hidden-row");
                    }
                    return;
                  }

                  for (var j = 2; j< rows.length; j++){
                    if( rows[j].classList.contains("hidden-row")){
                      // console.log('hi');
                      for (var i = 2; i < rows.length; i++) {
                        
                          rows[i].classList.remove("hidden-row");
                          if(document.getElementById(letter_no).classList.contains('hidden-row')){
                            continue;
                          }
                          else{
                            document.getElementById(letter_no).classList.add("hidden-row");
                          }
                      }
                      return;
                    }
                  }
                  for (var i = 2; i < rows.length; i++) {
                    // console.log('hi');
                          if (rows[i] !== row) {
                              rows[i].classList.add("hidden-row");
                          }
                          else{
                            document.getElementById(letter_no).classList.remove("hidden-row");
                          }
                      }
                }
              </script>
          </div>
        </div>
      </div>
        </body>
    <script>
      function openCity(cityName, elmnt, color) {
        // Hide all elements with class="tabcontent" by default */
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }

        // Remove the background color of all tablinks/buttons
        tablinks = document.getElementsByClassName("tablink");
        for (i = 0; i < tablinks.length; i++) {
          tablinks[i].style.backgroundColor = "";
        }
        if (cityName != 'mainForm'){
          document.getElementById('all-buttons').style.display = "none";
        }
        else{
          document.getElementById('all-buttons').style.display = "block";
        }
        // Show the specific tab content
        document.getElementById(cityName).style.display = "block";

        // Add the specific color to the button used to open the tab content
        elmnt.style.backgroundColor = color;
      }

      // Get the element with id="defaultOpen" and click on it
      document.getElementById("defaultOpen").click();

    function clear1(){
      var table = document.getElementById('tb');
      var rowCount = table.rows.length;
      while(rowCount > '2'){
      var row = table.deleteRow(rowCount-1);
      rowCount--;

      hli--;
    }
      document.getElementById("addheading").click();
      // document.getElementById("date1_0").value = "";
      // document.getElementById("dep-hour1").value = "";
      // document.getElementById("location1_0").value = "";
      // document.getElementById("date1_1").value = "";
      // document.getElementById("arr-hour1").value = "";
      // document.getElementById("location1_1").value = "";
      // document.getElementById("mode1").value = "";
      // document.getElementById("num1").value = "";
      // document.getElementById("purpose1").selectedIndex  = 1;
      // document.getElementById("date1_0").value = "";
    }  
    
 // Draft Validation Code start
 function convertToDate(dateString) {
      var dateParts = dateString.split("-"); // Split the string into day, month, and year parts
      var day = parseInt(dateParts[0], 10); // Extract the day component and convert it to an integer
      var month = parseInt(dateParts[1], 10) - 1; // Extract the month component (subtract 1 since months are zero-based)
      var year = parseInt(dateParts[2], 10); // Extract the year component
      return new Date(year, month, day); // Construct a new Date object with the components
    }
  function validation(){
         
         var railway= document.getElementById('rly_1').value;
        //  console.log(railway);
        //  var description= document.getElementById('description').value;
         if( railway == ""){
            alert("Please enter rly./org.");
            return false;
         }

         var table = document.getElementById("tb"); // Replace "myTable" with the ID of your table
          var numRows = table.rows.length - 1;

        for(let i=1; i<numRows; i++)
        {
         date_curr=document.getElementById('date'+String(i)+'_0').value;
        
         if(date_curr ==''){
           alert("Please enter date of departure");
            return false;}

            date_curr2=document.getElementById('date'+String(i)+'_1').value;
        console.log(date_curr2);
          if(date_curr2 ==''){
            alert("Please enter date of arrival");
            return false;}
        }
        var date1 = "";
        var date2 = "";
        for(let i=1; i<numRows; i++){
          var da1 = document.getElementById('date'+String(i)+'_0').value;
          var da2 = document.getElementById('date'+String(i)+'_1').value;
          // console.log(date1, date2);
          date1 = convertToDate(da1).getTime();
          date2 = convertToDate(da2).getTime();
          if(date1 > date2){
            alert("Date of departure cannot be greater than date of arrival");
            return false;
          }
        }
        
        
        for(let i=1;i<numRows;i++){
        purpose=document.getElementById('purpose'+String(i)).value;
        if(purpose =='none' || purpose =='' || purpose == undefined){
          alert("Please enter purpose of schedule");
          return false;
        } 
       }

       for(let i=1; i<numRows; i++){
        var time1 = document.getElementById('dep-hour'+String(i)).value;
        var time2 = document.getElementById('arr-hour'+String(i)).value;
        var date1 = document.getElementById('date'+String(i)+'_0').value;
        var date2 = document.getElementById('date'+String(i)+'_1').value;
        // console.log("bool", typeof(date1), date2);
        if(time1 != "" && time2 != "" && date1 == date2){
          var time1 = time1.split(":");
          var time2 = time2.split(":");
          // console.log(time1, time2);
          if(time1[0] > time2[0]){
            alert("Departure time cannot be greater than arrival time");
            return false;
          }
          else if(time1[0] == time2[0]){
            if(time1[1] > time2[1]){
              alert("Departure time cannot be greater than arrival time");
              return false;
            }
          }
        }
       }

        for(let i=2; i<numRows; i++){
          var da1 = document.getElementById('date'+String(i-1)+'_1').value;
          var da2 = document.getElementById('date'+String(i)+'_0').value;
          // console.log(date1, date2);
          date1 = convertToDate(da1).getTime();
          date2 = convertToDate(da2).getTime();
          if(date1 > date2){
            alert("Date of arrival of previous schedule cannot be greater than date of departure of next schedule");
            return false;
          }
        }
     
         formchange1();
     }
     // Draft Validation code end
    function validation1(){
         
      var railway= document.getElementById('rly_1').value;
      if( railway == ""){
        alert("Please enter rly./org.");
        return false;
      }

      var description = document.getElementById('description').value;
         if(description == ""){
          alert("Please enter a description");
          return false;
         }

      //LOCATION NAME AND LOCATION TYPE VALIDATION - REQUIRED

      // var loc_name = document.getElementById('displayValue').value;
      // if(loc_name == ""){
      //   alert("Please enter Location Name");
      //   return false;
      // }

      // var loc_type = document.getElementById("locationType").value;
      // if(loc_type == ""){
      //   alert("Please enter Location Type");
      //   return false;
      // }

      // var desc = document.getElementById("description").value;
      // if(desc == ""){
      //   alert("Please enter description");
      //   return false;
      // }

      // var accompanied_by = document.getElementById('accompany').value;
      // if(accompanied_by == ""){
      //   alert("Please enter accompany by");
      //   return false;
      // }
      var table = document.getElementById("tb"); // Replace "myTable" with the ID of your table
      var numRows = table.rows.length -1;

      for(let i=1; i<numRows; i++){
        console.log("i", i);
         date_curr=document.getElementById('date'+String(i)+'_0').value;
        
         if(date_curr ==''){
           alert("Please enter date of departure");
            return false;}

            date_curr2=document.getElementById('date'+String(i)+'_1').value;
        console.log(date_curr2);
          if(date_curr2 ==''){
            alert("Please enter date of arrival");
            return false;}
      }
        var date1 = "";
        var date2 = "";
        for(let i=1; i<numRows; i++){
          var da1 = document.getElementById('date'+String(i)+'_0').value;
          var da2 = document.getElementById('date'+String(i)+'_1').value;
          // console.log(date1, date2);
          date1 = convertToDate(da1).getTime();
          date2 = convertToDate(da2).getTime();
          if(date1 > date2){
            alert("Date of departure cannot be greater than date of arrival");
            return false;
          }
        }
        
        
        for(let i=1;i<numRows;i++){
        purpose=document.getElementById('purpose'+String(i)).value;
        if(purpose =='none'){
          alert("Please enter purpose of schedule");
          return false;
        } 
       }

       var time1 = "";
       for(let i=1; i<numRows; i++){
        time1 = document.getElementById('dep-hour'+String(i)).value;
        var time2 = document.getElementById('arr-hour'+String(i)).value;
        // console.log("bool", typeof(date1), date2);
        if(time1 != "" && time2 != "" && date1 == date2){
          var time1 = time1.split(":");
          var time2 = time2.split(":");
          // console.log(time1, time2);
          if(time1[0] > time2[0]){
            alert("Departure time cannot be greater than arrival time");
            return false;
          }
          else if(time1[0] == time2[0]){
            if(time1[1] > time2[1]){
              alert("Departure time cannot be greater than arrival time");
              return false;
            }
          }
        }
      }

      for(let i=1; i<numRows; i++){
        if(time1 != ""){
          var loc1 = document.getElementById('location'+String(i)+'_0').value;
          var loc2 = document.getElementById('location'+String(i)+'_1').value;
          if(loc1 == "" || loc2 == ""){
            alert("Please enter location");
            return false;
          }
        }
      }

      var accompanied_by = document.getElementById('approve_auth').value;
      if(accompanied_by == ""){
        alert("Please enter designation of approving authority");
        return false;
      }

      


      formchange();
  }

  

  function getSelectValues(select) {
    var result = [];
    var options = select && select.options;
    var opt;

    for (var i=0, iLen=options.length; i<iLen; i++) {
      opt = options[i];

      if (opt.selected) {
        result.push(opt.value || opt.text);
      }
    }
    return result;
  }

  //draft save
  function formchange1() {
       
        // $("#draft").attr("disabled", true);
        let schedule_data=[]
        let count=$('#count_row').val() + 1
        // console.log("count", count);
        
        temp_dict = {}
        var el = document.getElementById('rly_1');  //get railway/org list  
        temp_dict['railway'] = getSelectValues(el); //store railway in temp_dict
        
        var division = document.getElementById('div_1'); //get division
        temp_dict['division'] = getSelectValues(division); //store division in temp_dict

        var location_type = document.getElementById('locationType'); //get location type
        temp_dict['location_type'] = getSelectValues(location_type); //store location type in temp_dict
        
        var department = document.getElementById('displayValue'); //get location name
        temp_dict['location'] = getSelectValues(department); //store department in temp_dict
        console.log(temp_dict['location']);

        var description = document.getElementById('description').value; //get description
        temp_dict['description'] = description; //store description in temp_dict

        var accompanied_by = document.getElementById('accompany'); //get accompanied_by
        temp_dict['accompanied_by'] = getSelectValues(accompanied_by); //store accompanied_by in temp_dict

        // temp_dict['location'] = '';

        temp_dict['document'] = final_file_name; //store document in temp_dict
        

        var looking_after = document.getElementById('looking_after').value; //get looking_after
        temp_dict['looking_after'] = looking_after; //store looking_after in temp_dict

        var recom_officer = document.getElementById('recom_officer').value; //get recom_officer
        temp_dict['recom_officer'] = recom_officer; //store recom_officer in temp_dict

        var approve_auth = document.getElementById('approve_auth').value; //get approve_auth
        temp_dict['approve_auth'] = approve_auth; //store approve_auth in temp_dict

        var info = document.getElementById('info');  //get for info
        temp_dict['info'] = getSelectValues(info); //store info in info

        console.log(temp_dict);
        var table = document.getElementById("tb"); // Replace "myTable" with the ID of your table
        var numRows = table.rows.length;
        console.log(numRows);

        for(let x=1; x<numRows; x++){

          let dict= {}
          let dat= 'date'+x+'_0'
          let date = $('#'+dat).val()
          dict['date'] =  date

          let dat1= 'date'+x+'_1'
          let date1 = $('#'+dat1).val()
          dict['date1'] =  date1

          let mo = 'mode'+x
          let mode = $('#'+mo).val()
          dict['mode'] = mode

          let no= 'num'+x
          let number = $('#'+ no).val()
          dict['number'] = number

          let dep_h= 'dep-hour'+x
          let dep_hour = $('#'+dep_h).val()
          dict['dep_hour'] = dep_hour
          
          // let dep_m= 'dep-min'+x
          // let dep_min = $('#'+dep_m).val()
          // dict['dep_min'] = dep_min

          let arr_h= 'arr-hour'+x
          let arr_hour = $('#'+arr_h).val()
          dict['arr_hour'] = arr_hour
          
          // let arr_m= 'arr-min'+x
          // let arr_min = $('#'+arr_m).val()
          // dict['arr_min'] = arr_min

          let fr= 'location'+ x +"_0";
          let fro = $('#'+fr).val()
          dict['from'] = fro

          let t= 'location'+x+"_1"
          let to = $('#'+t).val()
          dict['to'] = to

          let pur= 'purpose'+x
          let purpose = $('#'+pur).val()
          dict['purpose'] = purpose

          let id = 'tour_detail_id'+x
          let tour_id = $('#'+id).val()
          dict["tour_id"] = tour_id
         
          schedule_data.push(dict)
        }
        r = confirm('Are you sure you want to confirm!')
        if ( r == true){
          console.log("true")
        }
        else{
          return;
        }
        
        mydata = [temp_dict, schedule_data];
        console.log(mydata);
       
        //creating json object to send to backend
        let data1={
        data : JSON.stringify(mydata),
        isSubmit: false,
        event: $("#displayValue").val(),
        csrfmiddlewaretoken: '{{csrf_token}}'
       };
       if("{{draft_details.is_exists}}" == 'True'){
          data1['is_exists'] = true;
          $.ajax({
            type:'POST',       
            data: data1,
            url: "/saveDraftData/?draft_id={{draft_details.draft_id}}",
            dataType:'json',
          
            success: function (response) {
              alert('Data save as draft successfully');
              window.location.href="/form/?draft_id="+response['draft_id']
    
            }
          })
       }
      else{
        data1['is_exists'] = false;
      $.ajax({
          type:'POST',       
          data: data1,
          url:'{% url "saveDraftData" %}',
          dataType:'json',
        
          success: function (response) {
            console.log("hi",response);
            alert('Data save as draft successfully');
            window.location.href="/form/?draft_id="+response['draft_id']
  
          }
        })
      }
      
      }

      $("#aFile_upload").on("change", function (e) {

var count=1;
var files = e.currentTarget.files; // puts all files into an array

// call them as such; files[0].size will get you the file size of the 0th file
for (var x in files) {

    var filesize = ((files[x].size/1024)/1024).toFixed(4); // MB

    if (files[x].name != "item" && typeof files[x].name != "undefined" && filesize <= 10) { 

        if (count > 1) {
            
            approvedHTML += ", "+files[x].name;
        }
        else {
        
            approvedHTML += files[x].name;
        }

        count++;
    }
}
$("#approvedFiles").val(approvedHTML);

});
  

    //draft save end
  function formchange() {
        // $("#submit").attr("disabled", true);
         // $("#draft").attr("disabled", true);
         let schedule_data=[]
        let count=$('#count_row').val() + 1
        // console.log("count", count);
        
        temp_dict = {}
        var el = document.getElementById('rly_1');  //get railway/org list  
        temp_dict['railway'] = getSelectValues(el); //store railway in temp_dict
        
        var division = document.getElementById('div_1'); //get division
        temp_dict['division'] = getSelectValues(division); //store division in temp_dict
        
        var location_type = document.getElementById('locationType'); //get location type
        temp_dict['location_type'] = getSelectValues(location_type); //store location type in temp_dict

        var department = document.getElementById('displayValue'); //get location name
        temp_dict['location'] = getSelectValues(department); //store department in temp_dict

        var description = document.getElementById('description').value; //get description
        temp_dict['description'] = description; //store description in temp_dict

        var accompanied_by = document.getElementById('accompany'); //get accompanied_by
        temp_dict['accompanied_by'] = getSelectValues(accompanied_by); //store accompanied_by in temp_dict

        // temp_dict['location'] = '';

        temp_dict['document'] = final_file_name; //store document in temp_dict
        

        var looking_after = document.getElementById('looking_after').value; //get looking_after
        temp_dict['looking_after'] = looking_after; //store looking_after in temp_dict

        var recom_officer = document.getElementById('recom_officer').value; //get recom_officer
        temp_dict['recom_officer'] = recom_officer; //store recom_officer in temp_dict

        var approve_auth = document.getElementById('approve_auth').value; //get approve_auth
        temp_dict['approve_auth'] = approve_auth; //store approve_auth in temp_dict

        var info = document.getElementById('info');  //get for info
        temp_dict['info'] = getSelectValues(info); //store info in info

        console.log(temp_dict);
        var table = document.getElementById("tb"); // Replace "myTable" with the ID of your table
        var numRows = table.rows.length;
        console.log(numRows);

        for(let x=1; x<numRows; x++){

          let dict= {}
          let dat= 'date'+x+'_0'
          let date = $('#'+dat).val()
          dict['date'] =  date

          let dat1= 'date'+x+'_1'
          let date1 = $('#'+dat).val()
          dict['date1'] =  date

          let mo = 'mode'+x
          let mode = $('#'+mo).val()
          dict['mode'] = mode

          let no= 'num'+x
          let number = $('#'+ no).val()
          dict['number'] = number

          let dep_h= 'dep-hour'+x
          let dep_hour = $('#'+dep_h).val()
          dict['dep_hour'] = dep_hour
          
          // let dep_m= 'dep-min'+x
          // let dep_min = $('#'+dep_m).val()
          // dict['dep_min'] = dep_min

          let arr_h= 'arr-hour'+x
          let arr_hour = $('#'+arr_h).val()
          dict['arr_hour'] = arr_hour
          
          // let arr_m= 'arr-min'+x
          // let arr_min = $('#'+arr_m).val()
          // dict['arr_min'] = arr_min

          let fr= 'location'+ x +"_0";
          let fro = $('#'+fr).val()
          dict['from'] = fro

          let t= 'location'+x+"_1"
          let to = $('#'+t).val()
          dict['to'] = to

          let pur= 'purpose'+x
          let purpose = $('#'+pur).val()
          dict['purpose'] = purpose

          let id = 'tour_detail_id'+x
          let tour_id = $('#'+id).val()
          dict["tour_id"] = tour_id
         
          schedule_data.push(dict)
        }

        r = confirm('Are you sure you want to submit the data!')
        if ( r == true){
          console.log("true")
        }
        else{
          return;
        }


        mydata = [temp_dict, schedule_data];
        console.log(mydata);
       
        let data1={
          data : JSON.stringify(mydata),
          event: $("#displayValue").val(),
          isSubmit: true,
          csrfmiddlewaretoken: '{{csrf_token}}'
       };
       if("{{draft_details.is_modify}}" == 'False'){
        if("{{draft_details.is_exists}}" == 'True'){
            data1['is_exists'] = true;
            $.ajax({
              type:'POST',       
              data: data1,
              url: "/saveDraftData/?draft_id={{draft_details.draft_id}}",
              dataType:'json',
            
              success: function (response) {
                alert('Schedule submitted successfully');
                window.location.href="/form/"
      
              }
            })
        }
        else{
          data1['is_exists'] = false;
        $.ajax({
            type:'POST',       
            data: data1,
            url:'{% url "saveDraftData" %}',
            dataType:'json',
          
            success: function (response) {
              console.log("hi",response);
              alert('Schedule submitted successfully');
              window.location.href="/form/"
    
            }
          })
        }
    }
    else{
      $.ajax({
            type:'POST',       
            data: data1,
            url:'/tour/modify/?schedule_id={{draft_details.draft_id}}',
            dataType:'json',
          
            success: function (response) {
              console.log("hi",response);
              alert('Schedule submitted successfully');
              window.location.href="/form/"
    
            }
          })
    }
      // $.ajax({
      //     type:'POST',       
      //     data: data1,
      //     url:'/saveDraftData/?draft_id={{draft_details.draft_id}}',
      //     dataType:'json',
        
      //     success: function (response) {
            
      //       alert('Data saved successfully');
      //       window.location.href="{% url 'listofschedule/' %}"
  
      //     }
      //   })
      }

      function railway__1(id){
       
        let newid = id.substr(4)
        
        var rly=$('#zone'+newid).val();
    
    
        data={
            'rly_data': JSON.stringify(rly)
            
          }

          $.ajax({
            type : 'GET',
            url : "{% url 'getdiv_rly1' %}",
            dataType : 'json',
            data : data,

            success : function(response){
              division=response.division;
                          $('#division'+ newid).empty();
                          $('#division'+ newid).append(`<option value="" >NA</option>`);
                          for (let i = 0; i < division.length; i++) {
                            $('#division'+newid).append(`<option value="${division[i].location_code}"> ${division[i].location_code}-${division[i].location_type}</option>`);
                                      }
            }
          })
      }

  function location_dropdown(id){
        $(id).select2({
          
          minimumInputLength: 1,
          language: {
              inputTooShort: function() {
                return 'Please Add Location';
              }
            },
          tags: [],
          ajax: {
              url: '{% url "autoFetchLocation1" %}',
              dataType: 'json',
              type: "GET",
              quietMillis: 50,
              data: function (term) {
                  return {
                      last_val: term.term
                  };
                
                  
              },
              processResults: function (data) {
                return {
                      results: $.map(data, function (item) {
                      
                        
                          return{
                            text: item.city,
                            
                            id: item.city,
                          }
                      })
                  };
                },
          }
      });
    }
      // NOTEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE

      
    
    

    var globallistgm='';
    var globallistbm='';
    var globallistdrm='';
    var globallistphod='';
    
    function auto(inp, arr) {
      var currentFocus;
      inp.addEventListener("input", function(e) {
          var a, b, i, val = this.value;
          closeAllLists();
          if (!val) { return false;}
          currentFocus = -1;
          a = document.createElement("DIV");
          a.setAttribute("id", this.id + "autocomplete-list");
          a.setAttribute("class", "autocomplete-items");
        
          this.parentNode.appendChild(a);
       
          for (i = 0; i < arr.length; i++) {
    
            if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
              
              b = document.createElement("DIV");
           
              b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
              b.innerHTML += arr[i].substr(val.length);
            
              b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
           
                  b.addEventListener("click", function(e) {
            
                  inp.value = this.getElementsByTagName("input")[0].value;
                  
                  closeAllLists();
                  
              });
              a.appendChild(b);
            }
          }
      });
    
      inp.addEventListener("keydown", function(e) {
          var x = document.getElementById(this.id + "autocomplete-list");
          if (x) x = x.getElementsByTagName("div");
          if (e.keyCode == 40) {
            
            currentFocus++;
            
            addActive(x);
          } else if (e.keyCode == 38) { 
          
            currentFocus--;
           
            addActive(x);
          } else if (e.keyCode == 13) {
         
            e.preventDefault();
            if (currentFocus > -1) {
            
              if (x) x[currentFocus].click();
            }
          }
      });
      function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
      
        x[currentFocus].classList.add("autocomplete-active");
      }
      function removeActive(x) {
       
        for (var i = 0; i < x.length; i++) {
          x[i].classList.remove("autocomplete-active");
        }
      }
      function closeAllLists(elmnt) {
       
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
          if (elmnt != x[i] && elmnt != inp) {
          x[i].parentNode.removeChild(x[i]);
        }
      }
    }
    function removePopupForBtn(el){
        let idpattern = '#'+el +' '+'.bootstrap-select'
         $(idpattern).removeClass('show')
      };
    document.addEventListener("click", function (e) {
        closeAllLists(e.target);
    });
    }
    
    
  
      var hli = 0
      var sli = []
      
      var ssli = []
      
    
      var full_array = []
    $(document).ready(function(){

      $(`#tooltip0`).tooltip();
      $('.demo').selectpicker();
      $(".demo").removeClass("dropdown");
      $('#acceptedTable').DataTable({
        // paging:false,
        dom:'Bfrtip',
        buttons:[
        {
           extend: 'pdf',
           footer: true,
           exportOptions: {
                columns: [0,1,2,3,4,5,6,7,8]
            }
           
          },
          { extend: 'excel',
           footer: true,
           exportOptions: {
                columns: [0,1,2,3,4,5,6,7,8]
            }}
        ]
      });
      $('#zonetable').DataTable({
        columnDefs: [
        { width: '5%', targets: 0 },
        { width: '20%', targets: 1 },
        { width: '10%', targets: 2 },
        { width: '10%', targets: 3 },
        { width: '10%', targets: 4 },
        { width: '5%', targets: 5 },
        { width: '15%', targets: 6 },
        { width: '15%', targets: 7 },
        { width: '15%', targets: 8 }
      ],
      autoWidth: false,
      });
      $('#outboxTable').DataTable();
      $('#rejectedTable').DataTable();
      $('#inboxTable').DataTable({
        columnDefs: [
          { width: '20%', targets: 0 },
          { width: '25%', targets: 1 },
          { width: '15%', targets: 2 },
          { width: '20%', targets: 3 },
          { width: '10%', targets: 4 }
        ],
        autoWidth: false,
      });

      var button = $(`#divdesgn0 .bs-actionsbox .btn-group`);
      button.append(`<button type="button" id="bdesgn0" class="btn btn-default btn-light" onclick="getOption('desgn0')" hidden>Save</button>`)
      button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn0')">Close</button>`)
      button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id=''  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`)
      // button.append('<button type="button"  class="btn btn-default btn-light" >Close</button>')
      button.append(`<button type="button" id="btndel0" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)
       
      $(".demo").on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue) {
         
          getOption(`desgn0`)
          });
    
              
     
                    $("#addmech").click(function (e) {
    
                      if (sli.length == 0){
                        alert('Please Add heading First')
                        return false;
                      }
                    
                      var table = document.getElementById("addworkmech");
                      e.preventDefault();
                    //  var heading= table.insertRow();
                    //  h1=headingCount;
                      var row = table.insertRow();
    
                    
                      //var rowCount = $('#addworkmech tr').length;
                      
                      //j1=rowCount;
                      //i1=rowCount;
                      
                      
                      sli[hli-1] = sli[hli-1]+1
                      //let rowlen = parseInt(rowCount)-1
                     
                      
                      //let item = hli+'.' + String(rowlen)
                      let item = hli+'.' + String(sli[hli-1])
                      ssli.push(0)
    
                      ///added/////////////////////////////////////
                      let officerid='divofficer'+hli;
                      let markeofficerid='divmarkeofficer'+hli;
                      let targetdateid='divtargetdate'+hli;
                      $('#'+officerid).hide();
                     $('#'+markeofficerid).hide();
                      $('#'+targetdateid).hide();
                      ///////////////////////////////////////
    
                    //  j1 = j1 + 1;
                    //  var work1 = 'work1' + String(j1);
                    // var heading_title=heading.insertCell(0);
            
                    //  var cell1 = row.insertCell(0);
                      var cell2 = row.insertCell(0);
                      var cell3 = row.insertCell(1);
                      var cell4 = row.insertCell(2);
                      var cell5 = row.insertCell(3);
                      var cell6 = row.insertCell(4);
                    //  var cell7 = row.insertCell(5);
    
                    // cell1.innerHTML =
                    // '<td style="width:5px;""><div style="text-align: center; width:5px font-family:verdana;">'+(j1)+'</div></td>';
                    
                    full_array.push(item)
                    
                    var itemno='itemno'+item
                    var observation='observation'+item
                    var officer='officer'+item
                    var markeofficer='markeofficer'+item
                    var targetdate='targetdate'+item
                    
                    
                  
                    cell2.innerHTML =
                    '<td><div class="autocomplete1"><div style="text-align: center; width:5px font-family:verdana;" id='+itemno+'>'+item+'</div></td>';
                
                    
                    cell3.innerHTML =
                    '<td><div class="autocomplete1"><textbox  id='+observation+
                    ' autocomplete1 = "off"  style="height:50px;" class="form-control" /></textbox></div></td>'; 
                    cell4.innerHTML =
                    '<td><div class="autocomplete1"><button type="button" class="btn btn-primary btn-md" id='+officer+'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN();" style="margin-left:1vh;margin-top:1vh;">i</button>  </div></td>'; 
                    cell5.innerHTML ='<td><textarea type="text" class="form-control" value="" custom-offic="" custom-key="" id='+markeofficer+' class="autocomplete1" readonly></textarea></td>'
                    
                    cell6.innerHTML ='<td><div class="autocomplete1"><input type="text" autocomplete="off" class="form-control datepker" placeholder="yyyy-mm-dd" style="height: 2em; width: 118px;" id='+targetdate+'  readonly > </div></td>'; 
                    // cell3.innerHTML =
                    // '<td><div class="autocomplete1"><label for="myfile">Upload a file:</label><input type="file" id="myfile" name="myfile"></div></td>'; 
                    // <div class="col-sm-6"><select name="officer_code1" id="officers_code1" class="custom-select" multiple="multiple" style="width:200%;height:20%;"> {% for t in hqwise %}<option value="{{t.empname}}">{{t.empname}}</option>{% endfor %}</select><input type="text" id="officer_code_hidden" name="officer_code_hidden" hidden></div> 
                    $("textarea").each(function () {
                      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                        }).on("input", function () {
                          this.style.height = "auto";
                          this.style.height = (this.scrollHeight) + "px";
                        });
    
                  //var min = new Date();
                  $('#date1_0').datepicker({
                    dateFormat: 'dd-mm-yy',
                    minDate: 0,
                    
                    
                  })
                  $('#date1_1').datepicker({
                    dateFormat: 'dd-mm-yy',
                    minDate: 0,
                    
                    
                  })
    
                  $('.datepker').datepicker({
                    dateFormat: 'dd-mm-yy',
                    minDate: 0,
                    
                    
                  })           
                  
                  
                  });
    
                  hli = parseInt("{{draft_details.tour_count}}")
              $("#addheading").click(function (e) {
                
                      var table = document.getElementById("addworkmech");
                      e.preventDefault();
                    
                      var row1 = table.insertRow();
                      var row1Count = 1;
                      var table = document.getElementById("tb"); // Replace "myTable" with the ID of your table
                      hli = table.rows.length-3;
                      console.log(table.rows.length);
                      // $('#count_row').val(hli)
                      // console.log($('#count_row').val());
                      hli++;
                      
                      sli.push(0)

                      
                      
                      var cell1 = row1.insertCell(0);
                      var cell2 = row1.insertCell(1);
                      var cell3 = row1.insertCell(2);
                      var cell4 = row1.insertCell(3);
                      var cell5 = row1.insertCell(4);
                      var cell6 = row1.insertCell(5);
                      var cell7 = row1.insertCell(6);
                      var cell8 = row1.insertCell(7);
                      var cell9 = row1.insertCell(8);
                     
                    
                      var zone='zone'+hli
                    //  var cell3 = row.insertCell(2);
                      
                     $('#count_row').val(hli)
                     console.log($('#count_row').val());
                         
                      full_array.push(String(hli))
                      
                      var heading1='date'+hli+'_0'
                      var heading2='date'+hli+'_1'
                      var officer='officer'+hli
                      var markeofficer='markeofficer'+hli
                      var item ='item'+hli
                      var targetdate='targetdate'+hli
                      var divofficer='divofficer'+hli
                      var divmarkeofficer='divmarkeofficer'+hli
                      var divtargetdate='divtargetdate'+hli
                      // var location='location'+(2*hli)
                      var location = 'location'+hli+'_0'
                      // var location2='location'+(2*hli+1)
                      var location2 = 'location' + hli + '_1'
                      var zone='zone'+hli
                      var division='mode'+hli
                     
                      let date1 = 'dep-hour'+hli
                      let date2 = 'dep-min'+hli

                      
                  
                    cell1.innerHTML= '<td id="col1" ALIGN="left" style="width: 130px;"> <input id='+heading1+' type="text" style="background-color: #fff;" class="form-control datepker " name="date_to_act" placeholder="dd-mm-yyyy" required  readonly style="height:34px;"> </td>';

                    cell2.innerHTML='<td style="width: 80px;"><input style="height:100%; justify-content: center;" placeholder="hour" type="text" id="'+date1+'" name="dep-hour" onfocus="settime(this)"></td>';

                    cell3.innerHTML = `
                    <td>
                      <select name="${location}" id="${location}" data-placeholder="Select-Location" class="form-control" style="width:150px; height:34px;">    
                      </select>
                    </td> 
                    `;

                    cell4.innerHTML= `<td id="col1" ALIGN="left" style="width: 130px;"> <input id='${heading2}' type="text" style="background-color: #fff;" class="form-control datepker " name="date_to_act" placeholder="dd-mm-yyyy" required  readonly style="height:34px;"> </td>'`;

                    cell5.innerHTML=`<td style="width: 80px;"><input style="height:100%; justify-content: center;" placeholder="hour" type="text" id="arr-hour${hli}" name="dep-hour" onfocus="settime(this)"></td>`;
                    
                    cell6.innerHTML = `
                    <td>
                      <select name="${location2}" id="${location2}" data-placeholder="Select-Location" class="form-control" style="width:150px; height:34px;">    
                      </select>
                    </td> 
                    `;  

                    cell7.innerHTML ='<td id="col0" class = "select"><select class="form-control" id='+division+' size="0" name="zone" onchange="railway__1(this.id)"  style="width:100%; height:100%;" data-placeholder="Select one mode" required><option value="" selected disabled hidden >Select</option><option value="flight">Flight</option><option value="rail">Rail</option><option value="stay">Stay</option></select></td>'; 
    
                    cell8.innerHTML =`<td style="width: 75px;"><input placeholder="Enter no." style="width:100%; height:100%;" id="num${hli}" type="number" name='num${hli}'></td>`; 
                    
                    cell9.innerHTML = `
                    <td>
                      <div class="form-group">
                        <select id="purpose${hli}"  class="form-control" data-placeholder="Select a purpose" >
                            <option value="none" selected disabled hidden>Select an Option</option>
                            <option value="Annual Inspection">Annual  inspection</option>
                          <option value="Coach Inspection">Coach Inspection</option>
                          <option value="Coaching depot Inspection">Coaching depot Inspection</option>
                          <option value="Footplate Inspection">Footplate Inspection</option>
                          <option value="General Inspection">General Inspection</option>
                          <option value="Institute Inspection">Institute Inspection</option>           
                          <option value="OBHS Inspection">OBHS Inspection</option>
                          <option value="Rake Inspection">Rake Inspection</option>
                          <option value="Railway siding Inspection">Railway Siding Inspection</option>
                          <option value="Railway Unit Inspection">Railway Unit Inspection</option>
                          <option value="RCD Inspection">RCD inspection</option>
                          <option value="Safety Inspection">Safety Inspection</option>
                          <option value="Section Inspection">Section Inspection</option>
                          <option value="Station Inspection">Station Inspection</option>
                          <option value="Track Inspection">Track Inspection</option>
                          <option value="Train Inspection">Train Inspection</option>            
                          <option value="Weigh bridge Inspection">Weigh Bridge Inspection</option>
                          <option value="Workshop inspection">Workshop Inspection</option>
                          <option value="Wagon depot Inspection">Wagon Depot Inspection</option>
                          <option value="travelling">Travelling</option>
                          <option value="Other">Other</option>
                        </select>
                          
                      </div>
                    </td>`;
                    
                  
                    $("#purpose"+hli).select2({
                              tags: true,
                              tokenSeparators: [','],  
                              maximumInputLength: 10
                          });

                      // var input1 = document.getElementById('dep-hour'+hli);
                      // // var input2 = document.getElementById('dep-min'+hli);
                      // var input3 = document.getElementById('arr-hour'+hli);
                      // // var input4 = document.getElementById('arr-min'+hli);

                      // input1.addEventListener('input', function() {
                      //     const value = parseInt(input1.value);
                      //     if (value<0) {
                      //       document.getElementById("dep-hour"+hli).value = 0
                      //     } else if (value >23) {
                      //       document.getElementById("dep-hour"+hli).value = 23
                      //     }
                      //   });
                      //   input2.addEventListener('input', function() {
                      //     const value = parseInt(input2.value);
                      //     if (value<0) {
                      //       document.getElementById("dep-min"+hli).value = 0
                      //     } else if (value >59) {
                      //       document.getElementById("dep-min"+hli).value = 59
                      //     }
                      //   });
                      //   input3.addEventListener('input', function() {
                      //     const value = parseInt(input3.value);
                      //     if (value<0) {
                      //       document.getElementById("arr-hour"+hli).value = 0
                      //     } else if (value >23) {
                      //       document.getElementById("arr-hour"+hli).value = 23
                      //     }
                      //   });
                      //   input4.addEventListener('input', function() {
                      //     const value = parseInt(input4.value);
                      //     if (value<0) {
                      //       document.getElementById("arr-min"+hli).value = 0
                      //     } else if (value >59) {
                      //       document.getElementById("arr-min"+hli).value = 59
                      //     }
                      //   });

                    $("#"+location).select2({                
                          minimumInputLength: 1,
                          language: {
                              inputTooShort: function() {
                                return 'Please Add Location';
                              }
                            },
                          // tags: [],
                          ajax: {
                              url: '{% url "autoFetchLocation1" %}',
                              dataType: 'json',
                              type: "GET",
                              quietMillis: 50,
                              data: function (term) {
                                  return {
                                      last_val: term.term
                                  };
                                
                                  
                              },
                              processResults: function (data) {
                                return {
                                      results: $.map(data, function (item) {
                                      
                                        
                                          return{
                                            text: item.city,
                                            
                                            id: item.city,
                                          }
                                      })
                                  };
                                },
                          }
                      });
                      $("#"+location2).select2({                
                          minimumInputLength: 1,
                          language: {
                              inputTooShort: function() {
                                return 'Please Add Location';
                              }
                            },
                          // tags: [],
                          ajax: {
                              url: '{% url "autoFetchLocation1" %}',
                              dataType: 'json',
                              type: "GET",
                              quietMillis: 50,
                              data: function (term) {
                                  return {
                                      last_val: term.term
                                  };
                                
                                  
                              },
                              processResults: function (data) {
                                return {
                                      results: $.map(data, function (item) {
                                      
                                        
                                          return{
                                            text: item.city,
                                            
                                            id: item.city,
                                          }
                                      })
                                  };
                                },
                          }
                      });
                    
                    $(`#tooltip${hli}`).tooltip();
                    $('.demo').selectpicker();
                    $(".demo").removeClass("dropdown");
      
                    var button = $(`#divdesgn${hli} .bs-actionsbox .btn-group`);
                    button.append(`<button type="button" id="bdesgn${hli}" class="btn btn-default btn-light" onclick="getOption('desgn${hli}')" hidden>Save</button>`)
                    button.append(`<button  type="button"  class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${hli}');">Close</button>`)
                    button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);
      
                    button.append(`<button type="button" id="btndel${hli}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)
                     
                    $(".demo").on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue) {
                     
                        getOption(`desgn${hli}`)
                        });
                    
                function removePopupForBtn(el){
                  let idpattern = '#'+el +' '+'.bootstrap-select'
                  $(idpattern).removeClass('show')
                };
                   
                  $('.demo').selectpicker();
                    $('.datepker').datepicker({
                      dateFormat: 'dd-mm-yy',
                      minDate: 0

                    })
                    $("#"+zone).select2();
                    $("#"+location).select2({
                          minimumInputLength: 1,
                          language: {
                              inputTooShort: function() {
                                return 'Please Add Location';
                              }
                            },
                          tags: [],
                          ajax: {
                              url: '{% url "autoFetchLocation1" %}',
                              dataType: 'json',
                              type: "GET",
                              quietMillis: 50,
                              data: function (term) {
                                  return {
                                      last_val: term.term
                                  };
                                 
                              },
                              processResults: function (data) {
                                return {
                                      results: $.map(data, function (item) {
                                      
                                          return{
                                            text: item.city,
                                            
                                            id: item.city,
                                          }
                                      })
                                  };
                                },
                              
                              
                          }
                      });
                
                    //var min = new Date();
                    //$('.datepker').datepicker('setDate',min);
    
                      $("textarea").each(function () {
                      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                        }).on("input", function () {
                          this.style.height = "auto";
                          this.style.height = (this.scrollHeight) + "px";
                        });
    
                      ///////////////////////////////////////
                      
              });
              $('#date1_0').datepicker({
                    dateFormat: 'dd-mm-yy',
                    minDate: 0,
                    
                    
                  })
                  $('#date1_1').datepicker({
                    dateFormat: 'dd-mm-yy',
                    minDate: 0,
                    
                    
                  })
              $("#addSubmech").click(function (e) {
                
                var table = document.getElementById("addworkmech");
                      e.preventDefault();
                      let item = hli+'.' + String(sli[hli-1])
                      
                      if(hli == 0){
                        alert('Add Desc First')
                        return false;
                      }
                      if(sli[hli-1] == 0)
                      {
                        alert('Add Sub Heading');
                        return false;
                      }
                      var row1 = table.insertRow();
                      var row1Count = 1;
                      
                      
                      ssli[ssli.length-1] = ssli[ssli.length-1]+1
                      
                      let item2 = item+'.'+String(ssli[ssli.length-1])
                      
                      var cell1 = row1.insertCell(0);
                      var cell2 = row1.insertCell(1);
                    //  var cell3 = row.insertCell(2);
                      full_array.push(item2)
    
                      var subheading1='subdes'+item2
    
                      cell1.innerHTML='<div style="text-align: center;  height:50px; width:5px; font-family:verdana;"></div>'
                      cell2.innerHTML ='<td>'+ item2 +'<div class="autocomplete1"><textarea maxlength="250" id='+subheading1+' autocomplete1 = "off"  style="height:30px;margin-left: 100px; width: 82%;" class="form-control" /></textarea></div></td>'; 
    
                      $("textarea").each(function () {
                      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                        }).on("input", function () {
                          this.style.height = "auto";
                          this.style.height = (this.scrollHeight) + "px";
                        });
              });
    
    
    
    
          $('#deletemech').click(function (e) {
                e.preventDefault();
                  var rowCount = $('#addworkmech tr').length;
    
                  ///added////////////////
                  var table = document.getElementById("addworkmech"); 
                  let val_id=table.rows[rowCount-1].cells[0].innerText;
                 
                  if(val_id !='')
                  {     
                    let val_split=val_id.split('.');
                    
                    if(val_split.length > 1)
                    {
                      let del_id=val_split[0]+'.'+'1';
                      if(del_id == val_id)
                      {
                        
                        let officerid='divofficer'+val_split[0];
                        let markeofficerid='divmarkeofficer'+val_split[0];
                        let targetdateid='divtargetdate'+val_split[0];
                        $('#'+officerid).show();
                        $('#'+markeofficerid).show();
                        $('#'+targetdateid).show();
                        $("textarea").each(function () {
                          this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                            }).on("input", function () {
                              this.style.height = "auto";
                              this.style.height = (this.scrollHeight) + "px";
                        });
                      }
    
                    }
                        
                  }
                  ///////////////////////////////////////
    
                  j1=rowCount;                    
                  if (j1 > 0) {
               
                  full_array.pop()
                  document.getElementById("addworkmech").deleteRow(-1);
                  if( hli > 0 && sli[hli-1] !=0 )
                  {
                   
                      if(ssli[ssli.length-1]==0)
                      {
                        ssli.pop()
                        if(sli[hli-1]==0){
                          sli.pop()
                          hli--;
                        }else{
                          sli[hli-1] = sli[hli-1]-1
                        }
                      }
                      else
                      {
                        ssli[ssli.length-1]=ssli[ssli.length-1]-1
                      }
                }
                else if( hli > 0 && sli[hli-1] == 0 )
                  {
                        if(sli[hli-1]==0)
                        {
                          sli.pop()
                          hli--;
                        }
                        else
                        {
                          sli[hli-1] = sli[hli-1]-1
                        }
                }
                  j1--;
                  
    
                }
                
    
          });
    
    
    });
    
    //================================================================================================           
    //================================================================================================           
    //================================================================================================         
   
    
    
    ////////////////////////////////   added 03/08/22
    
    var globalarrid=[];
    var main=[];
    function remove_save_marked_officers()
    {
      if(globalarrid.length==0)
      {
        alert('Nothing to Remove');
        return false;
      }
      globalarrid.pop();
      main.pop();
    
      document.getElementById('alltext').value=globalarrid;
        
    }
    function add_save_marked_officers(){
      var emp_no = ""
      var emp_no1 = ""
      var table = $('#text').DataTable();
      table.destroy();
      table = $('#text1').DataTable();
      table.destroy();
      var table = $('#text').DataTable();
      table.destroy();
      table = $('#textdesigselect').DataTable();
      table.destroy();
    
      
      let lst1='no';
      let lst2='no';
      $("input[type='checkbox'][name='chktext']:not(:checked)").each(function (){
        lst1='yes';
      });
      $("input[type='checkbox'][name='chktext1']:not(:checked)").each(function (){
        lst2='yes';
      });
      var rly_1=$('#rly_1').val();
      var div_1=$('#div_1').val();
      if(globallistgm!='' && lst1 == 'yes')
      { 
        globallistgm='';
      }
      if(globallistbm!='' && lst1 == 'yes')
      { 
        globallistbm='';
      }
      if(globallistphod!='' && lst1 == 'no')
      { 
          let x='';
          if(rly_1 == '')
            globallistphod=globallistphod;
            else{
          for(ii=0;ii<rly_1.length;ii++)
          {
            x=x+globallistphod+'/'+rly_1[ii]+', ';
          }
          globallistphod=x;}
      }
      else if(globallistphod!='' && lst1 == 'yes')
      { 
        globallistphod='';
      }
      if(globallistdrm!='' && lst2 == 'no')
      { let x='';
          if(rly_1 == '')
            globallistdrm=globallistdrm;
          else{
            for(ii=0;ii<rly_1.length;ii++)
            {
              x=x+globallistdrm+'/'+rly_1[ii]+', ';
            }
    
            globallistdrm=x;}
      }
      else if(globallistdrm!='' && lst2 == 'yes')
      { 
        globallistdrm='';
      }
      let chkdes=0,arrdemp=[],arrsemp=[];
      let g=0,d=0,p=0,b=0,chgdesig ='Y';
      
      $('.messageCheckbox:checkbox:checked').each(function(i){
        //val[i] = $(this).val();
        let oneOffic= $(this).val();
        let id = oneOffic.split(',')[0]
        let desig = oneOffic.split(',')[1]
        
        
        chkdes=0;
        if(desig.startsWith("DRM/") && chgdesig == 'Y')
        {
          chgdesig = 'N';
          if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }
        }
        if(globallistgm!='' )
        {
              $("input[type='checkbox'][name='chktext']:checked").each(function (){
                    if(desig == $(this).val().split(',')[1])
                    chkdes=1;
              });
              if(g==0)
              { 
                g=1;
                if(emp_no1!="")
                  emp_no1+=',';
              emp_no1 +=globallistgm;
    
              if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }
                      
            }
        }
        else if(globallistbm!=''  )
        {
                $("input[type='checkbox'][name='chktext']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                      chkdes=1;
                });
                if(g==0){ g=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistbm;
                if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
        else if(globallistphod!='' )
        {
          $("input[type='checkbox'][name='chktext']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                      chkdes=1;
                });
                if(p==0){ p=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistphod;
                if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
     
        if(globallistdrm!=''  && desig.startsWith("DRM/"))
        {
          $("input[type='checkbox'][name='chktext1']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                        chkdes=1;
                });
                if(d==0){ d=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistdrm;
               
                    if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
        if(chkdes == 0)
        {
          if(arrsemp.length != 0)
          {
            arrdemp.push(arrsemp);
          }
          arrsemp=[]
          if(emp_no1!="")
                    emp_no1+=',';
          emp_no1 +=desig;
         
          if(emp_no!="")
              emp_no+=',';
          emp_no +=id;
          arrsemp.push(id);
          
        }
        else
        {
          if(emp_no!="")
              emp_no+=',';
          emp_no +=id;
          arrsemp.push(id);
          
        }
        
      });
      arrdemp.push(arrsemp);
      if(emp_no == '')
      {
        alert('Select Checkbox To add');
        $('#text').DataTable();
        $('#text1').DataTable();
        $('#textdesigselect').DataTable();
        return false;
      }
      
        let chkemp_no1=emp_no1.split(',');
        let chkemp_no=emp_no.split(',');
    
        if(document.getElementById('alltext').value!='')
            globalarrid=(document.getElementById('alltext').value).split(',');
        // for(let ij=0;ij<chkemp_no1.length;ij++)
        // {
        //     if(globalarrid.includes(String(chkemp_no1[ij])))
        //     {
        //       alert(chkemp_no1[ij]+' is already previously added ..');
        //     }
        //     else
        //     {
        //       main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
        //       globalarrid.push(chkemp_no1[ij]);
        //     }
        // }
        // document.getElementById('alltext').value=globalarrid;
        

        
    //////////////////  changed
    let prevpost='',prevchk=0;

for(let ij=0;ij<chkemp_no1.length;ij++)
{
  //alert(chkemp_no1[ij]);
    if(globalarrid.includes(String(chkemp_no1[ij])))
    {
      if (prevpost!='')
        prevpost=prevpost+', ';
      prevpost=prevpost+chkemp_no1[ij];
      prevchk=1;
      //alert(chkemp_no1[ij]+' is already previously added ..');
    }
    
    else if(chkemp_no1[ij] == "All GM's/ZR")
    {
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm].substring(0,3)=='GM/')
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }

      }
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);

    }
    else if(chkemp_no1[ij].substring(0,3)=='GM/')
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All GM's/ZR")
        {
          chkcgm=1
        }

      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
          prevpost=prevpost+', ';
        prevpost=prevpost+chkemp_no1[ij];
        prevchk=1;
      }

    }

    else if(chkemp_no1[ij] == "All DRM's")
    {
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm].substring(0,4)=='DRM/')
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }
        else if(globalarrid[cgm].substring(0,10)=="All DRM's/")
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }

      }
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);

    }

    else if(chkemp_no1[ij].substring(0,4)=='DRM/')
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All DRM's")
        {
          chkcgm=1
        }
        else if(globalarrid[cgm].substring(0,10)=="All DRM's/")
        {
          for(drmi=0;drmi<main[cgm]['designation_code'].length;drmi++)
          {
            if(chkemp_no.includes(main[cgm]['designation_code'][drmi]))
            {
              chkcgm=1;
              break;
            }

          }
        }
      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
            prevpost=prevpost+', ';
          prevpost=prevpost+chkemp_no1[ij];
          prevchk=1;
      }
    }
    
    else if(chkemp_no1[ij].substring(0,10)=="All DRM's/")
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All DRM's")
        {
          chkcgm=1
        }
      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
            prevpost=prevpost+', ';
          prevpost=prevpost+chkemp_no1[ij];
          prevchk=1;
      }
    }
    else
    {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
    }
}



if(prevchk==1)
{
  alert('Following Post Are already Present '+prevpost);
}
for(let remi=globalarrid.length-1;remi>=0;remi--)
{
  if(globalarrid[remi].length==0 || globalarrid[remi]==' ')
        {
          globalarrid.splice(remi,1);
          main.splice(remi,1);
        }

}
//////////////////  changed
document.getElementById('alltext').value=globalarrid;


        
    
      ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            } 
    
      ele=document.getElementsByName('chk');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }
    
      ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            } 
  //////////////////  changed
            ele=document.getElementsByName('chkdesig');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        }
//////////////////  changed


      globallistdrm='';
      globallistgm='';
      globallistphod='';
      globallistbm='';
      document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
    
      document.getElementById('rly_1').value='';
      document.getElementById('div_1').value='';
      document.getElementById('dept_1').value='';
      document.getElementById('desig').value='';
        $('#text').DataTable();
        $('#text1').DataTable();
        $('#textdesigselect').DataTable();
      
    }
    
    
    /////////////////////////////    end 03/08/22   
    function save_marked_officers(){
      let emp_no='',emp_no1='';
    
       for(i=0;i<main.length;i++)
       {
         if(emp_no1!="")
             emp_no1+=',';
           emp_no1+=main[i].desig;
         x=main[i].designation_code;
         if(emp_no!="")
             emp_no+=',';
           emp_no+=main[i].designation_code;
       }
      
       let mark_off = $('#mark_officersss').val();
     
       if(mark_off=='Copy To'){
                                   
         document.getElementById('copyto').value=emp_no1;
         var myInput = document.getElementById('copyto');
             myInput.setAttribute('custom-offic', emp_no);
         let Y = document.getElementById('copyto').scrollHeight
         document.getElementById('copyto').style.height =(10+Y)+"px";
     
     
         var myInput = document.getElementById('copyto');
             myInput.setAttribute('custom-key', main);
     
       }else{
         markofficer='markeofficer'+ mark_off
         document.getElementById(markofficer).value=emp_no1;
         var myInput = document.getElementById(markofficer);
             myInput.setAttribute('custom-offic', emp_no);
     
             let x = document.getElementById(markofficer).scrollHeight
             document.getElementById(markofficer).style.height =(10+x)+"px";
     
     
             var myInput = document.getElementById(markofficer);
             myInput.setAttribute('custom-key', JSON.stringify(main));
 
 
                 let test=mark_off.split('.');
                 let testid='';
                 for(let ii=0;ii<test.length;ii++)
                 {
                   if(ii==0)
                     testid=String(test[ii]);
                   else
                     testid=testid+'a'+String(test[ii]);
                 }
                 id='btndel'+testid;
                
               document.getElementById(id).click();
               emp_no=emp_no.split(',');
              //  alert(emp_no)
               $(`.desgn${testid}`).selectpicker('val', emp_no);
             
       }
       $('#close1').click();
       
     
    }
          
  
  

        function select1(id){  
          var table = $('#text1').DataTable();
          table.destroy();
          if(id.checked)
          {
            var ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=true;  
            }  
            var table = $('#text1').DataTable();
          }
          else
          {
            var ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            var table = $('#text1').DataTable();
          }
        }  
        function select21(id){  
          var table = $('#text').DataTable();
          table.destroy();
          if(id.checked)
          {
            var ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=true;  
            }  
            var table = $('#text').DataTable();
          }
          else
          {
            var ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            var table = $('#text').DataTable();
          }
        }  
    
    var globaldiv='';
    function setvalueIN(){
    
      $("#alltext").css({"height": "50px",});
      main=[];
      globalarrid=[];
    
      let zone = $('#zone').val();
      $('#rly_1').val(zone);
    
    var arrayArea = $('#department').val();
    $('#dept_1').select2({}).select2('val', arrayArea);
    $('#desig').val('');
    $('#desig').select2().trigger('change');
      if($('#division').val()!='')
        globaldiv=$('#division').val();
      $('#rly_1').select2().trigger('change');
    
    
      let mark_off = $('#mark_officersss').val();
      
    if(mark_off=='Copy To'){
        
        var myInput = document.getElementById('copyto');
        var officer_val11=myInput.getAttribute('custom-key');
        document.getElementById('alltext').value=document.getElementById('copyto').value;
    }
    else{
      
          markofficer='markeofficer'+ mark_off
          var myInput = document.getElementById(markofficer);
          var officer_val11=myInput.getAttribute('custom-key');
          document.getElementById('alltext').value=document.getElementById(markofficer).value;   
    }
    if((document.getElementById('alltext').value).length>0)
    {
      globalarrid=String(document.getElementById('alltext').value).split(',');
      main=JSON.parse(officer_val11);
    }
    
    
    
      
    }
    
    
    
    
    function hidetable(e){
        
      $('#text').show(); $('#text1').hide(); $('#table2').hide(); $('#table3').hide(); $('#table4').hide(); $('#table5').hide();
      $('#mark_officersss').val((e.id).substr(7));
    
    
    }
    
   
              
                      // Read selected option
    // $('#rly').click(function(){
    //   var username = $('#rly option:selected').text();
    //   var userid = $('#rly').val();
                    
                       
                        
    // });
    
    $("#rly_1").select2();
              
              // Read selected option
    $('#rly_1').click(function(){
      var username = $('#rly_1 option:selected').text();
      var userid = $('#rly_1').val();
                             
    });
    
    $("#div_1").select2();
              
    // Read selected option
    
    $('#div_1').click(function(){
      var username = $('#div_1 option:selected').text();
      var userid = $('#div_1').val();
    });
    
    $("#zone0").select2();
    $("#division0").select2();
            
    $('#division').click(function(){
      var username = $('#div option:selected').text();
      var userid = $('#div').val();
    });
    
    $("#department").select2();
              
    $('#department').click(function(){
        var username = $('#department option:selected').text();
        var userid = $('#department').val();
    });
    
    //////////////////////////////////////////////
    $('#desig').select2({});
    
    var globaldesigid=[];
    
    
    function selordesel(id)
    {
          var table = $('#textdesig').DataTable();
          table.destroy();
          var table1 = $('#textdesigselect').DataTable();
          table1.destroy();
         
          if(id.checked)
          {
            globaldesigid=[];
            $('#textdesigselect tbody').empty();
            var row='';
            var ele=document.getElementsByName('chkdesig');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox') 
                   {
                    ele[i].checked=true; 
                    let id=ele[i].id;
                    val=ele[i].value;
                    val=val.split(',')
                    globaldesigid.push(id.substring(2,id.length));
                    row += "<tr id='trid"+id+"'>";  
                    row+=  '<td hidden><input checked type="checkbox" id="'+val[0]+'" class="messageCheckbox" value="'+(val[0]+','+val[1])+'" name="chk" ></td>';
                    row += '<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="'+val[0]+'" hidden>'+val[0]+'</td>';
                    row += '</tr>';
                
                   } 
            }  
            $('#textdesigselect tbody').append(row);
            var table1 = $('#textdesigselect').DataTable();
            var table = $('#textdesig').DataTable();
          }
          else 
          {
            var ele=document.getElementsByName('chkdesig');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            globaldesigid=[];
            $('#textdesigselect tbody').empty();
            var table1 = $('#textdesigselect').DataTable();
            var table = $('#textdesig').DataTable();
          }       
    }
    
    function selectdesig(val)
    {
      let id=val.id;
      val=val.value;
      
      var table = $('#textdesigselect').DataTable();
      table.destroy();
      val=val.split(',');
      var row='';
      if(document.getElementById(id).checked==true)
          {
            globaldesigid.push(id.substring(2,id.length));
              row += "<tr id='trid"+id+"'>";  
                  row+=  '<td hidden><input checked type="checkbox" id="'+val[0]+'" class="messageCheckbox" value="'+(val[0]+','+val[1])+'" name="chk" ></td>';
                row += '<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="'+(val[2]+','+val[1])+'" hidden>'+(val[2]+','+val[1])+'</td>';
                row += '</tr>';
                $('#textdesigselect tbody').append(row);
                var table = $('#textdesigselect').DataTable();
          }
          else 
          {
            let id1=id.substring(2,id.length);
            id='trid'+id;
    
                index = globaldesigid.indexOf(id1);
                if (index > -1) { 
                  globaldesigid.splice(index, 1);
                }
    
            var row = document.getElementById(id);
            row.parentNode.removeChild(row);
            var table = $('#textdesigselect').DataTable();
          }       
    }
    
    function getdesigdata()
    {
      let desig=$('#desig').val();
      $('#showdiv1').hide();
      $('#showdiv2').show();
      $('#textdesigselect').DataTable();
      var table = $('#textdesig').DataTable();
        table.destroy();
    
      data={
              'desig':desig,
          }
                $.ajax({
                    type: "GET",
                    url: "{% url 'designation_wise' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(mydata) {
                       let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="selordesel(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        
                        for (let i = 0; i < mydata.length; i++) {
                         
       
    
                          if(globaldesigid.includes(mydata[i]['designation']))
                           { 
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="ab${mydata[i]['empno']}"  value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']},${mydata[i]['empname']}" name="chkdesig" onclick="selectdesig(this)"></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden >
                                ${mydata[i]['empname']},${mydata[i]['desig_longdesc']}</td>`;
                            
                              row += `</tr>`;
                           }
                           else
                           {
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox"  id="ab${mydata[i]['empno']}"  value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']},${mydata[i]['empname']}" name="chkdesig" onclick="selectdesig(this)"></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden >
                                ${mydata[i]['empname']},${mydata[i]['desig_longdesc']}</td>`;
                            
                              row += `</tr>`;
                           }
    
                        }
                        
                        $('#textdesig thead').remove();
                        $('#textdesig tr').remove();
                        $('#textdesig').append(head);
                        $('#textdesig tbody').append(row);
                        
                        $('#textdesig').DataTable();
                          
           
                    },
               
                });
    
    }
    
    //////////////////////////////////////
    $('#desig').click(function(){
        var username = $('#desig option:selected').text();
        var userid = $('#desig').val();
    });
    
    $("#dept_1").select2();
              
    $('#dept_1').click(function(){
        var username = $('#desig option:selected').text();
        var userid = $('#desig').val();
    });
   
    
    function getdivdeptdata()
    {
      $('#showdiv1').show();
      $('#showdiv2').hide();
      getdivwisedata();
      fungetzonedata();
    }
    
    function getdivwisedata()
    {
      $('#showdiv1').show();
      $('#showdiv2').hide();
      var table = $('#text1').DataTable();
        table.destroy();
        $('#text1').hide();
        var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1,
              'dept_1':dept_1,
              'div_1':div_1,
              
            }
                $.ajax({
                    type: "GET",
                    url: "{% url 'division_wise1' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                      mydata=response.divwise;
                      //  let row = "";
                      //   let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select1(this)"></th>
                      //   <th>Division Officers</th></tr></thead>`;
                      //   for (let i = 0; i < mydata.length; i++) {
                      //       row += "<tr>";  
                      //         row+=  `<td><input type="checkbox" id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext1" ></td>`;
                      //         row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                      //           ${mydata[i]['desig_longdesc']}</td>`;
                            
                      //       row += `</tr>`;
                      //   }
                        // $('#text1 thead').remove();
                        // $('#text1 tr').remove();
                        // $('#text1').append(head);
                        // $('#text1 tbody').append(row);
                        // $('#text1').show();
                        // $('#text1').DataTable();
                          
           
                    },
                });
      // document.getElementById('allphod').checked=false;
      // document.getElementById('allgm').checked=false;
      // document.getElementById('allboard').checked=false;
      // document.getElementById('alldrm').checked=false;
      // document.getElementById('allbo').checked=false;
      // document.getElementById('allpanel').checked=false;
               
    }
    
        $('#allgm').click(function() {
          document.getElementById('allboard').checked=false;
          document.getElementById('allphod').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          data={
              'rly_1':rly_1,
              
          } 
          $('#showdiv1').show();
          $('#showdiv2').hide();
          globallistgm='';
           if(this.checked){
            globallistgm= "All GM's/ZR";
              $.ajax({
                    type: "GET",
                    url: "{% url 'gm_list_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allgm;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistgm='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
          });   
          
        $('#alldrm').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          var table = $('#text1').DataTable();
          table.destroy();
            var div_1=$('#rly_1').val();
              data={
                  'div_1':div_1,
                  
              }
              globallistdrm='';   
           if(this.checked){
            globallistdrm="All DRM's"
                $.ajax({
                    type: "GET",
                    url: "{% url 'drm_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                      mydata=response.alldrm;
                      let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select1(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext1"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text1 thead').remove();
                        $('#text1 tr').remove();
                        $('#text1').append(head);
                        $('#text1 tbody').append(row);
                        $('#text1').show();
                        $('#text1').DataTable();       
                    },
      
                });
    
                }
    
                else{
                  globallistdrm=''; 
                  var ele=document.getElementsByName('chktext1');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text1').DataTable();
                }
          });   
     
        $('#allphod').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allboard').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          data={
              'rly_1':rly_1,
          }
          globallistphod='';
           if(this.checked){
            globallistphod="All PHOD's";
              $.ajax({
                    type: "GET",
                    url: "{% url 'phod_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allphod;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['empno']}" class="messageCheckbox" value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['empname']},${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistphod='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
        }); 
       
        $('#allboard').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allphod').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          data={
              'rly_1':rly_1,
              
          }
          globallistbm=''; 
           if(this.checked){
            globallistbm="All Board Member's"; 
              $.ajax({
                    type: "GET",
                    url: "{% url 'board_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allboard;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Board Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['empno']}" class="messageCheckbox" value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['empname']},${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistbm='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
    }); 
    
     function fungetzonedata()
     {
      $('#showdiv1').show();
      $('#showdiv2').hide();
          var table = $('#text').DataTable();
          table.destroy();
          $('#text').hide();
          var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1,
              'dept_1':dept_1,
              'div_1':div_1,
              
            }
                $.ajax({
                    type: "GET",
                    url: "{% url 'headqwise' %}",
                    data: data,
                    success: function(response) {
                      mydata=response.hqwise;
                      let row = "";
                      let head = `<tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr>`;
                        
                       
                          for (let i = 0; i < data.length; i++) {
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox" id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                          }
                        
                        $('#text thead').empty();
                        $('#text tbody').empty();
                        //$('#text tr').remove();
                        $('#text thead').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();      
                       
                    },
                    
                   
                });
      document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
     }
            
    
      // $('#div_1').click(function() {
      //   var rly_1=$('#rly_1').val();
      //   if(rly_1 == []) 
      //     return false;
      //   let divdata=$('#div_1').val();
       
      //   // elif(dept_1 == [] && rly_1 == [])
      //   //   return false;
      //   // elif(dept_1 != [])
      //   //   return false;
      //   data={
      //       'rly_1':rly_1,
      //   }
      
      //   $.ajax({
      //     type : 'GET',
      //     url : "{% url 'division_by_rly1' %}",
      //     dataType : 'json',
      //     data : data,
    
      //     success : function(response){
      //       division=response.division;
      //       $('#div_1').empty();
            
      //         for (let i = 0; i < division.length; i++) {
      //           if(globaldiv.length!=0)
      //           {
      //             if(globaldiv == division[i])
      //               { 
      //                 $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
      //               }
      //             else
      //               $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
      //           }
      //           else
      //           {
      //             if(divdata.includes(division[i]))
      //               { 
      //                 $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
      //               }
      //             else
      //               $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
      //           }
    
      //         }
      //         globaldiv=[];
      //         fungetzonedata();
      //         $('#div_1').select2().trigger('change');          
      //     }
    
          
      //   })
              
      // })  
    
      $('#rly_1').change(function() {
        var rly_1=$('#rly_1').val();
        if(rly_1 == []) 
          return false;
        let divdata=$('#div_1').val();
       
        // elif(dept_1 == [] && rly_1 == [])
        //   return false;
        // elif(dept_1 != [])
        //   return false;
        data={
            'rly_1':rly_1,
        }
      
        $.ajax({
          type : 'GET',
          url : "{% url 'division_by_rly2' %}",
          dataType : 'json',
          data : data,
    
          success : function(response){
            division=response.division;
            $('#div_1').empty();
            
              for (let i = 0; i < division.length; i++) {
                if(globaldiv.length!=0)
                {
                  if(globaldiv == division[i])
                    { 
                      $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
                    }
                  else
                    $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
                }
                else
                {
                  if(divdata.includes(division[i]))
                    { 
                      $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
                    }
                  else
                    $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
                }
    
              }
              globaldiv=[];
              fungetzonedata();
              $('#div_1').select2().trigger('change');          
          }
    
          
        })
              
      })  
  
   
      // $('#zone').change(function() {
      //   var rly=$('#zone').val();
    
    
          
    
      //       data={
      //           'rly_data': JSON.stringify(rly)
                
      //         }
    
      //         $.ajax({
      //           type : 'GET',
      //           url : "{% url 'getdiv_rly1' %}",
      //           dataType : 'json',
      //           data : data,
    
      //           success : function(response){
      //             division=response.division;
      //                         $('#division').empty();
      //                         $('#division').append(`<option value="" disabled>NA</option>`);
      //                         for (let i = 0; i < division.length; i++) {
      //                         $('#division').append(`<option value="${division[i]}">
      //                                             ${division[i]}
      //                                       </option>`);
      //                                     }
      //           }
      //         })
      // })

   
     
   
   
    function changeColorBtn(el){
      let val = el.id
      if (val == 'addheading'){
        document.getElementById('addheading').style.backgroundColor = "#3333ff";
        document.getElementById('addmech').style.backgroundColor = "#337AB7";
        document.getElementById('addSubmech').style.backgroundColor = "#337AB7";
      }
      else if(val == 'addmech'){
        document.getElementById('addheading').style.backgroundColor = "#337AB7";
        document.getElementById('addmech').style.backgroundColor = "#3333ff";
        document.getElementById('addSubmech').style.backgroundColor = "#337AB7";
      }
      else if(val == 'addSubmech'){
        document.getElementById('addheading').style.backgroundColor = "#337AB7";
        document.getElementById('addmech').style.backgroundColor = "#337AB7";
        document.getElementById('addSubmech').style.backgroundColor = "#3333ff";
      }
    
    }
   
      $(function() {
    
          $('input[name="daterange1"]').daterangepicker({
              autoUpdateInput: false,
              maxDate: new Date(),
              
              locale: {
                  cancelLabel: 'Clear'
              }
          });
    
          $('input[name="daterange1"]').on('apply.daterangepicker', function(ev, picker) {
              
              if(picker.startDate.format('DD/MM/YYYY') == picker.endDate.format('DD/MM/YYYY')){
                $(this).val(picker.startDate.format('DD/MM/YYYY'))
              }
              else{
                $(this).val(picker.startDate.format('DD/MM/YYYY') + ' to ' + picker.endDate.format('DD/MM/YYYY'));
              
              }
              //setTitle() //for autofill title 2nd comment
          });
    
          $('input[name="daterange1"]').on('cancel.daterangepicker', function(ev, picker) {
              $(this).val('');
          });
    
    });
    
    
    
    
      $("textarea").each(function () {
      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
        }).on("input", function () {
          this.style.height = "auto";
          this.style.height = (this.scrollHeight) + "px";
        });
 
      $(function(){
        $('#addMore').on('click', function() {
          var data = $("#tb tr:eq(1)").clone(true).appendTo("#tb");
          data.find("input").val('');
          alert("one row added!")
          
    });

   
   $(document).on('click', '.remove', function() {
    r = confirm('Are you sure you want to Delete the row!')
            if ( r == true){
              var table = document.getElementById('tb');
	          var rowCount = table.rows.length;
	          if(rowCount > '3'){
		        var row = table.deleteRow(rowCount-1);
		        rowCount--;
          
            hli--;
            $('#count_row').val() = hli
           
            alert("Last row deleted!")
	          }
	             else{
		              alert('There should be atleast one row'); 
	                    }
            }
           
       
      });
    })
   
      $(function(){
          $("#mycal").datepicker({
            dateFormat : "dd/mm/y",
          });
      });
    
    
    
      $('.datepicker').datepicker({
        inline: true
      });


      window.addEventListener('DOMContentLoaded', function() {
        // Get the element ID from the URL
        var elementId = window.location.hash.substr(1);
        if(elementId!=""){
          // Scroll to the element with the matching ID
        var element = document.getElementById(elementId);
          if (element) {
            element.click();
          }
        }

      });

      window.addEventListener('DOMContentLoaded', function() {
        
        const urlParams = new URLSearchParams(window.location.search);
        const myParam = urlParams.get('draft_id');
        
        if(myParam){
          is_exists = "{{draft_details.is_exists}}";

          if(is_exists == 'True'){
            document.getElementById("description").value = "{{draft_details.description}}";
            document.getElementById("file_alert").value = "(Previously uploaded file cannot be shown due to security reasons)";
          }
        }
      });

     
    </script>
   
    <script>
  function settime(btn) {
        var id = btn.id;
        $('#'+id).daterangepicker({
            autoApply: false,
            timePicker: true,
            timePicker24Hour: true,
            timePickerIncrement: 1,
            timePickerSeconds: false,
            singleDatePicker: true,
            locale: {
                format: 'HH:mm'
            },
            
        }).on('show.daterangepicker', function (ev, picker) {
            picker.container.find(".calendar-table").hide();
        });
    }

      var globalfavlst=[];
      function getOption(e){
        let id=e.substring(5,e.length);
        var options = document.getElementById(e).selectedOptions;
        var values = Array.from(options).map(({ value }) => value);
        let tooltipid='tooltip'+ id.replaceAll('.','a');
        let markofficer='markeofficer'+ id;
  
        let lt='desgninp'+id;
        let notexist=[], altext=document.getElementById(lt).value;
        altext=altext.split(',');
        
        var myInput = document.getElementById(markofficer);
        var officer_id=myInput.getAttribute('custom-offic');
       
        if(officer_id.length!=0)
        {
          officer_id=officer_id.split(',');
        }
        else
        {
          officer_id=[];
        }
    
        officer_id=[...new Set(officer_id.concat(values))]
        
        for(let i=0;i<altext.length;i++)
        {
          if(values.includes(String(altext[i])))
          {
            continue;
          }
          else
          {
                var index = officer_id.indexOf(altext[i]);
                if (index !== -1) {
                  officer_id.splice(index, 1);
                }
          }
              
        }csrf_token
  
        document.getElementById(lt).value=values;

        data={
            'officer_id': JSON.stringify(values),
            'csrfmiddlewaretoken': '{{csrf_token}}'
          }
    
          $.ajax({
            type : 'POST',
            url : "{% url 'desig_changecode' %}",
            dataType : 'json',
            data : data,
    
            success : function(response){
              marked_id=JSON.parse(response.marked_id);
              marked_desig=response.marked_desig;
              marked_key=JSON.parse(response.marked_key);
    
              document.getElementById(markofficer).value=marked_desig;
              var myInput = document.getElementById(markofficer);
              myInput.setAttribute('custom-offic', marked_id);
              // let x = document.getElementById(markofficer).scrollHeight;
              // document.getElementById(markofficer).style.height =(10+x)+"px";
    
              const tx = document.getElementsByTagName("textarea");
              for (let i = 0; i < tx.length; i++) {
                tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
                tx[i].addEventListener("input", OnInput, false);
              }
    
              function OnInput() {
                this.style.height = 0;
                this.style.height = (this.scrollHeight) + "px";
              }
              $("textarea").trigger("input");
              var myInput = document.getElementById(markofficer);
              myInput.setAttribute('custom-key',JSON.stringify(marked_key));
  
              myInput = document.getElementById(tooltipid);
              
              if(marked_desig.length==0)
              {
                marked_desig='Add From Dropdown'
              }
              myInput.innerHTML=truncateString(marked_desig,10);
              marked_desig=marked_desig.replaceAll(',',', ')
              myInput.title=marked_desig;
              $('#'+tooltipid).tooltip();
            }
          })
    
    
    
    }
    function truncateString(str, num) {
      if (str.length > num) {
        return str.slice(0, num) + "...";
      } else {
        return str;
      }
    }
    
      let today=new Date().toISOString().split('T')[0];
      document.getElementsByName("date_to_act")[0].setAttribute('min',today);
      
    </script>  
    <script>
      var globalfavlst=[];
  function getOption(e){
    
      let id=e.substring(5,e.length);
      var options = document.getElementById(e).selectedOptions;
      var values = Array.from(options).map(({ value }) => value);
      let tooltipid='tooltip'+ id.replaceAll('.','a');
      let markofficer='markeofficer'+ id;

      let lt='desgninp'+id;
      let notexist=[], altext=document.getElementById(lt).value;
      altext=altext.split(',');
      
      var myInput = document.getElementById(markofficer);
      var officer_id=myInput.getAttribute('custom-offic');
     
      if(officer_id.length!=0)
      {
        officer_id=officer_id.split(',');
      }
      else
      {
        officer_id=[];
      }
  
      officer_id=[...new Set(officer_id.concat(values))]
      
      for(let i=0;i<altext.length;i++)
      {
        if(values.includes(String(altext[i])))
        {
          continue;
        }
        else
        {
              var index = officer_id.indexOf(altext[i]);
              if (index !== -1) {
                officer_id.splice(index, 1);
              }
        }
            
      }

      document.getElementById(lt).value=values;

      data={
          'officer_id': JSON.stringify(values),
          'csrfmiddlewaretoken': '{{csrf_token}}'
        }
  
        $.ajax({
          type : 'POST',
          url : "{% url 'desig_changecode' %}",
          dataType : 'json',
          data : data,
  
          success : function(response){
            marked_id=JSON.parse(response.marked_id);
            marked_desig=response.marked_desig;
            marked_key=JSON.parse(response.marked_key);
  
            document.getElementById(markofficer).value=marked_desig;
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-offic', marked_id);
            // let x = document.getElementById(markofficer).scrollHeight;
            // document.getElementById(markofficer).style.height =(10+x)+"px";
  
            const tx = document.getElementsByTagName("textarea");
            for (let i = 0; i < tx.length; i++) {
              tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
              tx[i].addEventListener("input", OnInput, false);
            }
  
            function OnInput() {
              this.style.height = 0;
              this.style.height = (this.scrollHeight) + "px";
            }
            $("textarea").trigger("input");
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-key',JSON.stringify(marked_key));

            myInput = document.getElementById(tooltipid);
            
            if(marked_desig.length==0)
            {
              marked_desig='Add From Dropdown'
            }
            myInput.innerHTML=truncateString(marked_desig,10);
            marked_desig=marked_desig.replaceAll(',',', ')
            myInput.title=marked_desig;
            $('#'+tooltipid).tooltip();
          }
        })
  
  
  
  }
  
  $('.demo-copy').selectpicker()
      $(".demo-copy").removeClass("dropdown");
      var button = $(`#copy_divdesgn .bs-actionsbox .btn-group`);
      button.append(`<button type="button" class="btn btn-default btn-light" onclick="copyToOption();">Save</button>`)

  function copyToOption(){
    
    // let id=e.substring(5,e.length);
    var options = document.getElementById('copy_desgn').selectedOptions;
    var values = Array.from(options).map(({ value }) => value);
    
    let lt='copy_desgninp';
    let notexist=[], altext=document.getElementById(lt).value;
    altext=altext.split(',');

    let markofficer='copyto';
    var myInput = document.getElementById(markofficer);
    var officer_id=myInput.getAttribute('custom-offic');
    if(values.length==0 && officer_id.length==0)
    {
      alert('Please select Designation to Add');
      return false;
    }
    if(officer_id.length!=0)
    {
      officer_id=officer_id.split(',');
    }
    else
    {
      officer_id=[];
    }

    officer_id=[...new Set(officer_id.concat(values))]
    
    for(let i=0;i<altext.length;i++)
    {
      if(values.includes(String(altext[i])))
      {
        continue;
      }
      else
      {
            var index = officer_id.indexOf(altext[i]);
            if (index !== -1) {
              officer_id.splice(index, 1);
            }
      }
          
    }
    document.getElementById(lt).value=values;

    data={
        'officer_id': JSON.stringify(officer_id),
        'csrfmiddlewaretoken': '{{csrf_token}}'
      }
   
      $.ajax({
        type : 'POST',
        url : "{% url 'desig_changecode' %}", 
        dataType : 'json',
        data : data,

        success : function(response){
          marked_id=JSON.parse(response.marked_id);
          marked_desig=response.marked_desig;
          marked_key=JSON.parse(response.marked_key);

          document.getElementById(markofficer).value=marked_desig;
          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-offic', marked_id);
          // let x = document.getElementById(markofficer).scrollHeight;
          // document.getElementById(markofficer).style.height =(10+x)+"px";

          const tx = document.getElementsByTagName("textarea");
          for (let i = 0; i < tx.length; i++) {
            tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
            tx[i].addEventListener("input", OnInput, false);
          }

          function OnInput() {
            this.style.height = 0;
            this.style.height = (this.scrollHeight) + "px";
          }
          $("textarea").trigger("input");

          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-key',JSON.stringify(marked_key));
          
        }
      })



    }
  </script> 
  


           
    {% endblock %}  
