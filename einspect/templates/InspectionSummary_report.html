{% extends 'base.html' %} 
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspection Summary Report</title>
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous"> -->
    <script src="{% static '/js/jquery-3.4.1.min.js' %}" ></script>
    <script src="{% static '/js/popper.min.js' %}" ></script>
    <script src="{% static '/js/Chart.min.js' %}"></script>
    <script src="{% static '/js/jquery-3.3.1.slim.min.js' %}" ></script>
    <script src="{% static '/js/bootstrap.min.js' %}" ></script>
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script> -->
    <script src="{% static '/js/jquery-ui.js' %}"></script>
    <script src="{% static '/js/jquery-1.12.4.js' %}"></script>
    <script src="{% static '/js/select2.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}"  />
    <script src="{% static '/js/moment.min.js' %}"></script>

    <script src="{% static '/js/jquery-3.3.1.js' %}"></script>
    <script src="{% static '/js/sweetalert.min.js' %}"></script>
    <script src="{% static '/js/jquery.min.js' %}"></script>
    <script src="{% static '/js/bootstrap.min1.js' %}"></script>
    <script src="{% static '/js/jquery.min1.js' %}"></script>
    <script src="{% static '/js/jquery-ui.min.js' %}"></script>
    <script src="{% static '/js/jspdf.min.js' %}"></script>

    <script src="{% static '/DataTables/datatables.min.js' %}"></script>
    <script src="{% static '/js/dataTables.bootstrap4.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/DataTables/datatables.min.css' %}"  />

    <link rel="stylesheet" type="text/css" href="{% static '/css/bootstrap.min.css' %}"  />
    <link rel="stylesheet" type="text/css" href="{% static '/css/jquery-ui.css' %}"  />
    
    <script src="{% static '/js/jquery.timepicker.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/jquery.timepicker.min.css' %}"  />

    <script type="text/javascript" src="{% static '/daterangepicker-master/moment.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/datepicker-master/moment.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/daterangepicker-master/daterangepicker.js'%}"></script>

    <link rel="stylesheet" type="text/css" href="{%static '/daterangepicker-master/daterangepicker.css'%}" />

    <!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <script rel="stylesheet" href="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script> -->

    <!-- supriya link -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"> -->

    <link rel="stylesheet" type="text/css" href="{% static '/css/forms_common.css' %}" />

</head>

<body>

  <div>
    <h3 id="h6" class="report_heading">Inspection Summary Report</h3>
  </div>

  <div class="container">

    <div class="container inpt-container mt-5" id="filterForm" >
      <div class="row">
        <div class="col-lg-3">
          <div class="form-group">
            <label class="lbl-caption">From Date<sup class="text-danger"> *</sup></label>
            <input type="text" id="dateofInsp1" autocomplete="off" placeholder="Select Date" class="form-control datepicker disableFuturedate"  name="dateofInsp" readonly  required>
        </div>
        </div>
        <div class="col-lg-3">
          <div class="form-group">
            <label class="lbl-caption">To Date<sup class="text-danger"> *</sup></label>
            <input type="text" id="dateofInsp2" placeholder="Select Date" class="form-control datepicker2 disableFuturedate" autocomplete="off" readonly  name="dateofInsp" required>
        </div>
        </div>
        <div class="col-lg-6">
          <div class="row float-right">
            <div class="form-group">
                <div class="col">
                  <div class="btn-toolbar" role="toolbar" style="margin-top:30px;">
                      <div class="btn-group mr-2" role="group" >
                          <button type="button" class="btn btn-warning btn-sm" id="btnReset1" onclick="searchdetailsISR('normal')">Continue</button>
                          <button type="button" class="btn btn-secondary btn-sm" id="btnReset" value="submit" onclick="searchdetailsISR('reset')">Reset</button>
                      </div>
                  </div>
                </div>
              </div>
              <div class="form-group">
                  <div class="col">
                    <div class="btn-toolbar" role="toolbar" style="margin-top:30px;">
                        <div class="btn-group mr-2" role="group" >
                            <button type="button"  id="submitpdf" class="btn btn-danger btn-sm" value="PDF" onclick="pdfShow()">PDF <i class="fa fa-file-pdf"></i></button>            
                            <button type="button"  id="submitexcel" class="btn btn-success btn-sm" value="excel" onclick="excelShow()">Excel <i class="fa fa-file-excel"></i></button>
                        </div>
                    </div>
                  </div>
              </div>
        </div>
        </div>
      </div>
    </div>

    <div class="container mt-5">
      <div class="row" style="background-image: radial-gradient(circle farthest-side, #fceabb, #f8b500);  color: black ;font-weight: bold;height: 40px; vertical-align: middle;">
        <div class="col-lg-6 my-1">
          <div class="row ml-1">
            Show      
            <div class="col-lg-5">
              <select name="category" class="form-control-sm" id="selectedCategory" style="width:100%;">
                <option value="" selected="selected" disabled>Select</option>
                <option>10</option>
                <option>50</option>
              </select>
            </div>
            Entries
          </div>
        </div>       
    
        <div class="col-lg-6 my-1">
          <div class="row float-right mr-2">
              <button class="btn btn-sm bg-white mr-2" style="height:30px; margin-top: 2px;" type="button" id="filterButton" value="filter" onclick="show_filters(this.val)" >
                <i class="fa fa-filter fa-sm"></i>
                Toggle Filter
              </button>
                      
              <div class="form-inline float-right">         
                <div>
                  <input type="text" class="form-control form-control-sm" id="myInput" placeholder="Search Text..." >
                </div>
                <div>
                  <i class="fa-solid fa-print my-2 mx-2" onclick="window.print();"></i>
                </div>          
              </div>
            </div>
          </div>
       </div> 
    </div> 
  
    <table class="table table-bordered table-sm table-hover table-data" cellspacing="0"  id="show_details">
        <thead id="thead_IC ">
          <tr>
            <th scope="col" style="width: 15px;">S.No.</th>
            <th style="width: 30%;" scope="col">Designation Name</th>
            {% for i in shortcode %}
            <th scope="col">{{i}}</th>
            {% endfor %}
            <th scope="col">Total</th>
          </tr>
        </thead>
        <tbody id="details121">  </tbody>        
    </table>

  </div>
      
    <div class="col-md-12">
        
        </div>
        
      <!-- </div> -->

        <br><br>
</body>

<script>
   $('.select2').select2();
</script>
<script>
  // $(document).ready(function () {
       
    // });
// 
</script>
<script>

$(document).ready(function () {

// 


$("#myInput").on("keyup", function(){
  var value = $(this).val().toLowerCase();
  $("#details121 tr").filter(function() {
  $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)

});

});




var currentdate = new Date();
var startdate = moment().subtract(7, 'days')
var enddate = moment()
$("#dateofInsp1").val(startdate.format('DD/MM/YYYY'))  
$("#dateofInsp2").val(enddate.format('DD/MM/YYYY'))
$("#dateofInsp1").datepicker({
  maxDate: currentdate,
  enddate: "currentdate",
  dateFormat: "dd/mm/yy",
  changeMonth: true,
  changeYear: true,
  todayHighlight: true,
  clearBtn: true

});
$('#dateofInsp1').change(function () {
  var dateofInsp1 = $('#dateofInsp1').val();
  console.log("hii", dateofInsp1)
  var currentdate = new Date();
  // $("#dateofInsp2").val(currentdate.getDate() + "/" + parseInt(currentdate.getMonth() + 1) + "/" + currentdate.getFullYear())
  $("#dateofInsp2").datepicker({
    maxDate: currentdate,
    minDate: dateofInsp1,
    // startDate: dateofInsp1,
    dateFormat: "dd/mm/yy",
    changeMonth: true,
    changeYear: true,
    todayHighlight: true
  });
})
searchdetailsISR('normal')

});

</script>
<script>


function searchdetailsISR(check){
var dateofInsp1= $('#dateofInsp1').val();
// alert(dateofInsp1)
var dateofInsp2= $('#dateofInsp2').val();
// alert(dateofInsp2)
// var rlyorg= $('#rlyorg').val();
console.log("dateofInsp1" ,dateofInsp1)
console.log("dateofInsp2" ,dateofInsp2)

$("#details121").empty();
data={
  'dateofInsp1':dateofInsp1,
  'dateofInsp2':dateofInsp2,
  'check':check,
  // 'rlyorg':rlyorg,
}
$.ajax({
  url:'{% url "searchdetailsISR" %}',
        dataType: 'json',
        type: 'GET',
        data: data,
        success: function(response)
        {
          console.log("Response.finalList",response.finalList)
          var table=$('#show_details').DataTable();
          table.destroy();
            
            
            $('#show_details tbody').empty();
            body = response.finalList
            header=response.insid
            console.log(body)
            var row='';

            var num=0;
            // console.log(response.desig)
            for(let i=0;i<body.length;i++)
            {
                
                
                row+=`<tr>

                  <td>${++num}</td>
                  <td>${body[i]['designation__designation']}</td>`
                  for(let j=0;j<header.length;j++){
                    row+=`<td>${body[i][header[j]['name']]}</td>`
                  }
                  row+=`<td>${body[i]['total']}</td>`
            }
            row+=`</tr>
            `
            $('#show_details tbody').append(row);

            var table=$('#show_details').DataTable({
              pageLength : 10,
              "lengthChange": false,
              searching: false, 
              pagingType: "simple",
              "language": {
              "info": "Page _PAGE_ of _PAGES_",
                     
              }
            });
       

       

      if(check=='reset'){
        var currentdate = new Date();
        var startdate = moment().subtract(7, 'days')
        var enddate = moment()
        $("#dateofInsp1").val(startdate.format('DD/MM/YYYY'))  
        $("#dateofInsp2").val(enddate.format('DD/MM/YYYY'))
        

      }

    }
})
}



function pdfShow()
{
var fromdate = $('#dateofInsp1').val();
var todate = $('#dateofInsp2').val();
submitbtn=$('#submitpdf').val();
alert(submitbtn)
console.log(fromdate)
if(fromdate!='' && todate!=''){
  window.open("{% url 'inspectionsummaryReportPdf' %}"+"?fromdate="+fromdate+"&todate="+todate+'&submitbtn='+submitbtn,"_blank")
}else{
  alert('No data available')
}

// window.location.href="{% url 'inspectionsummaryReportPdf' %}"+"?fromdate="+fromdate+"&todate="+todate+'&submitbtn='+submitbtn;


}

function excelShow()
{
var fromdate = $('#dateofInsp1').val();
var todate = $('#dateofInsp2').val();
submitbtn=$('#submitexcel').val();
alert(submitbtn)
if(fromdate!='' && todate!=''){
  window.location.href="{% url 'inspectionsummaryReportPdf' %}"+"?fromdate="+fromdate+"&todate="+todate+'&submitbtn='+submitbtn;
}else{
  alert('No data available')
}
}

function show_filters(val){

$('#filterForm').toggle();

}
</script>


</html>

{% endblock content %}