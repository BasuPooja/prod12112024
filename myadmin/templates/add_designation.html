{% extends 'adminDash.html' %}

{% block content %}
{% load static %}
<head>
  <script src="{% static '/js/autosize.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">
 <style>
  .select2-selection__rendered {
    line-height: 31px !important;
}
.select2-container .select2-selection--single {
    height: 35px !important;
    
}
.select2-selection__arrow {
    height: 34px !important;
    
}
 </style>

   <title>Designation master</title>
   <script>
    $(document).ready(function () {
      $('#post').select2();
      $('#rltype2').select2();
      $('#rltype').select2();
      $('#pre_station').select2();
      $('#pre_reporting_officer').select2();
      $('#category').select2();
      $('#depart1').select2();
        setDataTablePlugin();
    });

    function setDataTablePlugin() {
        $('#table2').DataTable({
            "scrollY": "65vh",
            "scrollCollapse": true,

            "pagingType": "full_numbers"

        });
    }
    
</script>
  </head>
  
<br>
<h3 style="font-family: 'Lato', sans-serif;"><b><center>Add Designation</center></b></h3>
<center>
  <div class="container">
    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'success' %}
              <div class="alert1 alert-success" id="alert1">
                <strong>Success </strong>{{ message }}
              </div>
            {% elif message.tags == 'error' %}
              <div class="alert alert-danger">
                <strong>Error </strong>{{ message }}
              </div>
            {% elif message.tags == 'info' %}
              <div class="alert alert-info">
                <strong>Info </strong>{{ message }}
              </div>
            {% else %}
            
            {% endif %}
           
        
        {% endfor %}
    {% endif %}
  </div>
</center>
<br>

<center>
    <form method="POST">{%csrf_token%}
        <div class="container">
             <table class="table table-borderless">
              

                <div class="row">
                  
                    <div class="col-md-1"></div>
                    <div class="col-md-2" style="text-align: left;">                      
                      <label>Post</label><span style="color:red;font-weight:bold;">*</span></div>
                      <div class="col-md-3">
                        <select  class="form-control" name="post" id="post" onchange=" cal_desig();createDesignation();" >
                          <option disabled selected  value=""> Select post</option>
                          {% for i in post %}
                          <option> {{i.post_code}} </option>
                          {% endfor %}
                      </select>
                  </div>
                  <div class="col-md-1"></div>
                  <div class="col-md-2" style="text-align: left;">
                <label>Work Area1</label></div>
                <div class="col-md-3">
                   <input class="form-control" id="work12" name="work12" maxlength="20" placeholder="Enter work" onkeyup="createDesignation()"/>
            </div>


                    </div>

                </div>
                <br> 
              
                <div class="row">
                  
                  <div class="col-md-1"></div>
                <div class="col-md-2" style="text-align: left;">
                    <label>Railway/ Division</label><span style="color:red;font-weight:bold">*</span></div>
                    <div class="col-md-3">

                      <select  id="rltype2" required class="form-control"
                      onchange="getstationName(this.value);createDesignation()">
                      <option value="" selected disabled hidden>Railway/ Division</option>

                      {% for i in all_railway %}
                      <option value="{{i.rly_unit_code}}">{{i.location_code}}/
                          {{i.location_description}}/ {{i.location_type}}</option>
                      {% endfor %}
                  </select>
                  </div>
                    <div class="col-md-1"></div>
                    <div class="col-md-2" style="text-align: left;">
                      <label for="rly">Station</label><span style="color:red;font-weight:bold">*</span>
                    </div>
                      <div class="col-md-3">
                        <select class="form-control" id="pre_station" style="width:100%;"
                        placeholder="Select Station">
                        <option value="" selected disabled hidden>Select Station</option>
                        {%for j in all_station%}
                        <option value="{{j.station_name}}">{{j.station_name}} </option>
                        {%endfor%}
                        </select>
                  </div>
            
                 


              </div>
             
              <br>


              <div class="row">
                
              
            <div class="col-md-1"></div>
            <div class="col-md-2" style="text-align: left;">
          <label>Work Area2</label></div>
          <div class="col-md-3">
             <input class="form-control" id="work" name="work" maxlength="20" placeholder="Enter work" onkeyup="createDesignationWork()"/>
      </div>
      <div class="col-md-1"></div>
      <div class="col-md-2" style="text-align: left;">
      <label>Reporting Officer</label><span style="color:red;font-weight:bold">*</span>
    </div>
      <div class="col-md-3">
      
        <select class="form-control" id="pre_reporting_officer" style="width:100%;"
        placeholder="Select Reporting Officer">
        <option value="" selected disabled hidden>Select Reporting Officer</option>
        {%for j in rly_emp_designation%}
        <option value="{{j}}">{{j}} </option>
        {%endfor%}
    </select>
       
    </div>

   
              </div>
          <br>
          <div class="row">
              
              

        <div class="col-md-1"></div>
        <div class="col-md-2" style="text-align: left;">
      <label>Official Contact No.</label></div>
      <div class="col-md-3">
        <input class="form-control" type="text" id="contact" autocomplete="off"
                                            onkeypress="return isNumber(event)" placeholder="Enter Contact number"
                                            maxlength="10">
    </div>


  <div class="col-md-1"></div>
  <div class="col-md-2" style="text-align: left;">
<label >Official Email ID</label><span style="color:red;font-weight:bold">*</span></div>
<div class="col-md-3">
   <input type="email" class="form-control" id="email" maxlength="50" onchange="ValidateEmail(this)" autocomplete="off" onkeyup="emailToLowerCase();" name="email" placeholder="Enter Email ID" />
</div>

            </div><br>
           <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-2" style="text-align: left;">
        <label style="text-align: left;">Designation</label><span style="color:red;font-weight:bold">*</span></div>
        <div class="col-md-3">
           <input class="form-control" id="desig" name="desig" placeholder="Enter designation" required readonly/>
      </div>
           </div>



          <br>
          <div class="row">
            <div class="col-md-3">
              <label>Similar Designations</label></div>
                   <textarea style="margin-left:90px;width:1200px;height:100px;" id="designation_data" readonly></textarea>
                  </div>
   
          <br>
          <input type="checkbox" id="check" name="check">
          <label for="check">I assure the uniqueness of designation made by me.</label><br>
                <button  type="button" value="submit" name="submit" class="btn btn-success" id="savedesig" disabled> Submit</button></div>
                
                <br><br>
                  <div class="col-md-4">
                    <button type="button" class="btn btn-primary"  data-toggle="modal" data-target="#exampleModal"> Add Post</button>  </div>   
                    
                    </div>        

 <!-- department add -->
<div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModal1Label"
aria-hidden="true">
<div class="modal-dialog ">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModal1Label">Add New Department</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                onclick="window.location.href = window.location.href;">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-6">
                        <label><b>Department Name</b></label></div>
                        <div class="col-md-6">
                            <input type="text" id="department" name="department" list="productName" autocomplete="off" placeholder="Enter Department" class="form-control">
                            <datalist id="productName">
                                <option selected disabled hidden></option>
                    {% for i in unit %}
                        <option value = {{i.department_name}}>{{i.department_name}}</option>
                    {% endfor %}
                            </datalist>
                      </div></div>
                       
              <br>
                  
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                onclick="window.location.href = window.location.href;">Close</button>
            <button type="button" class="btn btn-primary" id="btn">Save
                    changes</button>
        </div>
    </div>
</div>
</div>
</div>

</div>
<div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModal2Label"
aria-hidden="true">
<div class="modal-dialog ">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModal2Label">Add Area</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                onclick="window.location.href = window.location.href;">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-6">
                <label><b>Department</b></label></div>
                <div class="col-md-6">
                <select  class="form-control" name="dept3" id="dept3" >
                    <option disabled selected  value=""> Select department</option>
                    {% for i in unit %}
                    <option  value="{{i.department_name}}"> {{i.department_name}} </option>
                    {% endfor %}
                      </select></div>
                   </div> <br>

                   <div class="row">
                    <div class="col-md-6">
                <label><b>Area</b></label></div>
                <div class="col-md-6">
                    <input type="text" id="shop2" name="shop2" list="shopname" autocomplete="off" class="form-control" placeholder="Enter Area name">
                    <datalist id="shopname">
                        <option selected disabled hidden></option>
            <!-- {% for i in shop_code %}
                <option value = {{i.shop_code}}>{{i.shop_code}}</option>
            {% endfor %} -->
                    </datalist>
                    </div>
                   </div>
                 
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                onclick="window.location.href = window.location.href;">Close</button>
            <button type="button" class="btn btn-primary" id="btn1">Save
                    changes</button>
        </div>
    </div>
</div>
</div>
</div>

</div>

<!-- section add -->
<div class="modal fade" id="exampleModal3" tabindex="-1" aria-labelledby="exampleModal3Label"
aria-hidden="true">
<div class="modal-dialog ">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModal3Label">Add Subarea</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                onclick="window.location.href = window.location.href;">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-6">
                <label><b>Department Name</b></label></div>
                <div class="col-md-6">
                <select  class="form-control" name="dept1" id="dept1" >
                    <option disabled selected  value=""> Select department</option>
                    {% for i in unit %}
                    <option  value="{{i.department_name}}">{{i.department_name}} </option>
                    {% endfor %}
                      </select></div>
                   </div> <br>

                   <div class="row">
                    <div class="col-md-6">
                <label>
                  <b>Area Code</b></label></div>
                <div class="col-md-6">
                  
                        <select name="sectiondept" id="sectiondept" class="form-control" placeholder="Choose Area">
                            <option disabled selected  value=""> Select Area</option>
                        </select>
                      
                    </div></div><br>
                    <div class="row">
                        <div class="col-md-6">
                    <label><b>Subarea Description</b></label></div>
                    <div class="col-md-6">
                        <input type="text" id="sec" name="sec" list="section" autocomplete="off" class="form-control" placeholder="Enter Subarea">
                        <datalist id="section">
                            <option selected disabled hidden></option>
               
                        </datalist></div>
                       </div>
                </div>
            
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                onclick="window.location.href = window.location.href;">Close</button>
            <button type="button" class="btn btn-primary" id="btn2">Save
                    changes</button>
        </div>
    </div>
</div>
</div>
</div>
</div>
  <!-- Modal add post -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Add New Post</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="row">
                  <div class="col-md-1"></div>
                  <div class="col-md" style="text-align: left;"> 
                    <label>Post Full Description</label><span style="color:red;font-weight:bold">*</span></div>
                    <div class="col-md">
                       <input type="text" autocomplete="off" class="form-control" id="postname" maxlength="95" name="postname" placeholder="Enter post description" required/>
                </div></div><br>
                <div class="row">
                  <div class="col-md-1"></div>
                <div class="col-md" style="text-align: left;">
                  <label>Post Short Code</label><span style="color:red;font-weight:bold">*</span></div>
                  <div class="col-md">
                     <input type="text" style="text-transform: uppercase" autocomplete="off" class="form-control" id="postcode" name="postcode" maxlength="25" placeholder="Enter post code" required onchange="checkPostCode(this.value)"/>
              </div>
                </div>
                </br>
                <div class="row">
                  
                  <div class="col-md-1"></div>
                <div class="col-md" style="text-align: left;">
                      <label>Category</label><span style="color:red;font-weight:bold">*</span></div>
                      <div class="col-md">
                        <select  class="form-control" style="width: 200px;" name="category" id="category" >
                          <option disabled selected  value=""> Select category</option>
                          {% for i in cat %}
                          <option> {{i.category}} </option>
                          {% endfor %}
                      </select>
                  </div>
                </div>
                </br>
                <div class="row">
                  <div class="col-md-1"></div>
                <div class="col-md" style="text-align: left;">
                    <label>Pay Level Max</label><span style="color:red;font-weight:bold">*</span></div>
                    <div class="col-md">

                      <select class="form-control" id="paymax" name="paymax" style="width:100%;"
                                            onchange="chkLevel(this.id)">
                                            <option value="" selected disabled hidden>Select Max Level</option>
                                            {%for j in level%}
                                            <option value="{{j}}">{{j}} </option>
                                            {%endfor%}
                                        </select>
                       <!-- <input type="number" min="0" class="form-control" id="paymax" maxlength="2" name="paymax" placeholder="Enter maximum pay level" required/> -->
                </div>
                </div></br>
                  
                <div class="row">
                  <div class="col-md-1"></div>
                <div class="col-md" style="text-align: left;">
                    <label>Pay Level Min</label><span style="color:red;font-weight:bold">*</span></div>
                    <div class="col-md">
                      <select class="form-control" id="paymin" name="paymin" style="width:100%;"
                      onchange="chkLevel(this.id)">
                      <option value="" selected disabled hidden>Select Min Level</option>
                      {%for j in level%}
                      <option value="{{j}}">{{j}} </option>
                      {%endfor%}
                  </select>
                       <!-- <input type="number" min="0" maxlength="2" class="form-control" id="paymin" name="paymin" placeholder="Enter minimum pay level" required/> -->
                </div>
                </div>

               <br>
               
                  <div class="row">
                    <div class="col-md-1"></div>
                  <div class="col-md" style="text-align: left;">
                    <label>Department</label><span style="color:red;font-weight:bold">*</span></div>
                    <div class="col-md">
                      <select  class="form-control" style="width: 200px;" name="depart1" id="depart1" >
                        <option disabled selected  value=""> Select department</option>
                        {% for i in unit %}
                        <option value="{{i.department_name}}"> {{i.department_name}} </option>
                        {% endfor %}
                    </select>          
                    </div>
                  </div>
              
                <br>
                
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="btnn">Save Changes</button>
        </div>
      </div>
      </div>
    </div>
  </div>
        </div>
     
        <div>




    </form>
</center>

<div class="modern" style="margin-left: 10%; margin-right: 10%; margin-bottom: 5%;font-family:'Lato', sans-serif">
  <!-- <table align="center" cellpadding="10"></table> -->
  <!-- <table class="table table-striped table-bordered table-hover" id="table2"> -->
    <table class="table table-striped table-bordered table-sm" width="700" id="table2">
   
    <!-- <thead class="thead-dark"> -->
      <thead style="background-color: #0066cc;white-space: nowrap;font-size: 1rem; color:white;text-align: center;">
      <tr>
        <th>Sr no.</th>
        <th>Designation</th>
        <th>Department</th>
        <th>Employee No.</th>
        <th>Status</th>
        <th>Email ID</th>
        <th>Action</th>
      </tr>
    </thead> 
    <tbody>
      {% for g in datatable %}
      <tr>
        <td>{{forloop.counter}}</td>
        <td>{{g.designation}}</td>
        <td>{{g.department}}</td>
        <td>{{g.empno_id}}</td>
        <td>{{g.status}}</td>
        <td>{{g.official_email_ID}}</td>
        <td>
          <input {% if g.delete_flag != False %} disabled {% endif %} type="button" name="action_1" id="Disable@{{g.designation_code}}" class="btn btn-danger btn-sm float-center" value="Disable" onclick="details_desig(this.id)" >
          <input {% if g.delete_flag != True %} disabled {% endif %} type="button" name="action_1" id="Enable@{{g.designation_code}}" class="btn btn-success btn-sm float-center" value="Enable" onclick="details_desig(this.id)" >

        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
    </div>


<script>

  function checkPostCode(val)
  {
          let data = {
                post_type: 'PostCode',
                postcode: val,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            };
            $.ajax({
                url: "{% url 'addPostAjax' %}",
                method: "POST",
                dataType: "JSON",
                data: data,
                success: function (response) {
                    if(response == 'Exists')
                    {
                      alert('Post Code Already Present');
                      $('#postcode').val('');
                    }
                },
                error: function (err) {
                    alert('Some error occured');
                }
            });
  }
          function chkLevel(id) {
            let val = $('#' + id).val();
            let min = $('#paymin').val();
            let max = $('#paymax').val();

            if (min != '' && max != '') {
                min = parseInt(min);
                max = parseInt(max);
                if (min > max) {
                    alert('Min Level Cannot Be Greater Then Max Level');
                    $('#paymin').val('');
                    $('#paymax').val('');
                    $('#' + id).val(val);
                }
            }

        }
function ValidateEmail(mail) 
          {
           if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.mail.value)
            {
              return (true)
            }
              alert("You have entered an invalid email address!")
              return (false)
          }


  $(function() {
    $('#design').on('keypress', function(e) {
      
        if (e.which == 32){
           
            return false;
        }
    });
      
});


function alphanumeric(e)
{
  var code=('charcode' in e) ? e.charCode:e.keyCode;
  if(
    !(code>47 && code<58) && !(code>64 && code<91) && !(code>96 && code<123)
  ){
    e.preventDefault();
  }
}
</script>

<script>
  $(document).ready(function(){ 
  
    
      
$("#shop").change(function(e){
  

  var shop = $("#shop").val();

  var data = {shop};

  
    $.ajax({
      type : 'GET',
      url : "{% url 'getsection_byshop' %}",
      dataType : 'json',
      data : data,

      success : function(response){
      
            var elementsadded = document.querySelectorAll(".newelestaff");
            if(elementsadded.length>0){
              var elementsaddedarr = Array.from(elementsadded);
            elementsaddedarr.forEach((el)=> el.remove());
            document.querySelector("#empno").selected = true;
           
            }
            var brarr,mystr,html;
            brarr = response.shop;
            mystr = "";
           
            $("#section").empty();
            html = `<option  class="newelecdno" value="" disabled hidden>Select Subarea</option>`;
            mystr = html.concat(mystr);
            brarr.forEach((el,index)=>{
              html = `<option class="newelecdno">${brarr[index]}</option>`
              
              mystr = html.concat(mystr);
            });
            html = "";
            document.querySelector("#section").insertAdjacentHTML('beforeend',mystr);
            mystr="";
      }
         })
         })
          
      
// $("#dept").change(function(e){
  
//   e.preventDefault(); 
//   var dept = $("#dept").val();

//   var data = {dept};

  
//     $.ajax({
//       type : 'GET',
//       url : "{% url 'getshop_bydept' %}",
//       dataType : 'json',
//       data : data,

//       success : function(response){
      
//             var elementsadded = document.querySelectorAll(".newelestaff");
//             if(elementsadded.length>0){
//               var elementsaddedarr = Array.from(elementsadded);
//             elementsaddedarr.forEach((el)=> el.remove());
//             document.querySelector("#empno").selected = true;
           
//             }
//             var brarr,mystr,html;
//             brarr = response.shop;
//             mystr = "";
           
//             $("#shop").empty();
//             html = `<option  class="newelecdno" value="" disabled hidden>Select Post</option>`;
//             mystr = html.concat(mystr);
//             brarr.forEach((el,index)=>{
//               html = `<option class="newelecdno">${brarr[index]}</option>`
              
//               mystr = html.concat(mystr);
//             });
//             html = "";
//             document.querySelector("#shop").insertAdjacentHTML('beforeend',mystr);
//             mystr="";
//       }
//          })
//          })
 
 
 $("#dept1").change(function(){
    
     var dept1 = $("#dept1").val();
     var data = {dept1};
  
       $.ajax({
         type : 'GET',
         url : "{% url 'post_bydept' %}",
         dataType : 'json',
         data : data,
   
         success : function(response){
             console.log(response)
             let htm = ''
             for (i in response.post_desc){
                 htm = '<option>'+response.post_desc[i].post_desc+'</option>'
                 $('#productName').append(htm)
             }
              
         }
            })
            })

            
      
// $("#dept").change(function(e){
  
//   e.preventDefault(); 
//   var dept = $("#dept").val();
  
//   var data = {dept};

  
//     $.ajax({
//       type : 'GET',
//       url : "{% url 'getpost_bydept' %}",
//       dataType : 'json',
//       data : data,

//       success : function(response){
      
//             var elementsadded = document.querySelectorAll(".newelestaff");
//             if(elementsadded.length>0){
//               var elementsaddedarr = Array.from(elementsadded);
//             elementsaddedarr.forEach((el)=> el.remove());
//             document.querySelector("#empno").selected = true;
           
//             }
//             var brarr,mystr,html;
//             brarr = response.post;
//             mystr = "";
           
//             $("#deptpost").empty();
//             html = `<option  class="newelecdno" value="" disabled hidden>Select Post</option>`;
//             mystr = html.concat(mystr);
//             brarr.forEach((el,index)=>{
//               html = `<option class="newelecdno">${brarr[index]}</option>`
              
//               mystr = html.concat(mystr);
//             });
//             html = "";
//             document.querySelector("#deptpost").insertAdjacentHTML('beforeend',mystr);
//             mystr="";
//       }
//          })
//          })



  })
 
        </script> 

<script>
  
function details_desig(el)
        {
            var _id = el;
            data={
                '_id':_id,
            }
            $.ajax({
                    type:'GET',
                    dataType:'json',
                    url:'{% url "details_desig" %}',
                    data:data,
                    success : function(response){
                      if(op=[]){
                      window.location.href = window.location.href;
                      }
                    }
                })
        }
</script>

<script>


    var select = '';
for (i=1;i<=18;i++){
  
    select += '<option val=' + i + '>' + i + '</option>';
}
$('#level').html(select);

    </script>
    <script>
      $(document).ready(function(){
        
        $('#btnn').click(function(){
      
          if( $("#postname").val() == null || $("#postcode").val() == null || $("#category").val() == null || $("#paymax").val() == null || $("#paymin").val() == null || $("#depart1").val() == null)
          {
              alert("Enter values");
              return false
          }
          else{
          if (confirm ("Are you sure you want to add the post?")) {
          $.ajax({
            url:"{% url 'add_post' %}",
            type: 'POST',
            dataType: 'json',
            data: {
              
              postname:$('#postname').val(),
              postcode:$('#postcode').val(),
              depart1:$('#depart1').val(),
              category:$('#category').val(),
              pc7_levelmax:$('#paymax').val(),
              pc7_levelmin:$('#paymin').val(),
              
              csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
            },
            success: function(response){
             
              location.reload();
            },
            error: function(response){
              alert('some error')
            }
          })
      }}
        });


       
        $('#savedesig').click(function(){
          if($('#post').val() == null)
          {
            alert('Post cannot be blank');
            return false;
          }
          if($('#rltype2').val() == null)
          {
            alert('Railway/Division cannot be blank');
            return false;
          }
          if($('#pre_station').val() == null)
          {
            alert('Station cannot be blank');
            return false;
          }

          // if($('#contact').val() == '')
          // {
          //   alert('Contact cannot be blank');
          //   $("#contact").focus();
          //   return false;
          // }
          // if ($('#contact').val().length < 10) {
          //       alert('Contact number should contain 10 digits');
          //       $("#contact").focus();
          //       return false;
          //   }
          if($('#email').val() == '')
          {
            alert('e-Mail cannot be blank');
            $("#email").focus();
            return false;
          }
          new_email = $('#email').val();
          var mailformat = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
            if (!new_email.match(mailformat)) {
                alert("Invalid email address.");
                $("#email").focus();
                return false;
            }


          if (confirm ("Are you sure you want to add the designation?")){
            $.ajax({
              url:"{% url 'save_designation' %}",
              type: 'POST',
              dataType: 'json',
              data: {
                post : $('#post').val(),
                designation:$('#desig').val(),
                contact:$('#contact').val(),
                email:$('#email').val(),
                rly: $('#rltype2').val(),
                station : $('#pre_station').val(),
                reporting_officer : $('#pre_reporting_officer').val(),
                csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
              },
              success: function(response){
                
               if(response.msg == 'Success')
               {
                alert('Designation added successfully ' + response.msg_1)
                  location.reload();
               }
                else 
                  alert(response.msg)
              },
              error: function(response){
                alert('some error occured')
              }
            })
          }
          
         
      }
        );
 

$("#dept1").change(function(){
  var dept = $("#dept1").val();
  var data = {dept};
 
    $.ajax({
      type : 'GET',
      url : "{% url 'shop_bydept' %}",
      dataType : 'json',
      data : data,

      success : function(response){
          
       // $("#sectiondept").find("option").remove()
          for(i in response.shop_code){
           var option = document.createElement("option");
           option.text = response.shop_code[i].shop_code;
           option.value = response.shop_code[i].shop_code;
           var select = document.getElementById("sectiondept");
           select.appendChild(option);
          }
      
          }
       })
         

$("#sectiondept").change(function(){
  var dept = $("#dept1").val();
  var sectiondept = $("#sectiondept").val();
  var data = {sectiondept,dept};
  
    $.ajax({
      type : 'GET',
      url : "{% url 'section_bydept' %}",
      dataType : 'json',
      data : data,

      success : function(response){
          console.log(response)
           let htm = ''
           $('#section').empty();
           for (i in response.section_desc){
           
               htm = '<option>'+response.section_desc[i].section_desc+'</option>'
               $('#section').append(htm)
           }
           
      }
         })
         })
      
      })
   
    

$("#dept").change(function(){
   
  var dept = $("#dept").val();
  var data = {dept};
 
    $.ajax({
      type : 'GET',
      url : "{% url 'shop_bydept' %}",
      dataType : 'json',
      data : data,

      success : function(response){
          console.log(response)
          let htm = ''
          for (i in response.shop_code){
              htm = '<option>'+response.shop_code[i].shop_code+'</option>'
              $('#shopname').append(htm)
          }
           
      }
         })
         })
      })
      
    
         
   
      
    </script>
    </script>
    <script type="text/javascript">
      $(function(){
        $("#check").click(function(){
          if($(this).is(":checked")){
            document.getElementById("savedesig").disabled = false;
          }
          else{
            document.getElementById("savedesig").disabled = true;
          }
        })
      });
      </script>
    <script>
      
      $('#btn').click(function(){
        if (confirm ("Are you sure you want to add this department?")) {
        $.ajax({
          url:"{% url 'dept_data' %}",
          type: 'POST',
          dataType: 'json',
          data: {
            
            department:$('#department').val(),
            
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
          },
          success: function(response){
           
            location.reload();
          },
          error: function(response){
            alert('some error')
          }
        })
    }
      });



      $('#btn1').click(function(){
        if (confirm ("Are you sure you want to add this shop?")) {
          
        $.ajax({
          url:"{% url 'shop_data' %}",
          type: 'POST',
          dataType: 'json',
          data: {
            
            dept:$('#dept3').val(),
            shop:$('#shop2').val(),
            
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
          },
          success: function(response){
           
            location.reload();
          },
          error: function(response){
            alert('some error')
          }
        })
    }
      });


  function cal_desig(){
  var post=document.getElementById('post').value;
  data={
    'post':post,
  }
  $.ajax({
    url: "{% url 'cal_desig' %}",
             method: "GET",
             dataType: "JSON",
             async: false,
             data: data,
            //  success: function (response) {
            //   if(response.len == 0)
            //   {
            //     $('#designation_data').val('');
            //   }
            //   else{

             
            //   for(i in response.desig){
            //     var design = response.desig[i].designation.split('/')[0]
            //     if(post == design){
                 
            //       $('#designation_data').append(response.desig[i].designation+', ')
            //     }
            //    }
            //   }
            //   }
            success: function (response) {
              $('#designation_data').empty();
              for(i in response.desig){
                var design = response.desig[i].designation.split('/')[0]
                if(post == design){
                  $('#designation_data').append(response.desig[i].designation+'  ,  ')
                }
              }
            }
             })
}


function railwaytype(){
  var rltype=document.getElementById('rltype2').value;
  if(rltype == 'DIRECTORATE' | rltype=='DIVISION' | rltype=='Coach Depot' | rltype=='WORKSHOP' | rltype=='STORE' | rltype=='CONSTRUCTION')
  {
    document.getElementById('div').disabled=false;
    document.getElementById('rly').disabled=false;
  }
  else if(rltype == 'RAILWAY BOARD' | rltype == 'RDSO' | rltype == 'PSU' | rltype=='OFFICE' | rltype=='HEAD QUATER' | rltype=='INSTITUTE' | rltype=='PRODUCTION UNIT')
  {
    document.getElementById('rly').disabled=false;
    document.getElementById('div').disabled=true;
  }
  data={
            'rltype':rltype,
        }

        $.ajax({
             url: "{% url 'railwaytype' %}",
             method: "GET",
             dataType: "JSON",
             async: false,
             data: data,
             success: function (response) {
              $("#rly option").remove();
              $("#rly").append(`<option disabled selected  value=""> Enter railway/Organisation</option>`);

              for (i in response.railway){
                $("#rly").append(`<option>${response.railway[i].location_code}</option>`);
              }
              
              }
            }
  )
}

// function divbyrly()
// {
//   var rly=document.getElementById('rly').value;
//   data={
//     'rly':rly,
//   }
//   $.ajax({
//              url: "{% url 'divbyrly' %}",
//              method: "GET",
//              dataType: "JSON",
//              async: false,
//              data: data,
//              success: function (response) {
//               for (i in response.division){
//                 $("#div").append(`<option>${response.division[i].location_code}</option>`);
//               }
              
//               }
//             }
//   )
// }

//  $('#rltype').click(function(){
    
//   var rltype=document.getElementById('rltype').value;
//   if(rltype=='DIVISION' | rltype=='WORKSHOP' | rltype=='STORE' | rltype=='CONSTRUCTION')
//   {
//     document.getElementById('div').disabled=false;
//     document.getElementById('rly').disabled=false;
//   }
//   else if(rltype=='OFFICE' | rltype=='HEAD QUATER' | rltype=='INSTITUTE' | rltype=='PRODUCTION UNIT')
//   {
//     document.getElementById('rly').disabled=false;
//     document.getElementById('div').disabled=true;
//   }
//  })

    $('#btn2').click(function(){
        if (confirm ("Are you sure you want to add this section?")) {
            
        $.ajax({
          url:"{% url 'section_data' %}",
          type: 'POST',
          dataType: 'json',
          data: {
            
            dept1:$('#dept1').val(),
            sectiondept:$('#sectiondept').val(),
            sec:$('#sec').val(),
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
          },
          success: function(response){
           
            location.reload();
          },
          error: function(response){
            alert('some error')
          }
        })
    }
  })
  function getstationName(val) {
   
            let data = {
                post_type: 'station',
                val: val,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            };
            $.ajax({
                url: "{% url 'addPostAjax' %}",
                method: "POST",
                dataType: "JSON",
                data: data,
                success: function (response) {
                    
                    let rep_officer = response.rep_officer;
                    let row = '<option value="" selected disabled hidden>Select Reporting Officer</option>';
                    $('#pre_reporting_officer').empty();
                    for (let i = 0; i < rep_officer.length; i++) {
                        row += `<option value="${rep_officer[i]}">${rep_officer[i]}</option>`;
                    }
                    $('#pre_reporting_officer').append(row);
                    response = response.all_station;
                    if (response.length > 0) {
                        let row = '<option value="" selected disabled hidden>Select station</option>';
                        $('#pre_station').empty();
                        for (let i = 0; i < response.length; i++) {
                            row += `<option value="${response[i].station_name}">${response[i].station_name}</option>`;
                        }
                        $('#pre_station').append(row);
                    }
                    else {
                        alert('Station is not present in master')
                    }
                },
                error: function (err) {
                    alert('Some error occured');
                }
            });
        }

        function createDesignation() {
          
            let designation = '';
            let post = $('#post').val();
            let rly = $('#rltype2').val();
            let work = $('#work').val();
            let work1 = $('#work12').val();
            if (post == null || post == '') {
                alert('Select Post First');
                $('#post').focus();
                return false;
            }
            if(work1 != '')
            {
                post = post + '/' + work1;
            }
            designation = post;
            designation = post;
          
            if (rly != null) {
                let data = {
                    post_type: 'checkRlyType',
                    rly: rly,
                    post: post,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                };
                $.ajax({
                    url: "{% url 'addPostAjax' %}",
                    method: "POST",
                    dataType: "JSON",
                    data: data,
                    success: function (response) {
                        response = response.createdDesignation;
                        if (work != '') {
                            response = response + work;
                        }
                        
                        $('#desig').val(response);
                    },
                    error: function (err) {
                        alert('Error in Designation Creation');
                    }
                });
            }
            else {
                if (work != '') {
                    designation = designation + work;
                }
                $('#desig').val(designation);
            }
        }

        function createDesignationWork() {
            let post = $('#post').val();
            let rly = $('#rltype2').val();
            let work = $('#work').val();
            if (post == null || post == '') {
                alert('Select Post First');
                $('#post').focus();
                $('#work').val('');
                return false;
            }
            if (rly == null || rly == '') {
                alert('Select Railway/Division First');
                $('#rltype2').focus();
                $('#work').val('');
                return false;
            }
            createDesignation();
        }
  function emailToLowerCase() {
            let email = $('#email').val();
            email = email.toLowerCase();
            $('#email').val(email);

        }
  function isNumber(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }
        setTimeout(function () {
            if ($('#msg').length > 0) {
                $('#msg').remove();
            }
        }, 5000);
    </script>
    <script>

      $(document).ready(function(){
        setTimeout(function(){
          $('#alert1').fadeOut(3000);
        })
      })     </script>
{% endblock content %}
