{% extends 'base.html' %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- CSS only -->
  <link rel="stylesheet" type="text/css" href="{% static '/accordian/bootstrap.min.css' %}" />
  <script src="{% static '/accordian/bootstrap.bundle.min.js' %}"></script>



  <script src="{% static '/js/jquery-3.4.1.min.js' %}"></script>
  <script src="{% static '/js/popper.min.js' %}"></script>
  <script src="{% static '/js/Chart.min.js' %}"></script>
  <script src="{% static '/js/jquery-3.3.1.slim.min.js' %}"></script>
  <script src="{% static '/js/bootstrap.min.js' %}"></script>

  <script src="{% static '/js/jquery-ui.js' %}"></script>
  <script src="{% static '/js/jquery-1.12.4.js' %}"></script>

  <script src="{% static '/js/select2.min.js' %}"></script>
  <script src="{% static '/js/moment.min.js' %}"></script>


  <script src="{% static '/js/jquery-3.3.1.js' %}"></script>
  <script src="{% static '/js/sweetalert.min.js' %}"></script>
  <script src="{% static '/js/jquery.min.js' %}"></script>
  <script src="{% static '/js/bootstrap.min1.js' %}"></script>
  <script src="{% static '/js/jquery.min1.js' %}"></script>
  <script src="{% static '/js/jquery-ui.min.js' %}"></script>
  <script src="{% static '/js/jspdf.min.js' %}"></script>

  <script src="{% static '/DataTables/datatables.min.js' %}"></script>
  <script src="{% static '/js/dataTables.bootstrap4.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/DataTables/datatables.min.css' %}" />


  <link rel="stylesheet" type="text/css" href="{% static '/css/bootstrap.min.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static '/css/jquery-ui.css' %}" />

  <script src="{% static '/js/jquery.timepicker.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/css/jquery.timepicker.min.css' %}" />
  <script type="text/javascript" src="{% static '/daterangepicker-master/moment.min.js'%}"></script>
  <script type="text/javascript" src="{% static '/daterangepicker-master/daterangepicker.js'%}"></script>
  <link rel="stylesheet" type="  text/css" href="{%static '/daterangepicker-master/daterangepicker.css'%}" />

  <script type="text/javascript" src="{% static '/js/jquery.mask.js'%}"></script>


  <link rel="//cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
  <script src="//cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
  <script src="{% static '/js/select2.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />

  <style>
    .details-show-hide {
      display: none;
    }
    
  </style>

  <title>Einspection | Inspection Edit Form</title>

</head>
<script type="text/javascript">
  $(".sidebar").addClass('close');
</script>

<body>
  <form method="POST" enctype="multipart/form-data">
    {%csrf_token%}
    <input type="text" id="inspectionId" name="inspectionId" hidden>
    <input type="submit" id="edit" Value="Edit" name="submit" hidden>
    <h3 style="text-align: center;">Einspection Report</h3>
    <div class="container-fluid">

      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" data-toggle="tab" href="#Finalized">Finalized Inspection</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="tab" href="#Pending">Pending Inspection</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="tab" href="#Closed">Closed Inspection</a>
        </li>
      </ul>
      <div class="tab-content">


        <div id="Finalized" class="container-fluid  tab-pane active"><br>
          <table id="inspectionDetails" class="table table-striped table-bordered center table-input">
            <thead style="background-color: #343a40;white-space: nowrap; color:white;text-align: left;">
              <tr>
                <th>S.No.</th>
                <th>Insp. Date</th>
                <th>Insp. Type</th>
                <th>Insp. Note</th>
                <th>Insp. Title</th>
                <th>Rly./Org.</th>
                <th>Div./Unit</th>
                <!-- <th>Edit</th> -->
                <th>Report</th>
              </tr>
            </thead>
            <tbody>
              {% for i in data %}
              <tr>
                <td>{{forloop.counter}}</td>
                <td>{{i.inspected_on | date:'d-m-Y' }}</td>
                <td>{{i.instypeid.name}}</td>
                <td>{{i.inspection_note_no}}</td>
                <td>{{i.inspection_title}}</td>
                <td>{{i.rly_id_id.location_code}}</td>
                <td>{{i.div_id_id.location_code}}</td>
                <!-- <td>
                                <button type="button" id="{{i.instypeid_id}}" name="{{i.einspno}}" onclick="fun_setdata(this.id,this.name);" style="border: white;" >
                                    <i class="fa fa-edit" style="font-size:24px;color:rgb(64, 112, 243)"></i>
                                </button>
                            </td> -->
                <th>
                  <button type="button" name="{{i.einspno}}" onclick="pdfDet(this.name);" style="border: white;">
                    <i class="fa fa-file" style="font-size:24px;color:rgb(245, 57, 32)"></i>
                  </button>
                </th>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div id="Pending" class="container-fluid  tab-pane"><br>
          <div id="pendingData">
            <table id="inspectionDetails1" class="table table-striped table-bordered center table-input">
              <thead style="background-color: #343a40;white-space: nowrap; color:white;text-align: left;">
                <tr>

                  <th>Insp. Date</th>
                  <th>Insp. Type</th>
                  <th>Insp. Note</th>
                  <th>Insp. Title</th>
                  <th>Rly./Org.</th>
                  <th>Div./Unit</th>
                  <th>Report</th>
                  <th>Show Detail</th>
                </tr>
              </thead>
              <tbody>
                {% for i in pending %}
                <tr>

                  <td>{{i.inspected_on | date:'d-m-Y' }}</td>
                  <td>{{i.instypeid.name}}</td>
                  <td>{{i.inspection_note_no}}</td>
                  <td>{{i.inspection_title}}</td>
                  <td>{{i.rly_id_id.location_code}}</td>
                  <td>{{i.div_id_id.location_code}}</td>
                  <th>
                    <button type="button" name="{{i.einspno}}" onclick="pdfDet(this.name);" style="border: white;">
                      <i class="fa fa-file" style="font-size:24px;color:rgb(245, 57, 32)"></i>
                    </button>
                  </th>
                  <td>
                    <button type="button" id="{{i.einspno}}" name="{{i.einspno}}" onclick="expandPending(this.name);"
                      style="border-style: none; margin-left: 30%;">
                      <i class="fas fa-angle-double-down" style="font-size:24px;color:rgb(105, 174, 238)"
                        title="Click To Expand/Shrink Details"></i>
                    </button>

                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div id="pendingDetails" class="details-show-hide">
            <table id="pendingDetailsTable1" class="table table-striped table-bordered center table-input">
              <thead style="background-color: #343a40;white-space: nowrap; color:white;text-align: left;">
                <tr>
                  <th>Insp. Date</th>
                  <th>Insp. Type</th>
                  <th>Insp. Note</th>
                  <th>Insp. Title</th>
                  <th>Rly./Org.</th>
                  <th>Div./Unit</th>
                  <th>Report</th>
                  <th>Hide Detail</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
            <br>
            <table id="pendingDetailsTable2" style="width: 100%;">
              
            </table>
          </div>
        </div>
        <div id="Closed" class="container-fluid  tab-pane"><br>
          <div id="closedData">
          <table id="inspectionDetails2" class="table table-striped table-bordered center table-input">
            <thead style="background-color: #343a40;white-space: nowrap; color:white;text-align: left;">
              <tr>
                <th>Insp. Date</th>
                <th>Insp. Type</th>
                <th>Insp. Note</th>
                <th>Insp. Title</th>
                <th>Rly./Org.</th>
                <th>Div./Unit</th>
                <th>Report</th>
                <th>Show Detail</th>
              </tr>
            </thead>
            <tbody>
              {% for i in closed %}
              <tr>
                <td>{{i.inspected_on | date:'d-m-Y' }}</td>
                <td>{{i.instypeid.name}}</td>
                <td>{{i.inspection_note_no}}</td>
                <td>{{i.inspection_title}}</td>
                <td>{{i.rly_id_id.location_code}}</td>
                <td>{{i.div_id_id.location_code}}</td>
                <th>
                  <button type="button" name="{{i.einspno}}" onclick="pdfDet(this.name);" style="border: white;">
                    <i class="fa fa-file" style="font-size:24px;color:rgb(245, 57, 32)"></i>
                  </button>
                </th>
                <td>
                  <button type="button" id="{{i.einspno}}" name="{{i.einspno}}" onclick="expandClosed(this.name);"
                    style="border-style: none; margin-left: 30%;">
                    <i class="fas fa-angle-double-down" style="font-size:24px;color:rgb(105, 174, 238)"
                      title="Click To Expand/Shrink Details"></i>
                  </button>

                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div id="closedDetails" class="details-show-hide">
          <table id="closedDetailsTable1" class="table table-striped table-bordered center table-input">
            <thead style="background-color: #343a40;white-space: nowrap; color:white;text-align: left;">
              <tr>
                <th>Insp. Date</th>
                <th>Insp. Type</th>
                <th>Insp. Note</th>
                <th>Insp. Title</th>
                <th>Rly./Org.</th>
                <th>Div./Unit</th>
                <th>Report</th>
                <th>Hide Detail</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
          <br>
          <table id="closedDetailsTable2" style="width: 100%;">
            
          </table>
        </div>
        </div>


      </div>

    </div>
  </form>
</body>

<script>
  $('#inspectionDetails').dataTable();
  $('#inspectionDetails1').dataTable({
    "ordering": false
  });
  $('#inspectionDetails2').dataTable({
    "ordering": false
  });
  function fun_setdata(instypeid, einspno) {
    window.location.href = "{% url 'showMenu' %}" + "?id=" + instypeid + "&inspectionId=" + einspno;
  }

  function pdfDet(id) {
    window.open("{% url 'pdfDetails' %}" + "?id=" + id);
  }

  function expandPending(einspno) {
   
    
    let data = {
        data_type: 'PendingDetails',
        einspno: einspno,
        csrfmiddlewaretoken: '{{ csrf_token }}'
    };
    $.ajax({
        url: "{% url 'showMenuFinal' %}",
        method: "POST",
        dataType: "JSON",
        data: data,
        success: function (response) {
            var row = '',thead = '',tbody = '';
            let inspectionData = response.inspectionData;
            let inspectionDetails = response.inspectionDetails;
            for(let i = 0; i < inspectionDetails.length; i++)
            {
              data = inspectionDetails[i];
              thead += ` <table class="table table-striped table-bordered center table-input" style="width:100%;">
                              <thead style="background-color: #343a40;white-space: nowrap; color:white;text-align: left;">`;
              for(let j = 0; j< data.length;j++)
              {
                if(j == 0)
                {
                  
                  thead += `<tr><th colspan="5">${data[j].category}</th></tr>`;
                  thead += `<tr><th>Observation</th>`;
                  thead += `<th>Value</th>`;
                  thead += `<th>Department</th>`;
                  thead += `<th>Designation</th>`;
                  thead += `<th>Status</th></tr></thead><tbody>`;
                 
                }
                thead += `<tr><td>${data[j].obs}</td>`;
                thead += `<td>`;
                  if(data[j].ctype == 8)
                  {
                    try
                    {
                        let rval = parseInt(data[j].val);
                        let rem = 10 - rval;
                        for(let k = 0; k < rval ; k++)
                        {
                          thead += `<label style="position: relative;
                                      width: 1em;
                                      font-size: 2vw;
                                      color: black;
                                      cursor: pointer;">★</label>`;
                        }
                        for(let k = 0; k < rem ; k++)
                        {
                          thead += `<label style="position: relative;
                                      width: 1em;
                                      font-size: 2vw;
                                      color: black;
                                      cursor: pointer;">☆</label>`;
                        }
                    }
                    catch(err)
                    {
                      thead += `${data[j].val}`;
                    }


                  }
                  else
                  {
                    thead += `${data[j].val}`;
                  }
                  
                  
                  thead += `  </td>`;
                thead += `<td>${data[j].dept}</td>`;
                thead += `<td>${data[j].desig}</td>`;
                thead += `<td>`;
                  if(data[j].status == 1)
                  {
                    thead += '<span style="color:red">Pending</span>';
                  }
                  else{
                    thead += '<span style="color:green">Closed</span>';
                  }
                  
                  thead += `</td></tr>`;
              }
              thead += '</tbody></table><br>';
              
              

            }
            
            $('#pendingDetailsTable2').empty();
            $('#pendingDetailsTable2').append(thead);
            if (inspectionData.length) { 
                let date = String(inspectionData[0].inspected_on).split('T')[0];
                date = date.split('-');
                date = date[2]+'-'+date[1]+'-'+date[0];
                row += `<tr><td>${date}</td>`;
                row += `<td>${inspectionData[0].entitydetails}</td>`;
                row += `<td>${inspectionData[0].inspection_note_no}</td>`;
                row += `<td>${inspectionData[0].inspection_title}</td>`;
                row += `<td>${inspectionData[0].rly_id_id__location_code}</td>
                        <td>${inspectionData[0].div_id_id__location_code}</td>`;
                row += `<td>
                      <button type="button" name="${einspno}" onclick="pdfDet(this.name);" style="border: white;">
                        <i class="fa fa-file" style="font-size:24px;color:rgb(245, 57, 32)"></i>
                      </button>
                  </td>`;
               
                    row += `<td>
                                  <button type="button" onclick="shrinkPending();"
                                      style="border-style: none; margin-left: 30%;">
                                      <i class="fas fa-angle-double-up"
                                          style="font-size:24px;color:rgb(105, 174, 238)"
                                          title="Click To Expand/Shrink Details"></i>
                                  </button>
                      </td> </tr>`;
                $('#pendingDetailsTable1 tbody').empty();
                $('#pendingDetailsTable1 tbody').append(row);
                document.getElementById('pendingDetails').classList.toggle('details-show-hide');
                document.querySelector('#pendingData').classList.toggle('details-show-hide');  
            }

           

        },
        error: function (data) {
            alert('Some error occured')
        }
    })

  }
 
  function shrinkPending() {
    document.getElementById('pendingDetails').classList.toggle('details-show-hide');
    document.querySelector('#pendingData').classList.toggle('details-show-hide');
  }

  function expandClosed(einspno) {
   
    
   let data = {
       data_type: 'ClosedDetails',
       einspno: einspno,
       csrfmiddlewaretoken: '{{ csrf_token }}'
   };
   $.ajax({
       url: "{% url 'showMenuFinal' %}",
       method: "POST",
       dataType: "JSON",
       data: data,
       success: function (response) {
           var row = '',thead = '',tbody = '';
           let inspectionData = response.inspectionData;
           let inspectionDetails = response.inspectionDetails;
           for(let i = 0; i < inspectionDetails.length; i++)
           {
             data = inspectionDetails[i];
             thead += ` <table class="table table-striped table-bordered center table-input" style="width:100%;">
                             <thead style="background-color: #343a40;white-space: nowrap; color:white;text-align: left;">`;
             for(let j = 0; j< data.length;j++)
             {
               if(j == 0)
               {
                 
                 thead += `<tr><th colspan="5">${data[j].category}</th></tr>`;
                 thead += `<tr><th>Observation</th>`;
                 thead += `<th>Value</th>`;
                 thead += `<th>Department</th>`;
                 thead += `<th>Designation</th>`;
                 thead += `<th>Status</th></tr></thead><tbody>`;
                
               }
               thead += `<tr><td>${data[j].obs}</td>`;
               thead += `<td>`;
                 if(data[j].ctype == 8)
                 {
                   try
                   {
                       let rval = parseInt(data[j].val);
                       let rem = 10 - rval;
                       for(let k = 0; k < rval ; k++)
                       {
                         thead += `<label style="position: relative;
                                     width: 1em;
                                     font-size: 2vw;
                                     color: black;
                                     cursor: pointer;">★</label>`;
                       }
                       for(let k = 0; k < rem ; k++)
                       {
                         thead += `<label style="position: relative;
                                     width: 1em;
                                     font-size: 2vw;
                                     color: black;
                                     cursor: pointer;">☆</label>`;
                       }
                   }
                   catch(err)
                   {
                     thead += `${data[j].val}`;
                   }


                 }
                 else
                 {
                   thead += `${data[j].val}`;
                 }
                 
                 
                 thead += `  </td>`;
               thead += `<td>${data[j].dept}</td>`;
               thead += `<td>${data[j].desig}</td>`;
               thead += `<td>`;
                  if(data[j].status == 1)
                  {
                    thead += '<span style="color:red">Pending</span>';
                  }
                  else{
                    thead += '<span style="color:green">Closed</span>';
                  }
                  
                  thead += `</td></tr>`;
             }
             thead += '</tbody></table><br>';
             
             

           }
           
           $('#closedDetailsTable2').empty();
           $('#closedDetailsTable2').append(thead);
           if (inspectionData.length) { 
               let date = String(inspectionData[0].inspected_on).split('T')[0];
               date = date.split('-');
               date = date[2]+'-'+date[1]+'-'+date[0];
               row += `<tr><td>${date}</td>`;
               row += `<td>${inspectionData[0].entitydetails}</td>`;
               row += `<td>${inspectionData[0].inspection_note_no}</td>`;
               row += `<td>${inspectionData[0].inspection_title}</td>`;
               row += `<td>${inspectionData[0].rly_id_id__location_code}</td>
                       <td>${inspectionData[0].div_id_id__location_code}</td>`;
               row += `<td>
                     <button type="button" name="${einspno}" onclick="pdfDet(this.name);" style="border: white;">
                       <i class="fa fa-file" style="font-size:24px;color:rgb(245, 57, 32)"></i>
                     </button>
                 </td>`;
              
                   row += `<td>
                                 <button type="button" onclick="shrinkClosed();"
                                     style="border-style: none; margin-left: 30%;">
                                     <i class="fas fa-angle-double-up"
                                         style="font-size:24px;color:rgb(105, 174, 238)"
                                         title="Click To Expand/Shrink Details"></i>
                                 </button>
                     </td> </tr>`;
               $('#closedDetailsTable1 tbody').empty();
               $('#closedDetailsTable1 tbody').append(row);
               document.getElementById('closedDetails').classList.toggle('details-show-hide');
               document.querySelector('#closedData').classList.toggle('details-show-hide');  
           }

          

       },
       error: function (data) {
           alert('Some error occured')
       }
   })

 }

  function shrinkClosed() {
    document.getElementById('closedDetails').classList.toggle('details-show-hide');
    document.querySelector('#closedData').classList.toggle('details-show-hide');
  }

</script>



</html>

{% endblock content %}