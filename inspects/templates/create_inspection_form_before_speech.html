
{% extends 'base.html' %} 
{% block content %}

{% load static %}

<head>
  <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">
  		
<link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">	
<script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script type="text/javascript">
  $(".sidebar").addClass('close');
</script>
<style>
     .modal-dialog-marks
    {
        width: 50% !important;
        height: 70% !important;
        margin: 10% !important;
        margin-left: 30% !important;
        padding: 3% !important;
        max-width:none !important;
        text-align: center !important;
        /* top: 25%;
        right: 15%;
        bottom: 25%;
        left: 45%; */
        background-color:white ;
    }
    .modal-content-marks
    {
        height: auto !important;
        min-height: 100% !important;
        border-radius: 0 !important; 
        width: 100% !important;
        /* text-align: center !important;   */
    }
    .modal-header-marks
    {
        border-bottom: 0px solid #9ea2a2 !important;
    }
    .modal-footer-marks
    {
        border-top: 0px solid #9ea2a2 !important;
    }
</style>
<style>
  .wrap.active {
  display: block;
  visibility: visible;
  box-shadow: 2px 3px 16px silver;
  transition: all 600ms;
  transform: translateY(0px);
  transition: all 0.5s;
}
.wrap {
  position: fixed;
  overflow: hidden;
  top: 10%;
  right: 10%;
  bottom: 85px;
  left: 10%;
  padding: 12px;
  display: block !important;
  border-radius: 4px;
  transform: translateY(20px);
  transition: all 0.5s;
  visibility: hidden;
  z-index: 9999;
  height: 85vh;
}

.wrap-1.active {
  display: block;
  visibility: visible;
  box-shadow: 2px 3px 16px silver;
  transition: all 600ms;
  transform: translateY(0px);
  transition: all 0.5s;
}
.wrap-1 {
  position: fixed;
  overflow: hidden;
  top: 10%;
  right: 10%;
  bottom: 85px;
  left: 10%;
  padding: 12px;
  display: block !important;
  border-radius: 4px;
  transform: translateY(20px);
  transition: all 0.5s;
  visibility: hidden;
  z-index: 9999;
  height: 85vh;
}
.wrap.active .content,.wrap-1.active .content  {
  position: relative;
  z-index: 1;
  opacity: 1;
  transition: all 600ms cubic-bezier(0.55, 0.055, 0.675, 0.19);
}
.wrap .content, .wrap-1 .content {
  opacity: 0;
}
.wrap.active:before, .wrap-1.active:before {
  height: 2000px;
  width: 2000px;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  margin-left: -1000px;
  margin-top: -1000px;
  display: block;
  -webkit-transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
  transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
}
.wrap:before, .wrap-1:before {
  position: fixed;
  width: 1px;
  height: 1px;
  background: white;
  content: "";
  bottom: 10px;
  left: 50%;
  top: 95%;
  color: #fff;
  border-radius: 50%;
  -webkit-transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
  transition: all 600ms cubic-bezier(0.215, 0.61, 0.355, 1);
}
.wrap::-webkit-scrollbar, .wrap-1::-webkit-scrollbar {
  width: 10px;  /* Remove scrollbar space */
  background: #dedede;
}
/* Optional: show position indicator in red */
.wrap::-webkit-scrollbar-thumb,.wrap-1::-webkit-scrollbar-thumb {
  background: #FF0000;
}
</style>
<style>
  .button{
  width:98px;
  height:75px;
  margin-top:2px;
  cursor: pointer;
}

.button{
  width:98px;
  height:75px;
  margin-top:2px;
  cursor: pointer;
}

.button:hover {
  box-shadow: inset 0 0 .125em rgba(#fff, .75);
  background:
  linear-gradient(#f8e7e8, #e30001, #bc0000) content-box,
  linear-gradient(-80deg, #f11f20, #9c1c1c, #f11f20) 0/ 37% 100% border-box;

}

.button1:hover {
  box-shadow: inset 0 0 .125em rgba(#fff, .75);
  background:
  linear-gradient(#81fc6e, #1cb804 50%) content-box,
  linear-gradient(#1cb804,#1cb804) border-box;
  
}
.button2:hover {
  box-shadow: inset 0 0 .125em rgba(#fff, .75);
  background:
  linear-gradient(#F0FF42, #82CD47, #54B435) content-box,
  linear-gradient(#82CD47,#82CD47) border-box;
  
}
.button3:hover {
  box-shadow: inset 0 0 .125em rgba(#fff, .75);
  background:
  linear-gradient(Yellow, #FFA500 33%) content-box,
  linear-gradient(orange, #FFA500) border-box;
  
}
.button4:hover {
  box-shadow: inset 0 0 .125em rgba(#fff, .75);
  background:
  linear-gradient(#3ba1e9, #3996db 50%) content-box,
  linear-gradient(#317bb5, #2499e6) border-box;
  
}
.button5:hover {
  box-shadow: inset 0 0 .125em rgba(#fff, .75);
  background:
  linear-gradient(to right top, #fff 50%, rgba(#fff, 0) 61%) 0 100%/ 50% $arr-h no-repeat,
  linear-gradient(to left top, #fff 50%, rgba(#fff, 0) 61%) 100% 100%/ 50% $arr-h no-repeat,
  linear-gradient(#e9e9e9 $box-r, #f0f0f0 43%, #9d9d9f);
  
}


.button:active {
  transform: translateY(0.5em);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
}
</style>
<style>
  .extra-css{
    background-color: white;
    border: 0px;
  }
 .bootstrap-select.btn-group .dropdown-menu.inner,	
.dropdown-menu.open {	
  min-height: 70vh !important;} 

  .btn-save {	
  align-items: center;	
  background-clip: padding-box;	
  background-color: #fa6400;	
  border: 1px solid transparent;	
  border-radius: .25rem;	
  box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;	
  box-sizing: border-box;	
  color: #fff;	
  cursor: pointer;	
  display: inline-flex;	
  font-family: system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;	
  font-size: 16px;	
  font-weight: 600;	
  justify-content: center;	
  line-height: 1.25;	
  margin: 0;	
  min-height: 3rem;	
  padding: calc(.875rem - 1px) calc(1.5rem - 1px);	
  position: relative;	
  text-decoration: none;	
  transition: all 250ms;	
  user-select: none;	
  -webkit-user-select: none;	
  touch-action: manipulation;	
  vertical-align: baseline;	
  width: auto;	
}	
.btn-save:hover,	
.btn-save:focus {	
  background-color: #fb8332;	
  box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;	
}	
.btn-save:hover {	
  transform: translateY(-1px);	
}	
.btn-save:active {	
  background-color: #c85000;	
  box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;	
  transform: translateY(0);	
}	
.btn-draft {	
  align-items: center;	
  background-clip: padding-box;	
  background-color: #666699;	
  border: 1px solid transparent;	
  border-radius: .25rem;	
  box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;	
  box-sizing: border-box;	
  color: #fff;	
  cursor: pointer;	
  display: inline-flex;	
  font-family: system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;	
  font-size: 16px;	
  font-weight: 600;	
  justify-content: center;	
  line-height: 1.25;	
  margin: 0;	
  min-height: 3rem;	
  padding: calc(.875rem - 1px) calc(1.5rem - 1px);	
  position: relative;	
  text-decoration: none;	
  transition: all 250ms;	
  user-select: none;	
  -webkit-user-select: none;	
  touch-action: manipulation;	
  vertical-align: baseline;	
  width: auto;	
}	
.btn-draft:hover,	
.btn-draft:focus {	
  background-color: #666699;	
  box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;	
}	
.btn-draft:hover {	
  transform: translateY(-1px);	
}	
.btn-draft:active {	
  background-color: #666699;	
  box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;	
  transform: translateY(0);	
}	
.modal-title	
{	
  font-size:1rem;	
  font-weight:600;	
}	
.copy-link	
{	
  cursor:pointer;	
  text-decoration: none;	
  font-weight:600;	
  color:#0059b3;	
  font-size:13px;	
}	
.table-inpt-fields td {padding:0px;border:0px;padding-left:10px;}


  * {
  box-sizing: border-box;
}
/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}
* {
  box-sizing: border-box;
}

/* Style the search field */
form.example input[type=text] {
  padding: 8px;
  font-size: 17px;
  border: 1px solid grey;
  float: left;
  width: 60%;
  background: #f1f1f1;
}

/* Style the submit button */
form.example button {
  float: left;
  width: 15%;
  padding: 8px;
  background: #2196F3;
  color: white;
  font-size: 17px;
  border: 1px solid grey;
  border-left: none; /* Prevent double borders */
  cursor: pointer;
}

form.example button:hover {
  background: #0b7dda;
}

/* Clear floats */
form.example::after {
  content: "";
  clear: both;
  display: table;
}        
</style>

<style>
 
 
#s2id_desig .select2-default {
  color: rgb(89, 255, 0) !important;
}

.autocomplete {
  /*the container must be positioned relative:*/
  position: relative;
  display: inline-block;
}

.autocomplete-items {
  position: absolute;
  border: 1px solid #d4d4d4;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  /*position the autocomplete items to be the same width as the container:*/
  top: 100%;
  left: 0;
  right: 0;
}
.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
  background-color: #fff;
  border-bottom: 1px solid #d4d4d4;
}
.autocomplete-items div:hover {
  /*when hovering an item:*/
  background-color: #e9e9e9;
}
.autocomplete-active {
  /*when navigating through the items using the arrow keys:*/
  background-color: DodgerBlue !important;
  color: #ffffff;
}

.select2-selection__choice__remove{
  border: none;
}

.multi_select_box{
  width: 150px;
  margin: 1px auto;
}
.multi_select_box select{
  width: 100%;
}
.multi_select_box button{
  background-color: #4B7BF5 !important;
  color: #fff !important;
}

.home-section .home-content .text{
    font-size: 15px;
    font-weight: 400;
  }

 
  .bootstrap-select.form-control-sm .dropdown-toggle {
    height: 2.8em;
  }

  /* .select2-search--inline {
    display: contents; 
    this will make the container disappear, making the child the one who sets the width of the element
} */

.select2-search__field:placeholder-shown {
    width: 100% !important; /*makes the placeholder to be 100% of the width while there are no options selected*/
}

  .mycls{
    display: inline-flex;
  }
    

 .strikeout  {
  position: relative;
  -webkit-text-decoration-line: line-through; /* Safari */
  text-decoration-line: line-through;
  text-decoration-thickness: 0.2rem;
  text-decoration-color: red;
}

.strikeoutbg  {
  background-color: lightyellow;
  -webkit-text-decoration-line: line-through; /* Safari */
  text-decoration-line: line-through;
  text-decoration-thickness: 0.2rem;
  text-decoration-color: red;
}


/* Popup container - can be anything you want */
.popup {
  position: relative;
  display: inline-block;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* The actual popup */
.popup .popuptext {
  visibility: hidden;
  width: 200px;
  background-color:white;
  color: #fff;
  text-align: left;
  border-radius: 6px;
  padding: 8px 0;
  position: absolute;
  z-index: 1;
  bottom: 0%;
  left: -110%;
  margin-left: -150px;
}

.popuptext input {
  border: 0px;
  font-size: 14px;
}

/* Popup arrow */
/* .popup .popuptext::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: #555 transparent transparent transparent;
} */

/* Toggle this class - hide and show the popup */
.popup .show {
  visibility: visible;
  -webkit-animation: fadeIn 1s;
  animation: fadeIn 1s;
}



.sethover:hover {
  background-color: lightblue;
  cursor: -webkit-grab; 
  cursor: grab;
  font-size: 140%;
}

#addworkmech tr{
  height:50px;
}
</style>

<!-- auto update  toggle button -->
<style>
 .switch {
  position: relative;
  display: inline-block;
  width: 90px;
  height: 34px;
}

.switch input {display:none;}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ca2222;
  -webkit-transition: .4s;
  transition: .4s;
   border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: #2ab934;
}

input:focus + .slider {
  box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(55px);
}

/*------ ADDED CSS ---------*/
.slider:after
{
 content:'OFF';
 color: white;
 display: block;
 position: absolute;
 transform: translate(-50%,-50%);
 top: 50%;
 left: 50%;
 font-size: 10px;
 font-family: Verdana, sans-serif;
}

input:checked + .slider:after
{  
  content:'ON';
}


#message_container {

/* to position it at bottom-left (dependent on the parent) */
position: fixed;
bottom: 3%;
left:45%;

/* to position the contents within the box (ie the message text) */
display: flex;
justify-content: center;
align-items: center;

/* to style the message box in particular ways */
background-color: #000;
color: white;
/* padding: 2em; */
border-radius: 20px;
box-shadow: 4px 4px 20px rgba(0,0,0,0.3);
width: 100%;
max-width: 250px;
height: 25px;
}

/*--------- END --------*/
</style>

<!-- for fi page  -->
<style>
.heading1{
   
   text-shadow: #6e6b6b;
   text-decoration-line: underline;
   text-align: center;
   border: 1 rem;
   margin: 20px ;
   padding: 10 px;
   color: #f4f4f4;
   font-weight: bold;
 }
 .containerField{
   align-items: center;
   margin-left: 10px;
 }
 .content{
   max-width: 800px;
   margin: 0 auto;
 }

  

 .department-wise-row {
   border-radius: 5px;
  
   margin-bottom: 20px;
   padding: 30px;
   width: 49%;
   max-width: 49%;
  
 }

 .category-wise-row {
   border-radius: 5px;
   margin-bottom: 20px;
   margin-right: 10px;
  

   margin-bottom: 20px;
   margin-right: 10px;
   padding: 30px;
   width: 49%;
   max-width: 49% ;
 }

 .pc1{
   background: linear-gradient(to right, #FF90BB, rgba(125, 55, 163, 0.703));
 }

 .pc2{
   background: linear-gradient(to right, rgba(141, 125, 229, 0.868), rgba(93, 58, 188, 0.795));
 }
.card-title {
   font-weight: bold;
   margin-bottom: 10px;
 }
 .title
 {
     text-align: center;
     font-weight:700;
     color:#000;
     font-size:1rem;
     padding:1rem;
     text-align: center;
 }

 .parent-card {
  
     color: #fff;
     margin: 2px;
     padding: 8px;
     margin-top: 3px;
     border-radius: 5px;
     box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
     width: 105%;
    
     max-height: 400px;
     max-width: 400px;
     border: 1px solid black;
     overflow: hidden;
     text-overflow: ellipsis;
     white-space: nowrap;
     margin-bottom: 15px;
     position: relative;
   }
  

.child-card {
background-color: rgba(255, 255, 255, 0.9);
margin: 5px;
padding: 10px;
border-radius: 5px;
box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
display: none;
color: #707887;
overflow: visible;
}

.parent-card:hover,
.parent-card.open {
           background: linear-gradient(to right, #5769b7, #8b58bf);
           cursor: pointer;
          
       }
       .parent-card.open .child-card {
display: block;
}
.marginleft{
 margin-left: 20px;
}
.card-container {
 display: flex;
 flex-wrap: wrap;
 justify-content: space-between;
 margin-top: 20px;
 margin-bottom: 20px;
}


  .wrapRow{
    
     margin-right: 20px;
     margin-left: 20px;
       display: flex;
       justify-content: center;
       background: linear-gradient(109.6deg, rgb(204, 228, 247) 11.2%, rgb(237, 246, 250) 100.2%);
       border-style: groove;
       border: 2px solid #817373;
     }


</style>
<style>
  .sectionsRow thead tr th {
    width: 10%;
  }

  .select2-results__option[aria-selected=true] { 
  background-color: #dff0c3 !important;
  color:#000 !important;
 }
 
  .select2-selection--multiple:before {
    content: "";
    position: absolute;
    right: 7px;
    top: 42%;
    border-top: 5px solid #888;
    border-left: 4px solid transparent;
    border-right: 4px solid transparent;
}


</style>
<style>
.plswait_overlay{
		width: 100%;
		height: 100%;
		background: rgba(0,0,0,.35);
		color:white;
		line-height: 700px;
		position: absolute;
		top:0px;
    right:0px;
    bottom:0px;
    left:0px;
		text-align: center;
		font-size: 25px;
		font-weight: bold;
		z-index: 1000000;
    opacity: 0;
	}
	

  .modal-open {
    overflow: initial;
}

</style>
<script>
  function plsWaitDiv(selector, visibility) {
    let divheight;
        if ('show' == visibility) {
            $(selector).css('position', 'relative');
            $(selector).append('<div id="foobar" class="plswait_overlay "></div>');
            try{
              divheight = $("#mainShowDiv").height() + 50;
            }
            catch{
              divheight = 1200;
            }
            document.getElementById("foobar").style.height = divheight + "px";
        } else {
            $(selector).css('position', 'static');
            $('.plswait_overlay').remove();
        }
    }
// to show  plsWaitDiv('body', 'show');
// to hide  plsWaitDiv('body', 'hidden');
	


</script>
</head>


    <body>

      <div id="mainShowDiv">
      
        <ul class="nav nav-tabs marginleft" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" data-toggle="tab" href="#Finalized">General Inspection</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="tab" href="#Pending">Field Inspection</a>
        </li>
       
      </ul>

      <div class="tab-content">
        <div id="Finalized" class="container-fluid  tab-pane active"><br>
          <div id="message_container">
            <div id="message_content">Data Auto Saved </div>
          </div>
    <input type="hidden" id="inspection_id_edit" value="{{ins_id}}">
    <input type="hidden" id="ins_flag_edit" value="{{ins_flag}}">
      <div class="container">
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == 'success' %}
                  <div class="alert alert-success">
                    <strong>Success </strong>{{ message }}
                  </div>
                {% elif message.tags == 'error' %}
                  <div class="alert alert-danger">
                    <strong>Error </strong>{{ message }}
                  </div>
                {% elif message.tags == 'info' %}
                  <div class="alert alert-info">
                    <strong>Info </strong>{{ message }}
                  </div>
                {% else %}
                
                {% endif %}
               
            
            {% endfor %}
        {% endif %}
      </div>
    
      <h3 class="report_heading">Create My Inspection Notes</h3>
      {% if ins_flag != 1 %}
      <div style="margin-right: 10%;">
       <label style="padding-left: 82%">Click To Enable Auto Save</label>
      <label class="switch" style="float: right;" title="Switch On For Auto Update">
        <input type="checkbox" onclick="getOnOffStatus()" id='onOffIdForAutoUpdate' >
        <span class="slider round"></span>
      </label>
    </div>
    {% endif %}
      <br>
      <br>

      
     
    <div class="container">
      <div class="inpt-container" style="padding:10px;">
      
        <div class="row" >
         
            <div class="col-3">
                <label for="Zone" class="lbl-caption">Rly./Org.</label><span style="color:red;font-weight:bold">*</span>
                <select class="form-control" id="zone" name="zone"  style="max-width:100%;" data-placeholder="Select zone.."  multiple required onchange="get_accompany()">
                    <option value=""  disabled hidden>select</option>
                    {% if option_val == 'edit' %}
                        {% for zn in Zone %}
                        {% if zn in multi_loc_zone %}
                          <option value="{{zn}}" selected>{{zn}}</option>
                        {% else %}
                          <option value="{{zn}}" >{{zn}}</option>
                        {% endif %}
                        {% endfor %}
                    {% else %}
                          {% for z in Zone %}
                          {% if z == Zone1 %}
                                <option value="{{z}}" selected>{{z}}</option>
                          {%else%}
                                <option value="{{z}}">{{z}}</option>
                          {% endif %}
                          {% endfor %}
                    {% endif %}
                </select>
            </div>
          <div class="col-2">
              <label for="division" class="lbl-caption">Div./Unit</label>
              <select class="form-control" id="division" data-placeholder="Select division.." name="division" style="max-width:100%;" multiple>
                      <option value=""  disabled hidden>select</option>
                      {% if option_val == 'edit' %}

                            {% for div in division %}
                            {% if div.location_code in multi_loc_div %}
                                <option value="{{div.location_code}}" selected>{{div.location_code}}</option>
                              
                              {% else %}
                              <option value="{{div.location_code}}">{{div.location_code}}</option>
                              {% endif %}
                            {% endfor %}
                      {% else %}
                          {% for d in division %}
                          {% if d.location_code == setdiv %}
                              <option value="{{d.location_code}}" selected>{{d.location_code}}</option>
                            {%else%}
                          <option value="{{d.location_code}}">{{d.location_code}}</option>
                          {% endif %}
                          {% endfor %}
                      {% endif %}
          
              </select>
          </div>
          <div class="col" hidden>
          
  
                <label for="division" class="lbl-caption">Location type</label>
                <select class="form-control" id="locationType" data-placeholder="Select location type.."  name="department" style="max-width:100%;" onchange="fun_en_dl(this.value)" multiple>
                    <option value=""   disabled hidden>select</option>
                      {% if option_val == 'edit' %}
                        {% for i in location_array %}
                        {% if i.type_code in multi_loc_from %}
                          <option value="{{i.type_code}}" selected>{{i.type}}</option>
                        {% else %}
                          <option value="{{i.type_code}}" >{{i.type}}</option>
                        {% endif %}
                      {% endfor %}
                    {% else %}
                        {% for i in location_array %}
                        <option value="{{i.type_code}}">{{i.type}}</option>
                        {% endfor %}
                    {% endif %}
                        
                    </select>
          </div>
        
          <div  class="col" hidden >
            <label for="location" class="lbl-caption">Location Name</label><br>
            <div>
              <select name="location" id="location" data-placeholder="Select location.." class="form-control" {% if option_val != 'edit' %} disabled {% endif %} multiple>
                <option value=""   disabled hidden>select</option>
                {% if option_val == 'edit' %}
                  {% for g in multi_loc %}
                  {% if g.type == 'LOC' %}
                      <option value="{{g.item}}#{{g.table_from}}#{{g.item_code}}" selected>{{g.item}}</option>
                  {% endif %}
                  {% endfor %}
                {% endif %}
              </select>
            </div>
            <button type="button" id="orlType" class="btn btn-outline-secondary btn-sm" style="margin-top: 5px;" data-toggle="modal" data-target="#ORLModal" >Select Locations</button>

            <!-- <button type="button" id="section" class="btn btn-outline-secondary btn-sm" style="margin-top: 5px;" onclick="showSection()" data-toggle="modal" data-target="#SectionModal" >Select Longer Section</button> -->
          </div>
          
            
          <div class="col-2" >
              <label for="txtDate2" class="lbl-caption">Insp. Date<span style="color:red;font-weight:bold">*</span></label><br>
              {% if option_val == 'edit' %}
                    {% for date in ins_detail %}
                      {% if date.start_date|date:'d/m/Y' == date.inspected_on|date:'d/m/Y' %}
                      <input type="text" autocomplete="off" placeholder="Select daterange.."  name="daterange1"   class="form-control" style="margin-top:0em ;height: 36px; background-color: #fff; max-width: 100%;" id="txtDate2"  value="{{date.start_date|date:'d/m/y'}}" readonly>
                      {% else %}
                      <input type="text" autocomplete="off" placeholder="Select daterange.."  name="daterange1"   class="form-control" style="margin-top:0em ;height: 36px; background-color: #fff; max-width: 100%;" id="txtDate2"  value="{{date.start_date|date:'d/m/y'}} to {{date.inspected_on|date:'d/m/y'}}" readonly>
                      {% endif %}
                    {% endfor %}
              {% else %}
                <input type="text" autocomplete="off" placeholder="Select daterange.."  name="daterange1" required class="form-control" style="margin-top:0em; height: 36px; background-color: #fff;border:1px solid rgb(138, 136, 136);box-shadow: none; max-width: 100%;" id="txtDate2"   readonly requied>
              {% endif %}
          </div>
          <div class="col-2" style="padding-top: 10px;" >
            <label  class="lbl-caption" hidden>Choose Location</label><br>
            
            <input type="checkbox" {% if gooWorkFlag %} checked {% endif %} id="goodWork">&nbsp;&nbsp;<label>Good Work</label>
            
          </div>
          <div  class="col-3">
            <label  class="lbl-caption" hidden>Choose Location</label><br>
            <button class="btn btn-success btn-sm mt-1"  data-toggle="modal" data-target="#chooseLocation" onclick="setChooseLocationData()"  id="genSections" >Choose Location</button>
            <button class="btn btn-warning btn-sm mt-1" onclick="setTitle()">&nbsp;&nbsp; Generate Title &nbsp;&nbsp;</button>
  
        </div>

           <div class="col-2" hidden>
            <label  class="lbl-caption" hidden>Generate title</label><br>
            <div class="row">
              <button class="btn btn-warning btn-sm mt-1" onclick="setTitle()">&nbsp;&nbsp; Generate Title &nbsp;&nbsp;</button>
            </div>
            <div class="row" hidden>
              <button class="btn btn-success btn-sm mt-1" onclick="setSections()" id="genSections">Generate Sections</button>
            </div>
        </div>
      
        </div> 
      </div>
    </div>
   
   
    <div class="container">
     
      {% if option_val == 'edit' %}
      {% for i in ins_detail %}
      <div class="row">
        <div class="col-lg-6 col-sm-12">
          
        <label for="start" class="lbl-caption">Title<span style="color:red;font-weight:bold">*</span></label>
        <textarea class="form-control" maxlength="1000"   id="titleinsp"  name="titleinsp" style="color:red !important;">{{i.inspection_title}}</textarea>
        <input type="text" value="{{i.inspection_no}}" id="inspection_no" hidden>
        </div>
        <div class="col-lg-3 col-sm-12">
          <label for="start" >Accompanied By</label>
          <select id="accompany"  class="form-control" data-placeholder="Search Designation.."  multiple>
            {% if acc_type == 'int' %}
              {% for i in desg_no11 %}
              {% if i.designation_code in Accompany %}
                  <option  value="{{i.designation}}" data-tokens="{{i.empnoser}}" selected>{{i.designation}}</option>
              {% else %}
              <option  value="{{i.designation}}" data-tokens="{{i.empnoser}}" >{{i.designation}}</option>
              {% endif %}
              {% endfor %}
            {% else %}
              {% for acc in Accompany %}
              <option value="{{acc}}" data-tokens="{{acc}}" selected>{{acc}}</option>
              {% endfor %}
              {% for i in desg_no11 %}
              {% if i.designation not in Accompany %}
                  <option  value="{{i.designation}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
              {% endif %}
              {% endfor %}
            {% endif %}
          </select>
        </div>
        <div class="col-lg-3 col-sm-12">
          
          <label for="start" class="lbl-caption"> Inspection Type<span style="color:red;font-weight:bold">*</span></label>
          <select name="insp_type" id="insp_type" data-placeholder="Select Inspection Type.." class="form-control">
            <option value=""   disabled hidden>select</option>
            {% for it in insp_type %}
              {% if i.insp_type == it.code %}
              <option  value="{{it.code}}" selected>{{it.types}}</option>
              {% else %}
              <option  value="{{it.code}}">{{it.types}}</option>
              {% endif %}
            {% endfor %}
          </select>
        </div> 
      </div> 
      {% endfor %}
   {% else %}
        <div class="row">	
        <div class="col-lg-6 col-sm-12">
          
          <label for="start" class="lbl-caption"> Inspection Title<span style="color:red;font-weight:bold">*</span></label>
          <textarea class="form-control " maxlength="1000" placeholder="Maximum character limit 1000"  id="titleinsp"  name="titleinsp" style="color:red !important;"></textarea>
        </div>
        
        <div class="col-lg-3 col-sm-12">    	
        <label for="start"  class="lbl-caption">Accompanied By</label>	
        <select id="accompany"  class="form-control" data-placeholder="Search Designation.."  multiple>
          {% for i in desg_no %}
              <option  value="{{i.designation}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
          {% endfor %}
        </select>
        <p style="font-size: 15px;">Note: To add other accompanying officials, type the Designation in the search box and enter to select.</p>
      
        </div>
        <div class="col-lg-3 col-sm-12">
          
          <label for="start" class="lbl-caption"> Inspection Type<span style="color:red;font-weight:bold">*</span></label>
          <select name="insp_type" id="insp_type" data-placeholder="Select Inspection Type.." class="form-control">
            <option value=""   disabled hidden>select</option>
            {% for i in insp_type %}
              <option  value="{{i.code}}">{{i.types}}</option>
            {% endfor %}
          </select>
        </div> 
      </div>
      {% endif %} 
      <div class="row" >
        <table id="sectionsRow" class="sectionsRow" style="width: 100%;margin-left: 20px;margin-top: 10px;">
          <thead>
            <!-- {% if option_val == 'edit' %}
            {% for x in all_sections %}
              <th><input class="sectionChecksClass" type="checkbox" id="x.sec_id" style="zoom:1.5;" onclick="addsections(this);"><label class="lbl-caption" style="font-size:18px;">{{x.sec_val}}</th>
            {% endfor %}
            {% endif %} -->
          </thead>
          
        </table>
      </div>
    
    <br>
    
    <div class="container p-0">
    
      <form action="{% url 'create_inspection_form' %}" method="POST"> 
        {% csrf_token %}
        
              
              <table id="table1" class="table table-striped table-bordered center table-input" >
                  <thead>
                    <tr style="margin-left: 5em;">
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5%;" hidden>Type</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5%;" >Item No.</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5%;" hidden>Item No.</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 50%;"> Inspection Para</th>
                      <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 12%;">Location</th> -->
                       <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 13%;">Item Pertains To</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 15%;">Select Officer</th>
                      <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 13%;">Type</th> -->
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 3%;">Action</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5%;" hidden>ID</th>
                    </tr>
                
                  </thead>
                  <tbody  id="addworkmech">
                  {% for i in prev_details %}
                  <tr>
                    <td hidden>{{i.typ}}</td>
                    <td style="text-align: center; width:5px; font-family:verdana;" >{{i.des_id}}</td>
                    <td style="text-align: center; width:5px; font-family:verdana;" hidden>{{i.des_id}}</td>
                    <td>
                    <div class="autocomplete1">
                    {% if i.typ == 'S' %}
                    <div id="divitemtype{{i.des_id_id}}">
                      Observations at 
                      <select name="location_at" id="location_at{{i.des_id_id}}" data-placeholder="Select Category.." class="form-control">
                        <!-- {% for g in multi_loc %}
                          {% if g.type == 'LOC' %}
                            {% if g.table_from == i.location_table and g.item == i.item_title %}
                                <option value="{{g.item}}#{{g.table_from}}#{{g.item_code}}" selected>{{g.item}}</option>
                            {% else %}
                              <option value="{{g.item}}#{{g.table_from}}#{{g.item_code}}" >{{g.item}}</option>
                            {% endif %}
                          {% endif %}
                        {% endfor %} -->
                        <option value="opt{{i.sec_id}}" selected>{{i.sec_val}}</option>
                      </select>
                    </div>
                    {% elif i.typ == 'P' %}
                    <textarea maxlength="3000" placeholder="Maximum character limit 3000" id='heading{{i.des_id_id}}'   autocomplete1=off  style="height:30px;" class="form-control">{{i.item_title}}</textarea>
                    {% elif i.typ == 'SP' %}
                    <textarea maxlength="3000"  placeholder="Maximum character limit 3000" id='heading{{i.des_id_id}}'   autocomplete1=off  style="height:30px;" class="form-control">{{i.observation}}</textarea>

                    {% else %}
                    <textarea maxlength="3000"  placeholder="Maximum character limit 3000" id='heading{{i.des_id_id}}'   autocomplete1=off  style="height:30px;" class="form-control">{{i.item_subtitle}}</textarea>
                    {% endif %}
                  
                    </div>
                    
                    <button type="button" hidden class="btn btn-outline-success btn-sm" id="add{{i.des_id_id}}" value="{{i.des_id_id}}" onclick="get_table_data(this);" ><i class="fa fa-table" aria-hidden="true" title="Click to Add table"></i></button>
                    <button type="button" hidden class="btn btn-outline-danger btn-sm" id="del{{i.des_id_id}}" value="{{i.des_id_id}}" onclick="remove_table_data(this);"><i class="fa fa-minus" aria-hidden="true"  title="Click to modify/alter table"></i></button>
                  
                    <span id="span{{i.des_id_id}}">
                      {% if i.tbl_data != '[]' %}
                      <table id="tblspan{{i.des_id_id}}">
                      {% for jk in i.tbl_data %}
                      
                        <tr>
                        {% for ik in jk %}
                        <td><input type="text" value="{{ik}}"></td>
                        {% endfor %}
                      </tr>
                      
                      {% endfor %}
                    </table>
                      {% endif %}
                    </span>
                    </td>
                    <td>
                      {% if i.typ == 'P' or i.typ == 'SP' %}
                      <div id="divitemtype{{i.des_id_id}}">
                        <select name="item_type{{i.des_id_id}}" id="item_type{{i.des_id_id}}" data-placeholder="Select Category.." class="form-control item_type_select2">
                          {% for x in item_typess %}
                          {% if i.item_type == x.code %}
                          <option value={{x.code}} selected>{{x.types}}</option>
                          {% else %}
                          <option value={{x.code}}>{{x.types}}</option>
                          {% endif %}
                          {% endfor %}
                        </select>
                      </div>
                      {% endif %}
                    </td>
                    <td>
                      {% if i.typ == 'P' or i.typ == 'SP' %}
                    <div id="showhide{{i.des_id_id}}">
                      <div class="mycls">
                        <div class="multi_select_box" id="divdesgn{{i.des_id_id}}">	                 
                        
                          <select id="desgn{{i.des_id_id}}" class="desgn{{i.des_id_id}} demo w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true" multiple data-selected-text-format="count > 2" multiple>	
                            {% for j in desg_no %}
                              {% if j.designation_code1 in i.mrkoffi %}
                              <option  value="{{j.designation_code}}" data-tokens="{{j.empnoser}}" selected>{{j.designation}}</option>
                              {% else %}
                              <option  value="{{j.designation_code}}" data-tokens="{{j.empnoser}}">{{j.designation}}</option>
                              {% endif %}
                            {% endfor %}
                            {% for j in i.extra_off %}
                            <option  value="{{j.designation_code}}" data-tokens="{{j.empnoser}}" selected>{{j.designation}}</option>
                            {% endfor %}
                          </select>
                          <input type="button" id="desgnbtn{{i.des_id_id}}" value="Ok" onclick="getOption('desgn{{i.des_id_id}}')" hidden>	
                          <input type="text" id="desgninp{{i.des_id_id}}" hidden >	
                                                    
                        </div>
                        &nbsp;	
                        <div class="autocomplete1" id="divmarkeofficer{{i.des_id_id}}">	
                          <!-- &nbsp;	 -->
                          <button hidden class="btn btn-outline-primary" type="button" id="cpy{{i.des_id_id}}" value="Copy" onclick="copy_mark_officer(this)" ><i class='fas fa-copy' style='font-size:24px;'></i></button>  
                          <!-- &nbsp; -->
                        <a hidden style="display:inline-block;	
                            width:130px;	
                            height:35px;	
                            margin-top:3px;	
                            color: white;	
                            background-color: darkslategray;	
                            padding: 5px 11px;	
                            border-style: 2px solid" id="tooltip{{i.des_id_id}}" class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title="Add From Dropdown" >Add From D...</a>  	
                        
                        
                        <!-- <a id="tooltipi{{i.des_id_id}}" data-placement="top" data-toggle="tooltipi" title="Add From Dropdown"> <i class="fa fa-info-circle" style="font-size:32px;margin-top:5px;color:#749DD3;"></i></a> -->
                        <button type="button" class="btn btn-success btn-sm ml-0 mt-1" title="Click to add instructions" id="instdesgn{{i.des_id_id}}" onclick="open_wrap(this)" ><i class="fa fa-tasks" aria-hidden="true"></i></button>

                        <textarea hidden type="text" placeholder="Add officer" class="form-control" value="" custom-offic="" custom-info={{i.custom_info}} custom-key="" id='markeofficer{{i.des_id_id}}' class="autocomplete1" readonly></textarea></div>	
                      </div>    
                      <!-- <div class="autocomplete1"><textarea style="height: 2em;"  type="text" placeholder="Remarks for Marked Officers" maxlength="500" class="form-control" value="{{i.markofcRemarks}}" custom-offic="" custom-key="" id='remarksmarkeofficer{{i.des_id_id}}' class="autocomplete1">{{i.markofcRemarks}}</textarea></div>	 -->
                    </div>
                    {% endif %}
                                            </td>
                    <!-- <td>
                      {% if i.typ != 'SSP' %}
                    <div class="autocomplete1" id="divtargetdate{{i.des_id_id}}">
                      <input type="text"  class="form-control datepker" value='{{i.target_date}}' autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;background-color:white;" id='targetdate{{i.des_id_id}}' readonly>
                     </div>
                     {% endif %}
                    </td> -->
                    
                    <!-- <td style="text-align: center;">
                      {% if i.typ != 'SSP' %}
                      <div class="autocomplete1" id="divcheckbox{{i.des_id_id}}">
                        {% if i.priority == 1 %}
                        <input type="checkbox" value="1" checked autocomplete="off" id='check{{i.des_id_id}}' style="zoom:1.5;text-align: center;border-left-width: 0px;margin-left: 10px;margin-top: 5px;">&nbsp;  
                        {% else %}
                        <input type="checkbox" value="1"  autocomplete="off" id='check{{i.des_id_id}}' style="zoom:1.5;text-align: center;border-left-width: 0px;margin-left: 10px;margin-top: 5px;">&nbsp;  
                        {% endif %}
                      
                      </div>
                      {% endif %}
                    </td> -->
                    <!-- <td>
                      {% if i.typ != 'SSP' %}
                      <div id="divtypeboxtype{{i.des_id_id}}">
                      {% if i.action_type == 0 %}
                      
                      <div class="form-check">
                        <input class="form-check-input" value="info" type="radio" name="flexRadioDefault{{i.des_id_id}}" id="type{{i.des_id_id}}"  onclick="disable_boxes(this)">
                        <label class="form-check-label" for="info">
                          For Information
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" value="action" type="radio" name="flexRadioDefault{{i.des_id_id}}" id="type{{i.des_id_id}}" checked onclick="disable_boxes(this)">
                        <label class="form-check-label" for="action">
                          For Compliance
                        </label>
                      </div>
                     
                     
                      {% else %}
                      <div class="form-check">
                        <input class="form-check-input" value="info" type="radio" name="flexRadioDefault{{i.des_id_id}}" id="type{{i.des_id_id}}" checked onload="disable_boxes(this)" onclick="disable_boxes(this)">
                        <label class="form-check-label" for="info">
                          For Information
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" value="action" type="radio" name="flexRadioDefault{{i.des_id_id}}" id="type{{i.des_id_id}}" onclick="disable_boxes(this)">
                        <label class="form-check-label" for="action">
                          For Compliance
                        </label>
                      </div>
                      
                      
                     
                      {% endif %}
                      </div>
                      {% else %}
                      
                        <div class="form-check" hidden>
                          <input class="form-check-input" value="action" type="radio" name="flexRadioDefault{{i.des_id_id}}" id="type{{i.des_id_id}}" checked onclick="disable_boxes(this)">
                          <label class="form-check-label" for="action">
                            For Compliance
                          </label>
                        </div>
                        <div class="form-check" hidden>
                          <input class="form-check-input" value="info" type="radio" name="flexRadioDefault{{i.des_id_id}}" id="type{{i.des_id_id}}" onclick="disable_boxes(this)">
                          <label class="form-check-label" for="info">
                            For Information
                          </label>
                        </div>
                     
                      {% endif %}
                    </td> -->
                    <td>
                      {% if i.typ != 'S' %}
                        <div class="popup">
                          
                          <button type="button" class="btn btn-outline-info btn-sm chkbtnclass CLOSEALLOPTIONS" id="popupbutton{{i.des_id_id}}" onmouseleave="funccloseallspan()" onmouseenter="myFunction('myPopup{{i.des_id_id}}')" onclick="myFunction('myPopup{{i.des_id_id}}')">
                            
                            <!-- <i class="fa fa-bars fa-2x" aria-hidden="true"  ></i> -->
                            <i class="fas fa-tools fa-2x" title="Click to Add"></i>
                          
                          </button>
                                  
                          <span class="popuptext" id="myPopup{{i.des_id_id}}" onclick="myFunction(this.id)" onmouseleave="funccloseallspan1()" onmouseenter="funccloseallspanset()">
                                  </span>
                          </div>
                          
                          &nbsp;
                          <button hidden type="button" class="btn btn-outline-danger btn-sm" id="del1{{i.des_id_id}}" value="{{i.des_id_id}}" onclick="get_del_id(this)"><i class="fa fa-trash fa-2x" aria-hidden="true" title="Click to Delete or undo Delete"></i></button>&nbsp;
                    {% endif %}
                        </td>
                        <td hidden>{{i.des_id_id}}</td>
                    </tr>
                  {% endfor %}
                  </tbody>
                  
              </table>
           
               
            <div class="btn-group">
                  <button type="button" class="btn btn-primary btn-sm"  style="margin-left: 6em;"  id="addsection" onclick="changeColorBtn(this);addsec(this);" hidden>Add Section</button> &nbsp;
                  <button type="button" class="btn btn-primary btn-sm"  id="addheading" onclick="addpara('P','-2');changeColorBtn(this);">Add Para</button> &nbsp;
                  <button  type="button"  class="btn btn-primary btn-sm" id="addmech" onclick="addpara('SP','-2');changeColorBtn(this);">Add Sub Para</button>&nbsp;
                  <button  type="button"  class="btn btn-primary btn-md" id="addSubmech" onclick="addpara('SSP','-2');changeColorBtn(this);">Add Sub Subpara</button>&nbsp;
                  <button  type="button"  name="addimage"  id="addimage" onclick="add_row_image()" class="btn btn-primary btn-md">Add Image</button>&nbsp;
                  <button type="button"  class="btn btn-danger btn-md"  onclick="delete_para()" >Delete</button> 
                    
            </div>
            <div class="row">
              <div class="mt-2">	
                <span style="color:red;font-weight:bold;margin-left: 6em;">*</span> <label class="lbl-caption">Required Fields in Forms</label>	
              </div>
            </div>
            <!-- image upload -->
              <br>
              <br>
              <table id="table_img" class="table table-striped table-bordered center table-input">
                <thead>
                  <tr>
                    <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 10%;">Reference No.</th>
                    <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 50%;">Select Image</th>
                    <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 20%;">Preview</th>
                    <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 20%;">Delete</th>
                  </tr>
                </thead>
              </table>
          
        
      </form>
          
    </div>
          
          
           
              <div class="container">
                <hr>
                <div class="container mt-1">
                  <div class="row">
                    <div class="col">
                      <label for="sttninsp" class="lbl-caption">Station of Inspecting Officer<span style="color:red;font-weight:bold">*</span></label>
                      <input maxlength="50"  class="form-control"  id="sttninsp"  name="sttninsp" {% if station_name != None %} value="{{station_name}}" {% else %} value="" {% endif %}></input>
                    </div>
                    <div class="col">
                      <label for="sttninsp" class="lbl-caption">Designation of Inspecting Officer<span style="color:red;font-weight:bold">*</span></label>
                      <input maxlength="50"  class="form-control"   id="desiginsp"  name="desiginsp" value="{{insp_desig}}"></input>
                    </div>
                    <div class="col">
                      <label for="sttninsp" class="lbl-caption">Name of Inspecting Officer<span style="color:red;font-weight:bold">*</span></label>
                      <input maxlength="50"  class="form-control"   id="ofcnameinsp"  name="ofcnameinsp" value="{{insp_ofc_name}}"></input>
                    </div>
                  </div>
                </div>
      
                <br>
                <div class="row">
                  <div class="col-md-6">
                      
                        <div class="input-group">
                          <!-- <span class="input-group-btn"> -->
                             
                                <!-- <a href="#" id="copytobtn" value="Copy To" data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setCopyValue(); setvalueIN()">Copy To <i class="fas fa-paper-plane"></i></a> -->
                               <!-- <b>Copy To </b>
                              </span> -->
                          <!-- <textarea type="text" class="form-control ml-2" custom-offic="" id="copyto" placeholder="Add officer from the dropdown" autocomplete="off" readonly></textarea>-->
                          <table class="table-inpt-fields">	
                            <tr>	
                              <td>          	
                                <!-- <a href="#" id="copytobtn" value="Copy To" data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setCopyValue(); setvalueIN()" class="copy-link">Copy To <i class="fas fa-paper-plane"></i></a></td>	 -->
                              Copy To
                              <td style="padding-left:1rem;"> 

                          <div class="multi_select_box" id="copy_divdesgn">
               
                            <select id="copy_desgn"  class="demo-copy w-80 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true" multiple data-selected-text-format="count > 2" multiple>
                              {% for i in copy_no %}
                              <option  value="{{i.designation_code}}" data-tokens="{{i.empnoser}}">{{i.designation}}</option>
                              {% endfor %}
                            </select>
                            <input type="button" id="copy_desgnbtn" value="Ok" onclick="copyToOption()" hidden>
                            <input type="text" id="copy_desgninp" hidden >
                          </div>
                        </td><td>	
                          <input type="text" class="form-control" custom-offic=""  id="copyto" placeholder="Add officer(s) from the dropdown" autocomplete="off" style="width: 20em;" readonly>	
                          </td></tr></table>
                        </div>
                      
                  </div>
                  <div class="col-md-6">
                    <div class="row mt-2">	
                      <div class="col-sm-12 col-md-12" align="right">	
                    <div class="btn-group">                  
                      <button type="button" id="draft" name="draft" value="Save as draft" onclick="Savedraft_data('Continue')" class="btn btn-draft btn-sm">Save Draft & Continue</button>  
                      <button type="button" id="draft1" name="draft1" value="Save as draft1" onclick="Savedraft_data('Exit')" class="btn btn-draft btn-sm">Save Draft & Exit</button>  

                      <button type="button" id="submit" name="submit" value="Submit"  class="btn btn-save btn-sm" onclick="Updatedraft_data1(this);" hidden>Submit</button> 
                      <button type="button" id="View_data" name="View_data" value="View_data" onclick="Updatedraft_data2(this)" class="btn btn-draft btn-sm" >Preview</button> &nbsp; 
    
                      <button type="button" id="submit1" name="submit1" value="Submit1"  class="btn btn-save btn-sm " data-toggle="modal" data-target="#otpModalCenter" onclick="saveByOtp(this);" hidden>Submit</button> 
                      <button type="button" id="submit2" class="btn btn-save btn-sm" onclick="chkvalidation();" {% if request.session.userrole == 'guest' %} disabled {% endif %}>Submit</button> 
                      &nbsp;<button type="button" class="btn btn-secondary btn-sm" onclick="compliance_alterdata();">Reset</button>

                    </div>
                      </div>
                
                    
                    </div>
                  </div>
                </div>

               

                
              </div>
           
      <br><br><br>
          <br>
          <button type="button" id="openModalOpenWrap" class="btn btn-secondary btn-sm" data-toggle="modal" data-target="#markofc" hidden>Reset</button>
    
          
    
       <!-- mark officers modal -->
      <div class="modal fade right" tabindex="-1" id="exampleModal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-full-width modal-dialog-scrollable"role="document">
            <div class="modal-content modal-content-full-width">
              <div class="modal-header modal-header-full-width"  style="height:50px">
                <h3 class="report_heading" id="ReplyModalLabel">Mark Officers</h3>
                    <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" id="close1">
                        <!-- <span aria-hidden="true">&times;</span> -->Close
                    </button>
                </div>
             
              <div class="modal-body">
                <form   action="" method="POST" >
                  {% csrf_token %}
                 <input type="text" value="" id="mark_officersss" hidden/>
                <div class="inpt-container" style="padding:10px;">      
                  <div class="row">
                      <div class="col-md-3">
                          <label class="lbl-caption">Rly./Org.</label>
                          <select multiple class="form-control" data-placeholder="Select zone.." id="rly_1" name="rly_1" class="custom-select" style="width: 100%;"  multiple >
                              {% for i in Zone %}
                              <option >{{i}}</option>
                              {% endfor %}
                  
                          </select>
                      </div>
                      <div class="col-md-3">
                          <label class="lbl-caption">Div./Unit</label>
                          <select class="form-control" id="div_1" data-placeholder="Select division.." name="div_1" class="custom-select" style="width: 100%;"  multiple onchange="getdivwisedata()">
                              {% for i in division %}
                              <option>{{i}}</option>
                              {% endfor %}
                          </select>
                      </div>
                      <div class="col-md-3">
                          <label class="lbl-caption"> Department</label>
                          <select multiple class="form-control" id="dept_1" data-placeholder="Select department.." name="dept_1" class="custom-select" style="width: 100%;"  onchange="getdivdeptdata()">
                              {% for i in department %}
                              <option value="{{i.department_name}}">{{i.department_name}}</option>
                              {% endfor %}        
                          </select>
                      </div>
                      <div class="col-md-3">
                          <label class="lbl-caption">Designation</label>
                          <select multiple class="form-control" id="desig" data-placeholder="Select designation.." name="desig" class="custom-select" style="width: 100%;"  onchange="getdesigdata();">
                              {% for i in alldesig %}
                              <option value="{{i.designation}}">{{i.designation}}</option>
                              {% endfor %}
                          </select>
                      </div>
                  </div>
                <br>
                <div class="row" style=" margin: 0%;">
                    <div class="col">
                        <input type="checkbox"  id="allgm" style="zoom: 1.5;">
                        <label class="lbl-caption" style="font-size:15px ;"> All GM/ZR</label>
                    </div>
                    <div class="col">
                        <input type="checkbox"  id="alldrm" style="zoom: 1.5;">
                        <label class="lbl-caption" style="font-size:15px ;"> All DRM</label>
                      
                    </div>
                    <div class="col">
                        <input type="checkbox"  id="allphod" style="zoom: 1.5;">
                        <label class="lbl-caption" style="font-size:15px ;"> All PHOD</label>
                      
                    </div>
                    <div class="col">
                        <input type="checkbox"  id="allboard" style="zoom: 1.5;">
                        <label class="lbl-caption" style="font-size:15px ;"> All Board Members</label>
                      
                    </div>
                    <div class="col">
                        <input type="checkbox"  id="allbo" style="zoom: 1.5;">
                        <label class="lbl-caption" style="font-size:15px ;"> All BO</label>
                    </div>
                    <div class="col">
                      <input type="checkbox"  id="allpanel" style="zoom: 1.5;">
                      <label class="lbl-caption" style="font-size:15px ;">Panel Members</label>
                  </div>
                </div>
              </div>
                <!-- <br> -->
                <div class="row">
                    <div class="col-md-10">
                      <!-- <label class="lbl-caption">Selected Designation</label> -->
                        <!-- <input type="text"  id="alltext" class="form-control" style="background-color: rgb(247, 218, 248);" > -->
                        <textarea class="form-control" maxlength="150"   id="alltext" placeholder="Selected Designation"  readonly></textarea>
            
                    </div>
                    <div class="col-md-2">
                      <div class="btn-group">
                        <button type="button" class="form-control  btn btn-info btn-sm" id="add_save_marked_officer" onclick="add_save_marked_officers();" >Add Designation</button>&nbsp;
                        <button type="button" class="form-control btn btn-success btn-sm" onclick="save_marked_officers();">Save</button>&nbsp;
                        <button type="button" class="form-control btn btn-danger btn-sm" onclick="remove_save_marked_officers();">Reset</button>&nbsp;
                      </div>
                    </div>
                  </div>
          
           
                <hr/>
                  <!-- <div class="row"></div>
                    <div class="col-lg-12 col-sm-12">
                      <label></label>
            
                    </div> -->
                    <!-- <div class="col-md-3">
                      
                    </div> -->
                    <!-- </div> -->
                    <!-- <br> -->
                    <div class="row" id="showdiv1">
                      <div class="col-md-6">
                            <table id="text" class="table table-striped table-bordered table-data">
                              <thead>
                                <tr><th></th>
                                  <th></th></tr>
                              </thead>
                              <tbody>
                              </tbody>  
                          </table>
                      </div>
                      <div class="col-md-6">
                            <table id="text1" class="table table-striped table-bordered table-data">
                              <thead>
                                  <tr><th></th><th></th></tr>
                              </thead>
                              <tbody>
                                
                              </tbody>
                          </table>
                      </div>
                    </div>
                    <div class="row" id="showdiv2">
                      <div class="col-md-6">
                            <table id="textdesig" class="table table-striped table-bordered ">
                              <thead>
                                <tr>
                                  <th></th>
                                  <th></th>
                                </tr>
                              </thead>
                              <tbody>
                              </tbody>  
                            </table>
                      </div>
                      <div class="col-md-1"></div>
                      <div class="col-md-5" hidden>
                        <table id="textdesigselect" class="table table-striped table-bordered ">
                          <thead>
                            <tr>
                              <th hidden></th>
                              <th>Selected Employee/Designation</th>
                            </tr>
                          </thead>
                          <tbody>
                          </tbody>  
                        </table>
                      </div>
                    </div>
                    <br>
            
                    <input type="hidden" value="0" id="s1" name="s1">
                    </form>
                    </div>
                      <div class="modal-footer">
                        
                        
                      </div>
            </div>
          </div>
      
        </div>
   
        <!-- Modal for mark officers apeksha-->
    <div class="modal" id="markofc" tabindex="-1" role="dialog" aria-labelledby="markofcModallabel" aria-hidden="true" >
      <div class="modal-dialog-marks" role="document">
          <div class="modal-content-marks">
              <div class="modal-header-marks">
                  <h3 class="report_heading" id="markofcModalLabel">Add Instructions</h3>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div class="modal-body" style="overflow-y:scroll; width: 100%; height: 100%;">
                <div id="tasks m-0" width="100%">
                  <table id="mytable1" class="table table-striped table-bordered table-data" width="100%">
                      <thead>
                          <tr align="center">
                            <th style="display: none;">ID</th>
                              <th style="width: 5%;">Sr. No</th>
                              <th style="width: 45%;">Selected Officer</th>
                              <th style="width: 30%;">Type</th>
                              <!-- <th style="width: 20%;">For Information</th>
                              <th style="width: 20%;">For Compliance</th> -->
                              <th style="width: 15%;" hidden>Target Date (Optional)</th>
                              <th style="width: 5%;" hidden>On Priority (Optional)</th>
                              <!-- <th style="width: 35%;">Remarks</th> -->
                          </tr>
                      </thead>
                      <tbody>
                      </tbody>
                  </table>
                  <div class="row" style="width: 100%;">
                      <div class="autocomplete1" id="toHideAct" style="width: 100%;">
                        <table style="text-align: center; width: 100%;">
                          <tr>
                            <th style="width: 15%;"><label for="datepker" class="lbl-caption">Target Date (Optional)</label></th>
                            <th style="width: 55%;"><input type="text"  class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 60%;background-color:white;" id='target_date_inpt' readonly></th>
                            <th style="width: 15%;"><label for="priority" class="lbl-caption">On Priority (Optional)</label></th>
                            <th style="width: 15%; text-align: left;"><input type="checkbox" value="1" autocomplete="off" id='checkbox_priority_inpt'></th>
                          </tr>
                        </table> 
                     </div>
                  </div>
                  
              </div>
                  
              </div>
              <div class="modal-footer-marks">
                  <div class="btn-toolbar" role="toolbar" >
                      <div class="btn-group mr-2" role="group" >
                        <button type="button" class="btn btn-success" name="saveinfo" id="saveinfo"  onclick="save_info(this)" data-dismiss="modal">Save</button>&nbsp;
                        <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" id="closeforward" >Close</button>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
  <!-- modal -->
                
        
        <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b> Target Date</b></h4>
              
            </div>
           
              <div class="modal-body">
                
                  
            
           
              
              <div><label for="start" >Target Date</label><br><input type="date"  class="col-md-2" required class="form-control" style="height: 2em;margin-top:0.7em;" id="target_date" value="new Date()"  onkeydown='event.preventDefault()' requied>
               
               
               </div>
    
            </div>
          </div>
             
        </div>
        
      </div>
    </div>
      </div>
              
      <div id="Pending" class="container-fluid  tab-pane"><br>
        <div class="container-fluid containerField">
          <h3 class="report_heading">Field Inspection</h3>
          <div class="row wrapRow">
            <div class="col-lg-6  department-wise-row">
              <h5 class="title">Department-wise</h5>
              <br>
              <div class="row">
                  {% for i in allDepartmentPhase2 %}
                <div class="col-lg-4 col-md-6">
                  <div class="parent-card pc1" onclick="toggleOpen(this)" onmouseover="showChildren(this)" onmouseout="hideChildren(this)">
                    <p class="card-title "><strong>{{i.department_name}}</strong></p>
                      {% for j in i.inspTypePhase2 %}
                      <div class="child-card" onclick="openPhase2('{{j.instypeid}}')" >
                          {{j.name}}
                      </div>
                      {% endfor %}
              </div>
                </div>
                {% endfor %}
            
              </div>
          </div>
        
      
      
              <div class="col-lg-5  category-wise-row">
              <h5 class="title">Category-wise</h5>
              <br>
              <div class="row">
                  {% for i in allCategoryPhase2 %}
                <div class="col-lg-4 col-md-6">
                  <div class="parent-card pc2" onclick="toggleOpen(this)" onmouseover="showChildren(this)" onmouseout="hideChildren(this)">
                    <p class="card-title "><strong>{{i.asset_category}}</strong></p>
                      {% for j in i.inspTypePhase2 %}
                      <div class="child-card" onclick="openPhase2('{{j.instypeid}}')" >
                          {{j.name}}
                      </div>
                      {% endfor %}
              </div>
                </div>
                {% endfor %}
            
              </div>
          
              
              </div>
      
            
        </div>
        </div>


      </div>
    </div>
    </div>
    
   
                
  </body>
             
              <div class="wrap mt-0">
                <div class="content mt-0">
                  <button class="btn btn-danger" onclick="closePpln();">&times;</button>
                  <iframe src="" style="width:100%;height:82vh;border:0px;" id="frmDash"></iframe>
                </div>
              </div> 
    
<!-- otp Modal -->
<div class="modal fade" id="otpModalCenter" tabindex="-1" role="dialog" aria-labelledby="otpModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="otpModalLongTitle">Verify Your inspection Form</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container">
          
          <div class="row">
            <div id="otpcurrent"></div>
            <div id="count_down">
              <div>Time left : <span id="timer"></span></div>
            </div>
            <br>
            <div class="col-8">
              <input style="background-color: #fff;" autocomplete="off" placeholder="- - - -" type="text" name="" id="your_otp" class="form-control" maxlength="4">
            </div>
            <div class="col-4">
              <button class="btn btn-info" id="verify_otp" onclick="verify_my_otp()">Verify</button>
            </div>
            
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>


<button type="button" id="viewmodalbtn" name="viewmodalbtn" value="viewmodalbtn"  hidden data-toggle="modal" data-target="#viewmodal" ></button> 


<div class="modal" tabindex="-1" id="viewmodal" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog-modal-xl" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="report_heading" id="exampleModalLabel">Preview of Inspection Note</h3>
      <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" id="previewClose">
        <!-- <span aria-hidden="true">&times;</span> -->Close
      </button>      
    </div>
    <div id="printable">
      <div class="modal-body">
        <centre><h4 style="text-align: center;"><label id="head3"></label></h4></centre> <br>
        <centre><h5 style="text-align: center;"><label id="acco"></label></h5></centre> 
        <centre><h5 style="text-align: center;">Inspection Type: <label id="insptypepreview"></label></h5></centre> 
        <!-- <div class="inpt-container" id="container1" style="padding-bottom: 10px;">
          <h1 style="text-align: center; font-size: 20px; padding-top: 40px;" id="inspection_title_prevM">HELLO</h1>
          <br>
          <h3 style="text-align: center; font-size: 15px; padding-top: 0px;" id="AccompanyM">HEY</h3>
        </br>
        </div> -->
        <table border="1" id="table2" class="table table-striped table-bordered table-data" >
  
          <thead >
            <tr style="margin-left: 5em;">  
              <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 10%;">Item No.</th>
              <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 40%;"> Inspection Para</th>
              <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 10%;"> Item Pertains To</th>
              <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 40%;">
                <table style="width: 100%">
                  <thead>
                    <tr>
                    <th style="width: 25%;">Action By</th>
                    <th style="width: 25%;">Type</th>
                    <th style="width: 25%;">Target Date</th>
                    <th style="width: 25%;">Priority</th>
                  </tr>
                  </thead>
                </table>
              </th>
             
            </tr>
          </thead>
          <tbody>

          </tbody>
      </table>
      
         
          <div class="head8">
            <h5 align="right"></h5>
            <h5 align="right"><label id="head6"> </label></h5>
            <h5 align="right"><label id="head5"> </label></h5> 
            <h5 align="right"><label id="head4"> </label></h5>
          </div>
          <br>
          <h5>Copy To:</h5>
          <label id="insp_desig" name="copy to:"></label> 
      </div>

      <div id="imgViewShow">

      </div>
    </div>
      <div class="modal-footer">
        <div class="btn-toolbar" role="toolbar" style="margin-top:30px;">
          <div class="btn-group mr-2" role="group" >
            <button type="button" class="btn btn-info" onclick="windowPrint()">Print/Save as PDF</button>&nbsp;
            <button type="button" id="submit21" class="btn btn-save btn-sm" onclick="clickSubmit2();" {% if request.session.userrole == 'guest' %} disabled {% endif %}>Submit</button> 
          </div>
      </div>
        <!-- <button type="button" class="btn btn-info btn-sm" onclick="windowPrint()">Print</button> -->
      </div>
    </div>
  </div>
</div>


<button type="button" id="addtablemodal"  data-toggle="modal" data-target="#tablerowcolumn" hidden></button>
<div class="modal" tabindex="-1" id="tablerowcolumn" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title" id="exampleModalLabel"><b> Give table rows and column</b></h4>
      <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" id="closespanid">
        <!-- <span aria-hidden="true">&times;</span> -->Close
    </button>
      <!-- <button type="button" class="btn btn-light  btn-sm" id="closespanid" data-dismiss="modal">&times;</button> -->
      
    </div>
      <div class="modal-body">
      <label>No of Rows</label>&nbsp;<input type="text" id="noofrows" onkeypress="return event.charCode > 47 && event.charCode < 58;" maxlength="2" placeholder="Numbers of rows should be Less than or equal to 50"><br>
      <label>No of Columns</label>&nbsp;<input type="text" id="noofcolumns" onkeypress="return event.charCode > 47 && event.charCode < 58;" maxlength="2" placeholder="Numbers of columns should be Less than or equal to 20"><br>
          
      </div>
      <div class="modal-footer">
        <button type="button" name="submit" value="Approved" 
                  class="btn btn-primary" onclick="setspantable()">Add Table</button>
        </button>
      </div>
    </div>
  </div>
</div>




<!-- table delete modal -->

<button type="button" id="deltablemodal"  data-toggle="modal" data-target="#tablerowcolumndel" hidden></button>
<div class="modal" tabindex="-1" id="tablerowcolumndel" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title" id="exampleModalLabel"><b> Select Options to Delete</b></h4>
      <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" id="closedelmodal">
        <!-- <span aria-hidden="true">&times;</span> -->Close
    </button>
      <!-- <button type="button" class="btn btn-light  btn-sm" id="closedelmodal" data-dismiss="modal">&times;</button> -->
      
    </div>
      <div class="modal-body">
        <input type="radio" id="table_checked" name="deletion_type" value="table" onclick="fun_set_del_table('table')" checked>
        <label>Delete Table</label><br>
        <input type="radio" name="deletion_type" value="row" onclick="fun_set_del_table('row')">
        <label>delete Row</label>&nbsp;<input class="form-control" readonly type="text" id="noofrowsdel" onkeypress="return event.charCode > 47 && event.charCode < 58;" placeholder="Enter Row No to Delete"><br>
        <input type="radio"  name="deletion_type" value="column" onclick="fun_set_del_table('column')">
        <label>Delete column</label>&nbsp;<input class="form-control" readonly type="text" id="noofcoldel" onkeypress="return event.charCode > 47 && event.charCode < 58;" placeholder="Enter Column No to Delete">


      </div>
      <div class="modal-footer">
        <button type="button" name="submit" value="delete" 
                  class="btn btn-primary" onclick="delete_table()">Delete</button>
        </button>
      </div>
    </div>
  </div>
</div>


<!-- table copy officer -->

<button type="button" id="openofficeremodal"  data-toggle="modal" data-target="#openofficeremodal_get" hidden></button>
<div class="modal" tabindex="-1" id="openofficeremodal_get" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title" id="exampleModalLabel"><b> Select Options to Copy From</b></h4>
      <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" id="closeofficermodal">
        <!-- <span aria-hidden="true">&times;</span> -->Close
    </button>
      <!-- <button type="button" class="btn btn-light  btn-sm" id="closeofficermodal" data-dismiss="modal">&times;</button> -->
      
    </div>
      <div class="modal-body">
        <table id="add_officer_tbl" style="width: 100%;">
          <tbody></tbody>
        </table>

      </div>
      <div class="modal-footer">
        <button type="button" name="submit" value="Copy_officer" 
                  class="btn btn-primary" onclick="Copy_marked_officer()">Copy</button>
        </button>
      </div>
    </div>
  </div>
</div>


 <!-- Modal for longer section -->
 <div class="modal fade" id="SectionModal" tabindex="-1" role="dialog" aria-labelledby="SectionModallabel" aria-hidden="true" >
  <div class="modal-dialog modal-dialog-scrollable" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h3 class="report_heading" id="SectionModalLabel">Add New/Longer Sections</h3>
              <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close">
                <!-- <span aria-hidden="true">&times;</span> -->Close
            </button>
          </div>

          <div class="modal-body" style="overflow-y:scroll; height: 200px;">
           <div class="row">
            <div class="col-6" style="width: 100%;">
              <label for="from_sttn" class="lbl-caption">From Station</label><br>
              <div style="width: 100%;">
                <select name="from_sttn" id="from_sttn" data-placeholder="Select Station.." class="form-control" style="width: 100%;">
                  <option value="">select</option>
                </select>
              </div>
            </div>
            <div class="col-6" style="width: 100%;">
              <label for="to_sttn" class="lbl-caption">To Station</label><br>
              <div style="width: 100%;">
                <select name="to_sttn" id="to_sttn" data-placeholder="Select Station.." class="form-control" style="width: 100%;">
                  <option value="">select</option>
                </select>
              </div>
            </div>
            
           </div>   
           <div class="row">
            <div class="col">
              <button type="button" class="btn btn-outline-info btn-sm mt-1" onclick="save_section()" >Add Section</button>
            </div>
           </div>
           <div class="row mt-2" style="height: 70px;">
            <textarea type="text" class="form-control lbl-caption word-wrap h-100" style="max-width: 100%;"  id="sectionsadded" style="background-color: rgb(157, 207, 251);" disabled></textarea>
           </div>
              
          </div>
          <div class="modal-footer">
              <div class="btn-toolbar" role="toolbar" >
                  <div class="btn-group mr-2" role="group" >
                      <button type="button" class="btn btn-outline-danger btn-sm mb-1" data-dismiss="modal" onclick="add_section()" >Save</button>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
<!-- modal -->

<!-- Modal for Other Railway Unit -->
<div class="modal fade" id="ORLModal" tabindex="-1" role="dialog" aria-labelledby="SectionModallabel" aria-hidden="true" >
  <div class="modal-dialog modal-dialog-scrollable" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h3 class="report_heading" id="SectionModalLabel">Add Other Location Types</h3>
              <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close">
                <!-- <span aria-hidden="true">&times;</span> -->Close
            </button>
          </div>

          <div class="modal-body" style="overflow-y:scroll; height: 200px;">
           <div class="row">
            <div class="col-md-10" >
              <label style="font-weight: 600;"> Add Location Name </label>
            
              <input type='text' class="form-control" id="orlNew">
            </div>
            <div class="col-md-2">
              <button type="button" class="btn btn-outline-info btn-sm mt-1" onclick="save_orl()" >Add</button>
            </div>
           </div>   
           <div class="row mt-2" style="height: 70px;">
            <textarea type="text" class="form-control lbl-caption word-wrap h-100" style="max-width: 100%;"  id="ORLsadded" style="background-color: rgb(157, 207, 251);" disabled></textarea>
           </div>
              
          </div>
          <div class="modal-footer">
              <div class="btn-toolbar" role="toolbar" >
                  <div class="btn-group mr-2" role="group" >
                      <button type="button" class="btn btn-outline-success btn-sm mb-1" data-dismiss="modal" onclick="add_ORL()" >Save</button>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
<!-- modal -->


<!-- modal choose location -->
<div class="modal" tabindex="-1" id="chooseLocation" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title" id="exampleModalLabel"><b> Select Location from Drop Down</b></h4>
      <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close" id="closeChoosemodal">Close
    </button>
      
    </div>
      <div class="modal-body">
        <div style="overflow-x: hidden ;overflow-y: auto; height:500px; ">
          {% for i in location_array %}
          <div class="row form-group">
            <div class="col-12"><label  for="{{i.type_code}}5551"><b>{{i.type}}
              {% if i.type_code == 'ORL' %} (From the dropdown Select Rly/Div and Location then click + To Add ) {% endif %}
              {% if i.type_code == 'TRN' %} (From the dropdown Select Rly,Div and Train then click + To Add ) {% endif %}
            
            </b></label></div>
            {% if i.type_code == 'ORL' %}
            <div class="col-4">
              <select class="form-control"    id="railway5551" name="railway5551" onchange="getDivisionForRailway(this.value,'ORL')" >
                <option selected disabled hidden value="">Select Railway</option>
              </select>
              </div> 
              <div class="col-4">
                <select class="form-control"  id="division5551" name="division5551">
                  <option selected disabled hidden value="">Select Division</option>
                </select>
                </div>
                <div class="col-3">
                  <input type="text" class="form-control"  id="text5551" name="text5551" >
                </div>
                <div class="col-1">
                  <input type="button" class="form-control btn btn-default" style="width:100%;" value="+" onclick="addOtherLocationData()">
                </div>
              {% endif %}
              {% if i.type_code == 'TRN' %}
            <div class="col-3">
              <select class="form-control"    id="trnrailway5551" name="trnrailway5551" onchange="getDivisionForRailway(this.value,'TRN')" >
                <option selected disabled hidden value="">Select Railway</option>
              </select>
              </div> 
              <div class="col-4">
                <select class="form-control"  id="trndivision5551" name="trndivision5551" onclick="getTrainData()">
                  <option selected disabled hidden value="">Select Division</option>
                </select>
                </div>
                <div class="col-4">
                  <select class="form-control"    id="trntext5551" name="trntext5551">
                    <option selected disabled hidden value="">Select Train No.</option>
                  </select>
                </div>
                <div class="col-1">
                  <input type="button" class="form-control btn btn-default" style="width:100%;"  value="+" onclick="addTrainLocationData()">
                </div>
               
              {% endif %}
            <div class="col-12">
              <select class="form-control setLocationClass" data-placeholder="Search {{i.type}}.."   id="{{i.type_code}}5551" name="{{i.type_code}}5551" multiple>
              </select>
            </div>
          </div>
          {% endfor %}
      </div>
    </div>
      <div class="modal-footer">
        <button type="button" name="submit" value="delete" class="btn btn-danger" onclick="removeLocationFromModal()">Clear</button>
        <button type="button" name="submit" value="delete" class="btn btn-primary" onclick="setLocationFromModal()">Done</button>
        </button>
      </div>
    </div>
  </div>
</div>


<!-- modal -->

<!-- locatio data set -->
<script>



function setChooseLocationData()
{
  
  
  let rly_zone = JSON.stringify($('#zone').val());
  let division_id = JSON.stringify($('#division').val());
  let data = {
    typ:'allLocation',
    rly_zone:rly_zone,
    division_id:division_id,
    csrfmiddlewaretoken: '{{ csrf_token }}'
  }
  $.ajax({
                method: "POST",
                url: "{% url 'setChooseLocationData' %}",
                dataType: 'json',
                data: data,
                success: function (response) {
                    let row='',rly_zone1=$('#zone').val();
                    for(let i=0;i<response.length;i++)
                    {
                      let id = response[i].id+'5551';
                      let prev_data = $('#'+id).val();
                      let data = response[i].data,option='',val;
                      for(let j=0;j<data.length;j++)
                      {
                        val=`${data[j].city}#${data[j].table_from}#${data[j].loc_code}`;
                        if(prev_data.includes(val) || editLocationData.includes(val))
                            option += `<option value="${data[j].city}#${data[j].table_from}#${data[j].loc_code}" selected>${data[j].city}</option>`;
                        else
                          option += `<option value="${data[j].city}#${data[j].table_from}#${data[j].loc_code}">${data[j].city}</option>`;
                      }
                      $('#'+id).empty();
                      $('#'+id).select2();
                      $('#'+id).append(option);
                      if(response[i].id == 'ORL')
                      {
                        
                        row+='<option selected disabled hidden value="">Select Railway</option>';
                        for(let j=0;j<rly_zone1.length;j++)
                        {
                          row+=`<option value="${rly_zone1[j]}">${rly_zone1[j]}</option>`;
                        }
                        $('#railway5551').empty();
                        $('#railway5551').append(row);

                        row=`<option selected disabled hidden value="">Select Division</option>`;
                        $('#division5551').empty();
                        $('#division5551').append(row);
                 
                        
                        for(let j=0;j<prev_data.length;j++)
                        {
                          let text = String(prev_data[j]).split('#');
                          option+=`<option value="${prev_data[j]}" selected>${text[0]}</option>`;
                        }




                        for(let j=0;j<editLocationData.length;j++)
                        {
                          if((editLocationData[j].split('#'))[1] == 'ORL')
                          {
                            let text = String(editLocationData[j]).split('#');
                            option+=`<option value="${editLocationData[j]}" selected>${text[0]}</option>`;
                            let index = editLocationData.indexOf(editLocationData[j]);
                            if(index != -1)
                            {
                              editLocationData.splice(index,1);
                            }
                          }
                        }


                        $('#'+id).append(option);



                      }
                      if(response[i].id == 'TRN')
                      {
                        
                        row+='<option selected disabled hidden value="">Select Railway</option>';
                        for(let j=0;j<rly_zone1.length;j++)
                        {
                          row+=`<option value="${rly_zone1[j]}">${rly_zone1[j]}</option>`;
                        }
                        $('#trnrailway5551').empty();
                        $('#trnrailway5551').append(row);

                        row=`<option selected disabled hidden value="">Select Division</option>`;
                        $('#trndivision5551').empty();
                        $('#trndivision5551').append(row);
                 
                        
                        for(let j=0;j<prev_data.length;j++)
                        {
                          let text = String(prev_data[j]).split('#');
                          option+=`<option value="${prev_data[j]}" selected>${text[0]}</option>`;
                        }
                        for(let j=0;j<editLocationData.length;j++)
                        {
                          if((editLocationData[j].split('#'))[1] == 'TRN')
                          {
                            let text = String(editLocationData[j]).split('#');
                            option+=`<option value="${editLocationData[j]}" selected>${text[0]}</option>`;
                            let index12 = editLocationData.indexOf(editLocationData[j]);
                            if(index12 > -1)
                            {
                             
                              editLocationData.splice(index12,1);
                            }
                          }
                        }
                        $('#'+id).append(option);
                      }
                      
                    }
                    
                }
            });

}

function removeLocationFromModal()
{

  
  let rly_zone = JSON.stringify($('#zone').val());
  let division_id = JSON.stringify($('#division').val());
  let data = {
    typ:'allLocation',
    rly_zone:rly_zone,
    division_id:division_id,
    csrfmiddlewaretoken: '{{ csrf_token }}'
  }
  $.ajax({
                method: "POST",
                url: "{% url 'setChooseLocationData' %}",
                dataType: 'json',
                data: data,
                success: function (response) {
                    let row='',rly_zone1=$('#zone').val();
                    for(let i=0;i<response.length;i++)
                    {
                      let id = response[i].id+'5551';
                      let prev_data = $('#'+id).val();
                      let data = response[i].data,option='',val;
                      for(let j=0;j<data.length;j++)
                      {
                          option += `<option value="${data[j].city}#${data[j].table_from}#${data[j].loc_code}">${data[j].city}</option>`;
                      }
                      $('#'+id).empty();
                      $('#'+id).select2();
                      $('#'+id).append(option);
                      if(response[i].id == 'ORL')
                      {
                        
                        row+='<option selected disabled hidden value="">Select Railway</option>';
                        for(let j=0;j<rly_zone1.length;j++)
                        {
                          row+=`<option value="${rly_zone1[j]}">${rly_zone1[j]}</option>`;
                        }
                        $('#railway5551').empty();
                        $('#railway5551').append(row);

                        row=`<option selected disabled hidden value="">Select Division</option>`;
                        $('#division5551').empty();
                        $('#division5551').append(row);
                 
                        
                        // for(let j=0;j<prev_data.length;j++)
                        // {
                        //   let text = String(prev_data[j]).split('#');
                        //   option+=`<option value="${prev_data[j]}" selected>${text[0]}</option>`;
                        // }




                        for(let j=0;j<editLocationData.length;j++)
                        {
                          if((editLocationData[j].split('#'))[1] == 'ORL')
                          {
                            let text = String(editLocationData[j]).split('#');
                            option+=`<option value="${editLocationData[j]}" selected>${text[0]}</option>`;
                            let index = editLocationData.indexOf(editLocationData[j]);
                            if(index != -1)
                            {
                              editLocationData.splice(index,1);
                            }
                          }
                        }


                        $('#'+id).append(option);



                      }
                      if(response[i].id == 'TRN')
                      {
                        
                        row+='<option selected disabled hidden value="">Select Railway</option>';
                        for(let j=0;j<rly_zone1.length;j++)
                        {
                          row+=`<option value="${rly_zone1[j]}">${rly_zone1[j]}</option>`;
                        }
                        $('#trnrailway5551').empty();
                        $('#trnrailway5551').append(row);

                        row=`<option selected disabled hidden value="">Select Division</option>`;
                        $('#trndivision5551').empty();
                        $('#trndivision5551').append(row);
                 
                        
                        // for(let j=0;j<prev_data.length;j++)
                        // {
                        //   let text = String(prev_data[j]).split('#');
                        //   option+=`<option value="${prev_data[j]}" selected>${text[0]}</option>`;
                        // }
                        for(let j=0;j<editLocationData.length;j++)
                        {
                          if((editLocationData[j].split('#'))[1] == 'TRN')
                          {
                            let text = String(editLocationData[j]).split('#');
                            option+=`<option value="${editLocationData[j]}" selected>${text[0]}</option>`;
                            let index12 = editLocationData.indexOf(editLocationData[j]);
                            if(index12 > -1)
                            {
                             
                              editLocationData.splice(index12,1);
                            }
                          }
                        }
                        $('#'+id).append(option);
                      }
                      
                    }
                    setLocationFromModal();
                    
                }
            });

}



function getDivisionForRailway(val,seltyp)
{
  
  let data = {
    typ:'allDivision',
    rly_zone:val,
   
    csrfmiddlewaretoken: '{{ csrf_token }}'
  }
  $.ajax({
                method: "POST",
                url: "{% url 'setChooseLocationData' %}",
                dataType: 'json',
                data: data,
                success: function (response) {
                  let option=`<option selected disabled hidden value="">Select Division</option>`;
                  for(let i=0;i<response.length;i++)
                  {
                    option += `<option value="${response[i].location_code}">${response[i].location_code}</option>`;
                  }
                  if(seltyp == 'ORL')
                  {
                    $('#division5551').empty();
                    $('#division5551').append(option);
                  }
                  if(seltyp == 'TRN')
                  {
                    $('#trndivision5551').empty();
                    $('#trndivision5551').append(option);
                  }
                }
              });
}
  
function addTrainLocationData()
{   
  let rly = $('#trnrailway5551').val();
  let div = $('#trndivision5551').val();
  let txt = $('#trntext5551').val();
  if(rly == null)
  {
    alert('Select Railway First');
    $('#trnrailway5551').focus();
    return false;
  }
  if(div == null)
  {
    alert('Select Division First');
    $('#trndivision5551').focus();
    return false;
  }
  if(txt == null)
  {
    alert('Select Train number');
    $('#trntext5551').focus();
    return false;
  }

  let option='',text;
  text = (txt).split('#')[0];
  txt = txt+'#'+div+'@'+rly;
  let data = $('#TRN5551').val();
  if(data.includes(txt))
  {
    alert('Train Already Present with these combination');
    return false;
  }
  option += `<option value="${txt}" selected>${text}</option>`
  $('#TRN5551').append(option).trigger('change');
  $('#trntext5551').val('').trigger('change');

}

function addOtherLocationData()
{
  let rly = $('#railway5551').val();
  let div = $('#division5551').val();
  let txt = $('#text5551').val();
  if(rly == null)
  {
    alert('Select Railway First');
    $('#railway5551').focus();
    return false;
  }
  if(txt.trim() == '')
  {
    alert('Enter Location Text To add');
    $('#text5551').focus();
    return false;
  }
  let val,option='',text;
  if(div!= null)
  {
    val = txt+'/'+div+'/'+rly;
    text = val+'#ORL#0#'+div+'@'+rly;
  }
  else 
  {
    val = txt+'/'+rly;
    text = val+'#ORL#0#'+rly;
  }
  let data = $('#ORL5551').val();
  
  if(data.includes(text))
  {
    alert('Location Already Present');
    return false;
  }
  option += `<option value="${text}" selected>${val}</option>`
  $('#ORL5551').append(option).trigger('change');
  $('#text5551').val('');

}

function getTrainData()
{
    let data = {
    typ:'allTrain',
    rly_zone:$('#trnrailway5551').val(),
    div_ws:$('#trndivision5551').val(),
    csrfmiddlewaretoken: '{{ csrf_token }}'
  }
  $.ajax({
                method: "POST",
                url: "{% url 'setChooseLocationData' %}",
                dataType: 'json',
                data: data,
                success: function (response) {
                  let option=`<option selected disabled hidden value="">Select Train No.</option>`;
                  for(let i=0;i<response.length;i++)
                  {
                    option += `<option value="${response[i].city}#TRN#${response[i].loc_code}">${String(response[i].city)}</option>`;
                  }
                  $('#trntext5551').empty();
                    $('#trntext5551').append(option);
                }
              });
}



function setLocationFromModal()
{
  //closeChoosemodal
  let idSel,allDD = document.querySelectorAll('.setLocationClass'),option='',val;
  for(let i=0;i<allDD.length;i++)
  {
    idSel = allDD[i].id;
    val = $('#'+idSel).val();
    for(let j=0;j<val.length;j++)
    {
      option += `<option value="${val[j]}" selected >${val[j]}</option>`;
    }
    
  }
    $('#location').empty();
    $('#location').append(option);
    document.getElementById('closeChoosemodal').click();
    setSections();
  
}
</script>



<!-- Add sections -->
<script>
  function addsec(e){
    let locs_val=$('#location').val()
    if (locs_val.length==0){
      alert('Please add location first.')
      return false;
    }
    locats=[]
    added_sec=[]
    var row=''
    var table = document.getElementById("addworkmech");
    let tbl_r_count = table.rows.length;
    if (tbl_r_count !=0){
      for(let i=0;i<tbl_r_count-1;i++){
        value = table.rows[i].cells[0].innerHTML;
          if( value == 'S'){
            var id='#location_at'+i
            sec=$(id).val()
            added_sec.push(sec)
          }
      }
    }
    if (added_sec.length == locs_val.length){
      alert('Cannot add more sections')
      return false;
    }
    addpara('S','-2');
    for (var i=0; i<locs_val.length;i++){
      x=locs_val[i].split('#')
      locats.push(x[0])
      if (added_sec.includes(locs_val[i]))
        continue
      else
        row+=`<option value="${locs_val[i]}"> ${x[0]}</option>`
    }
        
  
    pl=para_array.length-1
    i=para_array[pl]
    x=tbl_r_count
 
        value = table.rows[x].cells[0].innerHTML;
        if( value == 'S'){
          var id='#location_at'+i
      
          $(id).empty()
          $(id).append(row);
        }
  }
  </script>
<!-- add new globals -->


<script>
$('#message_container').hide();
  var para_count = -1;
  var para_array = [], para_array_marked = [];
  var full_array = [];
  var del_array = [];
  var no_of_row = 0;
  var copy_offier_id,set_offier_id='';

</script>

<!-- image upload -->
<script>

$('#table_img').hide();

var img_ref_no = [],img_count=0, set_option_val = [];
function set_option_value(id)
  {
    let tableid = document.getElementById('addworkmech');
    let id1 = id.substring(11,id.length),set_option;
    set_option = set_option_val[parseInt(id1)-1]
    if(set_option == 0)
    {
      set_option = 1;
      $('#'+id).empty();
      let row = '',ref_no='';
      row += `<option value="" selected disabled hidden>Select refrence number</option>`;
      for(let i =0; i<tableid.rows.length;i++)
      {
        if(tableid.rows[i].cells[0].innerHTML == 'S'){
        
          ref_no = tableid.rows[i].cells[2].innerHTML;
          continue;
        
        }
        if(ref_no!='')
        {
        if(((tableid.rows[i].cells[2].innerHTML).split('.')).length == 1)
          row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> ${ tableid.rows[i].cells[1].innerHTML}</option>`;
        else if(((tableid.rows[i].cells[1].innerHTML).split('.')).length == 2)
          row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
        else 
            row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;&nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
        }
        else{
          if(((tableid.rows[i].cells[2].innerHTML).split('.')).length == 1)
          row += `<option value="${ tableid.rows[i].cells[1].innerHTML}"> ${tableid.rows[i].cells[1].innerHTML}</option>`;
        else if(((tableid.rows[i].cells[1].innerHTML).split('.')).length == 2)
          row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
        else 
            row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;&nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
        }
        }
      $('#'+id).append(row);
    }
    set_option_val[parseInt(id1)-1] = set_option;
  }
function preview_img(id)
{
  let id1 = 'frame'+id;
  var x = document.getElementById(id1);
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
function preview(id)
{
  // upload_img_r(id);
  let id1 = 'frame'+id;
  let do_file = 'ipfile_'+id,btn_do_file = 'btn_img_'+id
  document.getElementById(id1).src="";
  const fi = document.getElementById(do_file);

    if (fi.files.length > 0) {
      for (let i = 0; i <= fi.files.length - 1; i++) {

        const fsize = fi.files.item(i).size;
        const file = Math.round((fsize / 1024));
        if (file > 100) {
          document.getElementById(do_file).value='';
          alert("File too Big, please select a file less than 100KB");
        }
        else {
          // let btn_do_file = 'btn_img_'+id, sel_text = 'ipfile_'+id,txt_img = 'img_text_'+id,frameid='frame'+id,file = "";
          // document.getElementById(btn_do_file).style.backgroundColor='blue';
          // document.getElementById(sel_text).value = file;
          // document.getElementById(txt_img).value = file;
          // //document.getElementById(frameid).src = file;
          // document.getElementById(btn_do_file).disabled = false;
          document.getElementById(btn_do_file).style.backgroundColor='blue';
          document.getElementById(btn_do_file).disabled = false;
          document.getElementById(id1).style.display = "none";
    
          document.getElementById(id1).src=URL.createObjectURL(event.target.files[0]);
        }
      }
    }
}
function add_row_image()
 {
    let tableid = document.getElementById('addworkmech');
    let img_row_count = document.getElementById('table_img').rows.length;
    if(img_row_count == 6)
    {
      alert(' Maximum Number of image to add is 5');
      return false;
    }

    img_count ++;
    set_option_val.push(0);
    
    let row = '<tr>';
    row += `<td style="width:10%"><select id="select_img_${img_count}" onclick="set_option_value(this.id)" style="height:40px;"><option value="" selected disabled hidden>Select refrence number</option>`;
    for(let i =0; i<tableid.rows.length;i++)
    {
        if(((tableid.rows[i].cells[1].innerHTML).split('.')).length == 1)
          row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> ${tableid.rows[i].cells[1].innerHTML}</option>`;
        else if(((tableid.rows[i].cells[1].innerHTML).split('.')).length == 2)
          row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
        else 
            row += `<option value="${tableid.rows[i].cells[1].innerHTML}"> &nbsp;&nbsp;&nbsp;&nbsp;${tableid.rows[i].cells[1].innerHTML}</option>`;
    }
    row += `</select></td>`;
    row += `<td style="width:40%"> 
      <div class="row form-group">
        <div class="col-9">
      <input type="file" id="ipfile_${img_count}" name="ipfile_${img_count}" class="form-control" onchange="preview('${img_count}')" accept="image/jpeg, image/x-png" >
      </div> <div class="col-3">
      <input type="button" id="btn_img_${img_count}" class="form-control" onclick="upload_img('${img_count}')" style="background-color:blue;height:40px;width:100%;" value="Upload Image" >          
    </div></div>
      <p style="color: blue;">Accepted types:  .png, .jpeg, .jpg and max file size: 100 KB</p>           
                
                
                <input type="button" id="btn_img_r${img_count}" onclick="upload_img_r('${img_count}')" style="background-color:red;" value="Reset Image" hidden disabled>

                 <input type="text" id="img_text_${img_count}" value="" hidden>
                 
            </td>
            <td style="width:30%"> 
              
                 <img class="imgFrame" id="frame${img_count}"  src="" width="400px" height="280px" style="display:none;"/>
               
                 <input type="button" onclick="preview_img('${img_count}')" style="background-color:blue;" value="Preview" hidden>
            </td>
            <td style="width:20%"> 
                 <input type="button" id="delete_img_${img_count}" class="form-control" onclick="delete_img(this)" style="background-color:red;height:40px;width:100%;" value="Delete">
            </td>
            `
    row += '</tr>';
    $('#table_img').append(row);
    //preview_img(img_count);
    img_ref_no.push(String(img_count));
    img_row_count = document.getElementById('table_img').rows.length;
    if(img_row_count > 1)
    {
      $('#table_img').show();
    }
  
 }
function delete_img(btn) {
 
  
  let id=btn.id, id1 = id.substring(11,id.length);
  let img_row_count = document.getElementById('table_img').rows.length;
  if(img_row_count == 1)
  {
    alert(' Nothing to delete');
    return false;
  }
  
  for(let ij=0;ij<img_ref_no.length;ij++)
  { 
    if(id1 == String(img_ref_no[ij]))
    {
      let txt_img = 'img_text_'+id1,file_name = document.getElementById(txt_img).value;
      if(file_name != '')
            {
            var data= new FormData();
            data.append('file',file_name)
            data.append('csrfmiddlewaretoken',"{{csrf_token}}");
            data.append('op',"delete");
            $.ajax({
                method: "POST",
                url: "{% url 'upload_img' %}",
                dataType: 'json',
                processData:false,
                contentType: false,
                mimeType: 'multipart/form-data',
                data: data,
                success: function (response) {
                    file = "";
                }
            });
          }
          break;
      
    }

  }

  var row = btn.parentNode.parentNode;
  row.parentNode.removeChild(row);
  img_row_count = document.getElementById('table_img').rows.length;
  if(img_row_count == 1)
    {
      $('#table_img').hide();
    }
    index = img_ref_no.indexOf(id1);
    if (index > -1) { 
      img_ref_no.splice(index, 1); 
    }
    
}
function upload_img_r(id)
{
  let do_file = 'img_text_'+id, file_name = document.getElementById(do_file).value,sel_text = 'ipfile_'+id;
  let btn_do_file = 'btn_img_'+id, txt_img = 'img_text_'+id,frameid='frame'+id,btn_reset = 'btn_img_r'+id;
  if(file_name == '')
  {
    alert('Nothing to reset');
    return false;
  }
  var data= new FormData();
  data.append('file',file_name)
  data.append('csrfmiddlewaretoken',"{{csrf_token}}");
  data.append('op',"delete");
  $.ajax({
      method: "POST",
      url: "{% url 'upload_img' %}",
      dataType: 'json',
      processData:false,
      contentType: false,
      mimeType: 'multipart/form-data',
      data: data,
      success: function (response) {
          document.getElementById(btn_do_file).style.backgroundColor='blue';
          file = "";
          document.getElementById(sel_text).value = file;
          document.getElementById(txt_img).value = file;
          document.getElementById(frameid).src = file;
          document.getElementById(btn_do_file).disabled = false;
          document.getElementById(btn_reset).disabled = true;   
      }
  });

}
function upload_img(id)
{
  let do_file = 'ipfile_'+id;
  let refNoId = 'select_img_'+id;
  if($('#'+refNoId).val() == null)
  {
    alert('Select Reference Number');
    return false;
  }
  if(document.getElementById(do_file).value == '')
  {
    alert('Select Image First');
    return false;
  }
  let btn_do_file = 'btn_img_'+id, txt_img = 'img_text_'+id,frameid='frame'+id,btn_reset = 'btn_img_r'+id;
  var data= new FormData();
  data.append('file',$('#'+do_file)[0].files[0])
  data.append('csrfmiddlewaretoken',"{{csrf_token}}");
  data.append('op',"upload");
  $.ajax({
      method: "POST",
      url: "{% url 'upload_img' %}",
      dataType: 'json',
      processData:false,
      contentType: false,
      mimeType: 'multipart/form-data',
      data: data,
      success: function (response) {
          alert("Image uploaded Successfully");
          document.getElementById(btn_do_file).style.backgroundColor='green';
          file = "/media/Inspection/" + response.file;
          document.getElementById(txt_img).value = file;
          document.getElementById(frameid).src = file;
          document.getElementById(btn_do_file).disabled = true;
          document.getElementById(btn_reset).disabled = false;
          preview_img(id);

          
          
      }
  });

}



</script>




<script>

var curr_span_id='',table_data=[];
function get_table_data(val)
  {
            id = val.id;
            id1=id.substring(3,id.length)
            spanid = 'span'+id1;
            curr_span_id = spanid;
            if(table_data.includes(id1))
            {
              alert('Table already Present');
              return false;
            }
            document.getElementById('addtablemodal').click();       
  }
////   start table delete code
var global_tblid,global_id1,delete_type;
  function open_modal_delete()
  {
    document.getElementById("noofrowsdel").readOnly = true;
    document.getElementById("noofcoldel").readOnly = true;
    document.getElementById("noofrowsdel").value = '';
    document.getElementById("noofcoldel").value = '';
    document.getElementById("table_checked").checked = true;
    document.getElementById('deltablemodal').click();

  }
  function fun_set_del_table(val)
  {
    delete_type = val;
    document.getElementById("noofrowsdel").readOnly = true;
    document.getElementById("noofcoldel").readOnly = true;
    document.getElementById("noofrowsdel").value = '';
    document.getElementById("noofcoldel").value = '';
    if(val == 'row')
      document.getElementById("noofrowsdel").readOnly = false;
    else if(val == 'column')
      document.getElementById("noofcoldel").readOnly = false;
  }
  function delete_table()
  {
    if(!confirm('Are you sure to delete'))
    {
      return false;
    }

    var tbldel = document.getElementById(global_tblid);
    var row_len = tbldel.rows.length;
    var col_len = tbldel.rows[0].cells.length;

    if(delete_type == 'table')
    {
          if(tbldel == null)
            alert('Nothing to delete')
          if(tbldel) tbldel.parentNode.removeChild(tbldel);
          index = table_data.indexOf(global_id1);
          if (index > -1) { 
            table_data.splice(index, 1); 
          }
    }
    else if(delete_type == 'row')
    {
        let noofrows = document.getElementById('noofrowsdel').value;
        if(noofrows == '')
        {
          alert('Enter No of Rows');
          return false;
        }
        if(parseInt(noofrows)<=0)
        {
          alert('Row should be greater than zero');
          return false;
        }
        if(parseInt(noofrows) > row_len)
        {
          alert('Row should not be greater than Number of Rows');
          return false;
        }
        tbldel.deleteRow(parseInt(noofrows)-1);
        if(row_len == 1)
        {
          if(tbldel == null)
            alert('Nothing to delete')
          if(tbldel) tbldel.parentNode.removeChild(tbldel);
          index = table_data.indexOf(global_id1);
          if (index > -1) { 
            table_data.splice(index, 1); 
          }
        }
    }
    else
    {
      let noofcolumns = document.getElementById('noofcoldel').value;
      if(noofcolumns == '')
        {
          alert('Enter No of Columns');
          return false;
        }
        if(parseInt(noofcolumns)<=0)
        {
          alert('Column should be greater than zero');
          return false;
        }
        if(parseInt(noofcolumns) > col_len)
        {
          alert('Column should not be greater than Number of Column');
          return false;
        }

        for (var i = 0; i < row_len; i++) 
        {
          tbldel.rows[i].deleteCell(parseInt(noofcolumns)-1);
        }


        if(col_len == 1)
        {
          if(tbldel == null)
            alert('Nothing to delete')
          if(tbldel) tbldel.parentNode.removeChild(tbldel);
          index = table_data.indexOf(global_id1);
          if (index > -1) { 
            table_data.splice(index, 1); 
          }
        }
    }
    document.getElementById('closedelmodal').click();
    document.getElementById("global_tblid").style.width = "100%";

  }

  function remove_table_data(val)
  {
          id = val.id;
          id1=id.substring(3,id.length)
          spanid = 'span'+id1;
          curr_span_id = spanid;
          idtbl = 'tbl'+curr_span_id;

          var tbldel = document.getElementById(idtbl);
          if(tbldel == null)
          {
            alert('Nothing to delete');
            return false;
          }
          global_tblid = idtbl;
          global_id1 = id1;
          delete_type = 'table';
          open_modal_delete();

          // var tbldel = document.getElementById(idtbl);
          // if(tbldel == null)
          //   alert('Nothing to delete')
          // if(tbldel) tbldel.parentNode.removeChild(tbldel);
          // index = table_data.indexOf(id1);
          // if (index > -1) { 
          //   table_data.splice(index, 1); 
          // }
  }

////   end table delete code


function setspantable()
  {
        noofrows = document.getElementById('noofrows').value;
        noofcolumns = document.getElementById('noofcolumns').value;
        id1=curr_span_id.substring(4,curr_span_id.length)
        if(noofrows == '')
        {
          alert('Enter No of Rows');
          return false;
        }
        if(noofcolumns == '')
        {
          alert('Enter No of Columns');
          return false;
        }
        if(parseInt(noofrows)<=0)
        {
          alert('Row should be greater than zero');
          return false;
        }
        if(parseInt(noofcolumns)<=0)
        {
          alert('Column should be greater than zero');
          return false;
        }
        if(parseInt(noofrows)>50)
        {
          alert('Row should be Less than 50');
          return false;
        }
        if(parseInt(noofcolumns)>20)
        {
          alert('Column should be Less than 20');
          return false;
        }
        table_data.push(id1);
        
        idtbl = 'tbl'+curr_span_id;
        obj1='<table border="1" id="'+idtbl+'">';
        noofrows =parseInt(noofrows);
        noofcolumns =parseInt(noofcolumns);
        for(i=0;i<noofrows;i++)
        {
          obj1+='<tr>';
          for(j=0;j<noofcolumns;j++)
          {
            id_data='tbl'+curr_span_id+String(i)+String(j);
            obj1+='<td><input type="text" id="'+id_data+'"></td>';
          }
          obj1+='</tr>';
        }
        document.getElementById(curr_span_id).innerHTML = obj1;
        document.getElementById('closespanid').click();
        
      }

</script>



    <script>
 $(document).ready(function(){
  $('#section').hide()
  $('#orlType').hide()
  fun_en_dl('')
 })
function fun_en_dl(val)
{
  locs_val=$('#locationType').val()
  val=locs_val
  if(String(val).length > 0)
  {
    $('#location').attr('disabled', false);
    locs_val=$('#locationType').val()
    if (locs_val.includes('SEM')){
      $('#section').show()
    }
    else $('#section').hide()
    if (locs_val.includes('ORL')){
      $('#orlType').show()
    }
    else $('#orlType').hide()
    
  }
  else{
    $('#location').attr('disabled', true);
    $('#location').empty();
    $('#section').hide()
  }

}
    
function showSection(){
  // $("#from_sttn").select2();
  $("#to_sttn").select2({
        minimumInputLength: 0,
        language: {
            inputTooShort: function() {
              return 'Please Add One or More Station';
            }
          },
        ajax: {
            url: '{% url "get_station_names" %}',
            dataType: 'json',
            type: "GET",
            quietMillis: 50,
            data: function (term) {
              let rly_zone = JSON.stringify($('#zone').val())
              let division_id = JSON.stringify($('#division').val())
                return {
                    last_val: term.term,
                    rly_zone: rly_zone,
                    division_id : division_id
                }; 
            },
            processResults: function (data) {
              
                return {
                    results: $.map(data, function (item) {
                 
                        return{
                          text: item.city,
                          
                          id: item.city+'#'+item.table_from+'#'+ item.loc_code,
                          
                        }
                    })
                };
              }, 
        }
    });
  $("#from_sttn").select2({
        minimumInputLength: 0,
        language: {
            inputTooShort: function() {
              return 'Please Add One or More Station';
            }
          },
        ajax: {
            url: '{% url "get_station_names" %}',
            dataType: 'json',
            type: "GET",
            quietMillis: 50,
            data: function (term) {
              let rly_zone = JSON.stringify($('#zone').val())
              let division_id = JSON.stringify($('#division').val())
                return {
                    last_val: term.term,
                    rly_zone: rly_zone,
                    division_id : division_id
                }; 
            },
            processResults: function (data) {
              
                return {
                    results: $.map(data, function (item) {
                 
                        return{
                          text: item.city,
                          
                          id: item.city+'#'+item.table_from+'#'+ item.loc_code,
                          
                        }
                    })
                };
              }, 
        }
    });


}  

function save_section(){
  var from_sec= $('#from_sttn').val()
  var to_sec= $('#to_sttn').val()
  var from_arr=String(from_sec).split('#')[0]
  var to_arr=String(to_sec).split('#')[0]
  var new_sec;
  if (from_arr==to_arr){
    alert("Cannot add Section")
  }
  else{
    new_sec=from_arr+'-'+to_arr
    if (String($('#sectionsadded').val()).length >0)
    var textval=$('#sectionsadded').val()+','+new_sec;
    else
    var textval=new_sec;
    $('#sectionsadded').val(textval);

  }
  var loc= $('#location').val()
}

function save_orl(){
  var new_sec= $('#orlNew').val()
  $('#orlNew').empty()
    if (String($('#ORLsadded').val()).length >0)
    var textval=$('#ORLsadded').val()+','+new_sec;
    else
    var textval=new_sec;
    $('#ORLsadded').val(textval);
  var loc= $('#location').val()
}

function add_section(){
  var loc= $('#location').val()
  var new_locs=$('#sectionsadded').val()
  var new_locs_arr=String(new_locs).split(',')
  $('#location').empty()
  for (var l=0;l<loc.length;l++){
    loc_array=String(loc[l]).split('#')
    $('#location').append(`<option value="${loc[l]}" selected> ${loc_array[0]}</option>`);
  }
  for (var l=0;l<new_locs_arr.length;l++){
    $('#location').append(`<option value="${new_locs_arr[l]}#SEM#0" selected> ${new_locs_arr[l]}</option>`);
  }
}

function add_ORL(){
  var loc= $('#location').val()
  var new_locs=$('#ORLsadded').val()
  var new_locs_arr=String(new_locs).split(',')
  $('#location').empty()
  for (var l=0;l<loc.length;l++){
    loc_array=String(loc[l]).split('#')
    $('#location').append(`<option value="${loc[l]}" selected> ${loc_array[0]}</option>`);
  }
  for (var l=0;l<new_locs_arr.length;l++){
    $('#location').append(`<option value="ORL-${new_locs_arr[l]}#ORL#0" selected> ${new_locs_arr[l]}</option>`);
  }
}
</script>
    
    
    <script>
    
    var globallistgm='';
    var globallistbm='';
    var globallistbo='';
    var globallistpanel='';
    var globallistdrm='';
    var globallistphod='';
    
    function auto(inp, arr) {
      var currentFocus;
      inp.addEventListener("input", function(e) {
          var a, b, i, val = this.value;
          closeAllLists();
          if (!val) { return false;}
          currentFocus = -1;
          a = document.createElement("DIV");
          a.setAttribute("id", this.id + "autocomplete-list");
          a.setAttribute("class", "autocomplete-items");
        
          this.parentNode.appendChild(a);
       
          for (i = 0; i < arr.length; i++) {
    
            if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
              
              b = document.createElement("DIV");
           
              b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
              b.innerHTML += arr[i].substr(val.length);
            
              b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
           
                  b.addEventListener("click", function(e) {
            
                  inp.value = this.getElementsByTagName("input")[0].value;
                  
                  closeAllLists();
                  
              });
              a.appendChild(b);
            }
          }
      });
    
      inp.addEventListener("keydown", function(e) {
          var x = document.getElementById(this.id + "autocomplete-list");
          if (x) x = x.getElementsByTagName("div");
          if (e.keyCode == 40) {
            
            currentFocus++;
            
            addActive(x);
          } else if (e.keyCode == 38) { 
          
            currentFocus--;
           
            addActive(x);
          } else if (e.keyCode == 13) {
         
            e.preventDefault();
            if (currentFocus > -1) {
            
              if (x) x[currentFocus].click();
            }
          }
      });
      function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
      
        x[currentFocus].classList.add("autocomplete-active");
      }
      function removeActive(x) {
       
        for (var i = 0; i < x.length; i++) {
          x[i].classList.remove("autocomplete-active");
        }
      }
      function closeAllLists(elmnt) {
       
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
          if (elmnt != x[i] && elmnt != inp) {
          x[i].parentNode.removeChild(x[i]);
        }
      }
    }
    
    document.addEventListener("click", function (e) {
        closeAllLists(e.target);
    });
    }
    
    
    </script>
          
    <script>
      var hli = 0
      var sli = []
      
      var ssli = []
      
    
  
         
    </script>



    <script>
     



    
        function Savedraft_data(exitcontinue)
          { 
            del_array = del_array.filter(onlyUnique);
         
            var table = document.getElementById("addworkmech");
            var zone=$("#zone").val();
            var division=$("#division").val();
            var department=$('#department').val();
            var inspection_date=$('#txtDate2').val();
            var insp_type=$('#insp_type').val();
            var item_sections = 0;
            let sec_details={}
            let sec_ids = {}



            hli = 0,full_array=[];
            for(let i=0;i<table.rows.length;i++)
            {
              if(table.rows[i].cells[0].innerHTML == 'P')
                hli++;
              if (table.rows[i].cells[0].innerHTML == 'S')
                item_sections=1
              full_array.push(table.rows[i].cells[1].innerHTML)
            }

            let ar ={}
            let id_ar=[]
            let sec_id_ar={}
            let ar1 = {},paradata;
            let myarr2 = {};
            if (item_sections==1){
              
              for(let j=0; j<full_array.length; j++)
              {
                paradata = para_array[j] 
                let temp = String(full_array[j].split('.'))
                let temp1 = full_array[j].split('.')
                // alert(temp)
                if (temp1.length == 1 && (temp.charCodeAt(0)>=65 && temp.charCodeAt(0)<=90 )){
                    headid = String(temp);
                    let hid='location_at'+ String(paradata);
                    let hid1='location_at'+ headid;
                    // alert(hid)
                    var val = document.getElementById(hid).value;
                    ar[hid1]=val
                  }
              }
              
              for (let j=0; j<full_array.length; j++)
              {
                let temp = full_array[j].split('.')
                
                if (temp.length == 1){
                 
                  temp = String(temp)
                  if (temp.charCodeAt(0)>=65 && temp.charCodeAt(0)<=90 ){
                    section1=temp
                    id_ar=[]
                  }
                  else{
                    id_ar.push(temp)
                  }
                  sec_id_ar[section1]=id_ar
                }
              }
            }


            sec_details=JSON.stringify(ar)
            sec_ids=JSON.stringify(sec_id_ar)
    
    
            
            for(let i=1; i<=hli; i++){
              let ar ={}
              let myar1 = []

              for(let j=0; j<full_array.length; j++)
              {
                paradata = para_array[j]
                if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.'){
                
                  let temp = full_array[j].split('.')
                  myar1.push(String(full_array[j]))
                  
                  if(temp.length == 1){
                    let hid='heading'+ String(paradata);
                    var val = document.getElementById(hid).value;
                    let hid1='heading'+ full_array[j];
                    ar[hid1]=val
                    
                    if(val == '' && !(del_array.includes(paradata))){
                      alert('Please fill some data in inspection para')
                      document.getElementById(hid).focus()
                      return false;
                    }

                    // for type of action
                    // let typeofaction = 'type'+ String(paradata);
                    // let action_val = document.getElementById(typeofaction);
                    
                    // if (action_val.checked == true){
                    //   var selected_action= "info"
                    // }
                    // else{
                    //   var selected_action= "action"
                    // }
                    // let action1='type'+ full_array[j];
                    // ar[action1]=selected_action

                    let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  if(cellVal =='')
                                  {
                                    alert('Please fill Table Data');
                                    return false;
                                  }
                              }
                              table_det.push(table_det1)
                            }
                      }
                          ar[full_array[j]]=table_det;


                        
                      d1_test = full_array[j]+'.'
                      var result_test = full_array.filter(option => option.startsWith(d1_test));
                      
                        d2_test = 'Yes'
                        for(iv=j+1;iv<table.rows.length;iv++)
                          {
                            if(table.rows[iv].cells[0].innerHTML == 'P' || table.rows[iv].cells[0].innerHTML == 'S')
                            {
                              break;
                            }
                            if(del_array.includes(para_array[iv]))
                            {
                              d2_test = 'Yes'
                            }
                            else
                            {
                              d2_test ='No'
                              break
                            }
                          }
                      // alert(d2_test)
                      if(d2_test == 'No')
                      {
                        a=1;
                      }
                    else{
                        
                        // let td = 'targetdate' + String(paradata);
                        let mf = 'markeofficer' + String(paradata);
                        let ity = 'item_type'+String(paradata);
                        // let chk = 'check'+ String(paradata);
                        
                        let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  if(cellVal =='')
                                  {
                                    alert('Please fill Table Data');
                                    return false;
                                  }
                              }
                              table_det.push(table_det1)
                            }
                      }
                          ar[full_array[j]]=table_det;
                        // var tddate = document.getElementById(td).value;
                        // let chk_val = document.getElementById(chk)
                          
                        //   if (chk_val.checked == true){
                        //       var checkbox = '1'
                        //       //alert(checkbox)
                        //   }
                        //   else if (chk_val.checked == false){

                        //     checkbox = '0'
                            
                        //   }
                        // alert("herllo")
                        var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                        var officer_info = document.getElementById(mf).getAttribute('custom-info');
                        
                        var itemtype = document.getElementById(ity).value;
                        let it = 'item_type' + full_array[j]
                        
                        // let td1 = 'targetdate' + full_array[j];
                        let mf1 = 'markeofficer' + full_array[j];
                        let mf2 = 'markeofcinfo' + full_array[j];
                        // let chk1 = 'check' + full_array[j];
                        // ar[td1]=tddate
                        ar[mf1]=officer_val
                        ar[mf2]=officer_info
                        ar[it]=itemtype
                        // ar[chk1]=checkbox  
                          
                        // let rema = 'remarksmarkeofficer' + String(paradata);
                        // var remarks = document.getElementById(rema).value;
                        // let rem = 'remarksmarkeofficer' + full_array[j];
                        // ar[rem]=remarks
                        // ar[td]=tddate
                        // ar[mf]=officer_val
                        // ar[chk]=checkbox     
                    }
    
                    
                    
              
                  }
                  else if(temp.length == 2){
                    let sid='heading'+String(paradata);
                    // let td = 'targetdate' + String(paradata);
                    let mf = 'markeofficer' + String(paradata);
                    let ity = 'item_type'+String(paradata);
                    // let chk = 'check'+ String(paradata);

                    
    
                    var val1 = document.getElementById(sid).value;
                    // var tddate = document.getElementById(td).value;
                    let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  if(cellVal =='')
                                  {
                                    alert('Please fill Table Data');
                                    return false;
                                  }
                              }
                              table_det.push(table_det1)
                            }
                      }
                          ar[full_array[j]]=table_det;
                    // let chk_val = document.getElementById(chk)
                    //       if (chk_val.checked == true){
                    //           var checkbox = '1'
                    //       }
                    //       else if (chk_val.checked == false){
                    //         checkbox = '0'
                    //       }
                    var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                    var officer_info = document.getElementById(mf).getAttribute('custom-info');
                    var itemtype = document.getElementById(ity).value;
                    
                    let sid1='observation'+full_array[j];
                    // let td1 = 'targetdate' + full_array[j];
                    let mf1 = 'markeofficer' + full_array[j];
                    // let chk1 = 'check' + full_array[j];
                    let mf2 = 'markeofcinfo' + full_array[j];
                    let it = 'item_type' + full_array[j]
                    
                    ar[sid1]=val1
                    // ar[td1]=tddate
                    ar[mf1]=officer_val
                    // ar[chk1]=checkbox   
                    // let rema = 'remarksmarkeofficer' + String(paradata);
                    // var remarks = document.getElementById(rema).value;
                    // let rem = 'remarksmarkeofficer' + full_array[j];
                    // ar[rem]=remarks
                    ar[mf2]=officer_info
                    ar[it]=itemtype

                    if(val1 == '' && !(del_array.includes(paradata))){
                      alert('Please fill some data in inspection sub para')
                      document.getElementById(sid).focus();
                      return false;
                    }
                    // for type of action
                    // let typeofaction = 'type'+ String(paradata);
                    // let action_val = document.getElementById(typeofaction);
                    
                    // if (action_val.checked == true){
                    //   var selected_action= "info"
                    // }
                    // else{
                    //   var selected_action= "action"
                    // }
                    // let action1='type'+ full_array[j];
                    // ar[action1]=selected_action
                  }
                  else{
                    let ssid='heading'+String(paradata);
                    var val2 = document.getElementById(ssid).value;
                    if(val2 == ''  && !(del_array.includes(paradata))){
                      alert('Please fill some data in inspection sub Subpara')
                      document.getElementById(ssid).focus();
                      return false;
                    }
                    let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  if(cellVal =='')
                                  {
                                    alert('Please fill Table Data');
                                    return false;
                                  }
                              }
                              table_det.push(table_det1)
                            }
                      }
                          ar[full_array[j]]=table_det;

                          let ssid1='subdes'+full_array[j];   
                    ar[ssid1]=val2
                    // for type of action
                    // let typeofaction = 'type'+ String(paradata);
                    // let action_val = document.getElementById(typeofaction);
                    
                    // if (action_val.checked == true){
                    //   var selected_action= "info"
                    // }
                    // else{
                    //   var selected_action= "action"
                    // }
                    // let action1='type'+ full_array[j];
                    // ar[action1]=selected_action
    
                    
                  }
                  
                }
              }
              
              ar1[String(i)]=ar
              myarr2[String(i)]=myar1
            }
        
          
        var final_p=JSON.stringify(ar1)
        var id_final = JSON.stringify(myarr2)
        
        if(zone =='' || zone == null){
          alert("Please fill Rly/Org ")
          return false;
        }
        
        
        
        if(inspection_date=='' || inspection_date==undefined){
            alert("Please fill date of inspection ")
            return false;
        }
        if($('#titleinsp').val()==''){
          alert("Please fill title of inspection ")
          return false;
        }
        if($('#sttninsp').val()==''){
          alert("Please fill Station of Inspecting Officer ")
          return false;
        }
        if($('#desiginsp').val()==''){
          alert("Please fill Designation of Inspecting Officer ")
          return false;
        }
        if($('#ofcnameinsp').val()==''){
          alert("Please fill Name of Inspecting Officer ")
          return false;
        }
        
	      // final_p=final_p.replace(/window/gi,'Windows')	
        // final_p=final_p.replace('/&','and')


        let final_img=[],temp_img=[];
        for(let jk=0;jk<img_ref_no.length;jk++)
        {
          temp_img=[]
          let sel_id, txt_id;
          sel_id = document.getElementById('select_img_'+img_ref_no[jk]).value;
          txt_id = document.getElementById('img_text_'+img_ref_no[jk]).value;
          if(sel_id == '')
          {
            alert('select Reference number')
            $('#select_img_'+img_ref_no[jk]).focus();
            return false;
          }
          if(txt_id == '')
          {
            alert('select Image')
            $('#img_text_'+img_ref_no[jk]).focus();
            return false;
          }
          if(!full_array.includes(sel_id))
          {
            alert('select Proper reference number')
            $('#select_img_'+img_ref_no[jk]).focus();
            return false;
          }
          temp_img.push(sel_id);
          temp_img.push(txt_id);
          final_img.push(temp_img);
        }
        final_img = JSON.stringify(final_img);
        

       
        let temp_delarray=[]
        for(let i=0;i<table.rows.length;i++)
            {
              for(let k=0;k<del_array.length;k++)
              {
                if(i == del_array[k])
                  temp_delarray.push(table.rows[i].cells[1].innerHTML)
              }
            }

        let del_array_continue = temp_delarray;
        
        let temp_para_array_marked=[]
        for(let i=0;i<table.rows.length;i++)
            {
              for(let k=0;k<para_array_marked.length;k++)
              {
                if(i == para_array_marked[k])
                {
                  if((String(table.rows[i].cells[1].innerHTML).split('.')).length === 1)
                  {
                    mf1 = 'markeofficer' + String(para_array_marked[k]);
                    let officer_val21 = document.getElementById(mf1).getAttribute('custom-offic');
                    if(officer_val21.length > 0)
                        temp_para_array_marked.push({'id':table.rows[i].cells[1].innerHTML,'officer':officer_val21})
                  }
                }
              }
            }
    
            

            goodWork = 0;
            if($("#goodWork").is(":checked"))
            {
                goodWork = 1;
            }
            
        // $("#draft").attr("disabled", true);

        //return false;
        let data1 = {
            goodWork : goodWork,
            zone: JSON.stringify($('#zone').val()),
            division: JSON.stringify($('#division').val()),
            department: JSON.stringify($('#department').val()),
            location: JSON.stringify($('#location').val()),
            accompany: JSON.stringify($('#accompany').val()),
            txtDate2:$('#txtDate2').val(),
            titleinsp: $('#titleinsp').val(),
            send_to: document.getElementById('copyto').getAttribute('custom-offic'),
            send_desig: document.getElementById('copyto').value,
            final_partinspected:encryptWithAES(final_p),
            id_partinspected:id_final,
            final_img: final_img,
            temp_para_array_marked : JSON.stringify(temp_para_array_marked),
            del_array:JSON.stringify(del_array_continue),
            csrfmiddlewaretoken: '{{ csrf_token }}',
            inspection_no : $('#inspection_id_edit').val(),
            ins_flag : $('#ins_flag_edit').val(),
            insp_desig:$('#desiginsp').val(),
            insp_ofc_name:$('#ofcnameinsp').val(),
            station_name:$('#sttninsp').val(),
            item_sections:item_sections,
            sec_ids:sec_ids,
            sec_details:sec_details,
            insp_type:insp_type,
            full_array:JSON.stringify(full_array),
          };
       
                $.ajax({
                          type: 'POST',
                            url: "{% url 'save_draft_data' %}",
                            dataType: 'json',
                            data: data1,
                            success: function (response) {
                              // $("#draft").attr("disabled", false);
                              if(exitcontinue == 'Exit')
                                window.location.href='{% url "draft_inspection_form" %}';
                              else
                              {
                                $('#inspection_id_edit').val(response.inspection_no);
                                alert('Data Saved as Draft');

                              }
           
                        },
                        error: function (exception) {
                    
                          alert("oops error!");
                }
              
          });
             
    }
    
    function onlyUnique(value, index, array) {
      return array.indexOf(value) === index;
    }
    var globalarrid=[], main=[];
    function remove_save_marked_officers()
    {
      if(globalarrid.length==0)
      {
        alert('Nothing to Remove');
        return false;
      }
      globalarrid.pop();
      main.pop();
    
      document.getElementById('alltext').value=globalarrid;
        
    }
    function add_save_marked_officers(){
      var emp_no = ""
      var emp_no1 = ""
      var table = $('#text').DataTable();
      table.destroy();
      table = $('#text1').DataTable();
      table.destroy();
      var table = $('#text').DataTable();
      table.destroy();
      table = $('#textdesigselect').DataTable();
      table.destroy();
    
      
      let lst1='no';
      let lst2='no';
      $("input[type='checkbox'][name='chktext']:not(:checked)").each(function (){
        lst1='yes';
      });
      $("input[type='checkbox'][name='chktext1']:not(:checked)").each(function (){
        lst2='yes';
      });
      var rly_1=$('#rly_1').val();
      var div_1=$('#div_1').val();
      if(globallistgm!='' && lst1 == 'yes')
      { 
        globallistgm='';
      }
      if(globallistbm!='' && lst1 == 'yes')
      { 
        globallistbm='';
      }
      if(globallistphod!='' && lst1 == 'no')
      { 
          let x='';
          if(rly_1 == '')
            globallistphod=globallistphod;
            else{
          for(ii=0;ii<rly_1.length;ii++)
          {
            x=x+globallistphod+'/'+rly_1[ii]+', ';
          }
          globallistphod=x;}
      }
      else if(globallistphod!='' && lst1 == 'yes')
      { 
        globallistphod='';
      }
      if(globallistdrm!='' && lst2 == 'no')
      { let x='';
          if(rly_1 == '')
            globallistdrm=globallistdrm;
          else{
            for(ii=0;ii<rly_1.length;ii++)
            {
              x=x+globallistdrm+'/'+rly_1[ii]+', ';
            }
    
            globallistdrm=x;}
      }
      else if(globallistdrm!='' && lst2 == 'yes')
      { 
        globallistdrm='';
      }
      let chkdes=0,arrdemp=[],arrsemp=[];
      let g=0,d=0,p=0,b=0,chgdesig ='Y';
      
      $('.messageCheckbox:checkbox:checked').each(function(i){
        //val[i] = $(this).val();
        let oneOffic= $(this).val();
        let id = oneOffic.split(',')[0]
        let desig = oneOffic.split(',')[1]
        
        
        chkdes=0;
        if(desig.startsWith("DRM/") && chgdesig == 'Y')
        {
          chgdesig = 'N';
          if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }
        }
        if(globallistgm!='' )
        {
              $("input[type='checkbox'][name='chktext']:checked").each(function (){
                    if(desig == $(this).val().split(',')[1])
                    chkdes=1;
              });
              if(g==0)
              { 
                g=1;
                if(emp_no1!="")
                  emp_no1+=',';
              emp_no1 +=globallistgm;
    
              if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }
                      
            }
        }
        else if(globallistbm!=''  )
        {
                $("input[type='checkbox'][name='chktext']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                      chkdes=1;
                });
                if(g==0){ g=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistbm;
                if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
        else if(globallistphod!='' )
        {
          $("input[type='checkbox'][name='chktext']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                      chkdes=1;
                });
                if(p==0){ p=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistphod;
                if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
     
        if(globallistdrm!=''  && desig.startsWith("DRM/"))
        {
          $("input[type='checkbox'][name='chktext1']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                        chkdes=1;
                });
                if(d==0){ d=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistdrm;
               
                    if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
        if(chkdes == 0)
        {
          if(arrsemp.length != 0)
          {
            arrdemp.push(arrsemp);
          }
          arrsemp=[]
          if(emp_no1!="")
                    emp_no1+=',';
          emp_no1 +=desig;
         
          if(emp_no!="")
              emp_no+=',';
          emp_no +=id;
          arrsemp.push(id);
          
        }
        else
        {
          if(emp_no!="")
              emp_no+=',';
          emp_no +=id;
          arrsemp.push(id);
          
        }
        
      });
      arrdemp.push(arrsemp);
      if(emp_no == '')
      {
        alert('Select Checkbox To add');
        $('#text').DataTable();
        $('#text1').DataTable();
        $('#textdesigselect').DataTable();
        return false;
      }
      
        let chkemp_no1=emp_no1.split(',');
        let chkemp_no=emp_no.split(',');
    
        if(document.getElementById('alltext').value!='')
            globalarrid=(document.getElementById('alltext').value).split(',');
        // for(let ij=0;ij<chkemp_no1.length;ij++)
        // {
        //     if(globalarrid.includes(String(chkemp_no1[ij])))
        //     {
        //       alert(chkemp_no1[ij]+' is already previously added ..');
        //     }
        //     else
        //     {
        //       main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
        //       globalarrid.push(chkemp_no1[ij]);
        //     }
        // }
        // document.getElementById('alltext').value=globalarrid;
        

        
    //////////////////  changed
    let prevpost='',prevchk=0;

for(let ij=0;ij<chkemp_no1.length;ij++)
{
  //alert(chkemp_no1[ij]);
    if(globalarrid.includes(String(chkemp_no1[ij])))
    {
      if (prevpost!='')
        prevpost=prevpost+', ';
      prevpost=prevpost+chkemp_no1[ij];
      prevchk=1;
      //alert(chkemp_no1[ij]+' is already previously added ..');
    }
    
    else if(chkemp_no1[ij] == "All GM's/ZR")
    {
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm].substring(0,3)=='GM/')
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }

      }
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);

    }
    else if(chkemp_no1[ij].substring(0,3)=='GM/')
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All GM's/ZR")
        {
          chkcgm=1
        }

      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
          prevpost=prevpost+', ';
        prevpost=prevpost+chkemp_no1[ij];
        prevchk=1;
      }

    }

    else if(chkemp_no1[ij] == "All DRM's")
    {
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm].substring(0,4)=='DRM/')
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }
        else if(globalarrid[cgm].substring(0,10)=="All DRM's/")
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }

      }
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);

    }

    else if(chkemp_no1[ij].substring(0,4)=='DRM/')
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All DRM's")
        {
          chkcgm=1
        }
        else if(globalarrid[cgm].substring(0,10)=="All DRM's/")
        {
          for(drmi=0;drmi<main[cgm]['designation_code'].length;drmi++)
          {
            if(chkemp_no.includes(main[cgm]['designation_code'][drmi]))
            {
              chkcgm=1;
              break;
            }

          }
        }
      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
            prevpost=prevpost+', ';
          prevpost=prevpost+chkemp_no1[ij];
          prevchk=1;
      }
    }
    
    else if(chkemp_no1[ij].substring(0,10)=="All DRM's/")
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All DRM's")
        {
          chkcgm=1
        }
      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
            prevpost=prevpost+', ';
          prevpost=prevpost+chkemp_no1[ij];
          prevchk=1;
      }
    }
    else
    {
      main.push({'desig':chkemp_no1[ij],'designation_code':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
    }
}



if(prevchk==1)
{
  alert('Following Post Are already Present '+prevpost);
}
for(let remi=globalarrid.length-1;remi>=0;remi--)
{
  if(globalarrid[remi].length==0 || globalarrid[remi]==' ')
        {
          globalarrid.splice(remi,1);
          main.splice(remi,1);
        }

}
//////////////////  changed
document.getElementById('alltext').value=globalarrid;


        
    
      ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            } 
    
      ele=document.getElementsByName('chk');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }
    
      ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            } 
  //////////////////  changed
            ele=document.getElementsByName('chkdesig');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        }
//////////////////  changed


      globallistdrm='';
      globallistgm='';
      globallistphod='';
      globallistbm='';
      document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
      document.getElementById('allbo').checked=false;
      document.getElementById('allpanel').checked=false;
    
      document.getElementById('rly_1').value='';
      document.getElementById('div_1').value='';
      document.getElementById('dept_1').value='';
      document.getElementById('desig').value='';
        $('#text').DataTable();
        $('#text1').DataTable();
        $('#textdesigselect').DataTable();
      
    }
    
    
    /////////////////////////////    end 03/08/22   
    function save_marked_officers(){
     let emp_no='',emp_no1='';
      for(i=0;i<main.length;i++)
      {
        if(emp_no1!="")
            emp_no1+=',';
          emp_no1+=main[i].desig;
        
        
        if(emp_no!="")
            emp_no+=',';
          emp_no+=main[i].designation_code;
      }
      let emono34 = emp_no.split(',');
      emp_no = '';
      for(let i =0;i<emono34.length;i++)
      {
        //alert(emono34[i])
            if(emono34[i] != 'undefined')
            {
              if(emp_no!="")
                  emp_no+=',';
              emp_no+=emono34[i];
            }

      }
    
      let mark_off = $('#mark_officersss').val();
    
      if(mark_off=='Copy To'){
        // alert(main)    
        document.getElementById('copyto').value=emp_no1;
        var myInput = document.getElementById('copyto');
            myInput.setAttribute('custom-offic', emp_no);
        let Y = document.getElementById('copyto').scrollHeight
        document.getElementById('copyto').style.height =(10+Y)+"px";
    
    
        var myInput = document.getElementById('copyto');
            myInput.setAttribute('custom-key', main);

      let cop = $('#copyto').attr('custom-offic')
      let new_cop = cop.split(',')
      $('#copy_desgn').selectpicker('val', new_cop)
    
      }
      else{
        markofficer='markeofficer'+ mark_off;

        document.getElementById(markofficer).value=emp_no1;
        var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-offic', emp_no);
    
            let x = document.getElementById(markofficer).scrollHeight;
            document.getElementById(markofficer).style.height =(10+x)+"px";
    
    
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-key', JSON.stringify(main));


                let test=mark_off.split('.');
                let testid='';
                for(let ii=0;ii<test.length;ii++)
                {
                  if(ii==0)
                    testid=String(test[ii]);
                  else
                    testid=testid+'a'+String(test[ii]);
                }
                id='btndel'+testid;
               
              document.getElementById(id).click();
              emp_no=emp_no.split(',');
              emp_no11=emp_no1.split(',');



              $(`#desgn${testid}`).selectpicker("destroy");
                for(let ij =0;ij<emp_no.length;ij++)
                {
                  if($(`#desgn${testid} option[value='${emp_no[ij]}']`).length <= 0)
                  {
                    
                    tkn = emp_no[ij].replace('/',' ');
                   
                    $(`#desgn${testid}`).append(`<option value="${emp_no[ij]}" data-tokens="${tkn}">${emp_no11[ij]}</option>`);
                    
                  }
                }
                var officer='officer'+testid;
                $(`.desgn${testid}`).selectpicker();	
                  $(`.desgn${testid}`).removeClass("dropdown");	
                  var button = $(`#divdesgn${testid} .bs-actionsbox .btn-group`);	
                  button.append(`<button type="button" id="bdesgn${testid}" class="btn btn-default btn-light" onclick="getOption('desgn${testid}')" hidden>Save</button>`)	
                  button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${testid}');">Go/Close</button>`)	
                  button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);	
                  button.append(`<button type="button" id="btndel${testid}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)	
                   
                  

                  $(`#desgn${testid}`).on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue){	
                    let his_id= this.id;
                      getOption(`${his_id}`);
                      });	
                  function removePopupForBtn(el){	
                      let idpattern = '#'+el +' '+'.bootstrap-select'	
                      $(idpattern).removeClass('show')	
                    };
              
             $(`.desgn${testid}`).selectpicker('val', emp_no);
            
      }
      $('#close1').click();
    }
          
    </script>
 
 
    
    
    <script>
    
    
    
    
        function select1(id){  
          var table = $('#text1').DataTable();
          table.destroy();
          if(id.checked)
          {
            var ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=true;  
            }  
            var table = $('#text1').DataTable();
          }
          else
          {
            var ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            var table = $('#text1').DataTable();
          }
        }  
        function select21(id){  
          var table = $('#text').DataTable();
          table.destroy();
          if(id.checked)
          {
            var ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=true;  
            }  
            var table = $('#text').DataTable();
          }
          else
          {
            var ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            var table = $('#text').DataTable();
          }
        }  
        // function deSelect(){ 
        //   var table = $('#text').DataTable();
        //   table.destroy(); 
        //     var ele=document.getElementsByName('chk');  
        //     for(var i=0; i<ele.length; i++){  
        //         if(ele[i].type=='checkbox')  
        //             ele[i].checked=false;  
        //     }  
        //     var table = $('#text').DataTable();
    
        //     document.getElementById('chkselect').checked=false;
        // }       
       
       
      
    </script>
        
    <script>
    var globaldiv='';
    function setvalueIN(){
    
      $("#alltext").css({"height": "50px",});
      main=[];
      globalarrid=[];
    
      let zone = $('#zone').val();
      $('#rly_1').val(zone);
    
    var arrayArea = $('#department').val();
    $('#dept_1').select2({}).select2('val', arrayArea);
    $('#desig').val('');
    $('#desig').select2().trigger('change');
      if($('#division').val()!='')
        globaldiv=$('#division').val();
      $('#rly_1').select2().trigger('change');
    
    
      let mark_off = $('#mark_officersss').val();
      
    if(mark_off=='Copy To'){
        
        var myInput = document.getElementById('copyto');
        var officer_val11=myInput.getAttribute('custom-key');
        document.getElementById('alltext').value=document.getElementById('copyto').value;
    }
    else{
      
          markofficer='markeofficer'+ mark_off
          var myInput = document.getElementById(markofficer);
          var officer_val11=myInput.getAttribute('custom-key');
          document.getElementById('alltext').value=document.getElementById(markofficer).value;   
    }
    if((document.getElementById('alltext').value).length>0)
    {
      globalarrid=String(document.getElementById('alltext').value).split(',');
      main=JSON.parse(officer_val11);
    }
    
    
      
    }
    
    function setCopyValue()
    {
      $("#alltext").css({"height": "50px",});

      $('#mark_officersss').val('Copy To')
    
    }
    
    
    function hidetable(e){
      $('#text').show(); $('#text1').hide(); $('#table3').hide(); $('#table4').hide(); $('#table5').hide();
      $('#mark_officersss').val((e.id).substr(7));
    }
    


    $("#zone").select2();
    $("#zone").next(".select2").mouseenter(function() {
      $('body').trigger('mousedown');
      $("#zone").select2('open');
    });  

//   $('#zone').on('change', function() {
//     var selected = $(this).val().length;
//     var of = $(this).find('option').length;
//       $(this).parent().find('.select2 .select2-selection ul').html('Selected ' + selected + ' of ' + of +'  items.')
// });

 
    $(document).on('mouseleave', '.select2-container .select2-dropdown', function(e) {
    var selectId = $(this).find("ul").attr('id').replace("select2-", "").replace("-results", "");
    $("#"+selectId).select2("close");
    });


    // $(document).on('mouseleave', '.select2-search__field', function(e) {
    //   // if($('.select2-container').mouseenter == false)
    //   //   {
    //   //     $('body').trigger('mousedown');
    //   //   }
    //   var element = document.querySelector('.select2-container .select2-dropdown');
    //   alert(element)
    //     if (element.mouseenter) {
    //     }
    // });
   
              
    // Read selected option
    $('#rly').click(function(){
      var username = $('#rly option:selected').text();
      var userid = $('#rly').val();
                    
                       
                        
    });
    
    $("#rly_1").select2();
              
              // Read selected option
    $('#rly_1').click(function(){
      var username = $('#rly_1 option:selected').text();
      var userid = $('#rly_1').val();
                             
    });
    
    $("#div_1").select2();
              
    // Read selected option
    
    $('#div_1').click(function(){
      var username = $('#div_1 option:selected').text();
      var userid = $('#div_1').val();
    });
    
    $("#division").select2();
              
    $("#division").next(".select2").mouseenter(function() {
      $('body').trigger('mousedown');
      $("#division").select2('open');
    });  

    $("#insp_type").select2();
              
    $("#insp_type").next(".select2").mouseenter(function() {
      $('body').trigger('mousedown');
      $("#insp_type").select2('open');
    });  

    // $('#insp_type').hover(function() {
      
    //     $(this).attr('size', document.getElementById("insp_type").options.length);
    //     }, function() {
    //     $(this).attr('size', 1);
    // });
    // $('#zone').hover(function() {
    //     $(this).attr('size', $('option').length);
    //     }, function() {
    //     $(this).attr('size', 1);
    // });

    $('#division').click(function(){
      var username = $('#div option:selected').text();
      var userid = $('#div').val();
    });
    
    $("#department").select2();
              
    $('#department').click(function(){
        var username = $('#department option:selected').text();
        var userid = $('#department').val();
    });
    
    //////////////////////////////////////////////
    $('#desig').select2()
    
    var globaldesigid=[];
    
    
    function selordesel(id)
    {
          var table = $('#textdesig').DataTable();
          table.destroy();
          var table1 = $('#textdesigselect').DataTable();
          table1.destroy();
         
          if(id.checked)
          {
            globaldesigid=[];
            $('#textdesigselect tbody').empty();
            var row='';
            var ele=document.getElementsByName('chkdesig');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox') 
                   {
                    ele[i].checked=true; 
                    let id=ele[i].id;
                    val=ele[i].value;
                    val=val.split(',')
                    globaldesigid.push(id.substring(2,id.length));
                    row += "<tr id='trid"+id+"'>";  
                    row+=  '<td hidden><input checked type="checkbox" id="'+val[0]+'" class="messageCheckbox" value="'+(val[0]+','+val[1])+'" name="chk" ></td>';
                    row += '<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="'+val[0]+'" hidden>'+val[0]+'</td>';
                    row += '</tr>';
                
                   } 
            }  
            $('#textdesigselect tbody').append(row);
            var table1 = $('#textdesigselect').DataTable();
            var table = $('#textdesig').DataTable();
          }
          else 
          {
            var ele=document.getElementsByName('chkdesig');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            globaldesigid=[];
            $('#textdesigselect tbody').empty();
            var table1 = $('#textdesigselect').DataTable();
            var table = $('#textdesig').DataTable();
          }       
    }
    
    function selectdesig(val)
    {
      let id=val.id;
      val=val.value;
      
      var table = $('#textdesigselect').DataTable();
      table.destroy();
      val=val.split(',');
      var row='';
      if(document.getElementById(id).checked==true)
          {
            globaldesigid.push(id.substring(2,id.length));
              row += "<tr id='trid"+id+"'>";  
                  row+=  '<td hidden><input checked type="checkbox" id="'+val[0]+'" class="messageCheckbox" value="'+(val[0]+','+val[1])+'" name="chk" ></td>';
                row += '<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="'+(val[2]+','+val[1])+'" hidden>'+(val[2]+','+val[1])+'</td>';
                row += '</tr>';
                $('#textdesigselect tbody').append(row);
                var table = $('#textdesigselect').DataTable();
          }
          else 
          {
            let id1=id.substring(2,id.length);
            id='trid'+id;
    
                index = globaldesigid.indexOf(id1);
                if (index > -1) { 
                  globaldesigid.splice(index, 1);
                }
    
            var row = document.getElementById(id);
            row.parentNode.removeChild(row);
            var table = $('#textdesigselect').DataTable();
          }       
    }
    
    function getdesigdata()
    {
      let desig=$('#desig').val();
      $('#showdiv1').hide();
      $('#showdiv2').show();
      $('#textdesigselect').DataTable();
      var table = $('#textdesig').DataTable();
        table.destroy();
    
      data={
              'desig':desig,
          }
                $.ajax({
                    type: "GET",
                    url: "{% url 'designation_wise' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(mydata) {
                       let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="selordesel(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        
                        for (let i = 0; i < mydata.length; i++) {
                         
       
    
                          if(globaldesigid.includes(mydata[i]['designation']))
                           { 
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="ab${mydata[i]['designation_code']}"  value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chkdesig" onclick="selectdesig(this)"></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden >
                                ${mydata[i]['desig_longdesc']}</td>`;
                            
                              row += `</tr>`;
                           }
                           else
                           {
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox"  id="ab${mydata[i]['designation_code']}"  value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chkdesig" onclick="selectdesig(this)"></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden >
                                ${mydata[i]['desig_longdesc']}</td>`;
                            
                              row += `</tr>`;
                           }
    
                        }
                        
                        $('#textdesig thead').remove();
                        $('#textdesig tr').remove();
                        $('#textdesig').append(head);
                        $('#textdesig tbody').append(row);
                        
                        $('#textdesig').DataTable();
                          
           
                    },
               
                });
    
    }
    
    //////////////////////////////////////
    $('#desig').click(function(){
        var username = $('#desig option:selected').text();
        var userid = $('#desig').val();
    });

  
    
    $("#dept_1").select2();
              
    $('#dept_1').click(function(){
        var username = $('#desig option:selected').text();
        var userid = $('#desig').val();
    });
    </script>
       
    <script>
    
    function getdivdeptdata()
    {
      $('#showdiv1').show();
      $('#showdiv2').hide();
      getdivwisedata();
      fungetzonedata();
    }
    
    function getdivwisedata()
    {
      $('#showdiv1').show();
      $('#showdiv2').hide();
      var table = $('#text1').DataTable();
        table.destroy();
        $('#text1').hide();
        var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1,
              'dept_1':dept_1,
              'div_1':div_1,
              
            }
                $.ajax({
                    type: "GET",
                    url: "{% url 'division_wise1' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                      mydata=response.divwise;
                       let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select1(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                            row += "<tr>";  
                              row+=  `<td><input type="checkbox" id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext1" ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                            
                            row += `</tr>`;
                        }
                        $('#text1 thead').remove();
                        $('#text1 tr').remove();
                        $('#text1').append(head);
                        $('#text1 tbody').append(row);
                        $('#text1').show();
                        $('#text1').DataTable();
                          
           
                    },
                });
      document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
      document.getElementById('allbo').checked=false;
      document.getElementById('allpanel').checked=false;
               
    }
    
        $('#allgm').click(function() {
          document.getElementById('allboard').checked=false;
          document.getElementById('allphod').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          data={
              'rly_1':rly_1,
              
          } 
          $('#showdiv1').show();
          $('#showdiv2').hide();
          globallistgm='';
           if(this.checked){
            globallistgm= "All GM's/ZR";
              $.ajax({
                    type: "GET",
                    url: "{% url 'gm_list_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allgm;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistgm='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
          });   
    
          
        $('#alldrm').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          var table = $('#text1').DataTable();
          table.destroy();
            var div_1=$('#rly_1').val();
            var dept_1=$('#dept_1').val();
              data={
                  'div_1':div_1,
                  'dept_1':dept_1,
              }
              globallistdrm='';   
           if(this.checked){
            globallistdrm="All DRM's"
                $.ajax({
                    type: "GET",
                    url: "{% url 'drm_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                      mydata=response.alldrm;
                      let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select1(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext1"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text1 thead').remove();
                        $('#text1 tr').remove();
                        $('#text1').append(head);
                        $('#text1 tbody').append(row);
                        $('#text1').show();
                        $('#text1').DataTable();       
                    },
      
                });
    
                }
    
                else{
                  globallistdrm=''; 
                  var ele=document.getElementsByName('chktext1');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text1').DataTable();
                }
          });   
    
     
        $('#allphod').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allboard').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1,
              'dept_1':dept_1,
          }
          globallistphod='';
           if(this.checked){
            globallistphod="All PHOD's";
              $.ajax({
                    type: "GET",
                    url: "{% url 'phod_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allphod;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistphod='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
        }); 
       
        $('#allboard').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allphod').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1,
              'dept_1':dept_1,
          }
          globallistbm=''; 
          
           if(this.checked){
            
            globallistbm="All Board Member's"; 
              $.ajax({
                    type: "GET",
                    url: "{% url 'board_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allboard;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Board Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistbm='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
    }); 

    $('#allbo').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allphod').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text1').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1, 
              'div_1':div_1, 
              'dept_1':dept_1,
          }
          globallistbo=''; 
          
           if(this.checked){
            
            globallistbo="All Branch Officers"; 
              $.ajax({
                    type: "GET",
                    url: "{% url 'branch_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allbo;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Branch Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text1 thead').remove();
                        $('#text1 tr').remove();
                        $('#text1').append(head);
                        $('#text1 tbody').append(row);
                        $('#text1').show();
                        $('#text1').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistbo='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text1').DataTable();
                }
    }); 
    
    $('#allpanel').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allphod').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1, 
              'div_1':div_1, 
              'dept_1':dept_1,
          }
          globallistpanel=''; 
          
           if(this.checked){
            
            globallistpanel="All Panel Officers"; 
              $.ajax({
                    type: "GET",
                    url: "{% url 'panel_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allpanel;
                        
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Panel Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistpanel='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
    }); 
    
     function fungetzonedata()
     {
      $('#showdiv1').show();
      $('#showdiv2').hide();
          var table = $('#text').DataTable();
          table.destroy();
          $('#text').hide();
          var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1,
              'dept_1':dept_1,
              'div_1':div_1,
              
            }
                $.ajax({
                    type: "GET",
                    url: "{% url 'headqwise' %}",
                    data: data,
                    success: function(response) {
                      mydata=response.hqwise;
                      let row = "";
                      let head = `<tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr>`;
                        
                       
                          for (let i = 0; i < mydata.length; i++) {
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox" id="${mydata[i]['designation_code']}" class="messageCheckbox" value="${mydata[i]['designation_code']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                          }
                        
                        $('#text thead').empty();
                        $('#text tbody').empty();
                        //$('#text tr').remove();
                        $('#text thead').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();      
                       
                    },
                    
                   
                });
      document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
      document.getElementById('allbo').checked=false;
      document.getElementById('allpanel').checked=false;
     }
            
    
      $('#rly_1').change(function() {
        var rly_1=$('#rly_1').val();
        if(rly_1 == []) 
          return false;
        let divdata=$('#div_1').val();
       
        // elif(dept_1 == [] && rly_1 == [])
        //   return false;
        // elif(dept_1 != [])
        //   return false;
        data={
            'rly_1':rly_1,
        }
      
        $.ajax({
          type : 'GET',
          url : "{% url 'division_by_rly1' %}",
          dataType : 'json',
          data : data,
    
          success : function(response){
            division=response.division;
            $('#div_1').empty();
            
              for (let i = 0; i < division.length; i++) {
                if(globaldiv.length!=0)
                {
                  if(globaldiv == division[i])
                    { 
                      $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
                    }
                  else
                    $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
                }
                else
                {
                  if(divdata.includes(division[i]))
                    { 
                      $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
                    }
                  else
                    $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
                }
    
              }
              globaldiv=[];
              fungetzonedata();
              $('#div_1').select2().trigger('change');          
          }
    
          
        })
              
      })  
    
    
    
    </script>

    <script>
     
    
    function setTitle() {
    
      let zone = $('#zone').val()
      let division = $('#division').val()
      let department = $('#department').val()
      let txtDate = $('#txtDate2').val()
      let user = '{{desig|safe}}'
      let title = 'Inspection of'
      //alert(zone+'----'+ user +'----'+department)
    
      
      var loca = $("#location").val();
      
      
    
      if(zone==null){
        alert('Please select Rly/Org')
        return false;
      }
      // alert(txtDate)
      if(txtDate==null || txtDate==''){
        alert('Please enter date')
        return false;
      }
     
      else{
        let data={
            'zone': JSON.stringify(zone),
            'division': JSON.stringify(division),
            'loca': JSON.stringify(loca)
          }
          $.ajax({
            type : 'GET',
            url : "{% url 'generateTitle' %}",
            dataType : 'json',
            data : data,
            success : function(response){
              Title=response.Title;
              // if(division == '' || division == null){
                if(Title.length>1000)
                {
                  alert('Cannot generate Title, as size is greater then required title size. please type manually')
                }
                else{
                if (txtDate.includes('to'))
                  txtDate=' from '+txtDate
                else
                  txtDate=' dated '+txtDate
                $('#titleinsp').val(title+' '+Title+' by '+user+txtDate)
                }
              // }
              // else{
                // $('#titleinsp').val(title+' '+loca+'  '+zone +'/'+division+' by '+user+' date: '+txtDate)
              // }
      
            }
            });
      }
      
     
    }
    

    </script>
    <script>
      $(document).ready(function(){
        var rly=$('#zone').val();
        let setdiv='{{setdiv|safe}}';

        let option_val='{{option_val|safe}}';
        
        if(option_val != 'edit')
        {
          
        let data={
            'rly_data': JSON.stringify(rly)
          }

          $.ajax({
            type : 'GET',
            url : "{% url 'getdiv_rly' %}",
            dataType : 'json',
            data : data,
            success : function(response){
              let division=response.division;
              
              if (division.length == 0){
                $('#division').empty();
                $('#division').prop('disabled', true);
              }
              else{
                $('#division').empty();
                $('#division').prop('disabled', false);
                $('#division').append(`<option value="" disabled>NA</option>`);
                  for (let i = 0; i < division.length; i++) {
                    if(setdiv == division[i].location_code)
                      $('#division').append(`<option selected value="${division[i].location_code}"> ${division[i].location_code}</option>`);
                    else
                      $('#division').append(`<option value="${division[i].location_code}"> ${division[i].location_code}</option>`);
                  }
              }
             
              
            }
          })
        }
      });
  
      $('#zone').change(function() {
        var rly=$('#zone').val();
         let divisiondata = $('#division').val();
            data={
                'rly_data': JSON.stringify(rly)
                
              }
    
              $.ajax({
                type : 'GET',
                url : "{% url 'getdiv_rly' %}",
                dataType : 'json',
                data : data,
    
                success : function(response){
                  let division=response.division;
                  if (division.length == 0){
                    $('#division').empty();
                    $('#division').prop('disabled', true);
                  }else{
                    $('#division').empty();
                    $('#division').prop('disabled', false);
                    $('#division').append(`<option value="" disabled>NA</option>`);
                      for (let i = 0; i < division.length; i++) {
                        if(divisiondata.includes(division[i].location_code))
                          $('#division').append(`<option selected value="${division[i].location_code}"> ${division[i].location_code}</option>`);
                        else
                          $('#division').append(`<option value="${division[i].location_code}"> ${division[i].location_code}</option>`);
                      }
                  }
                  
                  setLocationFromModal();
                }
              })
      })
    
      $('#division').change(function() {setLocationFromModal();})
    
      function changeColorBtn(el){
      let val = el.id
      if (val == 'addheading'){
        document.getElementById('addheading').style.backgroundColor = "#3333ff";
        document.getElementById('addmech').style.backgroundColor = "#337AB7";
        document.getElementById('addSubmech').style.backgroundColor = "#337AB7";
      }
      else if(val == 'addmech'){
        document.getElementById('addheading').style.backgroundColor = "#337AB7";
        document.getElementById('addmech').style.backgroundColor = "#3333ff";
        document.getElementById('addSubmech').style.backgroundColor = "#337AB7";
      }
      else if(val == 'addSubmech'){
        document.getElementById('addheading').style.backgroundColor = "#337AB7";
        document.getElementById('addmech').style.backgroundColor = "#337AB7";
        document.getElementById('addSubmech').style.backgroundColor = "#3333ff";
      }
    
    }
    
    
    </script>
    
    <script>
    
    
    
    

$(function() {

$('input[name="daterange1"]').daterangepicker({
    autoUpdateInput: false,
    autoApply: true,
    maxDate: new Date(),
    "opens": "left",
    locale: {
        cancelLabel: 'Clear'
    }
});

$('input[name="daterange1"]').on('apply.daterangepicker', function(ev, picker) {
  $(this).val(picker.startDate.format('DD/MM/YY') + ' to ' + picker.endDate.format('DD/MM/YY'));
  
  if(picker.startDate.format('DD/MM/YY') == picker.endDate.format('DD/MM/YY')){
      $(this).val(picker.startDate.format('DD/MM/YY'))
    }
    else{
      $(this).val(picker.startDate.format('DD/MM/YY') + ' to ' + picker.endDate.format('DD/MM/YY'));
    
    }
  
  $('.applyButtonClasses').click()

  
});

$('input[name="daterange1"]').on('cancel.daterangepicker', function(ev, picker) {
    $(this).val('');
});

});

$('#txtDate2').hover(function(){
  $('body').trigger('mousedown');
 document.getElementById('txtDate2').click();
});

    
      $("textarea").each(function () {
      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
        }).on("input", function () {
          this.style.height = "auto";
          this.style.height = (this.scrollHeight) + "px";
        });
    </script>

    
<script>
 
  var globalfavlst=[];
 
  // function getOption(e){
  //     let id=e.substring(5,e.length);
  //     if(id.length >= 1)
  //     {
  //       for(let jjj=0;jjj<para_array_marked.length;jjj++)
  //             {
  //               e = 'desgn'+String(para_array_marked[jjj]);
  //               id=e.substring(5,e.length);
  //             var options = document.getElementById(e).selectedOptions;
  //             var values = Array.from(options).map(({ value }) => value);
  //             let tooltipid='tooltip'+ id.replaceAll('.','a');
  //             let markofficer='markeofficer'+ id;

  //             let lt='desgninp'+id;
  //             let notexist=[], altext=document.getElementById(lt).value;
  //             altext=altext.split(',');
              
  //             var myInput = document.getElementById(markofficer);
  //             var officer_id=myInput.getAttribute('custom-offic');
            
  //             if(officer_id.length!=0)
  //             {
  //               officer_id=officer_id.split(',');
  //             }
  //             else
  //             {
  //               officer_id=[];
  //             }
          
  //             officer_id=[...new Set(officer_id.concat(values))]
              
  //             for(let i=0;i<altext.length;i++)
  //             {
  //               if(values.includes(String(altext[i])))
  //               {
  //                 continue;
  //               }
  //               else
  //               {
  //                     var index = officer_id.indexOf(altext[i]);
  //                     if (index !== -1) {
  //                       officer_id.splice(index, 1);
  //                     }
  //               }
                    
  //             }

  //             document.getElementById(lt).value=values;
              
  //             data={
  //                 'officer_id': JSON.stringify(values),
  //                 'csrfmiddlewaretoken': '{{csrf_token}}'
  //               }
          
  //               $.ajax({
  //                 type : 'POST',
  //                 url : "{% url 'desig_changecode' %}",
  //                 dataType : 'json',
  //                 data : data,
          
  //                 success : function(response){
  //                   marked_id=JSON.parse(response.marked_id);
  //                   marked_desig=response.marked_desig;
  //                   marked_key=JSON.parse(response.marked_key);
          
  //                   document.getElementById(markofficer).value=marked_desig;
  //                   var myInput = document.getElementById(markofficer);
  //                   myInput.setAttribute('custom-offic', marked_id);
  //                   // let x = document.getElementById(markofficer).scrollHeight;
  //                   // document.getElementById(markofficer).style.height =(10+x)+"px";
          
  //                   const tx = document.getElementsByTagName("textarea");
  //                   for (let i = 0; i < tx.length; i++) {
  //                     tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
  //                     tx[i].addEventListener("input", OnInput, false);
  //                   }
          
  //                   function OnInput() {
  //                     this.style.height = 0;
  //                     this.style.height = (this.scrollHeight) + "px";
  //                   }
  //                   $("textarea").trigger("input");
  //                   var myInput = document.getElementById(markofficer);
  //                   myInput.setAttribute('custom-key',JSON.stringify(marked_key));

  //                   myInput = document.getElementById(tooltipid);
                    
  //                   if(marked_desig.length==0)
  //                   {
  //                     marked_desig='Add From Dropdown'
  //                   }
  //                   myInput.innerHTML=truncateString(marked_desig,10);
  //                   marked_desig=marked_desig.replaceAll(',',', ')
  //                   myInput.title=marked_desig;
  //                   $('#'+tooltipid).tooltip();
  //                 }
  //               })
  //             }
  //     }
      
  //     else
  //     {
  //     var options = document.getElementById(e).selectedOptions;
      
  //     var values = Array.from(options).map(({ value }) => value);
  //     let tooltipid='tooltip'+ id.replaceAll('.','a');
  //     let markofficer='markeofficer'+ id;

  //     let lt='desgninp'+id;
  //     let notexist=[], altext=document.getElementById(lt).value;
  //     altext=altext.split(',');
      
  //     var myInput = document.getElementById(markofficer);
  //     var officer_id=myInput.getAttribute('custom-offic');
     
  //     if(officer_id.length!=0)
  //     {
  //       officer_id=officer_id.split(',');
  //     }
  //     else
  //     {
  //       officer_id=[];
  //     }
  
  //     officer_id=[...new Set(officer_id.concat(values))]
      
  //     for(let i=0;i<altext.length;i++)
  //     {
  //       if(values.includes(String(altext[i])))
  //       {
  //         continue;
  //       }
  //       else
  //       {
  //             var index = officer_id.indexOf(altext[i]);
  //             if (index !== -1) {
  //               officer_id.splice(index, 1);
  //             }
  //       }
            
  //     }

  //     document.getElementById(lt).value=values;
      
  //     data={
  //         'officer_id': JSON.stringify(values),
  //         'csrfmiddlewaretoken': '{{csrf_token}}'
  //       }
  
  //       $.ajax({
  //         type : 'POST',
  //         url : "{% url 'desig_changecode' %}",
  //         dataType : 'json',
  //         data : data,
  
  //         success : function(response){
  //           marked_id=JSON.parse(response.marked_id);
  //           marked_desig=response.marked_desig;
  //           marked_key=JSON.parse(response.marked_key);
  
  //           document.getElementById(markofficer).value=marked_desig;
  //           var myInput = document.getElementById(markofficer);
  //           myInput.setAttribute('custom-offic', marked_id);
         
  
  //           const tx = document.getElementsByTagName("textarea");
  //           for (let i = 0; i < tx.length; i++) {
  //             tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
  //             tx[i].addEventListener("input", OnInput, false);
  //           }
  
  //           function OnInput() {
  //             this.style.height = 0;
  //             this.style.height = (this.scrollHeight) + "px";
  //           }
  //           $("textarea").trigger("input");
  //           var myInput = document.getElementById(markofficer);
  //           myInput.setAttribute('custom-key',JSON.stringify(marked_key));

  //           myInput = document.getElementById(tooltipid);
            
  //           if(marked_desig.length==0)
  //           {
  //             marked_desig='Add From Dropdown'
  //           }
  //           myInput.innerHTML=truncateString(marked_desig,10);
  //           marked_desig=marked_desig.replaceAll(',',', ')
  //           myInput.title=marked_desig;
  //           $('#'+tooltipid).tooltip();
  //         }
  //       })
  //     }
  
  
  
  // }
 

  function getOption(e){
      let id=e.substring(5,e.length);
     
      var options = document.getElementById(e).selectedOptions;
      
      var values = Array.from(options).map(({ value }) => value);
      let tooltipid='tooltip'+ id.replaceAll('.','a');
       let tooltipiId = 'tooltipi'+ id.replaceAll('.','a');
      let markofficer='markeofficer'+ id;

      let lt='desgninp'+id;
      let notexist=[], altext=document.getElementById(lt).value;
      altext=altext.split(',');
      
      var myInput = document.getElementById(markofficer);
      var officer_id=myInput.getAttribute('custom-offic');
     
      if(officer_id.length!=0)
      {
        officer_id=officer_id.split(',');
      }
      else
      {
        officer_id=[];
      }
  
      officer_id=[...new Set(officer_id.concat(values))]
      
      for(let i=0;i<altext.length;i++)
      {
        if(values.includes(String(altext[i])))
        {
          continue;
        }
        else
        {
              var index = officer_id.indexOf(altext[i]);
              if (index !== -1) {
                officer_id.splice(index, 1);
              }
        }
            
      }

      document.getElementById(lt).value=values;
      
      data={
          'officer_id': JSON.stringify(values),
          'csrfmiddlewaretoken': '{{csrf_token}}'
        }
  
        $.ajax({
          type : 'POST',
          url : "{% url 'desig_changecode' %}",
          dataType : 'json',
          data : data,
  
          success : function(response){
            marked_id=JSON.parse(response.marked_id);
            marked_desig=response.marked_desig;
            marked_key=JSON.parse(response.marked_key);
  
            document.getElementById(markofficer).value=marked_desig;
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-offic', marked_id);
         
  
            const tx = document.getElementsByTagName("textarea");
            for (let i = 0; i < tx.length; i++) {
              tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
              tx[i].addEventListener("input", OnInput, false);
            }
  
            function OnInput() {
              this.style.height = 0;
              this.style.height = (this.scrollHeight) + "px";
            }
            // $("textarea").trigger("input");
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-key',JSON.stringify(marked_key));

            myInput = document.getElementById(tooltipid);
            
            if(marked_desig.length==0)
            {
              marked_desig='Add From Dropdown'
            }
            myInput.innerHTML=truncateString(marked_desig,10);
            marked_desig=marked_desig.replaceAll(',',', ')
            myInput.title=marked_desig;
            $('#'+tooltipid).tooltip();


            myInput = document.getElementById(tooltipiId);
            if(marked_desig.length==0)
            {
              marked_desig='Add From Dropdown'
            }
            marked_desig=marked_desig.replaceAll(',',', ')
            //myInput.title=marked_desig;
            $('#tooltipi'+String(0)).tooltip();


          }
        })
      }
  
  

  $('.demo-copy').selectpicker()
      $(".demo-copy").removeClass("dropdown");
      var button = $(`#copy_divdesgn .bs-actionsbox .btn-group`);
      button.append(`<button hidden type="button" class="btn btn-default btn-light" onclick="copyToOption();">Save</button>`)
      button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopup();">Go/Close</button>`)
      button.append(`<button type="button" id="copybtndel" class="actions-btn bs-deselect-all btn btn-default btn-light" onclick="copyTofungettest()" hidden >Remove</button>`)
      button.append(`<button id="copytobtn" class="btn btn-default btn-light" value="Copy To" data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setCopyValue(); setvalueIN()" ><i class="fas fa-search"></i></button>`)
      $(".demo-copy").on("changed.bs.select", function(clickedIndex, isSelected, oldValue) {
      copyToOption();
       
  });

  function removePopup(){
    $('#demo-copy .bootstrap-select').removeClass('show')
  }
  
  
  function copyToOption(){
    
    var options = document.getElementById('copy_desgn').selectedOptions;
    var values = Array.from(options).map(({ value }) => value);
    
    
    let lt='copy_desgninp';
    let notexist=[], altext=document.getElementById(lt).value;
    altext=altext.split(',');

    let markofficer='copyto';
    var myInput = document.getElementById(markofficer);
   
    var officer_id=[];
    officer_id=[...new Set(officer_id.concat(values))]
    
    for(let i=0;i<altext.length;i++)
    {
      if(values.includes(String(altext[i])))
      {
        continue;
      }
      else
      {
            var index = officer_id.indexOf(altext[i]);
            if (index !== -1) {
              officer_id.splice(index, 1);
            }
      }
    }
    document.getElementById(lt).value=values;
    data={
        'officer_id': JSON.stringify(officer_id),
        'csrfmiddlewaretoken': '{{csrf_token}}'
      }

      $.ajax({
        type : 'POST',
        url : "{% url 'desig_changecode' %}",
        dataType : 'json',
        data : data,

        success : function(response){
          marked_id=JSON.parse(response.marked_id);
          marked_desig=response.marked_desig;
          marked_key=JSON.parse(response.marked_key);

          document.getElementById(markofficer).value=marked_desig;
          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-offic', marked_id);
       

          const tx = document.getElementsByTagName("textarea");
          for (let i = 0; i < tx.length; i++) {
            tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
            tx[i].addEventListener("input", OnInput, false);
          }

          function OnInput() {
            this.style.height = 0;
            this.style.height = (this.scrollHeight) + "px";
          }
          $("textarea").trigger("input");

          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-key',JSON.stringify(marked_key));
          
        }
      })



    }

 
    function fungettest(id)
      {
              id='btndel'+String(id).substring(8,(String(id)).length);
              document.getElementById(id).click();
             

      }

function truncateString(str, num) {
  if (str.length > num) {
    return str.slice(0, num) + "...";
  } else {
    return str;
  }
}

</script>
<script>

  $(document).ready(function(){
    $('#submit2').hide()
  })
  
  let timerOn = true;
  function timer(remaining) {
    var m = Math.floor(remaining / 60);
    var s = remaining % 60;
    
    m = m < 10 ? '0' + m : m;
    s = s < 10 ? '0' + s : s;
    document.getElementById('timer').innerHTML = m + ':' + s;
    remaining -= 1;
    
    if(remaining >= 0 && timerOn) {
      setTimeout(function() {
          timer(remaining);
      }, 1000);
      return;
    }
  
    if(!timerOn) {
      
      return;
    }
    
    alert('Timeout for otp');
  }
  
  function chkvalidation()
  {
    var table = document.getElementById("addworkmech");
              var zone=$("#zone").val();
              var division=$("#division").val();
              var location=$("#location").val();
              var department=$('#department').val();
              var inspection_date=$('#txtDate2').val();
              hli = 0,full_array=[];
              let paradata, continue_status = true;
              
              for(let i=0;i<table.rows.length;i++)
              {
                if(table.rows[i].cells[2].className == 'strikeout')
                  {
                    continue_status = false;
                  }
                  else{
                    continue_status = true;
                    break;
                  }
              }
              if(!continue_status)
              {
                alert("All item is deleted or item is not added, hence cannot be submitted")
                return false;
              }

              for(let i=0;i<table.rows.length;i++)
              {
                if(table.rows[i].cells[0].innerHTML == 'P')
                  hli++;
                full_array.push(table.rows[i].cells[1].innerHTML)

                

                
              }
             
              if(full_array.length == 0){
                alert('Please Enter Inspection Details')
                return false;
              }
              for(let i=1; i<=hli; i++){
                for(let j=0; j<full_array.length; j++)
                {
                  paradata = para_array[j]
                  if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.'){
                    let temp = full_array[j].split('.')
                    
                    
                    if(temp.length == 1){
                      let hid='heading'+ String(paradata);
                      var val = document.getElementById(hid).value;
                      
      
                      if(val == '' && !(del_array.includes(paradata))){
                        alert('Please fill some data in inspection para');
                        document.getElementById(hid).focus();
                        return false;
                      }
                     
                      let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  if(cellVal =='' && !(del_array.includes(paradata)))
                                  {
                                    alert('Please fill Table Data');
                                    return false;
                                  }
                              }
                              table_det.push(table_det1)
                            }
                      }
                          

                      d1_test = full_array[j]+'.'
                      var result_test = full_array.filter(option => option.startsWith(d1_test));
                      
                      d2_test = 'Yes'
                        for(iv=j+1;iv<table.rows.length;iv++)
                          {
                            if(table.rows[iv].cells[0].innerHTML == 'P')
                            {
                              break;
                            }
                            if(del_array.includes(para_array[iv]))
                            {
                              d2_test = 'Yes'
                            }
                            else
                            {
                              d2_test ='No'
                              break
                            }
                          }

                      if(d2_test == 'No')
                      {
                        a=1;
                      }
                      else{
                          

                          // let td = 'targetdate' + String(paradata);
                          let mf = 'markeofficer' + String(paradata);
                          // let chk = 'check'+ String(paradata);
                          let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  if(cellVal =='' && !(del_array.includes(paradata)))
                                  {
                                    alert('Please fill Table Data');
                                    return false;
                                  }
                              }
                              table_det.push(table_det1)
                            }
                      }
                      
                          // var tddate = document.getElementById(td).value;
                      
                          // let chk_val = document.getElementById(chk)
                            
                          
                          //   if (chk_val.checked == true){
                          //       var checkbox = '1'
                               
                                
                          //   }
                          //   else if (chk_val.checked == false){
  
                          //     checkbox = '0'
                              
                              
                          //   }
                          var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                          
                          if(officer_val == '' && !(del_array.includes(paradata))){
                            alert('Please Add mark officers')
                            return false;
                          }
                      
                         
                                  
                      }
                      
                    }
                    else if(temp.length == 2){
                      let sid='heading'+String(paradata);
                      // let td = 'targetdate' + String(paradata);
                      let mf = 'markeofficer' + String(paradata);
                      // let chk = 'check'+ String(paradata);
      
                      var val1 = document.getElementById(sid).value;
                      // var tddate = document.getElementById(td).value;
                      
                      
      
                      if(val1 == '' && !(del_array.includes(paradata))){

                        alert('Please fill some data in inspection sub para')
                        document.getElementById(sid).focus();
                        return false;
                      }
                      let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  if(cellVal =='' && !(del_array.includes(paradata)))
                                  {
                                    alert('Please fill Table Data');
                                    return false;
                                  }
                              }
                              table_det.push(table_det1)
                            }
                      }
                      
                      // let chk_val = document.getElementById(chk)
                      //   if (chk_val.checked == true){
                      //       var checkbox = '1'
                      //   }
                      //   else if (chk_val.checked == false){
  
                      //     checkbox = '0'
                      //   }
      
                      var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                      
                     
                    } 
                    else{
                      let ssid='heading'+String(paradata);
                      var val2 = document.getElementById(ssid).value;
                      let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  if(cellVal =='' && !(del_array.includes(paradata)))
                                  {
                                    alert('Please fill Table Data');
                                    return false;
                                  }
                              }
                              table_det.push(table_det1)
                            }
                      }
                      if(val2 == '' && !(del_array.includes(paradata))){
                        document.getElementById(ssid).focus();
                        alert('Please fill some data in inspection sub Subpara')
                        return false;
                      }
                      
                    }
                    
                  }
                }
              }
            
              
          if(zone =='' || zone==null){
            alert("Please fill Rly/Org ")
            return false;
          }
          
          if(inspection_date=='' || inspection_date==undefined){
              alert("Please fill date of inspection ")
              return false;
          }
          if($('#titleinsp').val()==''){
            alert("Please fill title of inspection ")
            return false;
          } 

          if($('#sttninsp').val()==''){
          alert("Please fill Station of Inspecting Officer ")
          return false;
        }
        if($('#desiginsp').val()==''){
          alert("Please fill Designation of Inspecting Officer ")
          return false;
        }
        if($('#ofcnameinsp').val()==''){
          alert("Please fill Name of Inspecting Officer ")
          return false;
        }
          for(let i=0;i<table.rows.length;i++)
            {

              if(table.rows[i].cells[0].innerHTML == 'SP')
              {
                let offid = 'markeofficer'+para_array[i];
                let offVal = document.getElementById(offid).value;
              
                if(offVal == '' && !(del_array.includes(para_array[i])))
                {
                  alert('Please Add mark officers')
                  return false;
                }
              }
              

            }

         

          
        for(let jk=0;jk<img_ref_no.length;jk++)
        {
          let sel_id, txt_id;
          sel_id = document.getElementById('select_img_'+img_ref_no[jk]).value;
          txt_id = document.getElementById('img_text_'+img_ref_no[jk]).value;
          if(sel_id == '')
          {
            alert('select Reference number')
            $('#select_img_'+img_ref_no[jk]).focus();
            return false;
          }
          if(txt_id == '')
          {
            alert('select Image')
            $('#img_text_'+img_ref_no[jk]).focus();
            return false;
          }
          if(!full_array.includes(sel_id))
          {
            alert('select Proper reference number')
            $('#select_img_'+img_ref_no[jk]).focus();
            return false;
          }
        }
        if(confirm('Are you sure?'))
        document.getElementById('submit1').click();
  }
  
  
  function saveByOtp(el){
    $.ajax({
          type : 'GET',
          url : "{% url 'saveByOtp_ajax' %}",
          dataType : 'json',
          success : function(response){
           //OTP SENDED TO DATA BASE
            let time_count =  parseInt(response.timer)
            alert(response.newotp)
            timer(time_count);
           
  
           
          }
    });
  
  }
  
  function verify_my_otp(){
    const myotp = document.getElementById('your_otp').value;
    $.ajax({
          type : 'POST',
          url : "{% url 'verify_my_otp_ajax' %}",
          dataType : 'json',
          data: {'myotp': myotp, csrfmiddlewaretoken: '{{csrf_token}}'},
          success : function(response){
            if(response.ret == 'True'){
              $('#submit').click();
              let html = `<div class="alert alert-success" role="alert">
                Form submited
              </div>`
              $('#otpcurrent').html(html)
            }else if(response.ret == 'False'){
              let html = `<div class="alert alert-danger" role="alert">
                OTP didn't match
              </div>`
              $('#otpcurrent').html(html)
              
            }
            
           
          }
    });
  }
  
  var digitPeriodRegExp = new RegExp('\\d|\\.');
  var input1 = document.getElementById('your_otp');
  var input2 = document.getElementById('input2');
  
  input1.addEventListener('keydown', function(event) {
      if(event.ctrlKey // (A)
      || event.altKey // (A)
      || typeof event.key !== 'string' // (B)
      || event.key.length !== 1) { // (C)
          return;
      }
      if(!digitPeriodRegExp.test(event.key)) {
          
          event.preventDefault();
      }
  }, false);
//   $("#accompany").select2({
//     tags: true,
//     tokenSeparators: [','],  
//     maximumInputLength: 10
// });

$("#accompany").select2({
        tags: true,
        tokenSeparators: [','],  
        minimumInputLength: 0,
        maximumInputLength: 50,
        language: {
            inputTooShort: function() {
              return 'Please Add One or More Location';
            }
          },
       
        ajax: {
            url: '{% url "autoFetchAccompany" %}',
            dataType: 'json',
            type: "GET",
            quietMillis: 50,
            data: function (term) {
              // let stype = JSON.stringify($('#locationType').val())
              let rly_zone = JSON.stringify($('#zone').val())
              let division_id = JSON.stringify($('#division').val())
                return {
                    last_val: term.term,
                    rly_zone: rly_zone,
                    division_id : division_id
                };
            },
            processResults: function (data) {
              
                return {
                    results: $.map(data, function (item) {
                 
                        return{
                          text: item.designation,
                          
                          id: item.designation,
                          
                        }
                    })
                };
              
              },
            
            
        }
    });

    $('#locationType').select2();
 

  $("#location").select2({
        minimumInputLength: 0,
        language: {
            inputTooShort: function() {
              return 'Please Add One or More Location';
            }
          },
       
        ajax: {
            url: '{% url "autoFetchLocation" %}',
            dataType: 'json',
            type: "GET",
            quietMillis: 50,
            data: function (term) {
              let stype = JSON.stringify($('#locationType').val())
              let rly_zone = JSON.stringify($('#zone').val())
              let division_id = JSON.stringify($('#division').val())
                return {
                    last_val: term.term,
                    stype: stype,
                    rly_zone: rly_zone,
                    division_id : division_id
                };
            },
            processResults: function (data) {
              
                return {
                    results: $.map(data, function (item) {
                 
                        return{
                          text: item.city,
                          id: item.city+'#'+item.table_from+'#'+ item.loc_code,
                          
                        }
                    })
                };
              
              },
  
        }
    });

  
    $("#locationType").next(".select2").mouseenter(function() {
      $('body').trigger('mousedown');
      $("#locationType").select2('open');
    }); 
  
  </script>
  <!-- Apeksha script for accompany -->
  <script>
    function get_accompany()
    {
      var rly=$('#zone').val();
         let divisiondata = $('#division').val();
            data={
                'rly_data': String(rly)
              }
                  $.ajax({	
                          type: 'GET',	
                            url: "{% url 'zone_get_accompany_officers' %}",	
                            dataType: 'json',	
                            data: data,
                            success: function (response) {
                              
                              $('#accompany').empty();
                              data_add=``
                              for(ii=0;ii<response.length;ii++)	
                                {	
                                data_add +=  '<option  value="'+response[ii].designation_code+'" data-tokens="'+response[ii].empnoser+'">'+response[ii].designation+'</option>';	
                                }
                              
                              $('#accompany').append(data_add);
                      }
                    })

    }
  </script>



<!-- add new code  -->


<script>

Array.prototype.insert = function ( index, ...items ) {
    this.splice( index, 0, ...items );
};

var chkSectionCond = false;
function addpara(typ_id , tbl_row_count)
{
                    if(typ_id == 'S' && !chkSectionCond)
                    {
                      chkSectionCond = true;
                    }
                    

                    var table = document.getElementById("addworkmech");
                    var tbl_len = table.rows.length,paraClass='';
                    let locs_val=$('#location').val()
                    let zones_val=$('#zone').val()
                    let divs_val=$('#division').val()
                    var sectionReq=false
                    if (locs_val.length>1 || zones_val.length>1 || divs_val.length>1)
                      sectionReq=true
                    if (sectionReq && typ_id != 'S' && table.rows.length == 0){
                      alert('Please add section first.')
                      return true;
                    }
                    if(!chkSectionCond && table.rows.length > 0)
                    {
                      for(let tl = tbl_len -1; tl>=0;tl--)
                      {
                        textdata = table.rows[tl].cells[0].innerHTML;
                        if(textdata !='S')
                          {
                            chkSectionCond=true;
                            break;
                          }
                      }
                    }
                    if(table.rows.length > 0)
                      paraClass = table.rows[tbl_len-1].cells[3].className;
                    
                      
                    if (chkSectionCond && table.rows.length > 0 && paraClass == 'strikeout' && typ_id != 'S' && tbl_row_count == '-2'){
                      let chkCond=false,textdata='';
                      for(let tl = tbl_len -1; tl>=0;tl--)
                      {
                        paraClass = table.rows[tl].cells[3].className;
                        textdata = table.rows[tl].cells[0].innerHTML;
                        if( paraClass == 'strikeout')
                        {
                          if(textdata !='S')
                          {
                            chkCond=false;
                          }
                          
                          if(textdata =='S')
                          {
                            chkCond=true;
                            break;
                          }
                          
                        }
                        else{
                          chkCond=false;
                            break;
                        }
                      }
                      if(chkCond)
                      {
                        if(typ_id == 'P')
                          alert('Item cannot be Added, either Add Section then Add para or Add para from the toolbox');
                        else if(typ_id == 'SP')
                         alert('Item cannot be Added, either Add Section then Add Sub-para or Add Sub-para from the toolbox');
                        else if(typ_id == 'SSP')
                          alert('Item cannot be Added, either Add Section then Add Sub sub-para or Add Sub sub-para from the toolbox');
                          return true;
                      }
                      else{
                        if(textdata == 'P' && typ_id == 'SSP')
                        {
                          alert('Add sub para first before adding sub subPara');
                          return true;
                        }
                      }
                     
                    }

                    if (tbl_len == 0){
                      if (typ_id == 'SP'){
                        alert('Add para first before adding sub Para');
                        return true;
                      }
                      else if (typ_id == 'SSP'){
                      alert('Add sub para first before adding sub subPara');
                        return true;
                      }
                      else if (typ_id == 'P'){
                        var confrm = confirm('You will not be able to add sections. Do you wish to continue?')
                        if (confrm){
                          $('#sectionsRow').hide();
                          document.getElementById("genSections").disabled=true;
                        }
                        else{
                          return true
                        }
                        
                      }
                    } 
                    else if(tbl_row_count === '-2'){
                      let index_1 = table.rows.length - 1;
                      let tp_1 = table.rows[index_1].cells[0].textContent;

                      if (tp_1 == 'S'){
                        if (typ_id == 'SP'){
                          alert('Add para first before adding sub Para');
                          return false;
                        }
                        else if (typ_id == 'SSP'){
                          alert('Add sub para first before adding sub subPara');
                          return false;
                        }
                        else if(typ_id == 'S'){
                          alert('Cannot add two sections simultaneously');
                          return false;
                        }
                      }
                      if(tp_1 == 'P'){
                        if (typ_id == 'SSP'){
                          alert('Add sub para first before adding sub subPara');
                            return true;
                        }
                      }
                    }                   
                    
                    // let locs_val=$('#location').val()
                    // if (locs_val.length>1 && typ_id != 'S' && table.rows.length == 0){
                    //   alert('Please add section first.')
                    //   return true;
                    // }
                    // if (table.rows.length == 0 && typ_id == 'P' && tbl_row_count === '-2'){
                    //   document.getElementById("addsection").disabled = true
                    // }

                    // if(table.rows.length == 0 && typ_id == 'SP' && tbl_row_count === '-2')
                    //   {
                    //     alert('Add para first before adding sub Para');
                    //     return true;
                    //   }
                    // else if (table.rows.length != 0){
                    //   let index_1 = table.rows.length - 1;
                    //   let tp_1 = table.rows[index_1].cells[0].textContent;
                      
                      
                    //   if (tp_1 == 'S'){
                    //     if (typ_id == 'SP')
                    //       {
                    //         alert('Add para first');
                    //         return true;
                    //       }
                    //       else if (typ_id == 'SSP'){
                    //         alert('Add sub para first before adding sub subPara');
                    //         return true;
                    //       }
                    //       else if (typ_id == 'S'){
                    //         alert('Cannot add two sections simultaneously');
                    //         return false;
                    //       }
                    //   }
                    //   else if(typ_id == 'SSP' && tbl_row_count === '-2')
                    //   {
                        
                    //     if(index_1 <0)
                    //     {
                    //       alert('Add para first');
                    //       return true;
                    //     }
                    //     if(tp_1 == 'P')
                    //     {
                    //       alert('Add sub para first before adding sub subPara');
                    //       return true;
                    //     }
                    //   }
                    // }





                    para_count ++;
                    for(let ok1=0;ok1<set_option_val.length;ok1++)
                            set_option_val[ok1] = 0;
                    $('#submit2').show()
                    
                    if(tbl_row_count == '-2')
                        tbl_row_count = table.rows.length;
                        
                    var row1 = table.insertRow(tbl_row_count);
                    
                    var index = para_array.indexOf(tbl_row_count);
                    if (index == -1) 
                    {
                      para_array.push(para_count);
                    }
                    else
                    {
                      para_array.insert(tbl_row_count, para_count);
                    }
                    var cell0 = row1.insertCell(0);
                    var cell1 = row1.insertCell(1);
                    var cell9 = row1.insertCell(2);
                    var cell2 = row1.insertCell(3);
                    var cell4 = row1.insertCell(4);
                    var cell5 = row1.insertCell(5);
                    var cell7 = row1.insertCell(6);
                    var cell8 = row1.insertCell(7);
                    
                    // var cell7 = row1.insertCell(7);
                    
                      var row1Count = 1;
                      hli++;
                      sli.push(0)
                      full_array.push(String(para_count))

                      var heading1='heading'+para_count;
                      addid = 'add' + para_count;
                      delid11 = 'del' + para_count;
                      spanid = 'span' +para_count;
                      var officer='officer'+para_count;
                      var markeofficer='markeofficer'+para_count
                      var targetdate='targetdate'+para_count;
                      var divofficer='divofficer'+para_count;
                      var divmarkeofficer='divmarkeofficer'+para_count;
                      var divtargetdate='divtargetdate'+para_count;
                      var divcheckbox='divcheckbox'+para_count;
                      var checkbox='check'+para_count;
                      var typeofaction='type'+para_count;
                      let delid='del1'+String(para_count);

                      //let delid='del1'+String(no_of_row);
                        no_of_row +=1;

                      cell0.innerHTML = typ_id;
                      cell0.style.display = 'none';
                      
                      cell1.innerHTML= para_count;
                      cell1.style = "text-align: center; width:5px; font-family:verdana;"
                      

                      cell9.innerHTML= para_count;
                      cell9.style = "text-align: center; width:5px; font-family:verdana;"
                      cell9.style.display = 'none';

                      cell8.innerHTML = para_count;
                      cell8.style.display = 'none';
                      // alert(para_count)
                      
                      if (typ_id == 'S'){
                        cell2.innerHTML=`<td>
                          <div id="divitemtype${para_count}">
                            Observations at 
                                   <select name="location_at" id="location_at${para_count}" data-placeholder="Select Category.." class="form-control">
                                  </select>
                               </div>
                          </td>`
                      }
                      else{
                          cell2innerHTML ='<td><div class="autocomplete1"><textarea maxlength="3000" placeholder="Maximum character limit 3000" id='+heading1+'  autocomplete1=off  style="height:30px;" class="form-control" /></textarea></div>'; 
                          cell2innerHTML +='<button type="button" hidden class="btn btn-outline-success btn-sm" id="'+addid+'" value="'+ para_count+'" onclick="get_table_data(this);" ><i class="fa fa-table " aria-hidden="true" title="Click to Add table"></i></button>'
                          cell2innerHTML +='<button type="button" hidden class="btn btn-outline-danger btn-sm" id="'+delid11+'" value="'+ para_count+'" onclick="remove_table_data(this);"><i class="fa fa-minus " aria-hidden="true" title="Click to modify/alter table"></i></button>'
                          cell2innerHTML +='<span id="'+spanid+'"></span>';
                          cell2innerHTML +='</td>'
                          cell2.innerHTML =cell2innerHTML;
                      
                          $("textarea").each(function () {	
                              this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");	
                                }).on("input", function () {	
                                  this.style.height = "auto";	
                                  this.style.height = (this.scrollHeight) + "px";	
                              });	


                        if(typ_id != 'SSP')
                        {
                          // cell3.innerHTML =`<td>
                          //     <td>
                          //       <div id="divitemtype${para_count}">
                          //           <select name="item_type${para_count}" id="item_type${para_count}" data-placeholder="Select Category.." class="form-control">
                          //             <option value="1" selected>A</option>
                          //             <option value="2">B</option>
                          //             <option value="0">C</option>
                          //           </select>
                          //       </div>
                          //     </td>`; 	

                            // cell4.innerHTML=`<td></td>`
                            cell4.innerHTML=`<td>
                                <div id="divitemtype${para_count}">
                                  <select name="item_type${para_count}" id="item_type${para_count}" data-placeholder="Select Category.." class="form-control item_type_select2">
                                    
                                    <option value="1" selected>Railway User Safety</option>
                                    <option value="2">Rly Employee Safety</option>
                                    <option value="0">Others</option>
                                  </select>
                                </div>
                            </td>`
                            para_array_marked.push(para_count)
                            let marked_zone = $('#zone').val();
                            let divisionss=$("#division").val();
                            plsWaitDiv('body', 'show');
                            $.ajax({	
                                  type: 'GET',	
                                    url: "{% url 'zone_get_marked_officers' %}",	
                                    dataType: 'json',	
                                    data: {'zone':String(marked_zone), 'divs':String(divisionss)},	
                                    success: function (response) {	
                                      
                            data_add = `
                            <td> 	
                              <div id="showhide${para_count}">
                              <div class="mycls">
                                <div class="multi_select_box" id="divdesgn${para_count}">	
                        
                                  <select id="desgn${para_count}" class="desgn${para_count} demo w-60 form-control form-control-sm dropup" data-size="6" data-dropup-auto="false" data-live-search="true" multiple data-actions-box="true" multiple data-selected-text-format="count > 2" multiple>	
                                    `    	
                                    for(ii=0;ii<response.length;ii++)	
                                  {	
                                    data_add +=  '<option  value="'+response[ii].designation_code+'" data-tokens="'+response[ii].empnoser+'">'+response[ii].designation+'</option>';	
                                  }   	
                                    data_add+= `</select>	
                                  <input type="button" id="desgnbtn${para_count}" value="Ok" onclick="getOption('desgn${para_count}')" hidden>	
                                  <input type="text" id="desgninp${para_count}" hidden >	
                                
                                </div>
                                &nbsp;
                              
                                <div class="autocomplete1 m-0" id="${divmarkeofficer}">	
                                  
                                  <button hidden class="btn btn-outline-primary" type="button" id="cpy${para_count}" value="Copy" onclick="copy_mark_officer(this)" ><i class='fas fa-copy' style='font-size:24px;'></i></button>  
                                
                                <a hidden style="display:inline-block;	
                                    width:130px;	
                                    height:35px;	
                                    margin-top:3px;	
                                    color: white;	
                                    background-color: darkslategray;	
                                    padding: 5px 11px;	
                                    border-style: 2px solid" id="tooltip${para_count}"  data-toggle="tooltip"  title="Add From Dropdown" >Add From D...</a>  	
                                  
                                    
                                    <a id="tooltipi${para_count}" data-placement="top" data-toggle="tooltipi" title="Add From Dropdown" hidden> <i class="fa fa-info-circle" style="font-size:32px;margin-top:5px;color:#055C9D;"></i></a>
                                    <button type="button" class="btn btn-success btn-sm ml-0 mt-1" title="Click to add instructions" id="instdesgn${para_count}" onclick="open_wrap(this)" ><i class="fa fa-tasks" aria-hidden="true"></i></button>
                                    <textarea hidden type="text" placeholder="Add officer" class="form-control" value="" custom-offic="" custom-info="" custom-key="" id='${markeofficer}' class="autocomplete1" readonly></textarea>
                                </div>	
                                
                              
                            </div>
                          </div>
                            </td>
                            `	
                            cell5.innerHTML = data_add;	

                      $(`#tooltip${para_count}`).tooltip();	
                      $(`#tooltipi${para_count}`).tooltip();
                      $('.demo').selectpicker();	
                      $(".demo").removeClass("dropdown");	
                      var button = $(`#divdesgn${para_count} .bs-actionsbox .btn-group`);	
                      button.append(`<button type="button" id="bdesgn${para_count}" class="btn btn-default btn-light" onclick="getOption('desgn${para_count}')" hidden>Save</button>`)	
                      button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${para_count}');">Go/Close</button>`)	
                      button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);	
                      button.append(`<button type="button" id="btndel${para_count}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)	
                      
                      

                      $(`#desgn${para_count}`).on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue){	
                        let his_id= this.id;
                          getOption(`${his_id}`);
                          });	
                      function removePopupForBtn(el){	
                          let idpattern = '#'+el +' '+'.bootstrap-select'	
                          $(idpattern).removeClass('show')	
                        };	

                        plsWaitDiv('body', 'hidden');
                    },error:function(err){
                      plsWaitDiv('body', 'hidden');
                    }
                        
                    });	




                            // cell4.innerHTML =`
                            // <td style="padding: 0.5px">
                            //   <div class="autocomplete1" id="'+divtargetdate+'">
                                
                            //     <input type="text"  class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;background-color:white;" id='+targetdate+' readonly> 
                            //   </div>
                              
                            //   <div class="autocomplete1 mt-1" id="'+divcheckbox+'"><input type="checkbox" value="1" autocomplete="off" id='+checkbox+'>&nbsp; <label for="priority" class="lbl-caption">On Priority</label> </div>
                            // </td>`; 	
                            $(".datepker").datepicker({	
                              showOn: 'focus',	
                              dateFormat: 'dd/mm/y',	
                              showButtonPanel: true,	
                              closeText: 'Clear', 	
                              minDate: 0,	
                              onClose: function () {	
                                var event = arguments.callee.caller.caller.arguments[0];	
                                if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {	
                                    $(this).val('');	
                                }	
                              },	
                              onSelect: function(selectedDate) {	
                                
                            }	
                            });	
                              
                            }


                        
                        
                        
                        //       if (typ_id != 'SSP'){
                        // add6+=`
                        //   <div id="divtypebox${typeofaction}">
                        //       <div class="form-check">
                        //           <input class="form-check-input" value="info" type="radio" name="flexRadioDefault${typeofaction}" id="${typeofaction}" onclick="disable_boxes(this)">
                        //           <label class="form-check-label" for="info">
                        //             For Information
                        //           </label>
                        //         </div>
                        //       <div class="form-check">
                        //           <input class="form-check-input" value="action" type="radio" name="flexRadioDefault${typeofaction}" id="${typeofaction}" checked onclick="disable_boxes(this)">
                        //           <label class="form-check-label" for="action">
                        //             For Compliance
                        //           </label>
                        //         </div>  
                        //       </div>
                        //   </td>`
                          
                        //   cell6.innerHTML = add6;
                        // }
                        // else{
                        //   let add6=`<td>
                        //     <div id="divtypebox${typeofaction}">
                        //       <div class="form-check" hidden>
                        //           <input class="form-check-input" value="action" type="radio" name="flexRadioDefault${typeofaction}" id="${typeofaction}" checked onclick="disable_boxes(this)">
                        //           <label class="form-check-label" for="action" >
                        //             For Compliance
                        //           </label>
                        //         </div>
                        //       <div class="form-check" hidden>
                        //           <input class="form-check-input" value="info" type="radio" name="flexRadioDefault${typeofaction}" id="${typeofaction}" onclick="disable_boxes(this)">
                        //           <label class="form-check-label" for="info">
                        //             For Information
                        //           </label>
                        //         </div>
                        //     </div>
                            
                        //   </td>`
                        //   cell6.innerHTML = add6;
                        // }
                      }
                        let add7 =''; 
                          // <button type="button"  value="${para_count}" onclick="del_complete(this.id)"><i class="fas fa-trash-alt fa-3x" aria-hidden="true" style="color:red;" title="Click to Complete Delete"></i></button>&nbsp;
                          add7 +=`<td>
                        <div class="popup">
                          <button type="button" class="btn btn-outline-info btn-sm chkbtnclass CLOSEALLOPTIONS" id="popupbutton${para_count}" onmouseleave="funccloseallspan()"  onmouseenter="myFunction('myPopup${para_count}')" onclick="myFunction('myPopup${para_count}')">
                            
                            <i class="fas fa-tools fa-2x" title="Click to Add"></i>
                            
                            </button>
                          
                                  <span class="popuptext" id="myPopup${para_count}" onclick="myFunction(this.id)" onmouseleave="funccloseallspan1()" onmouseenter="funccloseallspanset()">
                                  
                                  </span>
                          </div>&nbsp;`
                          add7 += '<button hidden class="btn btn-outline-danger btn-sm" type="button" id="'+delid+'" value="'+ para_count+'" onclick="get_del_id(this)"><i class="fa fa-trash fa-2x" aria-hidden="true" title="Click to Delete or undo Delete"></i></button>&nbsp;</td>'
                        
                        if (typ_id == 'S'){
                          add7 =`<td></td>`
                        }
                        cell7.innerHTML = add7;
                        set_para_no(table);
                      
                    }    
     
function set_para_no(table)
{
  let tbl_r_count = table.rows.length, tbl_p=0,tbl_sp=0,tbl_ssp=0, tbl_typ_id,val,chk_mrk ='Y', section_cnt='A',tbl_p1=0,tbl_sp1=0,tbl_ssp1=0;
  for(let i=0;i<tbl_r_count;i++)
  {
      value = table.rows[i].cells[0].innerHTML;
      if( value == 'S'){
        
        tbl_sp=0;
        tbl_ssp=0;
        tbl_typ_id = String(section_cnt);
        section_cnt=String.fromCharCode(section_cnt.charCodeAt(0) + 1)
        table.rows[i].cells[1].innerHTML = tbl_typ_id;
        table.rows[i].cells[2].innerHTML = tbl_typ_id;
        //changes for
        tbl_p1=0;
        tbl_sp1=0;
        tbl_ssp1=0;
        
      }
      else if( value == 'P')
      {
        tbl_p++;
        tbl_sp=0;
        tbl_ssp=0;

        tbl_p1++;
        tbl_sp1=0;
        tbl_ssp1=0;

        tbl_typ_id = String(tbl_p);
        table.rows[i].cells[2].innerHTML = String(tbl_p1);
        table.rows[i].cells[1].innerHTML = tbl_typ_id;
          $(`#showhide${para_array[i]}`).show();
          $(`#divitemtype${para_array[i]}`).show();
          $(`#divtargetdate${para_array[i]}`).show();
          $(`#divcheckbox${para_array[i]}`).show();
          $(`#divtypeboxtype${para_array[i]}`).show();
      }
      else if(value == 'SP')
      {
        tbl_sp++;
        tbl_ssp=0;

        tbl_sp1++;
        tbl_ssp1=0;

        tbl_typ_id = String(tbl_p)+'.'+String(tbl_sp);
        table.rows[i].cells[1].innerHTML = tbl_typ_id;
        table.rows[i].cells[2].innerHTML = String(tbl_p1)+'.'+String(tbl_sp1);
        for(let j=i;j<tbl_r_count;j++)
        {
          val =para_array[j];
          
          if(table.rows[j].cells[0].innerHTML != 'P')
          {
            if((table.rows[j].cells[0].innerHTML == 'SP' || table.rows[j].cells[0].innerHTML == 'SSP') && del_array.includes(val))
            {
              chk_mrk = 'N';
            }
            else
            {
              chk_mrk = 'Y';
              break;
            }
          }
          
        }
        if(table.rows[i-1].cells[0].innerHTML == 'P' && chk_mrk == 'Y' )
          {
            $(`#showhide${para_array[i-1]}`).hide();
            $(`#divitemtype${para_array[i-1]}`).hide();
            $(`#divtargetdate${para_array[i-1]}`).hide();
            $(`#divcheckbox${para_array[i-1]}`).hide();
            $(`#divtypeboxtype${para_array[i-1]}`).hide();
          }
      }
      else{
        tbl_ssp++;
        tbl_ssp1++;
        tbl_typ_id = String(tbl_p)+'.'+String(tbl_sp)+'.'+String(tbl_ssp);
        table.rows[i].cells[1].innerHTML = tbl_typ_id;
        table.rows[i].cells[2].innerHTML = String(tbl_p1)+'.'+String(tbl_sp1)+'.'+String(tbl_ssp1);
      }   
  }
}

function delete_para()
{

      for(let ok1=0;ok1<set_option_val.length;ok1++)
            set_option_val[ok1] = 0;
      var rowCount = document.getElementById("addworkmech").rows.length;
        if(rowCount == 0)
        {
          alert('Nothing to Delete');
          return false;
        }
        if(confirm('Are You sure to Delete The Last Row'))
        {
            var table = document.getElementById("addworkmech"); 
            a = para_array.pop();
            index = del_array.indexOf(a);
            
            if (index > -1) { 
              del_array.splice(index, 1); 
            }
            no_of_row -= 1;

            index = para_array_marked.indexOf(a);
            if (index > -1) { 
              para_array_marked.splice(index, 1); 
            }
            var tbldel = document.getElementById('tblspan'+a);
            if(tbldel) tbldel.parentNode.removeChild(tbldel);
            index = table_data.indexOf(a);
            if (index > -1) { 
              table_data.splice(index, 1); 
            }

            document.getElementById("addworkmech").deleteRow(-1);
            set_para_no(table)
        }
        var rowCount = document.getElementById("addworkmech").rows.length;
        if(rowCount == 0)
        {
          document.getElementById("addsection").disabled = false
          document.getElementById("genSections").disabled = false
          $('#sectionsRow').show();
        }
        reviewSections()

}

function get_del_id(th)
        {
          let val = parseInt(th.value),index,typ,typ1,index1,val1;
          let tableid = document.getElementById('addworkmech');
          index = para_array.indexOf(val);
          typ = tableid.rows[index].cells[0].innerHTML;
        
          if(del_array.includes(val))
          {
              if(index > 0)
                {
                  if(typ == 'SSP')
                  {
                    index1 = index - 1;
                    typ1 = tableid.rows[index1].cells[0].innerHTML;
                    if(typ1 == 'SP')
                    {
                      val1 = para_array[index1];
                      if(del_array.includes(val1))
                      {
                        alert('This item cannot be Undo please undo parent item');
                        return true;
                      }
                      
                      
                    }
                  }
                  else if(typ == 'SP')
                  {
                    for(let i = index-1;i>=0;i--)
                    {
                      typ1 = tableid.rows[i].cells[0].innerHTML;
                      
                      if(typ1 == 'P')
                      {
                        val1 = para_array[i];
                        
                        if(del_array.includes(val1))
                        {
                          
                          alert('This item cannot be Undo please undo parent item');
                          return true;
                        }
                        else{
                          break;
                        }
                      }
                    }
                  }
                  else if(typ == 'P')
                  {
                    for(let i = index-1;i>=0;i--)
                    {
                      typ1 = tableid.rows[i].cells[0].innerHTML;
                      if(typ1 == 'S')
                      {
                        val1 = para_array[i];
                        // alert(val1)
                        if(del_array.includes(val1))
                        {
                          alert('This item cannot be Undo please undo parent item');
                          return true;
                        }
                        else{
                          break;
                        }
                      }
                    }
                  }
                  
                }


              if(typ == 'SSP')
              {
                $(tableid.rows[index].cells[2]).removeClass("strikeout");
                $(tableid.rows[index].cells[3]).removeClass("strikeout");
                $(tableid.rows[index].cells[3]).find('textarea').removeClass("strikeoutbg");
                index1 = del_array.indexOf(val);
                if (index1 > -1) { 
                  del_array.splice(index1, 1); 
                }
              }
              else if(typ == 'SP')
              {
                $(tableid.rows[index].cells[2]).removeClass("strikeout");
                $(tableid.rows[index].cells[3]).removeClass("strikeout");
                $(tableid.rows[index].cells[3]).find('textarea').removeClass("strikeoutbg");
                index1 = del_array.indexOf(val);
                if (index1 > -1) { 
                  del_array.splice(index1, 1); 
                }
                for(let i=index+1;i<tableid.rows.length;i++)
                {
                  typ1 = tableid.rows[i].cells[0].innerHTML;
                  if(typ1 == 'SSP')
                  {
                    val = para_array[i]
                    $(tableid.rows[i].cells[2]).removeClass("strikeout");
                    $(tableid.rows[i].cells[3]).removeClass("strikeout");
                    $(tableid.rows[i].cells[3]).find('textarea').removeClass("strikeoutbg");
                    index1 = del_array.indexOf(val);
                    if (index1 > -1) { 
                      del_array.splice(index1, 1); 
                    }
                  }
                  else
                  {
                    break;
                  }
                }
              }
              else if(typ == 'P')
              {
                $(tableid.rows[index].cells[2]).removeClass("strikeout");
                $(tableid.rows[index].cells[3]).removeClass("strikeout");
                $(tableid.rows[index].cells[3]).find('textarea').removeClass("strikeoutbg");
                index1 = del_array.indexOf(val);
                if (index1 > -1) { 
                  del_array.splice(index1, 1); 
                }
                for(let i=index+1;i<tableid.rows.length;i++)
                {
                  typ1 = tableid.rows[i].cells[0].innerHTML;
                  if(typ1 != 'P' && typ1 != 'S')
                  {
                    val = para_array[i]
                    $(tableid.rows[i].cells[2]).removeClass("strikeout");
                    $(tableid.rows[i].cells[3]).removeClass("strikeout");
                    $(tableid.rows[i].cells[3]).find('textarea').removeClass("strikeoutbg");
                    index1 = del_array.indexOf(val);
                    if (index1 > -1) { 
                      del_array.splice(index1, 1); 
                    }
                  }
                  else
                  {
                    break;
                  }
                }
              }
          }
          else
          {
            if(typ == 'SSP')
            {
              del_array.push(val);
              $(tableid.rows[index].cells[2]).addClass("strikeout");
              $(tableid.rows[index].cells[3]).addClass("strikeout");
              $(tableid.rows[index].cells[3]).find('textarea').addClass("strikeoutbg");
            }
            else if(typ == 'SP')
            {
              del_array.push(val);
              $(tableid.rows[index].cells[2]).addClass("strikeout");
              $(tableid.rows[index].cells[3]).addClass("strikeout");
              $(tableid.rows[index].cells[3]).find('textarea').addClass("strikeoutbg");
              for(let i=index+1;i<tableid.rows.length;i++)
              {
                typ1 = tableid.rows[i].cells[0].innerHTML;
                if(typ1 == 'SSP')
                {
                  val = para_array[i]
                  del_array.push(val);
                  $(tableid.rows[i].cells[2]).addClass("strikeout");
                  $(tableid.rows[i].cells[3]).addClass("strikeout");
                  $(tableid.rows[i].cells[3]).find('textarea').addClass("strikeoutbg");
                }
                else
                {
                  break;
                }
              }
            }
            else if(typ == 'P')
            {
              var prev_type='N', next_type='N'
              for(let i=index-1;i>=0;i--){
                typ1 = tableid.rows[i].cells[0].innerHTML
                if(typ1 == 'S'){
                  prev_type='S'
                  break
                }
                else if(typ1 == 'P' && !($(tableid.rows[i].cells[1]).hasClass("strikeout"))){
                  prev_type='P'
                  break
                }
              }
              for(let i=index+1;i<tableid.rows.length;i++){
                typ1 = tableid.rows[i].cells[0].innerHTML
                if(typ1 == 'S'){
                  next_type='S'
                  break
                }
                else if(typ1 == 'P' && !($(tableid.rows[i].cells[1]).hasClass("strikeout"))){
                  next_type='P'
                  break
                }
              }
              
              if (prev_type=='S' && next_type=='S'){
                alert('Cannot delete the only Para between two sections')
                return true;
              }
              del_array.push(val);
              $(tableid.rows[index].cells[2]).addClass("strikeout");
              $(tableid.rows[index].cells[3]).addClass("strikeout");
              $(tableid.rows[index].cells[3]).find('textarea').addClass("strikeoutbg");
              for(let i=index+1;i<tableid.rows.length;i++)
              {
                typ1 = tableid.rows[i].cells[0].innerHTML;
                if(typ1 != 'P' && typ1 != 'S')
                {
                  val = para_array[i]
                  del_array.push(val);
                  $(tableid.rows[i].cells[2]).addClass("strikeout");
                  $(tableid.rows[i].cells[3]).addClass("strikeout");
                  $(tableid.rows[i].cells[3]).find('textarea').addClass("strikeoutbg");
                }
                else
                {
                  break;
                }
              }
            }
          }
          del_array = del_array.filter(onlyUnique);
          set_para_no(tableid);
        }

function myFunction(id) {
  let r_count = id.substring(7,id.length),prev_index,next_index,prev_typ='N',next_typ='N';
  var popup = document.getElementById(id);
  $('.popuptext').removeClass('show');
  var a = popup.classList.toggle("show");
  
 
  if( a == true)
  {
    for(let i =0;i<para_array.length;i++)
    {
      if(parseInt(r_count) == para_array[i])
      {
       
        let tbl_span_id = 'myPopup'+r_count;
        $('#'+tbl_span_id).empty();
        index = i;
        if(i == 0)
        {
          prev_index = -1;
        }
        else
        {
          prev_index = i - 1;
        }
        if(i+1 < para_array.length)
        {
          next_index = i + 1;
        }
        else
        {
          next_index = -1;
        }
        if(prev_index != -1)
        {
          prev_typ =document.getElementById("addworkmech").rows[prev_index].cells[0].innerHTML;
        }
        if(next_index != -1)
        {
          next_typ =document.getElementById("addworkmech").rows[next_index].cells[0].innerHTML;
        }
        
        curr_typ =document.getElementById("addworkmech").rows[index].cells[0].innerHTML;
        // let row = '';
        //   row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-table extra-css"  ></i></span><input type="text" onclick="addTableDropDown('add${r_count}');" value="Add Table" class="sethover"> </div>` ;
        //   row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-cut extra-css"  ></i></span><input type="text" onclick="removeTableDropDown('del${r_count}');" value="Remove Table" class="sethover"> </div>`;
        //   row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-copy extra-css"  ></i></span><input type="text" onclick="addOfficerDropDown('cpy${r_count}');" value="Copy Officer" class="sethover"></div>`;
        //   row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-trash extra-css"  ></i></span><input type="text" onclick="deleteRowDropDown('del1${r_count}');" value="Delete Row" class="sethover"> </div>` ;
        //   row +='<hr>';
        let row = '';
        row += `<button class="button button2"  type="button" id="save_btn"  class="btn btn-success" align="center" onclick="addTableDropDown('add${r_count}');"><i class="fa fa-table extra-css"></i><br>Add Table</button> `;
        row += `<button class="button button3"  type="button" id="save_btn"  class="btn btn-success" align="center" onclick="removeTableDropDown('del${r_count}');"><i class="fa fa-cut extra-css"></i><br>Remove Table</button> `;
        row += `<button class="button button4"  type="button" id="save_btn"  class="btn btn-success" align="center" onclick="addOfficerDropDown('cpy${r_count}');"><i class="fa fa-copy extra-css"></i><br>Copy Officer</button> `;  
        row += `<button class="button button5"  type="button" id="save_btn"  class="btn btn-success" align="center" onclick="deleteRowDropDown('del1${r_count}');"><i class="fa fa-trash extra-css"></i><br>Delete Row</button> `;  
        row +='<hr>'
        
      if (curr_typ == 'P'){
        if(prev_typ=='S' || prev_typ == 'N')
        { 
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i});" value="Add para Above" class="sethover"> </div>` ;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index});" value="Add para Below" class="sethover"> </div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index});" value="Add Sub-para Below" class="sethover"></div>`;
        }
        else if(prev_typ=='P')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
        }
        else if(prev_typ=='SP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
        }
        else if(prev_typ=='SSP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
        }
      }
        
      else if(curr_typ == 'SP')
        {
          if(prev_typ=='P')
          {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          }
          else if(prev_typ=='SP')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
          }
          else if(prev_typ=='SSP')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${i}); " value="Add para Above" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
          }
          if(next_typ == 'N' || next_typ == 'S')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
          }
          else if(next_typ == 'P')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
          }
          else if(next_typ == 'SP')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
          }
          else if(next_typ == 'SSP')
          {
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
            row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
          }
        }
      
      else if(curr_typ == 'SSP')
      {
        if(prev_typ=='SP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
        }
        else if(prev_typ=='SSP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${i}); " value="Add Sub para Above" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${i}); " value="Add Sub Subpara Above" class="sethover"></div>`;
        }
        if(next_typ == 'N' || next_typ == 'S')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
        }
        else if(next_typ == 'P')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
        }
        else if(next_typ == 'SP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('P',${next_index}); " value="Add para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
        }
        else if(next_typ == 'SSP')
        {
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SP',${next_index}); " value="Add Sub-para Below" class="sethover"></div>`;
          row += `<div class="input-group-prepend"><span class="input-group-text extra-css"><i class="fa fa-plus extra-css"  ></i></span><input type="text" onclick="addpara('SSP',${next_index}); " value="Add Sub Subpara Below" class="sethover"></div>`;
        }
      }
        
      $('#'+tbl_span_id).append(row);
        break;
      }
    } 
  }
}

function Copy_marked_officer()
{
    /// get idselected and clicked
    if(set_offier_id == '')
    {
      alert('Nothing is selected, please select');
      return false;
    }
    
    let testid = (copy_offier_id).substring(3,(copy_offier_id).length);
    
    let idsel = set_offier_id;
    let idmark = 'markeofficer'+idsel;
    let officer_val = document.getElementById(idmark).getAttribute('custom-offic');
    if(officer_val == '')
    {
        alert('Nothing is Selected in Marked Officer');
        return false;
    }
    officer_val = officer_val.split(',')
    let values=[]
    for(i=0;i<officer_val.length;i++)
    {
      values.push(officer_val[i])
    }
    
    emp_no = values;
    let tooltipid='tooltip'+ testid.replaceAll('.','a');
    let markofficer='markeofficer'+ testid;  
   
    data={
        'officer_id': JSON.stringify(values),
        'csrfmiddlewaretoken': '{{csrf_token}}'
      }
      $.ajax({
                  type : 'POST',
                  url : "{% url 'copy_get_marked_officers' %}",
                  dataType : 'json',
                  data : data,
          
                  success : function(response)
                  {


                    $(`#desgn${testid}`).selectpicker("destroy");
                    for(let ij =0;ij<response.length;ij++)
                    {
                      if($(`#desgn${testid} option[value='${response[ij].designation_code}']`).length <= 0)
                      {
                        
                        $(`#desgn${testid}`).append(`<option value="${response[ij].designation_code}" data-tokens="${response[ij].empnoser}">${response[ij].designation}</option>`);
                      }
                    }

                    var officer='officer'+testid;
                    $(`.desgn${testid}`).selectpicker();	
                    $(`.desgn${testid}`).removeClass("dropdown");	
                    var button = $(`#divdesgn${testid} .bs-actionsbox .btn-group`);	
                    button.append(`<button type="button" id="bdesgn${testid}" class="btn btn-default btn-light" onclick="getOption('desgn${testid}')" hidden>Save</button>`)	
                    button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${testid}');">Go/Close</button>`)	
                    button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);	
                    button.append(`<button type="button" id="btndel${testid}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)	
                    
                    $(`#desgn${testid}`).on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue){	
                      let his_id= this.id;
                      getOption(`${his_id}`);
                        });	
                    function removePopupForBtn(el){	
                        let idpattern = '#'+el +' '+'.bootstrap-select'	
                        $(idpattern).removeClass('show')	
                      };
                    $(`.desgn${testid}`).selectpicker('val', emp_no);
              },
              error: function(data)
              {
                alert('Some error exist, contact Adminstrator')
              }
            })
    document.getElementById('closeofficermodal').click();              
}

function copy_mark_officer(th)
{
 
    copy_offier_id = th.id;
    let copy_id = parseInt((copy_offier_id).substring(3,(copy_offier_id).length));
    let tableid = document.getElementById('addworkmech'), typ,val,id,itm,count_row=0,count_col=0, showHideId='showhide'+String(copy_id);
    if(document.getElementById(showHideId).style.display === 'none')
    {
      alert('Cannot use copy because, nothing to set copied value');
      return false;
    }
    if(para_array.length == 0)
    {
      alert('Nothing is present to Copy from');
      return false;
    }
    $('#add_officer_tbl tbody').empty();
    let row='<tr><td><label style="font-weight:bold;"> Select From Paragraph</label><br>';
    for(let j=0;j<tableid.rows.length;j++)
    {
      typ = tableid.rows[j].cells[0].innerHTML;
      itm = tableid.rows[j].cells[1].innerHTML;
      val = para_array[j];
      id='showhide'+String(val);
      if(!$('#'+id).is(':hidden') && typ == 'P' && copy_id != val)
        {  
          row += `<input type="radio" name="deletion_type" value="${val}" onclick="fun_set_officer_copy('${val}')">
                  <label>Para ${itm}</label>&nbsp;`;
                  count_row ++;
        }
      
    }
    row += '</td></tr><tr><td><label style="font-weight:bold;"> Select From Sub Paragraph</label><br>'
    for(let j=0;j<tableid.rows.length;j++)
    {
      typ = tableid.rows[j].cells[0].innerHTML;
      itm = tableid.rows[j].cells[1].innerHTML;
      val = para_array[j];
      id='showhide'+String(val);
      if(!$('#'+id).is(':hidden') && typ == 'SP' && copy_id != val)
        {  
          row +=`<input type="radio" name="deletion_type" value="${val}" onclick="fun_set_officer_copy('${val}')">
            <label>Subpara ${itm}</label>&nbsp;`
            count_col ++;
        }
    }
    row += '</td></tr>';
    if(count_col ==0 && count_row ==0)
    {
      alert('Nothing to copy From');
      return false;
    }
    $('#add_officer_tbl tbody').append(row);
    document.getElementById('openofficeremodal').click();
}

function fun_set_officer_copy(val)
{
  set_offier_id = val;
}

var pass = false;
function Updatedraft_data2(el)
  { 
              var table = document.getElementById("addworkmech");
              var zone=$("#zone").val();
              var division=$("#division").val();
              var location=$("#location").val();
              var department=$('#department').val();
              let ar1 = {}
              let myarr2 = {}
              let getItemArray = [],deletedItemListImg=[],correspondingItem=[];
              let head = 0,shead, sshead,headid='',count=0, pardata;
              hli = 0,full_array=[],hliArray = [];
              const isUpperCase = (string) => /^[A-Z]*$/.test(string)
          
              for(let i=0;i<table.rows.length;i++)
              {
                let character = table.rows[i].cells[1].innerHTML;
                
                if (isUpperCase(character)) {
                    hliArray.push(character);
                    }
                   
                else if(table.rows[i].cells[0].innerHTML == 'P')
                  {  
                    hli++;
                    hliArray.push(character);
                  }

                full_array.push(table.rows[i].cells[1].innerHTML)
              }
              
              for( ijk=0; ijk<hliArray.length; ijk++)
              {
                shead =0;
                sshead=0;
                let ar ={}
                let myar1 = []
                if (isUpperCase(hliArray[ijk]))
                {
                          let index=full_array.indexOf(hliArray[ijk]);
                          if(del_array.includes(index) && el.value == 'View_data' )
                          {
                            continue;
                          }
                          
                          
                         let conw=true;

                         let whilecount = 0
                         while(conw)
                         {
                            try
                            {
                              whilecount++;
                              if(whilecount>=100)
                              {
                                conw = false;
                              }
                              
                              let hid1='location_at'+ String(index);
                              index=parseInt(index)+1;
                              var val = document.getElementById(hid1).innerHTML;
                              ar[hliArray[ijk]] = val;
                              myar1.push(String(hliArray[ijk]));
                              conw = false;
                            }
                            catch(err)
                            {
                              if(whilecount>=100)
                              {
                                conw = false;
                              }
                              pass;
                            }
                          }
                        
                }
                else{
                  i =parseInt(hliArray[ijk])
                for(let j=0; j<full_array.length; j++)
                {
                  
                    paradata = para_array[j]
                    if(del_array.includes(paradata) && el.value == 'View_data' )
                    {
                      if(!deletedItemListImg.includes(full_array[j]))
                          deletedItemListImg.push(full_array[j])
                      continue;
                    }
                    
                    if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.'){ 
                        let temp = full_array[j].split('.')
                        if(temp.length == 1){
                          shead =0;
                          sshead =0;
                          head++;
                          headid = String(head);
                          correspondingItem[full_array[j]]=headid;
                          getItemArray.push(paradata);
                          let hid='heading'+ String(paradata);
                          let hid1='heading'+ headid;
                          var val = document.getElementById(hid).value;
                          ar[hid1] = val;
                          
                          let table_det=[];
                          if(table_data.includes(String(paradata)))
                          {
                                tableid = 'tblspan'+String(paradata);
                                var oTable = document.getElementById(tableid);
                                var rowLength = oTable.rows.length;
                                for (ig = 0; ig < rowLength; ig++){
                                  table_det1=[]
                                  var oCells = oTable.rows.item(ig).cells;
                                  var cellLength = oCells.length;
                                  for(var jg = 0; jg < cellLength; jg++){
                                      var cellVal = oCells.item(jg).children[0].value;
                                      table_det1.push(cellVal)
                                  }
                                  table_det.push(table_det1)
                                }
                          }
                          ar[headid]=table_det;

                          d1_test = full_array[j]+'.'
                      
                          d2_test = 'Yes'

                          for(iv=j+1;iv<table.rows.length;iv++)
                          {
                            if(table.rows[iv].cells[0].innerHTML == 'P' || table.rows[iv].cells[0].innerHTML == 'S')
                            {
                              break;
                            }
                            if(del_array.includes(para_array[iv]))
                            {
                              d2_test = 'Yes'
                            }
                            else
                            {
                              d2_test ='No'
                              break
                            }
                          }
                          if(d2_test == 'No')
                          {
                            pass;
                          }
                          else{
    
    
                              // let td = 'targetdate' + String(paradata);
                              let mf = 'markeofficer' + String(paradata);
                              // let chk = 'check' + String(paradata);
                              // var tddate = document.getElementById(td).value;
                              // let rema = 'remarksmarkeofficer' + String(paradata);
                              // var remarks = document.getElementById(rema).value;
                              // let chk_val = document.getElementById(chk)
                              // if (chk_val.checked == true){
                              //     var checkbox = '1'
                              // }
                              // else if (chk_val.checked == false){
    
                              //   checkbox = '0'
                              // }
                              
                              var officer_val = document.getElementById(mf).value;
                              var officerinfo = document.getElementById(mf).getAttribute('custom-info');
                              let mf2 = 'markeofficerinfo' + headid;
                              ar[mf2]=officerinfo
                              // let td1 = 'targetdate' + headid;
                              let mf1 = 'markeofficer' + headid;
                              
                              // let chk1 = 'check' + headid;
                              // let rem = 'remarksmarkeofficer' + headid;
                              // ar[rem]=remarks
                              // ar[td1]=tddate
                              ar[mf1]=officer_val
                              
                              // ar[chk1]=checkbox  
                              
                          }
    
                    
                        }
                        else if(temp.length == 2){
                          sshead=0;
                          shead++;
                          getItemArray.push(paradata);
                          headid = String(head)+'.'+String(shead);
                          correspondingItem[full_array[j]]=headid;
                          let sid='heading'+String(paradata);
                          // let td = 'targetdate' + String(paradata);
                          let mf = 'markeofficer' + String(paradata);
                          // let chk = 'check' + String(paradata);
    
                          var val1 = document.getElementById(sid).value;
                          // var tddate = document.getElementById(td).value;

                          // let rema = 'remarksmarkeofficer' + String(paradata);
                          // var remarks = document.getElementById(rema).value;
                          
                          
                          let table_det=[];
                          if(table_data.includes(String(paradata)))
                          {
                                tableid = 'tblspan'+String(paradata);
                                var oTable = document.getElementById(tableid);
                                var rowLength = oTable.rows.length;
                                for (ig = 0; ig < rowLength; ig++){
                                  table_det1=[]
                                  var oCells = oTable.rows.item(ig).cells;
                                  var cellLength = oCells.length;
                                  for(var jg = 0; jg < cellLength; jg++){
                                      var cellVal = oCells.item(jg).children[0].value;
                                      table_det1.push(cellVal)
                                  }
                                  table_det.push(table_det1)
                                }
                          }
                          ar[headid]=table_det;
                          // let chk_val = document.getElementById(chk)
                          // if (chk_val.checked == true){
                          //     var checkbox = '1'
                          // }
                          // else if (chk_val.checked == false){
    
                          //   checkbox = '0'
                          // }
                          
    
                          var officer_val = document.getElementById(mf).value;
                          
                          let sid1='observation'+headid;
                          // let td1 = 'targetdate' + headid;
                          let mf1 = 'markeofficer' + headid;
                          // let chk1 = 'check' + headid;
                          // let rem = 'remarksmarkeofficer' + headid;
                          // ar[rem]=remarks
                          ar[sid1]=val1
                          // ar[td1]=tddate
                          ar[mf1]=officer_val
                          // ar[chk1]=checkbox
                          var officerinfo = document.getElementById(mf).getAttribute('custom-info');
                          let mf2 = 'markeofficerinfo' + headid;
                          ar[mf2]=officerinfo
                        } 
                        else{
                          sshead++;
                          headid = String(head)+'.'+String(shead)+'.'+String(sshead);
                          correspondingItem[full_array[j]]=headid;
                          let ssid='heading'+String(paradata);
                          var val2 = document.getElementById(ssid).value;
                          let ssid1='subdes'+headid;
                          let table_det=[];
                          if(table_data.includes(String(paradata)))
                          {
                                tableid = 'tblspan'+String(paradata);
                                var oTable = document.getElementById(tableid);
                                var rowLength = oTable.rows.length;
                                for (ig = 0; ig < rowLength; ig++){
                                  table_det1=[]
                                  var oCells = oTable.rows.item(ig).cells;
                                  var cellLength = oCells.length;
                                  for(var jg = 0; jg < cellLength; jg++){
                                      var cellVal = oCells.item(jg).children[0].value;
                                      table_det1.push(cellVal)
                                  }
                                  table_det.push(table_det1)
                                }
                          }
                          ar[headid]=table_det;
                          ar[ssid1]=val2
                        }
                        
                        myar1.push(String(headid))
                      }
                  }
                }
                if(myar1.length == 0)
                  continue;
                count++;
                
                ar1[String(count)]=ar
                myarr2[String(count)]=myar1
              }
              
             

              document.getElementById('viewmodalbtn').click();
              var obj = '';
              $('#table2 tbody').empty();
              let insTypeOPE = ['Others','Railway User Safety','Rly Employee Safety']
              
              
              let unip=0,unisp=0,unissp=0,section_cnt='A';
              for(i in myarr2)
              {
                
                arr2 = myarr2[i];
                if (isUpperCase(arr2[0]))
                {
                  dataLocation = (ar1[i][arr2[0]]).split('#')
                  
                  obj +='<tr><td style="width:10%;">'+String(section_cnt)+'</td><td colspan="2" style="width:50%;">'+dataLocation+'</td><td style="width:40%;"></td></tr>';  
                  section_cnt=String.fromCharCode(section_cnt.charCodeAt(0) + 1);
                  unip=0;
                  unisp=0;
                  unissp=0;
                }
                else
                {
                for(j=0;j<arr2.length;j++)
                {
                  obj +='<tr>';
                  data = arr2[j].split('.');
                 
                  

                  if((data).length == 1)
                  {
                    unip++;
                    unisp=0;
                    unissp=0;
                    if(arr2.length == 1)
                    {
                      getItemValue = getItemArray.splice(0,1);
                      item_type_PEO = document.getElementById('item_type'+getItemValue[0]).value;
                      heading = ar1[i]['heading'+arr2[j]];
                      // targetdate = ar1[i]['targetdate' +arr2[j]];
                      markeofficer = ar1[i]['markeofficer'+arr2[j]];
                      // markeofficer = markeofficer.replace(',',', ')
                      
                      if(ar1[i]['markeofficerinfo'+arr2[j]].length)
                        officerinfo =  JSON.parse(ar1[i]['markeofficerinfo'+arr2[j]]);
                      else
                        officerinfo = ""

                      
                      // check = ar1[i]['check'+arr2[j]];

                      tbl21 = ar1[i][arr2[j]];

                      
    
                      obj += `<td style="width:10%;">${arr2[j]}</td>`;
                      obj += `<td style="width:40%;">${heading}`;
                      if(tbl21.length>0)
                      { 
                        
                        obj+='<br><table style="width:100%; border-style:solid;">';
                        for(i9=0;i9<tbl21.length;i9++)
                        {
                          obj+='<tr>';
                            for(i8=0;i8<tbl21[i9].length;i8++)
                            {
                              obj+='<td>'+tbl21[i9][i8]+'</td>';
                            }
                            obj+='</tr>';
                        }
                        obj+='</table>';
                      }
                      obj +='</td>';
                      obj +='<td style="width:10%;">'+insTypeOPE[item_type_PEO]+'</td>';
                      if(officerinfo.length || markeofficer.length){
                      obj+=`<td style="width:40%;">
                        <table  class="table table-striped" style="width: 100%; background-color: #c4dcfb;">`
                            if(officerinfo.length){
                              let officerOrder = []
                              for (var i91=0;i91<officerinfo.length;i91++){
                                if (officerinfo[i91]['selected_action'] == 'info' )
                                    officerOrder.push(officerinfo[i91])
                              }
                              for (var i91=0;i91<officerinfo.length;i91++){
                                if (officerinfo[i91]['selected_action'] == "action" )
                                    officerOrder.push(officerinfo[i91])
                              }
                              officerinfo = officerOrder;
                              for (var i91=0;i91<officerinfo.length;i91++){
                              
                                obj+=` <tr>
                                    <td style="width: 25%;">${officerinfo[i91]['Designation']}</td>`
                                    if (officerinfo[i91]['selected_action'] == 'info' )
                                    {
                                        obj+=`   <td style="width: 25%;"> For Information</td>
                                                  <td style="width: 25%;"></td>
                                                  <td style="width: 25%;">`
                                    }
                                    else
                                    {
                                          obj+=`<td style="width: 25%;">For Action </td>
                                              <td style="width: 25%;">`
                                      if (officerinfo[i91]['tddate']!='-1') 
                                        obj+=`${officerinfo[i91]['tddate']}` 
                                      obj+=`  </td><td style="width: 25%;">`
                                            if (officerinfo[i91]['priority']==1) 
                                            obj+=`On priority` 
                                          }
                                      obj+=`</td> </tr>`
                                  }
                              }
                            else{
                              officerinfo=markeofficer.split(',')
                              for (var i91=0;i91<officerinfo.length;i91++)
                                   {
                                    
                                     obj+=`<tr>
                                        <td style="width: 25%;">${officerinfo[i91]}</td>`
                                        if(officerinfo[i91] == '')
                                          obj+=`<td style="width: 25%;"> </td>`
                                        else
                                          obj+=`<td style="width: 25%;"> For Action</td>`
                                        
                                        obj+=`<td style="width: 25%;"></td>
                                        <td style="width: 25%;"></td>
                                      </tr>`
                                    }
                            }
                          }
                        else
                        obj +='<td style="width:10%;"><table style="width: 100%;">'
                        obj+=`</table></td>`
                      // obj += `<td>${markeofficer}</td>`;
                      // obj += `<td>${targetdate}</td>`;
                      // if(check =='1')
                      //   obj += `<td>High</td>`;
                      // else
                      //   obj += `<td>-</td>`;
                    }
                    else
                    {
                      getItemValue = getItemArray.splice(0,1);
                      item_type_PEO = document.getElementById('item_type'+getItemValue[0]).value;
                      tbl21 = ar1[i][arr2[j]];
                      heading = ar1[i]['heading'+arr2[j]];
                      obj += `<td style="width:10%;">${arr2[j]}</td>`;
                      obj += `<td style="width:40%;">${heading}`;
                        if(tbl21.length>0)
                      {
                        obj+='<br><table style="width:100%; border-style:solid;">';
                        for(i9=0;i9<tbl21.length;i9++)
                        {
                          obj+='<tr>';
                            for(i8=0;i8<tbl21[i9].length;i8++)
                            {
                              obj+='<td>'+tbl21[i9][i8]+'</td>';
                            }
                            obj+='</tr>';
                        }
                        obj+='</table>';
                      }
                      obj +='</td>';
                      //obj += `<td>`+insTypeOPE[item_type_PEO]+`</td>`;
                      obj += `<td style="width:10%;"></td>`;
                      obj += `<td style="width:40%;"></td>`;
                     
                    }
                  }
                  else if((data).length == 2)
                  {
                    unisp++;
                    unissp=0;
                      getItemValue = getItemArray.splice(0,1);
                      item_type_PEO = document.getElementById('item_type'+getItemValue[0]).value;
                      heading = ar1[i]['observation'+arr2[j]];
                      // targetdate = ar1[i]['targetdate' +arr2[j]];
                      
                      markeofficer = ar1[i]['markeofficer'+arr2[j]];
                      if(ar1[i]['markeofficerinfo'+arr2[j]].length)
                        officerinfo =  JSON.parse(ar1[i]['markeofficerinfo'+arr2[j]]);
                      else
                        officerinfo = ""
                      // check = ar1[i]['check'+arr2[j]];
                      tbl21 = ar1[i][arr2[j]];
                      obj += `<td style="width:10%;">${arr2[j]}</td>`;
                      obj += `<td style="width:40%;">${heading}`;
                        if(tbl21.length>0)
                      {
                        obj+='<br><table style="width:100%; border-style:solid;">';
                        for(i9=0;i9<tbl21.length;i9++)
                        {
                          obj+='<tr>';
                            for(i8=0;i8<tbl21[i9].length;i8++)
                            {
                              obj+='<td>'+tbl21[i9][i8]+'</td>';
                            }
                            obj+='</tr>';
                        }
                        obj+='</table>';
                      }
                      obj +='</td>';
                      obj += `<td style="width:10%;">${insTypeOPE[item_type_PEO]}</td>`;
                      if(officerinfo.length || markeofficer.length){
                      obj+=`<td style="width:40%;">
                        <table  class="table table-striped" style="width: 100%; background-color: #c4dcfb;">`
                          if(officerinfo.length){
                            let officerOrder = []
                              for (var i91=0;i91<officerinfo.length;i91++){
                                if (officerinfo[i91]['selected_action'] == 'info' )
                                    officerOrder.push(officerinfo[i91])
                              }
                              for (var i91=0;i91<officerinfo.length;i91++){
                                if (officerinfo[i91]['selected_action'] == "action" )
                                    officerOrder.push(officerinfo[i91])
                              }
                              officerinfo = officerOrder;
                              for (var i91=0;i91<officerinfo.length;i91++){
                              obj+=` <tr>
                                    <td style="width: 25%;">${officerinfo[i91]['Designation']}</td>`
                                    if (officerinfo[i91]['selected_action'] == 'info' )
                                    {
                                    obj+=`   <td style="width: 25%;"> For Information</td>
                                        <td style="width: 25%;"></td>
                                        <td style="width: 25%;">`
                                    }
                                    else
                                    {
                                    obj+=`<td style="width: 25%;">For Action </td>
                                        <td style="width: 25%;">`
                                          if (officerinfo[i91]['tddate']!='-1') obj+=`${officerinfo[i91]['tddate']}` 
                                    obj+=`  </td>
                                        <td style="width: 25%;">`
                                          if (officerinfo[i91]['priority']==1) obj+=`On priority` 
                                        }
                                    obj+=`</td> </tr>`
                                        }
                      }
                      else{
                        officerinfo=markeofficer.split(',')
                        for (var i91=0;i91<officerinfo.length;i91++)
                        {
                                    
                                    obj+=`<tr>
                                       <td style="width: 25%;">${officerinfo[i91]}</td>`
                                       if(officerinfo[i91] == '')
                                         obj+=`<td style="width: 25%;"> </td>`
                                       else
                                         obj+=`<td style="width: 25%;"> For Action</td>`
                                       
                                       obj+=`<td style="width: 25%;"></td>
                                       <td style="width: 25%;"></td>
                                     </tr>`
                                   }
                              // obj+=`<tr>
                              //     <td style="width: 25%;">${officerinfo[i91]}</td>
                              //     <td style="width: 25%;"> For Action</td>
                              //     <td style="width: 25%;"></td>
                              //     <td style="width: 25%;"></td>
                              //   </tr>`
                      }

                    }
                        else
                        obj +='<td style="width:40%;"><table style="width: 100%;">'
                      obj+=`</table></td>`
                      // obj += `<td>${markeofficer}</td>`;
                      // obj += `<td>${targetdate}</td>`;
                      // if(check =='1')
                      //   obj += `<td>High</td>`;
                      // else
                      //   obj += `<td>-</td>`;
                  }
                  else
                  {
                   unissp++;
                    tbl21 = ar1[i][arr2[j]];
                      obj += `<td style="width:10%;">${arr2[j]}</td>`;
                      heading = ar1[i]['subdes'+arr2[j]];
                      obj += `<td style="width:40%;">${heading}`;
                        if(tbl21.length>0)
                      {
                        obj+='<br><table style="width:100%; border-style:solid;">';
                        for(i9=0;i9<tbl21.length;i9++)
                        {
                          obj+='<tr>';
                            for(i8=0;i8<tbl21[i9].length;i8++)
                            {
                              obj+='<td>'+tbl21[i9][i8]+'</td>';
                            }
                            obj+='</tr>';
                        }
                        obj+='</table>';
                      }
                      obj +='</td>';
                      obj += `<td style="width:10%;"></td><td style="width:40%;"></td>`;
                     
                  }
                  
                  
                  obj +='</tr>';
                }
                
              }}

              $('#table2 tbody').append(obj)   
               
              var zone=$("#zone").val();
              var division=$("#division").val();
              var location=$("#location").val();
              var department=$('#department').val();
              var titleinsp=$('#titleinsp').val();
              $('#head3').html(titleinsp);
              let previnsp_type = document.getElementById('insp_type').value;
              if(previnsp_type == '0')
                previnsp_type = 'Regular Inspection'
              else if(previnsp_type == '1')
                previnsp_type = 'Drive Based Inspection(issued by RB)'
              else if(previnsp_type == '2')
                previnsp_type = 'Night Inspection'
              else if(previnsp_type == '3')
                previnsp_type = 'Surprise Inspection'
              $('#insptypepreview').html(previnsp_type);  
              
              var accompany=$('#accompany').val();
              if (accompany.length)
                accompany='Accompanied By: '+accompany
              $('#acco').html(accompany);
              var copyto=$('#copyto').val();
              copyto = copyto.replaceAll(',',', ')
              $('#insp_desig').html(copyto);
              var sttninsp=$('#sttninsp').val();
              $('#head4').html(sttninsp);
              var desiginsp=$('#desiginsp').val();
              $('#head5').html(desiginsp);
              var ofcnameinsp=$('#ofcnameinsp').val();
              $('#head6').html(ofcnameinsp);

              let imgId,imgSrc,imgDet='',imgSelId,imgFrame = document.querySelectorAll('.imgFrame'),counti=0,dataval;
              $('#imgViewShow').empty();
    
              for(let i =0; i<imgFrame.length;i++)
              {
                  imgId = $(imgFrame[i]).attr('id');
                  imgSelId = 'select_img_'+imgId.substring(5,imgId.length)
                  
                  if(document.getElementById(imgId).value != '' && !deletedItemListImg.includes($("#"+imgSelId+" option:selected").text().trim()))
                  {
                    if(counti%2 == 0)
                      imgDet +=`<div class="container-fluid row text-center">`;

                      imgSrc = $(imgFrame[i]).attr('src');
                      dataval = correspondingItem[$("#"+imgSelId+" option:selected").text().trim()]
                      imgDet += `<div class="col-lg-6 text-center">
                      <img src=${imgSrc} width="600px" height="400px" />
                      <h5>Pic:${(i+1)} with reference to S.No. ${dataval}</h5>
                      </div>`

                    if(counti%2 != 0)
                      imgDet +=`</div>`;
                      counti++;
                    
                  }
              }
              $('#imgViewShow').append(imgDet);
  }

  //   function isCharacterALetter(char) {
//     alert(char)
//   return (/[A-Z]/).test(char)
// }
function Updatedraft_data1(el)
  { 
    clearInterval(globalTimerIDAutoSave);
      var table = document.getElementById("addworkmech");
      var zone=$("#zone").val();
      var division=$("#division").val();
      var location=$("#location").val();
      var department=$('#department').val();
      var insp_type=$('#insp_type').val();
      var item_sections = 0;
      let ar1 = {}
      let myarr2 = {}
      let sec_details={}
      let sec_ids = {}
      let head = 0,shead, sshead,headid='',count=0, section='A';

      hli = 0,full_array=[],hliArray = [];
      const isUpperCase = (string) => /^[A-Z]*$/.test(string)
   
      for(let i=0;i<table.rows.length;i++)
      {
        if(table.rows[i].cells[0].innerHTML == 'P')
          hli++;
        if (table.rows[i].cells[0].innerHTML == 'S'){
          item_sections=1
        }
        full_array.push(table.rows[i].cells[1].innerHTML);
      }
   

      let ar ={}
      let id_ar=[]
      let sec_id_ar={},section1='';

      if (item_sections==1){
        let sethead = 1,section_cnt='A';
        for(let j=0; j<full_array.length; j++)
        {
          paradata = para_array[j] 
          let temp = String(full_array[j].split('.'))
          let temp1 = full_array[j].split('.')
          
          if(del_array.includes(j) && el.value == 'Submit' )
          {
            continue;
          }
          if (temp1.length == 1 && (temp.charCodeAt(0)>=65 && temp.charCodeAt(0)<=90 )){
              headid = String(temp);
              let hid='location_at'+ String(paradata);
              let hid1='location_at'+ section_cnt;
              var val = document.getElementById(hid).value;
              ar[hid1]=val;
              section_cnt=String.fromCharCode(section_cnt.charCodeAt(0) + 1);
            }
        }
        sethead = 1,section_cnt='A';
        for (let j=0; j<full_array.length; j++)
        {
          if(del_array.includes(j) && el.value == 'Submit' )
          {
            continue;
          }
          let temp = full_array[j].split('.')
                
          if (temp.length == 1){
            
            temp = String(temp)
            if (temp.charCodeAt(0)>=65 && temp.charCodeAt(0)<=90 ){
              section1=section_cnt;
              section_cnt=String.fromCharCode(section_cnt.charCodeAt(0) + 1);
              id_ar=[]
            }
            else{
              id_ar.push(String(sethead++));
            }
            sec_id_ar[section1]=id_ar
          }
        }
        
      }
      sec_details=JSON.stringify(ar)
      sec_ids=JSON.stringify(sec_id_ar)
    
      
      for(let i=1; i<=hli; i++){
        shead =0;
        sshead=0;
        let ar ={}
        let myar1 = []
        
        for(let j=0; j<full_array.length; j++)
        {
          paradata = para_array[j] 
            if(del_array.includes(paradata) && el.value == 'Submit' )
            {
              continue;
            }
          
            if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.')
            { 
                
              let temp = full_array[j].split('.')
                if(temp.length == 1 ){
                  shead =0;
                  sshead =0;
                  head++;
                  headid = String(head);
                  let hid='heading'+ String(paradata);
                  let hid1='heading'+ headid;
                  var val = document.getElementById(hid).value;
                  ar[hid1]=val
                  // for type of action
                    // let typeofaction = 'type'+ String(paradata);
                    // let action_val = document.getElementById(typeofaction);
                    
                    // if (action_val.checked == true){
                    //   var selected_action= "info"
                    // }
                    // else{
                    //   var selected_action= "action"
                    // }
                    // let action1='type'+ full_array[j];
                    // ar[action1]=selected_action
                  
                  let table_det=[];
                  if(table_data.includes(String(paradata)))
                  {
                    tableid = 'tblspan'+String(paradata);
                    var oTable = document.getElementById(tableid);
                    var rowLength = oTable.rows.length;
                    for (ig = 0; ig < rowLength; ig++){
                      table_det1=[]
                      var oCells = oTable.rows.item(ig).cells;
                      var cellLength = oCells.length;
                      for(var jg = 0; jg < cellLength; jg++){
                        var cellVal = oCells.item(jg).children[0].value;
                        table_det1.push(cellVal)
                      }
                      table_det.push(table_det1)
                    }
                  }
                  ar[headid]=table_det;

                  
              d1_test = full_array[j]+'.'
              // var result_test = full_array.filter(option => option.startsWith(d1_test));
              
                d2_test = 'Yes'
                for(iv=j+1;iv<table.rows.length;iv++)
                  {
                    if(table.rows[iv].cells[0].innerHTML == 'P' || table.rows[iv].cells[0].innerHTML == 'S')
                    {
                      break;
                    }
                    if(del_array.includes(para_array[iv]))
                    {
                      d2_test = 'Yes'
                    }
                    else
                    {
                      d2_test ='No'
                      break
                    }
                  }

              if(d2_test == 'No')
              {
                a=1;
              }
                  else{
                      // let td = 'targetdate' + String(paradata);
                      let mf = 'markeofficer' + String(paradata);
                      let ity = 'item_type'+String(paradata);
                      // let chk = 'check' + String(paradata);
                      // var tddate = document.getElementById(td).value;
                      // let chk_val = document.getElementById(chk)


                      let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal)
                              }
                              table_det.push(table_det1)
                            }
                      }
                      ar[headid]=table_det;
                      // if (chk_val.checked == true){
                      //     var checkbox = '1'
                      // }
                      // else if (chk_val.checked == false){

                      //   checkbox = '0'
                      // }
                      
                      var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                      var officer_info = document.getElementById(mf).getAttribute('custom-info');
                      var itemtype = document.getElementById(ity).value;
                      let it = 'item_type' + headid
                      // let td1 = 'targetdate' + headid;
                      let mf1 = 'markeofficer' + headid;
                      let mf2 = 'markeofcinfo' + headid;
                      // let chk1 = 'check' + headid;
                      // ar[td1]=tddate
                      ar[mf1]=officer_val
                      ar[mf2]=officer_info
                      ar[it]=itemtype
                      // ar[chk1]=checkbox  
                      // let rema = 'remarksmarkeofficer' + String(paradata);
                      // var remarks = document.getElementById(rema).value;
                      // let rem = 'remarksmarkeofficer' + headid;
                      // ar[rem]=remarks
                      
                    }

            
                }
                else if(temp.length == 2){
                  sshead=0;
                  shead++;
                  headid = String(head)+'.'+String(shead);
                  let sid='heading'+String(paradata);
                  // let td = 'targetdate' + String(paradata);
                  let mf = 'markeofficer' + String(paradata);
                  let ity = 'item_type'+String(paradata);
                  // let chk = 'check' + String(paradata);

                  var val1 = document.getElementById(sid).value;
                  // var tddate = document.getElementById(td).value;
                  // let chk_val = document.getElementById(chk)
                  // if (chk_val.checked == true){
                  //     var checkbox = '1'
                  // }
                  // else if (chk_val.checked == false){

                  //   checkbox = '0'
                  // }
                  
                  
                  let table_det=[];
                  if(table_data.includes(String(paradata)))
                  {
                        tableid = 'tblspan'+String(paradata);
                        var oTable = document.getElementById(tableid);
                        var rowLength = oTable.rows.length;
                        for (ig = 0; ig < rowLength; ig++){
                          table_det1=[]
                          var oCells = oTable.rows.item(ig).cells;
                          var cellLength = oCells.length;
                          for(var jg = 0; jg < cellLength; jg++){
                              var cellVal = oCells.item(jg).children[0].value;
                              table_det1.push(cellVal)
                          }
                          table_det.push(table_det1)
                        }
                  }
                  ar[headid]=table_det;

                  var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                  var officer_info = document.getElementById(mf).getAttribute('custom-info');
                  var itemtype = document.getElementById(ity).value;

                  if(officer_val == '' && el.value == 'Submit'){
                    alert('Please Add mark officers')
                    return false;
                  }
                  
                  let sid1='observation'+headid;
                  // let td1 = 'targetdate' + headid;
                  let mf1 = 'markeofficer' + headid;
                  let mf2 = 'markeofcinfo' + headid;
                  let it = 'item_type' + headid
                  // let chk1 = 'check' + headid;

                  ar[sid1]=val1
                  // ar[td1]=tddate
                  ar[mf1]=officer_val
                  ar[mf2]=officer_info
                  ar[it]=itemtype
                  // ar[chk1]=checkbox
                  // let rema = 'remarksmarkeofficer' + String(paradata);
                  // var remarks = document.getElementById(rema).value;
                  // let rem = 'remarksmarkeofficer' + headid;
                  // ar[rem]=remarks

                  // for type of action
                  // let typeofaction = 'type'+ String(paradata);
                  // let action_val = document.getElementById(typeofaction);
                  
                  // if (action_val.checked == true){
                  //   var selected_action= "info"
                  // }
                  // else{
                  //   var selected_action= "action"
                  // }
                  // let action1='type'+ full_array[j];
                  // ar[action1]=selected_action
                } 
                else{
                  sshead++;
                  headid = String(head)+'.'+String(shead)+'.'+String(sshead);
                  let ssid='heading'+String(paradata);
                  var val2 = document.getElementById(ssid).value;
                  let ssid1='subdes'+headid;
                  
                  let table_det=[];
                  if(table_data.includes(String(paradata)))
                  {
                        tableid = 'tblspan'+String(paradata);
                        var oTable = document.getElementById(tableid);
                        var rowLength = oTable.rows.length;
                        for (ig = 0; ig < rowLength; ig++){
                          table_det1=[]
                          var oCells = oTable.rows.item(ig).cells;
                          var cellLength = oCells.length;
                          for(var jg = 0; jg < cellLength; jg++){
                              var cellVal = oCells.item(jg).children[0].value;
                              table_det1.push(cellVal)
                          }
                          table_det.push(table_det1)
                        }
                  }
                  ar[headid]=table_det;
                  ar[ssid1]=val2
                  // for type of action
                //   let typeofaction = 'type'+ String(paradata);
                //   let action_val = document.getElementById(typeofaction);
                  
                //   if (action_val.checked == true){
                //     var selected_action= "info"
                //   }
                //   else{
                //     var selected_action= "action"
                //   }
                //   let action1='type'+ full_array[j];
                //   ar[action1]=selected_action
                }
                
                myar1.push(String(headid))
                // return  mnfalse
              }
          }
        
        
        if(myar1.length == 0)
        continue;
        count++;
        ar1[String(count)]=ar
        myarr2[String(count)]=myar1
      }
  
   
      var final_p=JSON.stringify(ar1)
      var id_final = JSON.stringify(myarr2)
  
     
      // For image saving
      let final_img=[],temp_img=[];
      for(let jk=0;jk<img_ref_no.length;jk++)
      {
        temp_img=[]
        let sel_id, txt_id;
        sel_id = document.getElementById('select_img_'+img_ref_no[jk]).value;
        txt_id = document.getElementById('img_text_'+img_ref_no[jk]).value;
        if(sel_id == '')
        {
          alert('select Reference number')
          $('#select_img_'+img_ref_no[jk]).focus();
          return false;
        }
        if(txt_id == '')
        {
          alert('select Image')
          $('#img_text_'+img_ref_no[jk]).focus();
          return false;
        }
        if(!full_array.includes(sel_id))
        {
          alert('select Proper reference number')
          $('#select_img_'+img_ref_no[jk]).focus();
          return false;
        }
        temp_img.push(sel_id);
        temp_img.push(txt_id);
        final_img.push(temp_img);
      }
      final_img = JSON.stringify(final_img);
      // image saving end
      
      goodWork = 0;
            if($("#goodWork").is(":checked"))
            {
                goodWork = 1;
            }
      let data1 = {
            goodWork : goodWork,
            zone: JSON.stringify($('#zone').val()),
            division: JSON.stringify($('#division').val()),
            department: JSON.stringify($('#department').val()),
            location: JSON.stringify($('#location').val()),
            accompany: JSON.stringify($('#accompany').val()),
            txtDate2:$('#txtDate2').val(),
            titleinsp: $('#titleinsp').val(),
            inspection_no: $('#inspection_no').val(),
            insp_type:$('#insp_type').val(),
            buttonValues: el.value,
            final_partinspected:encryptWithAES(final_p),
            id_partinspected:id_final,
            send_to: document.getElementById('copyto').getAttribute('custom-offic'),
            send_desig: document.getElementById('copyto').value,
            del_array_data:JSON.stringify(del_array),
            final_img: final_img,
            inspection_no : $('#inspection_id_edit').val(),
            ins_flag : $('#ins_flag_edit').val(),
            insp_desig:$('#desiginsp').val(),
            insp_ofc_name:$('#ofcnameinsp').val(),
            station_name:$('#sttninsp').val(),
            item_sections:item_sections,
            sec_ids:sec_ids,
            sec_details:sec_details,
            full_array:JSON.stringify(full_array),
            csrfmiddlewaretoken: '{{ csrf_token }}'
          };
        
      $.ajax({
        type: 'POST',
        url: "{% url 'create_inspection_details' %}",
        dataType: 'json',
        data: data1,
        success: function (response) {
            window.location.href='{% url "inspection_doneby_list" %}';
        },
        error: function (exception) {
          alert("oops error!");
          window.location.href='{% url "draft_inspection_form" %}';
        } 
      });      
    }
    
var option_val_edit = '{{option_val|safe}}';
var item_sections = '{{item_sections|safe}}';
// var table = document.getElementById("addworkmech");
//                     set_para_no(table);

$(document).ready(function(){

if(option_val_edit == 'edit')
{
  
  let deleted_sections=JSON.parse('{{deleted_sections|safe}}');
  for(let a6=0;a6<deleted_sections.length;a6++)
    {

        let btnid = String(deleted_sections[a6]);
        
       del_section(btnid)
    }
  var table_7 = document.getElementById("addworkmech");
  
  if(table_7.rows.length > 0)
  {
    $('#submit2').show();
    
  }

  let del_array_2=JSON.parse('{{item_val|safe}}');
  let already_included = JSON.parse('{{deleteArray|safe}}');

  table_data=JSON.parse('{{table_val|safe}}');
  // var prev_data = JSON.parse('{{prev_data|safe}}');
  var img_path_json = JSON.parse('{{img_path|safe}}');
  var marked_off_details = JSON.parse('{{marked_off_details|safe}}');

  para_array = JSON.parse('{{div_para_no|safe}}');
  para_array_marked = JSON.parse('{{para_marked_officer|safe}}');
  para_count = para_array.length -1;
  let item_val_type = JSON.parse('{{item_val_type|safe}}');
  
  
  if(del_array_2.length == 0 && table_7.rows.length>0 && item_sections!=1)
  {
    document.getElementById('del10').click();
    document.getElementById('del10').click();
  }
  else
  {
    for(let i6=0;i6<del_array_2.length;i6++)
    {
      if(item_val_type[i6] != 'S')
      {
        let btnid = 'del1'+String(del_array_2[i6]);

        let tableid = document.getElementById('addworkmech');
        index = para_array.indexOf(del_array_2[i6]);
        typ = tableid.rows[index].cells[1].innerHTML;
        if (already_included.includes(typ))
        {
          del_array.push(del_array_2[i6]);
          continue;
        }
        
        else
        document.getElementById(btnid).click();
      }
      else
      {
        del_array.push(del_array_2[i6]);
        
      }
    }
del_array = del_array.filter(onlyUnique);
    
}

  // $(".datepker").datepicker({	
  //                         showOn: 'focus',	
  //                         dateFormat: 'dd/mm/y',	
  //                         showButtonPanel: true,	
  //                         closeText: 'Clear', 	
  //                         minDate: 0,	
  //                         onClose: function () {	
  //                           var event = arguments.callee.caller.caller.arguments[0];	
  //                           if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {	
  //                               $(this).val('');	
  //                           }	
  //                         },	
  //                         onSelect: function(selectedDate) {	
                            
  //                       }	
  //                       });	
  
for(let i6=0;i6<para_array_marked.length;i6++)
  {
    let testid = para_array_marked[i6];
    var officer='officer'+testid;
      $(`.desgn${testid}`).selectpicker();	
        $(`.desgn${testid}`).removeClass("dropdown");	
        var button = $(`#divdesgn${testid} .bs-actionsbox .btn-group`);	
        button.append(`<button type="button" id="bdesgn${testid}" class="btn btn-default btn-light" onclick="getOption('desgn${testid}')" hidden>Save</button>`)	
        button.append(`<button  type="button" class="btn btn-default btn-light" onclick="removePopupForBtn('desgn${testid}');">Go/Close</button>`)	
        button.append(`&nbsp;<button style="box-shadow: none;" type="button" class="btn btn-primary btn-md" id='${officer}'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" ><i class="fas fa-search"></i></button>`);	
        button.append(`<button type="button" id="btndel${testid}" class="actions-btn bs-deselect-all btn btn-default btn-light" hidden >Remove</button>`)	
          
        $(`#desgn${testid}`).on("changed.bs.select", function(e, clickedIndex, isSelected, oldValue){	
          let his_id= this.id;
                      getOption(`${his_id}`);
            });	
        function removePopupForBtn(el){	
            let idpattern = '#'+el +' '+'.bootstrap-select'	
            $(idpattern).removeClass('show')	
          };

  }

  for(let i6=0;i6<marked_off_details.length;i6++)
  {
    let st = marked_off_details[i6].present;
    if(st == 'YES')
    {   
      let no = marked_off_details[i6].no;
      let marked_desig = marked_off_details[i6].marked_desig;
      let marked_id = marked_off_details[i6].marked_id;
      let marked_key = marked_off_details[i6].marked_key;
      marked_desig = marked_desig.replaceAll("@@","'")
      marked_desig = marked_desig.replaceAll("##","/")
      marked_desig = marked_desig.replaceAll("@$@",",")
      
      let key_1 = []
      for(let j6=0;j6<marked_key.length;j6++)
      {
        let data_1 = marked_key[j6]
       
        data_1 = data_1.replaceAll("@$$@",",")
        data_id = data_1[0]
        data_desig = data_1[1]

        data_id.replaceAll("@#@",",")
        data_id.split(',')

        data_desig = data_desig.replaceAll("@@","'")
        data_desig = data_desig.replaceAll("##","/")

        key_1.push({'desig':data_desig,'designation_code':data_desig})
      
      }
          marked_key=key_1;
          let tooltipid='tooltip'+ no;
          let markofficer='markeofficer'+ no;
          let _sel_id='desgn'+no;
          let tooltipiId = 'tooltipi'+no;
          

          document.getElementById(markofficer).value=marked_desig;
          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-offic', marked_id);

          const tx = document.getElementsByTagName("textarea");
          for (let i = 0; i < tx.length; i++) {
            tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
            tx[i].addEventListener("input", OnInput, false);
          }

          function OnInput() {
            this.style.height = 0;
            this.style.height = (this.scrollHeight) + "px";
          }
          $("textarea").trigger("input");
          var myInput = document.getElementById(markofficer);
          myInput.setAttribute('custom-key',JSON.stringify(marked_key));

          // myInput = document.getElementById(tooltipid);
          
          // if(marked_desig.length==0)
          // {
          //   marked_desig='Add From Dropdown'
          // }
          // myInput.innerHTML = truncateString(marked_desig,10);
          // marked_desig = marked_desig.replaceAll(',',', ')
          // myInput.title = marked_desig;
          // $('#'+tooltipid).tooltip();



          // myInput = document.getElementById(tooltipiId);
          // if(marked_desig.length==0)
          // {
          //   marked_desig='Add From Dropdown'
          // }
          // marked_desig = marked_desig.replaceAll(',',', ')
          // myInput.title = marked_desig;
          // $('#'+tooltipiId).tooltip();
          

    }

  }



  for(let i6=0;i6<img_path_json.length;i6++)
    {
      file = '/'+img_path_json[i6]['path']
      sno = img_path_json[i6]['id']
      add_row_image();
      id = img_count;
      let do_file = 'ipfile_'+id, sel_id = 'select_img_'+id;
      set_option_value(sel_id);
      let btn_do_file = 'btn_img_'+id, txt_img = 'img_text_'+id,frameid='frame'+id,btn_reset = 'btn_img_r'+id;
      document.getElementById(btn_do_file).style.backgroundColor='green';
      document.getElementById(txt_img).value = file;
      document.getElementById(frameid).src = file;
      document.getElementById(btn_do_file).disabled = true;
      document.getElementById(btn_reset).disabled = false;
      document.getElementById(sel_id).value=sno;
      preview_img(id);
    }

let officer_id = JSON.parse('{{new_mail_desig_code|safe}}');
$('#copy_desgn').selectpicker('val', officer_id)


set_para_no(table_7);

var tableq = document.getElementById("addworkmech");
var tbl_lenq = tableq.rows.length;
if(tbl_lenq > 0)
{
    textdata = tableq.rows[0].cells[0].innerHTML;
    if(textdata !='S')
      {
        $('#sectionsRow').hide();
        document.getElementById("genSections").disabled=true;
      }
  }
}

// for(let checks=0;checks<para_count;checks++){
//     let id_checks='type'+checks;
//     let name_checks='flexRadioDefault'+checks;
//     let val1 = $('input[name='+name_checks+']:checked').val();
//     if(val1 == 'info')
//     {
     
//       let tardate='#targetdate'+checks;
//       let prior='#divcheckbox'+checks;
      
//         $(tardate).hide()
//         $(prior).hide()
      
//     }
//   }

})
</script>
<script>
        
  $(document).ready(function () {
$("#submit2").on("click", function() {
  // $(this).attr("disabled", "disabled");
  $(this).attr("hidden", "hidden");
  doWork(); //this method contains your logic
});
});


function doWork() {
// alert("doing work");
//actually this function will do something and when processing is done the button is enabled by removing the 'disabled' attribute
//I use setTimeout so you can see the button can only be clicked once, and can't be clicked again while work is being done
setTimeout('$("#submit2").removeAttr("hidden")', 15000);
}




document.addEventListener("click", function(e) {
    let data = document.querySelectorAll('.chkbtnclass');
    for(let i=0;i<data.length;i++)
    {
      if(data[i].contains(e.target) == false)
      {
        let data1 = document.querySelectorAll(".popuptext");
        for(let j=0;j<data1.length;j++)
        {
          data1[i].classList.remove('show');
        }
      }
    }
});
function addTableDropDown(id)
{
  document.getElementById(id).click();
}
function removeTableDropDown(id)
{
  document.getElementById(id).click();
}
function addOfficerDropDown(id)
{
  document.getElementById(id).click();
}
function deleteRowDropDown(id)
{
  document.getElementById(id).click();
}

function disable_boxes(e){
  id=e.id;
  info=e.value
  if (info=='info'){
    id_s=id.substr(4);
    let tardate='#targetdate'+id_s;
    let prior='#divcheckbox'+id_s;
    $(tardate).hide()
    $(prior).hide()
  }
  else{
    id_s=id.substr(5);
    let tardate='#targetdate'+id_s;
    let prior='#divcheckbox'+id_s;
    let pr = '#checkbox'+id_s
    $(tardate).show()
    $(prior).show()
    $(pr).show()
  }
  // alert(info)
}


function windowPrint(){ 
    var pCon = $('#printable').html();
    w=window.open();
    w.document.write(pCon);
    w.print();
    w.close();
    // var pCon = document.getElementById('new21').innerHTML;
    // var orgCon = document.body.innerHTML; 
    // document.body.innerHTML = pCon; 
    // window.print();  
    // document.body.innerHTML = orgCon; 
  } 

var globalTimerIDAutoSave ='';
function getOnOffStatus()
{
  var zone=$("#zone").val();
  var inspection_date=$('#txtDate2').val();
  
           
if(document.getElementById('onOffIdForAutoUpdate').checked == true)
{
      document.getElementById('onOffIdForAutoUpdate').checked = false;
        
      if(zone =='' || zone == null){
          alert("Please fill Rly/Org ")
          return false;
        }
        if(inspection_date=='' || inspection_date==undefined){
            alert("Please fill date of inspection ")
            return false;
        }
        if($('#titleinsp').val()==''){
          alert("Please fill title of inspection ")
          return false;
        }
        if($('#sttninsp').val()==''){
          alert("Please fill Station of Inspecting Officer ")
          return false;
        }
        if($('#desiginsp').val()==''){
          alert("Please fill Designation of Inspecting Officer ")
          return false;
        }
        if($('#ofcnameinsp').val()==''){
          alert("Please fill Name of Inspecting Officer ")
          return false;
        }
        document.getElementById('onOffIdForAutoUpdate').checked = true;
        
        globalTimerIDAutoSave = setInterval(function() {
          autoSaveFunction();
            }, 60 * 1000); 


}	
  else
  {
    
    clearInterval(globalTimerIDAutoSave);

  }
}

function autoSaveFunction()
{
  ResetTimers();
            del_array = del_array.filter(onlyUnique);
           
            var table = document.getElementById("addworkmech");
            var zone=$("#zone").val();
            var division=$("#division").val();
            var department=$('#department').val();
            var inspection_date=$('#txtDate2').val();
            var insp_type=$('#insp_type').val();
            var item_sections = 0;
            let sec_details={}
            let sec_ids = {}


            hli = 0,full_array=[];
            for(let i=0;i<table.rows.length;i++)
            {
              if(table.rows[i].cells[0].innerHTML == 'P')
                hli++;
              if (table.rows[i].cells[0].innerHTML == 'S')
                item_sections=1
              full_array.push(table.rows[i].cells[1].innerHTML)
            }
    
    
            let ar ={}
            let id_ar=[]
            let sec_id_ar={}
            let ar1 = {},paradata;
            let myarr2 = {};
            if (item_sections==1){
              
              for(let j=0; j<full_array.length; j++)
              {
                paradata = para_array[j] 
                let temp = String(full_array[j].split('.'))
                let temp1 = full_array[j].split('.')

                // alert(temp)
                if (temp1.length == 1 && (temp.charCodeAt(0)>=65 && temp.charCodeAt(0)<=90 )){
                    headid = String(temp);
                    let hid='location_at'+ String(paradata);
                    let hid1='location_at'+ headid;
                    // alert(hid)
                    var val = document.getElementById(hid).value;
                    ar[hid1]=val
                  }
              }
              for (let j=0; j<full_array.length; j++)
              {
                let temp = full_array[j].split('.')
                
                if (temp.length == 1){
                 
                  temp = String(temp)
                  if (temp.charCodeAt(0)>=65 && temp.charCodeAt(0)<=90 ){
                    section1=temp
                    id_ar=[]
                  }
                  else{
                    id_ar.push(temp)
                  }
                  sec_id_ar[section1]=id_ar
                }
              }
              
            }
            sec_details=JSON.stringify(ar)
            sec_ids=JSON.stringify(sec_id_ar)

            for(let i=1; i<=hli; i++){
              let ar ={}
              let myar1 = []

              for(let j=0; j<full_array.length; j++)
              {
                paradata = para_array[j]
                if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.'){
                
                  let temp = full_array[j].split('.')
                  myar1.push(String(full_array[j]))
                  
                  if(temp.length == 1){
                    let hid='heading'+ String(paradata);
                    var val = document.getElementById(hid).value;
                    let hid1='heading'+ full_array[j];
                    ar[hid1]=val
                    
                   
                    // for type of action
                    // let typeofaction = 'type'+ String(paradata);
                    // let action_val = document.getElementById(typeofaction);
                    
                    // if (action_val.checked == true){
                    //   var selected_action= "info"
                    // }
                    // else{
                    //   var selected_action= "action"
                    // }
                    // let action1='type'+ full_array[j];
                    // ar[action1]=selected_action

                    let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  
                              }
                              table_det.push(table_det1)
                            }
                      }
                          ar[full_array[j]]=table_det;


                        
                      d1_test = full_array[j]+'.'
                      var result_test = full_array.filter(option => option.startsWith(d1_test));
                      
                        d2_test = 'Yes'
                        for(iv=j+1;iv<table.rows.length;iv++)
                          {
                            if(table.rows[iv].cells[0].innerHTML == 'P' || table.rows[iv].cells[0].innerHTML == 'S')
                            {
                              break;
                            }
                            if(del_array.includes(para_array[iv]))
                            {
                              d2_test = 'Yes'
                            }
                            else
                            {
                              d2_test ='No'
                              break
                            }
                          }

                      if(d2_test == 'No')
                      {
                        a=1;
                      }
                    else{
                        
                        // let td = 'targetdate' + String(paradata);
                        let mf = 'markeofficer' + String(paradata);
                        let ity = 'item_type'+String(paradata);

                        // let chk = 'check'+ String(paradata);
                        
                        let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  
                              }
                              table_det.push(table_det1)
                            }
                      }
                          ar[full_array[j]]=table_det;
                        // var tddate = document.getElementById(td).value;
                        // let chk_val = document.getElementById(chk)
                          
                        //   if (chk_val.checked == true){
                        //       var checkbox = '1'
                            
                        //   }
                        //   else if (chk_val.checked == false){

                        //     checkbox = '0'
                            
                        //   }
                       
                        var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                        var officer_info = document.getElementById(mf).getAttribute('custom-info');
                        var itemtype = document.getElementById(ity).value;
                        let it = 'item_type' + full_array[j]                        
                              // let td1 = 'targetdate' + full_array[j];
                              let mf1 = 'markeofficer' + full_array[j];
                              let mf2 = 'markeofcinfo' + full_array[j];

                              // let chk1 = 'check' + full_array[j];
                              // ar[td1]=tddate
                              ar[mf1]=officer_val
                              ar[mf2]=officer_info
                              ar[it]=itemtype
                              // ar[chk1]=checkbox  
                              
                              // let rema = 'remarksmarkeofficer' + String(paradata);
                              // var remarks = document.getElementById(rema).value;
                              // let rem = 'remarksmarkeofficer' + full_array[j];
                              // ar[rem]=remarks
                    
                    }
    
                    
                    
              
                  }
                  else if(temp.length == 2){
                    let sid='heading'+String(paradata);
                    // let td = 'targetdate' + String(paradata);
                    let mf = 'markeofficer' + String(paradata);
                    let ity = 'item_type'+String(paradata);
                    // let chk = 'check'+ String(paradata);

                    
    
                    var val1 = document.getElementById(sid).value;
                    // var tddate = document.getElementById(td).value;
                    let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                 
                              }
                              table_det.push(table_det1)
                            }
                      }
                          ar[full_array[j]]=table_det;
                    // let chk_val = document.getElementById(chk)
                    //       if (chk_val.checked == true){
                    //           var checkbox = '1'
                    //       }
                    //       else if (chk_val.checked == false){
                    //         checkbox = '0'
                    //       }
                    var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                    var officer_info = document.getElementById(mf).getAttribute('custom-info');
                    var itemtype = document.getElementById(ity).value;
                    
                          let sid1='observation'+full_array[j];
                          // let td1 = 'targetdate' + full_array[j];
                          let mf1 = 'markeofficer' + full_array[j];
                          // let chk1 = 'check' + full_array[j];
                          let mf2 = 'markeofcinfo' + full_array[j];
                          let it = 'item_type' + full_array[j]
                          

                          ar[sid1]=val1
                          // ar[td1]=tddate
                          ar[mf1]=officer_val
                          // ar[chk1]=checkbox   
                          // let rema = 'remarksmarkeofficer' + String(paradata);
                          // var remarks = document.getElementById(rema).value;
                          // let rem = 'remarksmarkeofficer' + full_array[j];
                          // ar[rem]=remarks
                          ar[mf2]=officer_info
                    ar[it]=itemtype
                   
                    // let typeofaction = 'type'+ String(paradata);
                    // let action_val = document.getElementById(typeofaction);
                    
                    // if (action_val.checked == true){
                    //   var selected_action= "info"
                    // }
                    // else{
                    //   var selected_action= "action"
                    // }
                    // let action1='type'+ full_array[j];
                    // ar[action1]=selected_action
                  }
                  else{
                    let ssid='heading'+String(paradata);
                    var val2 = document.getElementById(ssid).value;
                    
                    let table_det=[];
                      if(table_data.includes(String(paradata)))
                      {
                            tableid = 'tblspan'+String(paradata);
                            var oTable = document.getElementById(tableid);
                            var rowLength = oTable.rows.length;
                            for (ig = 0; ig < rowLength; ig++){
                              table_det1=[]
                              var oCells = oTable.rows.item(ig).cells;
                              var cellLength = oCells.length;
                              for(var jg = 0; jg < cellLength; jg++){
                                  var cellVal = oCells.item(jg).children[0].value;
                                  table_det1.push(cellVal);
                                  
                              }
                              table_det.push(table_det1)
                            }
                      }
                          ar[full_array[j]]=table_det;

                          let ssid1='subdes'+full_array[j];   
                    ar[ssid1]=val2
                    // for type of action
                    // let typeofaction = 'type'+ String(paradata);
                    // let action_val = document.getElementById(typeofaction);
                    
                    // if (action_val.checked == true){
                    //   var selected_action= "info"
                    // }
                    // else{
                    //   var selected_action= "action"
                    // }
                    // let action1='type'+ full_array[j];
                    // ar[action1]=selected_action
    
                    
                  }
                  
                }
              }
              
              ar1[String(i)]=ar
              myarr2[String(i)]=myar1
            }
        
          
        var final_p=JSON.stringify(ar1)
        var id_final = JSON.stringify(myarr2)
        
        if(zone =='' || zone == null){
          
          return false;
        }
        if(inspection_date=='' || inspection_date==undefined){
           
            return false;
        }
        if($('#titleinsp').val()==''){
        
          return false;
        }
        if($('#sttninsp').val()==''){
        
          return false;
        }
        if($('#desiginsp').val()==''){
          
          return false;
        }
        if($('#ofcnameinsp').val()==''){
         
          return false;
        }
        
	      // final_p=final_p.replace(/window/gi,'Windows')	
        // final_p=final_p.replace('/&','and')


        let final_img=[],temp_img=[],chkImageData = 0;
        for(let jk=0;jk<img_ref_no.length;jk++)
        {
          temp_img=[]
          let sel_id, txt_id;
          sel_id = document.getElementById('select_img_'+img_ref_no[jk]).value;
          txt_id = document.getElementById('img_text_'+img_ref_no[jk]).value;
          if(sel_id == '')
          {
           
            chkImageData = 1;
          }
          if(txt_id == '')
          {
          
            chkImageData = 1;
          }
          if(!full_array.includes(sel_id))
          {
            chkImageData = 1;
          }
          temp_img.push(sel_id);
          temp_img.push(txt_id);
          final_img.push(temp_img);
        }
        final_img = JSON.stringify(final_img);
        

       
        let temp_delarray=[]
        for(let i=0;i<table.rows.length;i++)
            {
              for(let k=0;k<del_array.length;k++)
              {
                if(i == del_array[k])
                  temp_delarray.push(table.rows[i].cells[1].innerHTML)
              }
            }

        del_array_temp = temp_delarray;
        
        let temp_para_array_marked=[]
        for(let i=0;i<table.rows.length;i++)
            {
              for(let k=0;k<para_array_marked.length;k++)
              {
                if(i == para_array_marked[k])
                {
                  if((String(table.rows[i].cells[1].innerHTML).split('.')).length === 1)
                  {
                    mf1 = 'markeofficer' + String(para_array_marked[k]);
                    let officer_val21 = document.getElementById(mf1).getAttribute('custom-offic');
                    if(officer_val21.length > 0)
                        temp_para_array_marked.push({'id':table.rows[i].cells[1].innerHTML,'officer':officer_val21})
                  }
                }
              }
            }
          
            goodWork = 0;
            if($("#goodWork").is(":checked"))
            {
                goodWork = 1;
            }
            
        let data1 = {
            goodWork : goodWork,
            zone: JSON.stringify($('#zone').val()),
            division: JSON.stringify($('#division').val()),
            department: JSON.stringify($('#department').val()),
            location: JSON.stringify($('#location').val()),
            accompany: JSON.stringify($('#accompany').val()),
            txtDate2:$('#txtDate2').val(),
            titleinsp: $('#titleinsp').val(),
            send_to: document.getElementById('copyto').getAttribute('custom-offic'),
            send_desig: document.getElementById('copyto').value,
            final_partinspected:encryptWithAES(final_p),
            id_partinspected:id_final,
            final_img: final_img,
            temp_para_array_marked : JSON.stringify(temp_para_array_marked),
            del_array:JSON.stringify(del_array_temp),
            csrfmiddlewaretoken: '{{ csrf_token }}',
            inspection_no : $('#inspection_id_edit').val(),
            ins_flag : $('#ins_flag_edit').val(),
            insp_desig:$('#desiginsp').val(),
            insp_ofc_name:$('#ofcnameinsp').val(),
            station_name:$('#sttninsp').val(),
            item_sections:item_sections,
            sec_ids:sec_ids,
            sec_details:sec_details,
            insp_type:insp_type,
            full_array:JSON.stringify(full_array),
          };
       
                $.ajax({
                          type: 'POST',
                            url: "{% url 'save_draft_data' %}",
                            dataType: 'json',
                            data: data1,
                            success: function (response) {
                              $('#inspection_id_edit').val(response.inspection_no)
                              $('#message_container').show();
                              setTimeout(function () {
                                      $('#message_container').hide();
                              }, 1000);

           
                        }
              
          });
             
    }
    
    

   


  
// $(".item_type_select2").select2();


// $(".item_type_select2").next(".select2").mouseenter(function() {
  
//   $(this).select2('open');
// });  

</script>






<script>
 let openCard = null;
function openPhase2(id)
{
  window.open("/showMenu/?id=" + id+'&_blank');
 
}

  function toggleOpen(parentCard) {
    const childCards = parentCard.querySelectorAll('.child-card');
    const isOpen = parentCard.classList.toggle('open');

    if (isOpen) {
      childCards.forEach((card) => {
        card.style.display = 'block';
      });

      if (openCard && openCard !== parentCard) {
        const openChildCards = openCard.querySelectorAll('.child-card');
        openChildCards.forEach((card) => {
          card.style.display = 'none';
        });
        openCard.classList.remove('open');
      }

      openCard = parentCard;
    } else {
      childCards.forEach((card) => {
        card.style.display = 'none';
      });
      openCard = null;
    }
  }

  function showChildren(parentCard) {
    if (!parentCard.classList.contains('open')) {
      const childCards = parentCard.querySelectorAll('.child-card');
      childCards.forEach((card) => {
        card.style.display = 'block';
      });
    }
  }

  function hideChildren(parentCard) {
    if (!parentCard.classList.contains('open')) {
      const childCards = parentCard.querySelectorAll('.child-card');
      childCards.forEach((card) => {
        card.style.display = 'none';
      });
    }
  }
  var parentCards = document.querySelectorAll('.parent-card');
parentCards.forEach(function(card) {
  card.addEventListener('mouseover', function() {
    showChildren(card);
  });

  card.addEventListener('mouseout', function() {
    hideChildren(card);
  });
});


function open_wrap(e){
  // alert(e.id)
  var id=e.id.substr(4)
  var desigs=$("#"+id).val()
  // alert(desigs)
  // urls='/officertask/?desigs='+desigs+'&id='+id;
  // $("#frmDash").attr("src",urls);
  // $(".wrap").toggleClass('active');

  var no=e.id.substr(9)
  markid='markeofficer'+no
  var info_id = document.getElementById(markid).getAttribute('custom-info');
  
  if(info_id!=''){
  info_id=JSON.parse(info_id)
  
  }
  if(desigs == '')
  {
    alert("Select Officer First")
    return false;
  }
  document.getElementById('openModalOpenWrap').click();
  data={
    'id':id,
    'desigs':JSON.stringify(desigs),
  }
  $.ajax({
    type : 'GET',
    url : "{% url 'officertask' %}",
    dataType : 'json',
    data : data,
    success : function(response)
    {
      var idsss='saveinfo'+response.id
      // alert(idsss)
      var myEle = document.getElementById("saveinfo")
      if(myEle) {
        document.getElementById("saveinfo").name =idsss ;
      }
      table=$('#mytable1').DataTable();
      table.destroy();
        $('#mytable1 tbody').empty();
        if(response.designations){
         
          row=''
          for(var i=0;i<response.designations.length;i++){
            row+=`
            <tr>
                        <td style="display:none">${response.designations[i]['designation_code']}</td>
                        <td>${i+1}</td>
                        <td style="text-align:center"><input hidden id="designation${response.designations[i]['designation_code']}" value="${response.designations[i]['designation']}">${response.designations[i]['designation']}</td>
                        <td> <div class="form-check">
                            <input class="form-check-input" value="info" type="radio" name="flexRadioDefault${response.designations[i]['designation_code']}" id="type${response.designations[i]['designation_code']}"  onclick="disable_boxes(this)">
                            <label class="form-check-label" for="info">
                              For Information
                            </label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" value="action" type="radio" name="flexRadioDefault${response.designations[i]['designation_code']}" id="type1${response.designations[i]['designation_code']}" checked onclick="disable_boxes(this)">
                            <label class="form-check-label" for="action">
                              For Compliance
                            </label>
                          </div></td>
                          <td hidden><div class="autocomplete1" id="divtargetdate${response.designations[i]['designation_code']}">
                                
                                <input type="text"  class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;background-color:white;" id='targetdate${response.designations[i]['designation_code']}' readonly> 
                               </div></td>
                               <td hidden><div class="autocomplete1 mt-1" id="divcheckbox${response.designations[i]['designation_code']}"><input type="checkbox" value="1" autocomplete="off" id='checkbox${response.designations[i]['designation_code']}'>&nbsp; <label for="priority" class="lbl-caption"></label> </div></td>
                    </tr>
            `
          }
          
          $('#mytable1 tbody').append(row);
          
          
          
          $('#mytable1').DataTable({
            pageLength:4,
            dom: 'Bfrtip',
            "bSort": false,
            "pagingType": "simple",
            "lengthChange":false,
            "sEmptyTable": 'Please Select Officers First',
              "language":{
                  "search": "Keyword search:"
                  
              }
            })
            
            
            
            $(".datepker").datepicker({	
                showOn: 'focus',	
                dateFormat: 'dd/mm/y',	
                showButtonPanel: true,	
                closeText: 'Clear', 	
                minDate: 0,	
                onClose: function () {	
                var event = arguments.callee.caller.caller.arguments[0];	
                if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {	
                    $(this).val('');	
                }	
                },	
                onSelect: function(selectedDate) {
            }	
            });	
            set_values_info(e)
          }
      }
      
      })
}

function closePpln()
  {
      $(".wrap").toggleClass('active');
      
  }


function save_info(e){
  var id = e.name.substr(13)
  
  markid='markeofficer'+id
  // alert(markid)
  var officer_val = document.getElementById(markid).getAttribute('custom-offic');
  officer_val = officer_val.split(',')
  table=$('#mytable1').DataTable();
  table.destroy();
  var info_val=[]
  for (var i=0;i<officer_val.length;i++){
    // alert(officer_val[i])
    var selected_action;
    var priority = 0; 
    var tddate = "-1"   
    var info = "type"+officer_val[i]
    // alert(info)
    let action_val = document.getElementById(info);
    var des = "designation" + officer_val[i];
    desig = document.getElementById(des).value;
    
                 
    if (action_val.checked == true){
       selected_action= "info"
    }
    else{
      selected_action= "action"
    }
    if (selected_action == "action"){
      // var tgtdate = "targetdate"+officer_val[i]
      tddate = document.getElementById("target_date_inpt").value;
      if (tddate == '')
        tddate='-1'
      // var priorityid = "checkbox"+officer_val[i]
      let prior = document.getElementById("checkbox_priority_inpt");
        
      if (prior.checked == true){
        priority= 1
      }
    }
    info_val.push({'DesignationCode':officer_val[i],'selected_action':selected_action,'priority':priority,'tddate':tddate,'Designation':desig})
  }
  var myInput = document.getElementById(markid);
  myInput.setAttribute('custom-info', JSON.stringify(info_val));
  
  // markid.setAttribute('custom-info', info_val);
  // document.getElementById(markid).setAttribute('custom-info')=info_val;
}


</script>
<script>
  $(".datepker").datepicker({	
                showOn: 'focus',	
                dateFormat: 'dd/mm/y',	
                showButtonPanel: true,	
                closeText: 'Clear', 	
                minDate: 0,	
                onClose: function () {	
                var event = arguments.callee.caller.caller.arguments[0];	
                if ($(event.delegateTarget).hasClass('ui-datepicker-close')) {	
                    $(this).val('');	
                }	
                },	
                onSelect: function(selectedDate) {
            }	
            });	
function set_values_info(e){
  let prior = document.getElementById("checkbox_priority_inpt");
  prior.checked = false
  document.getElementById("target_date_inpt").value="";
  var no=e.id.substr(9)
  markid='markeofficer'+no
  var info_id = document.getElementById(markid).getAttribute('custom-info');
  if(info_id!=''){
    table=$('#mytable1').DataTable();
      table.destroy();
        
  info_id=JSON.parse(info_id)
  var table = document.getElementById("mytable1");
  let tbl_r_count = table.rows.length;
  if (tbl_r_count !=0 && info_id.length){
    for (let j=0;j<info_id.length;j++){
      for(let i=0;i<tbl_r_count;i++){
        
        value = table.rows[i].cells[0].innerHTML;
        if( value != info_id[j]['DesignationCode'])
          continue
        else{
          if (info_id[j]['selected_action'] == 'info' || info_id[j]['selected_action'] == 1)
            {
              var info = "type"+value;
              let action_val = document.getElementById(info);                          
              action_val.checked = true;
              var priorityid = "#checkbox"+value;
              $(priorityid).hide();
              var tgtdate = "#targetdate"+value;
              $(tgtdate).hide();
            }
            else
            {
              if (info_id[j]['priority'] == 1){
                var priorityid = "checkbox"+value
                let prior = document.getElementById("checkbox_priority_inpt");
                prior.checked = true
              }
              if (info_id[j]['tddate'] != '-1'){
                var tgtdate = "targetdate"+value
                document.getElementById("target_date_inpt").value=info_id[j]['tddate'];
              }
        }
      }
      }
    }
  }



  $('#mytable1').DataTable({
            pageLength:4,
            dom: 'Bfrtip',
            "bSort": false,
            "pagingType": "simple",
            "lengthChange":false,
            "sEmptyTable": 'Please Select Officers First',
              "language":{
                  "search": "Keyword search:"
                  
              }
            })
            
}
}

function clickSubmit2()
{
  document.getElementById('previewClose').click();
  document.getElementById('submit2').click();
}

function encryptWithAES(message)
{
    var key ='AAAAAAAAAAAAAAAA'
    key = CryptoJS.enc.Utf8.parse(key);
    var iv = CryptoJS.enc.Utf8.parse('BBBBBBBBBBBBBBBB')
    var encrypted = CryptoJS.AES.encrypt(message, key, { iv: iv, mode: CryptoJS.mode.CBC});
    encrypted =encrypted.toString();
    return (encrypted)
}

function decryptWithAES(Base64CBC)
{
    var iv = CryptoJS.enc.Utf8.parse('BBBBBBBBBBBBBBBB');
    var key ='AAAAAAAAAAAAAAAA'
    key = CryptoJS.enc.Utf8.parse(key);
    var decrypted =  CryptoJS.AES.decrypt(Base64CBC, key, { iv: iv, mode: CryptoJS.mode.CBC});
    decrypted = decrypted.toString(CryptoJS.enc.Utf8);
    return (decrypted);   
}
function compliance_alterdata()
{
    window.location.reload();
}

var changeLocationId=[];
var deleteLocationId=[];

function setSections(){
    deleteLocationId = changeLocationId;
   
    changeLocationId=[];
    let locs_val=$('#location').val()
    let zones_val=$('#zone').val()
    let divs_val=$('#division').val()
    if (locs_val.length==0 && zones_val.length==0 && divs_val.length==0){
      // alert('Please add location first.')
      // return false;
      alert("Location can't be empty, Please add location.")
      $('#sectionsRow thead').empty();
    }
    else{
      let secRowCount = 0;
      row='<tr>'
      for(i=0;i<zones_val.length;i++){
        if (secRowCount % 4 == 0)
            row+='</tr><tr>';
        secRowCount++;
        changeLocationId.push(zones_val[i]+'#zone');
        row+=`<th><input class="sectionChecksClass" type="checkbox" id="${zones_val[i]}#zone" style="zoom:1.5;" onclick="addsections(this);">&nbsp;<label class="lbl-caption" title = "${zones_val[i]}" style="font-size:18px;">${zones_val[i]}</th>`
      }
      
      for(i=0;i<divs_val.length;i++){
        if (secRowCount % 4 == 0)
            row+='</tr><tr>';
        secRowCount++;
        changeLocationId.push(divs_val[i]+'#div');
        row+=`<th><input class="sectionChecksClass" type="checkbox" id="${divs_val[i]}#div" style="zoom:1.5;" onclick="addsections(this);">&nbsp;<label class="lbl-caption" title = "${divs_val[i]}" style="font-size:18px;">${divs_val[i]}</th>`
      }
      
      for(i=0;i<locs_val.length;i++){
        if (secRowCount % 4 == 0)
            row+='</tr><tr>';
        secRowCount++;
        x=locs_val[i].split('#');
        showLoc = x[0]
        if(showLoc.length > 30)
        {
          showLoc = showLoc.substring(0,30)+'...'
        }
        changeLocationId.push(locs_val[i]+'#loc');
        row+=`<th><input class="sectionChecksClass" type="checkbox" id="${locs_val[i]}#loc" style="zoom:1.5;" onclick="addsections(this);">&nbsp;<label class="lbl-caption" title = "${x[0]}" style="font-size:18px;">${showLoc}</th>`
      }
      row+='</tr>'
      $('#sectionsRow thead').empty();
      $('#sectionsRow thead').append(row);
    }
    reviewSections();
    for(let k=0;k<deleteLocationId.length;k++)
    {
      if(!changeLocationId.includes(deleteLocationId[k]))
      {
        var table123 = document.getElementById("addworkmech");
          for(let i=0;i<table123.rows.length;i++){
            value = table123.rows[i].cells[0].innerHTML;
            if( value == 'S'){
              x=table123.rows[i].cells[7].innerHTML
              var id='location_at'+x;
              opt = document.getElementById(id).value;
              cheks= opt.substring(3);
              
              if (cheks==deleteLocationId[k]){
                if(table123.rows[i].cells[2].className != 'strikeout')
                {
                  del_section(deleteLocationId[k]);
                }
              }
            }
          }


      }
    }
  }
  
  deleted_sections=[]
  function addsections(e){
    sec_id=e.id
    if (document.getElementById(sec_id).checked==true && !(deleted_sections.includes(sec_id))){
      val = sec_id.split('#')
      row=`<option value="opt${sec_id}" selected="true" disabled="true"> ${val[0]}</option>`

      var table = document.getElementById("addworkmech");
      var ap = addpara('S','-2');
      if (ap!=false){
      pl=para_array.length-1
      pa=para_array[pl]
      x= table.rows.length-1;
      value = table.rows[x].cells[0].innerHTML;
      if( value == 'S'){
        var id='#location_at'+pa
        $(id).empty()
        $(id).append(row);
      }
      // document.getElementById(sec_id).disabled=true;
      addpara('P','-2');
    }
    else{
      document.getElementById(sec_id).checked=false;
    }
  }
    else{
      // if(confirm("Are you sure you want to delete the entire section?"))
      del_section(e.id)
    }
  
}
  function reviewSections(){
  var table = document.getElementById("addworkmech");
  all_sections=[]
  for(let i=0;i<table.rows.length;i++){
    value = table.rows[i].cells[0].innerHTML;
    if( value == 'S'){
      x=table.rows[i].cells[7].innerHTML
      var id='location_at'+x;
      opt = document.getElementById(id).value
      cheks= opt.substring(3)
      all_sections.push(cheks)
    }
  }
  elements = document.getElementsByClassName("sectionChecksClass");
    for (i = 0; i < elements.length; i++) {
      elements[i].checked = false
        id=elements[i].id
        if (all_sections.includes(id)){
          if(deleted_sections.includes(id))
            elements[i].checked = false
          else
            elements[i].checked = true
        }
      }
}
  function del_section(e){
  
  var loc_val=e
  var index=-1
  var table = document.getElementById("addworkmech");
  all_sections=[]
  for(let i=0;i<table.rows.length;i++){
    value = table.rows[i].cells[0].innerHTML;
    if( value == 'S'){
      x=table.rows[i].cells[7].innerHTML
      var id='location_at'+x;
      opt = document.getElementById(id).value
      cheks= opt.substring(3)
      if (cheks==loc_val){
        index=i
      }
    }
  }
  val = para_array[index]
  
  if(deleted_sections.includes(loc_val))
    {
      $(table.rows[index].cells[2]).removeClass("strikeout");
      $(table.rows[index].cells[3]).removeClass("strikeout");
      $(table.rows[index].cells[3]).find('textarea').removeClass("strikeoutbg");
      index1 = del_array.indexOf(val);
      if (index1 > -1) { 
        del_array.splice(index1, 1); 
      }
      index2 = deleted_sections.indexOf(loc_val);
      if (index2 > -1) { 
        deleted_sections.splice(index2, 1); 
      }


      for(let i=index+1;i<table.rows.length;i++)
      {
        typ1 = table.rows[i].cells[0].innerHTML;
        if(typ1 != 'S')
        {
          val = para_array[i]
          $(table.rows[i].cells[2]).removeClass("strikeout");
          $(table.rows[i].cells[3]).removeClass("strikeout");
          $(table.rows[i].cells[3]).find('textarea').removeClass("strikeoutbg");
          let btnid = 'popupbutton'+table.rows[i].cells[7].innerHTML;
          $('#'+btnid).show();
          index1 = del_array.indexOf(val);
          if (index1 > -1) { 
            del_array.splice(index1, 1); 
          }
        }
        else
        {
          break;
        }
      }
      return true
    }
    else{
      try{
      $(table.rows[index].cells[2]).addClass("strikeout")
      $(table.rows[index].cells[3]).addClass("strikeout")
      }
      catch{pass}
      del_array.push(val)
      
      deleted_sections.push(loc_val)
      for(let i=index+1;i<table.rows.length;i++)
        {
          typ1 = table.rows[i].cells[0].innerHTML;
          if(typ1 != 'S')
          {
            val = para_array[i]
            del_array.push(val);
            $(table.rows[i].cells[2]).addClass("strikeout");
            $(table.rows[i].cells[3]).addClass("strikeout");
            $(table.rows[i].cells[3]).find('textarea').addClass("strikeoutbg");
            let btnid = 'popupbutton'+table.rows[i].cells[7].innerHTML;
            $('#'+btnid).hide();
          }
          else
          {
            break;
          }
        }
      }
}


$( document ).ready(function(){
  setSections()
});

</script>



<script>
  // function openModalAndWrap(button) {
  //     open_wrap(button); // Call open_wrap function
  //     $('#markofc').modal('show'); // Open the modal
  // }

var boolclose = true;
function funccloseallspanset()
{
  boolclose = false;
}
    function funccloseallspan()
    {
      setTimeout(() => {
        if(boolclose)
          $('.popuptext').removeClass('show');

        boolclose = true;
        
      }, 5);
      
    }

    function funccloseallspan1()
    {
      $('.popuptext').removeClass('show');
      boolclose = true;
    }

    var editLocationData =  $('#location').val();
</script>

{% endblock %}  


