{% extends 'base.html' %} 
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>trainReport</title>
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous"> -->
    <script src="{% static '/js/jquery-3.4.1.min.js' %}"></script>
    <script src="{% static '/js/popper.min.js' %}"></script>
    <script src="{% static '/js/Chart.min.js' %}"></script>
    <script src="{% static '/js/jquery-3.3.1.slim.min.js' %}"></script>
    <script src="{% static '/js/bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="{% static '/js/jquery-ui.js' %}"></script>
    <script src="{% static '/js/jquery-1.12.4.js' %}"></script>
    <script src="{% static '/js/select2.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
    <script src="{% static '/js/moment.min.js' %}"></script>
  
    <script src="{% static '/js/jquery-3.3.1.js' %}"></script>
    <script src="{% static '/js/sweetalert.min.js' %}"></script>
    <script src="{% static '/js/jquery.min.js' %}"></script>
    <script src="{% static '/js/bootstrap.min1.js' %}"></script>
    <script src="{% static '/js/jquery.min1.js' %}"></script>
    <script src="{% static '/js/jquery-ui.min.js' %}"></script>
    <script src="{% static '/js/jspdf.min.js' %}"></script>
  
  
  
    <script src="{% static '/DataTables/datatables.min.js' %}"></script>
    <script src="{% static '/js/dataTables.bootstrap4.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/DataTables/datatables.min.css' %}" /> 
  
    <link rel="stylesheet" type="text/css" href="{% static '/css/bootstrap.min.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static '/css/jquery-ui.css' %}" />
  
    <script src="{% static '/js/jquery.timepicker.min.js' %}"></script>
  
  
    <!-- swasti link -->
  
    <script type="text/javascript" src="{% static '/daterangepicker-master/moment.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/daterangepicker-master/daterangepicker.js'%}"></script>
    <link rel="stylesheet" type="  text/css" href="{%static '/daterangepicker-master/daterangepicker.css'%}" />
  
    
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <script rel="stylesheet" href="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
  
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
  
    <link rel="//cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <script src="//cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" type="text/css" href="{% static '/css/forms_common.css' %}" />


<!-- <link rel="stylesheet" type="text/css" href="{%static '/datepicker-master/datepicker.css'%}" /> -->
<style>

  th, td { white-space: nowrap; }
      div.dataTables_wrapper {
          /* width: 800px; */
          margin: 0 auto;
      }
  
      .inpt-container
  {
      background-image: linear-gradient(#cce3fc,#FFFFFF);
      border-bottom:2px solid #b0d8f5;
      margin-bottom:1rem;
  }
  
  h3.report_heading
      {
      position: relative;
      padding-bottom: 10px;
      font-weight: 600;
      color: #262626 !important;
      text-transform: uppercase;
      font-size: 18px;
      /* margin-left: 2rem; */
      text-align: center;
  }
  .report_heading::after {
      position: absolute;
      content: "";
      background: #C20E39;
      height: 3px;
      width: 64px;
      left: 0;
      right: 0;
      bottom: 0;
      margin: 0 auto;
  }
  
  
</style>
</head>

<body>
    
  <div>
    <h3 id="h6" class="report_heading">Train Inspection Review</h3>
  </div>

  <div class="container">
          
    <div class="col-lg-12 card shadow  mt-5 inpt-container " id="filterForm" >    
      <form id="form1" method="POST" style="width: 100%;"  id="filter">{%csrf_token%}
          <div class="container" style="font-family:'Lato', sans-serif ;">              
            <div class="row">
              <div class="col-lg-2">
                <div class="form-group">
                  <label class="lbl-caption">Train Category</label>
                  <select class="form-control "  id="train" data-live-search="true"  data-actions-box="true">
                      <option>Select</option>
                      {% for i in train %}
                      <option value="{{i.tn_category}}">{{i.tn_category}}</option>
                      {% endfor %}
                  </select>
                </div>
              </div>

              <div class="col-lg-2">
                <div class="form-group">
                  <label class="lbl-caption">From</label>
                  <input type="text" autocomplete="off" placeholder="Select Date" class="form-control" id="dateofInsp1" name="dateofInsp" readonly>
                </div>
              </div>

              <div class="col-lg-2">
                <div class="form-group">
                  <label class="lbl-caption">To</label>
                  <input type="text" autocomplete="off" placeholder="Select Date" class="form-control" id="dateofInsp2" name="dateofInsp" readonly>
                </div>
              </div>

              <div class="col-lg-5 col-md-12 col-sm-12 mx-2">
                <div class="row float-right">
                <div class="form-group" >
                    <div class="row">
                      <div class="btn-toolbar mx-1" role="toolbar">
                          <div class="btn-group" role="group" >
                            <button type="button" class="btn btn-warning btn-sm" id="search_filter" style="margin-top:30px ;white-space: normal; word-wrap: break-word;"  onclick="searchTrain()">Continue</button>
                            <button type="button" class="btn btn-secondary btn-sm" type="reset" id="btnReset"  style="margin-top:30px ;white-space: normal; word-wrap: break-word;" value="submit">Reset</button>                          
                          </div>
                      </div>
                      
                      <div class="btn-toolbar mx-1 " role="toolbar" >
                          <div class="btn-group" role="group" >
                            <button type="button" name="submitpdf" id="submitpdf"  style="margin-top:30px ;white-space: normal; word-wrap: break-word;" class="btn btn-danger btn-sm" value="PDF"  onclick="pdfShow()" >PDF <i class="fa fa-file-pdf"></i></button> 
                            <button type="button" name="submitexcel" style="margin-top:30px ;white-space: normal; word-wrap: break-word;" id="submitexcel" class="btn btn-success btn-sm" value="excel"  onclick="excelShow()" >Excel <i class="fa fa-file-excel"></i></button> 
                          </div>
                      </div>
  
                    </div>
                    </div>
                </div>
              </div>

            </div>
          </div>
      </form>        
    </div>
  
    <!-- <div class="row" style="background-color:#426fcf;  color: white ;font-weight: bold; vertical-align: middle; padding-top: 5px;  padding-bottom: 5px; height: 40px; margin-left: 1.3%; margin-right: 1.1%; margin-bottom: 3px;" >
    <i class="fa-solid fa-thumbtack" style="margin-top:5px; margin-left:10px ;"></i>&nbsp;
    Show Entries &nbsp;
  
    <div class="">
      <select name="category" id="selectedCategory"  style="height:25px; border-radius:3% ;">
        <option value="" selected="selected" disabled >Select</option>
        <option>{{details|length}}</option>
  
  
      </select>
    </div>&nbsp;(No. of records:&nbsp;<span id="num"></span>) 
  
              
              <button type="button" style="font-size: medium; border-radius: 4px; border: 2px solid #e7e7e7;background-color: white; margin-left: 2vw;" value="filter" onclick="show_filters(this.val)" ><i class="fa fa-filter" ></i>Filter</button>
  
                <i class="fa-solid fa-magnifying-glass" style="margin-left:26% ;margin-top:0.5%"></i>
                <input id="myInput" type="text" placeholder="Search Text..." style="margin-left: 70%; margin-top: -1.8em; border-radius: 5px; height: 25px;">
                <i class="fa-solid fa-print" style="margin-top:-2%; cursor: pointer; margin-left: 4vw; " onclick="window.print();" ></i>
              
        
  </div> -->
  
    <div class="container mt-5">
    <div class="row" style="background-image: radial-gradient(circle farthest-side, #fceabb, #f8b500);  color: black ;font-weight: bold;height: 40px; vertical-align: middle;">
      <div class="col-lg-6 my-1">
        <div class="row ml-1">
          Show      
          <div class="col-lg-5">
            <select name="category" class="form-control-sm" id="selectedCategory" style="width:100%;">
              <option value="" selected="selected" disabled>Select</option>
              <option>10</option>
              <option>50</option>
            </select>
          </div>
          Entries
        </div>
      </div>       
  
      <div class="col-lg-6 my-1">
        <div class="row float-right mr-2">
            <button class="btn btn-sm bg-white mr-2" style="height:30px; margin-top: 2px;" type="button" id="filterButton" value="filter" onclick="show_filters(this.val)" >
              <i class="fa fa-filter fa-sm"></i>
              Toggle Filter
            </button>
                    
            <div class="form-inline float-right">         
              <div>
                <input type="text" class="form-control form-control-sm" id="myInput" placeholder="Search Text..." >
              </div>
              <div>
                <i class="fa-solid fa-print my-2 mx-2" onclick="window.print();"></i>
              </div>          
            </div>
          </div>
        </div>
      </div> 
    </div> 
     
    <table class="table table-striped table-bordered table-sm table-data" id="tableshow" cellspacing="0" >
  
        <thead id="thead_IC" style="font-size:1.1em;background-color:  #cce3fc">
          <tr>
            <th style="border:1px solid black;" scope="col">Sr.No.</th>
            <th style="border:1px solid black;" scope="col">Train Category(Train Count)</th>
            <th style="border:1px solid black;" scope="col">Total Inspections done</th>
            <th style="border:1px solid black;" scope="col">Max Inspections(Count)</th>
            <th style="border:1px solid black;" scope="col">Min Inspections(Count)</th>
          </tr>
        </thead>
  
        <tbody id="tbody_IC">
        </tbody>
  
    </table>

  </div>

</body>

 <script>
  var x = $('#tableshow_length label').val()
  
  $(document).ready(function() {
       
    

$("#myInput").on("keyup", function(){
  var value = $(this).val().toLowerCase();
  $("#tbody_IC tr").filter(function() {
  $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)

});

});

      var currentdate=new Date();
      var startdate=moment().subtract(7, 'days')
      var enddate=moment()
      $("#dateofInsp1").val(startdate.format('DD/MM/YYYY'))
      $("#dateofInsp2").val(enddate.format('DD/MM/YYYY'))
      $( "#dateofInsp1" ).datepicker({ 
        maxDate: currentdate,
        enddate:"currentdate",
        dateFormat: "dd/mm/yy",
        changeMonth : true, 
        changeYear : true,
        todayHighlight: true,
        clearBtn:true
     
      });

      $('#dateofInsp1').change(function(){
        var dateofInsp1 = $('#dateofInsp1').val();
        console.log("hii",dateofInsp1)
        var currentdate=new Date();
        $("#dateofInsp2").val(currentdate.getDate() + "/" + parseInt(currentdate.getMonth() + 1) + "/" + currentdate.getFullYear())
        $( "#dateofInsp2" ).datepicker({ 
        maxDate: currentdate,
        minDate: dateofInsp1,
        // startDate: dateofInsp1,
        dateFormat: "dd/mm/yy",
        changeMonth : true,
        changeYear : true,
        todayHighlight: true 
      });
      })

      

      searchTrain();
   });

  //  $(document).ready(function(){
  //   $('[data-toggle="tooltip"]').tooltip();
  //  });

   $(':input[readonly]').css({'background-color':'white'});


// $(document).ready(function() {
// // $("#tableshow").empty();
// $.ajax
//    ({
//        url:'{% url "showTrain" %}',
//        dataType: 'json',
//        type: 'GET',
//        success: function(response)
//        {
           
//            // table.destroy();
           
//            // console.log(response.details)
//            for(i in response.details)
//            {
//                $('#tableshow tbody').append
//                (
//                    `<tr>
//                     <td>${i} (${response.details[i]['cnt']})</td> 
//                          <td>${response.details[i]['tot']}</td>
//                          <td>${response.details[i]['mxins']} ${response.details[i]['mx']}</td>
//                          <td>${response.details[i]['mnins']} ${response.details[i]['mn']}</td>

//                    </tr>`
//                )
//            }
//            var table=$('#tableshow').DataTable();
//        }
       
//    })
// });

function pdfShow()
  {
    var fromdate=$('#dateofInsp1').val();
    var todate=$('#dateofInsp2').val();
    var train=$('#train').val();
    submitbtn=$('#submitpdf').val();
    window.open("{% url 'trainReviewpdf' %}"+"?fromdate="+fromdate+"&todate="+todate+'&train='+train+"&submitbtn="+submitbtn,"_blank")
  }

  function excelShow()
  {
    var fromdate=$('#dateofInsp1').val();
    var todate=$('#dateofInsp2').val();
    var train=$('#train').val()
    submitbtn=$('#submitexcel').val();
    window.location.href="{% url 'trainReviewpdf' %}"+"?fromdate="+fromdate+"&todate="+todate+'&train='+train+"&submitbtn="+submitbtn;
  }

$('#btnReset').click(function(){
  $('#train').val('');
  var currentdate=new Date();
  var startdate=moment().subtract(7, 'days')
  var enddate=moment()
  $("#dateofInsp1").val(startdate.format('DD/MM/YYYY'))
  $("#dateofInsp2").val(enddate.format('DD/MM/YYYY'))
  $('#tableshow').dataTable().fnClearTable();
  $('#tableshow').dataTable().fnDestroy();
  // document.getElementById("num").innerHTML = 0;
          //  var table = $('#tableshow').DataTable({
          //   pageLength : 10,
          //   serverSide: false,
          //   retrieve: true,
          //   "lengthChange": false,
          //   searching: false, 
          //   pagingType: "simple",
          //   "language": {
          //   "info": "Page _PAGE_ of _PAGES_",
          //   }
          // }); 
  searchTrain();     

})


function searchTrain(){
   
    var fromdate=$('#dateofInsp1').val();
    var todate=$('#dateofInsp2').val();
    var train=$('#train').val()
    data={
        'fromdate':fromdate,
        'todate':todate,
        'train':train,

    }
    $("#tbody_IC").empty()

    $.ajax({
      url: '{% url "searchTrain" %}',
      dataType: 'json',
      type: 'GET',
      data: data,
      success: function(response)
      {
        $('#tableshow tbody').empty();
        
        var s=0;
        var num=0;
        // alert(response.detailsLength)
        for(i in response.details)
           {
               $('#tableshow tbody').append
               (
                   `<tr>
                    <td style="border:1px solid black;" scope="col" >${++num}</td>
                    <td style="border:1px solid black;">${i} (${response.details[i]['cnt']})</td> 
                         <td style="border:1px solid black;">${response.details[i]['tot']}</td>
                         <td style="border:1px solid black;"><a class="showtool" href="#" data-toggele="tooltip" data-placement="right" title="${response.details[i]['mxinfo']}">${response.details[i]['mxins']} ${response.details[i]['mx']}</td>
                         <td style="border:1px solid black;"><a class="showtool" href="#" data-toggele="tooltip" data-placement="right" title="${response.details[i]['mninfo']}">${response.details[i]['mnins']} ${response.details[i]['mn']}</td>

                   </tr>`             
               )
           }
           $('.showtool').tooltip();
          //  document.getElementById("num").innerHTML = num;
           var table = $('#tableshow'). DataTable({
                                            // scrollX: true,
                                            // scrollY:true,
                                            // scrollCollapse: true,
                                            // paging: true,
                                            serverSide: false,
                                            pageLength : 10,
                                            retrieve: true,
                                            "lengthChange": false,
                                            searching: false, 
                                            pagingType: "simple",
                                            "language": {
                                            "info": "Page _PAGE_ of _PAGES_",
                                            }
                                          }); 
         
            
            // const ctx = document.getElementById('myChart').getContext('2d');
            // let myChart=null;
            // ctx.destroy();
            // let inspcompleted={{inspcompleted| safe}}
            // let totalscheduled={{totalscheduled | safe}}
            // let per={{per | safe}}
            // let stncats2={{stncats2 | safe}}
//             let lable;
//             for(i in response.details)
//             {
//                 label=response.details[i]['mytrain']
//             }
//             let arr=[];
//             for(i in response.details)
//             {
//                 arr.push(response.details[i]['tot'])
//             }

//             console.log('arr',arr)
//             // ['A', 'A1','B', 'D', 'E', 'F']
//             myChart = new Chart(ctx, {
//                 type: 'pie',
//                 data: {
//                     labels:  label,
//                     datasets: [
//                         {
//                         label: '# of Votes',
//                         data: arr,
//                         backgroundColor: [
//                             'rgba(255, 99, 132, 1)',
//                             'rgba(54, 162, 235,1)',
//                             'rgba(255, 206, 86,1)',
//                             'rgba(75, 192, 192,1)',
//                             'rgba(153, 102, 255,1)',
//                             'rgba(255, 159, 64, 1)',
//                             'rgba(52, 210, 143,1)',
//                             'rgba(228, 236, 59,1)',
//                         ],
//                         borderColor: [
//                             'rgba(255, 99, 132, 1)',
//                             'rgba(54, 162, 235, 1)',
//                             'rgba(255, 206, 86, 1)',
//                             'rgba(75, 192, 192, 1)',
//                             'rgba(153, 102, 255, 1)',
//                             'rgba(255, 159, 64, 1)',
//                             'rgba(52, 210, 143,1)',
//                             'rgba(228, 236, 59,1)',
//                         ],
//                         borderWidth: 1
//                     }
                
//                 ]
//                 },
//                 options: {
//                 plugins: {
//                     datalabels: {
//                         anchor: 'center',
//                         align: 'center',
//                         formatter: Math.round,
//                         font: {
//                             weight: 'bold',
//                             size: 16
//                         }
//                     }
//                 }
//                 // ctx.destroy();
            
// }
// // ctx.destroy();

// });
// // destroyChart();

// details
      }
    //   ctx.destroy();

    })
    // destroyChart();

}

function show_filters(val){
  
  $('#filterForm').toggle();
}


</script>


   </script>

  </script>
</html>
{% endblock content %}