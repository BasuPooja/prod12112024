{% extends 'base.html' %} 
{% block content %}
{% load static %}

<!-- <head>
    <script src="{% static '/js/select2.min.js' %}"></script>
    <script src="{% static '/js/bootstrap.min.js' %}"></script>
    <script src="{% static '/js/jquery.min.js' %}"></script>
    <script src="{% static '/js/popper.min.js' %}"></script>
    <script type="text/javascript" src="{% static '/bootstrap-4.0.0/dist/js/bootstrap.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/bootstrap-4.0.0/dist/js/bootstrap.bundle.min.js'%}"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/bootstrap.min.css' %}">
    <script src="{% static '/js/jquery-3.3.1.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/DataTables/datatables.min.css' %}" />
    <link href="{% static '/css/bootstrap-toggle.min.css' %}" rel="stylesheet">
    <script src="{% static 'js/timepicker.js' %}"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="{% static '/daterangepicker-master/moment.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/daterangepicker-master/daterangepicker.js'%}"></script>
    <link rel="stylesheet" type="text/css" href="{%static '/daterangepicker-master/daterangepicker.css'%}" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" type="text" href="{% static '/bootstrap-4.0.0/dist/css/font-awesome.min.css' %}">
    <script src="{% static '/js/select2.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">  

</head> -->
<head>
  <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/forms_common.css' %}">
  <script type="text/javascript">
    $(".sidebar").addClass('close');
  </script>   
</head>
<style>
  .modal-content{
  border: solid !important;
  border-width: 1px !important;
  }
  .modal-header{
  background-color: #0066cc!important;
  color: #fff;
  border-radius: inherit;
  }
  </style>

<!-- <style>
    .datepicker-dropdown 
    {
        
        border-radius: 10px;
    }
  * {
      box-sizing: border-box;
    }
    .input,
    input[type=text]
    {
        width: 100%;
        padding: 12px 20px;
        margin: 2px 0;
        display: block;
        /* border: 1.5px solid rgb(14, 12, 12); */
        resize: vertical;
        border-radius: 4px;
        box-sizing: border-box;
    }
    input[type=submit] 
    {
        width: 40%;
        text-align: center;
        background-color: #4CAF50;
        color: rgb(15, 12, 12);
        padding: 14px 20px;
        margin: 2px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    input[type=submit]:hover 
    {
        background-color: #45a049;
        text-align: center;
    }
    input[type=button] 
    {
        width: 30%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 6px 6px;
        margin: 2px 2px 2px 2px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        }
    input[type=button]:hover 
    {
        background-color: #45a049;
        text-align: center;
    }
    .inputtag
    {
        height:20px;
    }
    .modal-dialog-full-width 
    {
        width: 80% !important;
        height: 100% !important;
        margin: 0 !important;
        padding-left: 20% !important;
        padding-top:5% !important;
        padding-bottom:5% !important;
        max-width:none !important;
        text-align: center !important;
    }
    .modal-content-full-width  
    {
        height: auto !important;
        min-height: 100% !important;
        border-radius: 0 !important; 
        text-align: center !important; 
    }
    .modal-header-full-width  
    {   border-bottom: 0px solid #9ea2a2 !important;    }
    .modal-footer-full-width  
    {   border-top: 0px solid #9ea2a2 !important;   }
    .container
    {   max-width: 1200px   }
    input[type="radio"]
    {   margin: 0 5px 0 5px;    }
    div.bold-selected 
    {   font-weight: bold;  }
</style>
<style>

    .nav-tabs .nav-link.active{
      background-color: #75ef6a;
      border-color: #343a40;
    }
      * {
      box-sizing: border-box;
    }
    body {
            font-family: 'Quicksand', sans-serif;;
            height: 100%;
            margin: 0;
            }
    
    
        
          input[type=text]
          {
                  width: 100%;
                  padding: 12px 20px;
                  margin: 8px 0;
                  display: block;
                  /* border: 1.5px solid rgb(14, 12, 12); */
                  border-radius: 4px;
                  box-sizing: border-box;
          }
        
          input[type=submit] {
                  width: 40%;
                  text-align: center;
                  background-color: #4CAF50;
                 
                  padding: 14px 20px;
                  margin: 8px 0;
                  border: none;
                  border-radius: 4px;
                  cursor: pointer;
          }
        
          input[type=submit]:hover {
                  background-color: #45a049;
                  text-align: center;
          }
        
        
          input[type=button]:hover {
                  background-color: #45a049;
                  text-align: center;
          }
          /* #viewbtn{
            margin-left:1050px;
          } */
        
          .inputtag{
            height:20px;
          }
          .button {
      padding: 15px 25px;
      font-size: 12px;
      text-align: center;
      margin-left: 2em;
      cursor: pointer;
      outline: none;
      color: #fff;
      background-color: #04AA6D;
      border: none;
      border-radius: 15px;
     
    }
    
    .button:hover {background-color: #3e8e41}
    
    .button:active {
      background-color: #77e046;
      box-shadow: 0 5px #666;
      transform: translateY(4px);
    }
    .modal-content{
    border: solid !important;
    border-width: 1px !important;
  }
  .modal-header{
    background-color: #3c84cd !important;
    color: #fff;
    border-radius: inherit;
  }
  .close span{
    color: #fff !important;
  }
  .close span:hover{
    color: #fff !important;
  }
</style>
   
   <style>
    .modal.left .modal-dialog,
    .modal.right .modal-dialog {
      position: fixed;
      margin: auto;
      width: 1200px;
      height: 100%;
      -webkit-transform: translate3d(0%, 0, 0);
      -ms-transform: translate3d(0%, 0, 0);
      -o-transform: translate3d(0%, 0, 0);
      transform: translate3d(0%, 0, 0);
    }
  
    .modal.left .modal-content,
    .modal.right .modal-content {
      height: 100%;
      overflow-y: auto;
    }
  
    .modal.left .modal-body,
    .modal.right .modal-body {
      padding: 15px 15px 80px;
    }
  
    /*Left*/
    .modal.left.fade .modal-dialog {
      left: -320px;
      -webkit-transition: opacity 0.3s linear, left 0.3s ease-out;
      -moz-transition: opacity 0.3s linear, left 0.3s ease-out;
      -o-transition: opacity 0.3s linear, left 0.3s ease-out;
      transition: opacity 0.3s linear, left 0.3s ease-out;
    }
  
    .modal.left.fade.show .modal-dialog {
      left: 0;
    }
  
    /*Right*/
    .modal.right.fade .modal-dialog {
      right: -320px;
      -webkit-transition: opacity 0.3s linear, right 0.3s ease-out;
      -moz-transition: opacity 0.3s linear, right 0.3s ease-out;
      -o-transition: opacity 0.3s linear, right 0.3s ease-out;
      transition: opacity 0.3s linear, right 0.3s ease-out;
    }
  
    .modal.right.fade.show .modal-dialog {
      right: 0;
    }
  
    /* ----- MODAL STYLE ----- */
    .modal-content {
      border-radius: 0;
      border: none;
    }
  
    .modal-header {
      border-bottom-color: #EEEEEE;
      background-color: #FAFAFA;
    }
  
    .modal-lg {
      max-width: 70% !important;
    }
  
    .modal {
      pointer-events: none;
    }
   </style> -->

<body>
    <h3 class="report_heading">MOM Received Reply</h3>
    <br>
    
    <div class="container">
        <div class="inpt-container">
            <div class="row ">
              <div class="col-3">
               <div class="form-group pl-3">
                <label class="lbl-caption" for="exampleFormControlSelect1">Date of Meeting</label>
                <input type="text" autocomplete="off" placeholder="Select Date Range.."  id ="mdate" name="mdate" class="form-control" style="margin-top:0em; height: 36px; background-color: #fff;border:1px solid rgb(138, 136, 136);box-shadow: none; max-width: 100%;" readonly required >     
               </div> 
              </div>

              <div class="col-lg-3"></div>
        
              <div class="col-6" >
                <div class="btn-toolbar float-right" role="toolbar" style="margin-top:30px;">
                  <div class="btn-group mr-2" role="group" >
                    <button type="button" class="btn btn-warning btn-sm"  id="momReceived_filter" onclick="momReceived_filter()">Continue</button>
                    <a class="btn btn-secondary btn-sm" href="/mom_received_action">Reset</a>                   
                </div>
                </div>
              </div>
        
            </div>
        </div>
        <br>
        <table id="tablereply" class="table table-striped  table-data table-bordered center" cellspacing="0">
            <thead >
                <tr style="text-align:left">
                    <th style="width:5%">S.No.</th>
                    <th style="width:8%">Meeting Date</th>
                    <th style="width:20%">MOM Note No</th>
                    <th style="width:55%">MOM Title</th>
                    <th style="width:10%">MOM Date</th>
                    <th style="width:10%">View Reply</th>
                </tr>
            </thead>
            <tbody>
                {% for i in receive_reply %}
                <tr style="text-align:left">
                    <td>{{forloop.counter}}</td>
                    <td>{{i.mom_date|date:"d/m/y"}}</td>
                    <td><a href="" data-toggle="modal" data-target="#PdfModal" onclick="show_pdf_file('{{i.insp_no}}','{{i.mom_note_no}}','{{i.mom_date|date:'d/m/y'}}');">{{i.mom_note_no}}</a></td>
                    <!-- <td>{{i.mom_note_no}}</td> -->
                    <td>{{i.mom_title}}</td>
                    <td>{{i.created_on|date:"d/m/y"}}</td>
                    <!-- <td><button type="button" class="btn btn-primary" data-toggle="modal" data-dismiss="modal" data-target="#ActionModal" id={{i.insp_no}} onclick="action(this)">Action</button></td> -->
                    {% if i.reply_status_flag == "True" %}
                    <td><a  style="color: green; " href="{% url 'receivemomreply' i.insp_no %}" target="blank">{{i.reply_status}}/{{i.total_status}}</a></td></td>
                    {% else %}
                    <td><a  style="color: red; " href="{% url 'receivemomreply' i.insp_no %}" target="blank">{{i.reply_status}}/{{i.total_status}}</a></td></td>
                    {% endif %}
                </tr>
                {% endfor %} 
            </tbody>
        </table>
    </div>

    
    <!-- Modal to view PDF -->
    <div class="modal fade right" id="PdfModal" tabindex="-1" role="dialog" aria-labelledby="PdfModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content modal-content-full-width ">
                <div class="modal-header modal-header-full-width ">
                    <h3 style="font-family: 'Lato', sans-serif;" id="PdfModalLabel">
                        <label id="pdf-heading"></label>
                    </h3>
                    <!-- <h3 class="modal-title w-100" id="PdfModalLabel"><label id="pdf-heading"></label></h3><br> -->
                    <button type="button" class="btn btn-danger" data-dismiss="modal" aria-label="Close" >Close</button>
                    <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button> -->
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col" id="preiew_report_pdf" style="max-width: 100%; max-height: 100%;">
                                <iframe id="iframepreview1"  style="width:550px; height:700px;" frameborder="0"></iframe>
                            </div>
                        </div>
                    </div>
                </div><!--  Modal Body -->
                <div class="modal-footer modal-footer-full-width">
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal" id="closePdf">Close</button>
                </div>
            </div><!-- Modal-Content-->
        </div><!-- Modal-Dialog -->
    </div>
</body>
<!-- <script type="text/javascript">
    $(function() {
    
        var start = moment().subtract(29, 'days');
        var end = moment();
    
        function cb(start, end) {
            $('#mdate span').html(start.format('DD/MM/YYYY') + ' - ' + end.format('DD/MM/YYYY'));
        }
    
        $('#mdate').daterangepicker({
            startDate: start,
            endDate: end,
            ranges: {
               'Today': [moment(), moment()],
               'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
               'Last 7 Days': [moment().subtract(6, 'days'), moment()],
               'Last 30 Days': [moment().subtract(29, 'days'), moment()],
               'This Month': [moment().startOf('month'), moment().endOf('month')],
               'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            }
        }, cb);
    
        cb(start, end);
    
    });
    </script> -->
<script>
    $(function() 
    {
        $('input[name="mdate"]').daterangepicker
        ({
            autoUpdateInput: false,
            autoApply: true,
            maxDate: new Date(),
            alwaysShowCalendars: true,
            locale: {   cancelLabel: 'Clear'    }
        });
    
        $('input[name="mdate"]').on('apply.daterangepicker', function(ev, picker) 
        {
            $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
            if(picker.startDate.format('DD/MM/YYYY') == picker.endDate.format('DD/MM/YYYY'))
            {   $(this).val(picker.startDate.format('DD/MM/YYYY'))  }
            else
            {   $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));  }
            $('.applyButtonClasses').click()
        });
    
        $('input[name="mdate"]').on('cancel.daterangepicker', function(ev, picker) 
        {   $(this).val('');    });
    });
 
 
 
 
 
 </script>
 
 
<script>
    
    $( document ).ready
    (
       function() 
       {
       
       }
    )

    var table = $('#tablereply').DataTable();
    function momReceived_filter(){

        
        // table.destroy();
        // $('#tablereply tbody').empty()
        // $('#tablereply').destroy();

        // alert('date filtering')
        
        data={
            'date':$('#mdate').val(),    
        }
        console.log(data)
        $.ajax
        ({
            url: "{% url 'filterReceivedata_ajax' %}",
            method: "GET",
            dataType: "JSON",
            data: data,

            success:function(response){
               console.log(response)
               table.destroy();
               $('#tablereply tbody').empty()
               let filterdata= response.result;
               console.log('filterdata',filterdata)
              
               
               let row="";

               
                
                              
               for( let i=0;i<filterdata.length;i++){
                 let srno=i+1
                 row += "<tr text-align:left>";
                 row += `<td width:5%>${srno}</td>
                 <td width:11%>${filterdata[i]['mom_date']}</td>
                 <td width:11%>${filterdata[i]['mom_note_no']}</td>
                 <td width:11%>${filterdata[i]['mom_title']}</td>
                 <td width:11%>${filterdata[i]['created_on']}</td>
                
                 <td><a type="button" class="btn btn-primary" style="color: #fff;" href="/receivemomreply/${filterdata[i]['insp_no']}"  style="color: #fff;">Received</a></td>`

                row += "</tr>";  
               }
             
               $('#tablereply tbody').append(row);
            //    $('#tablereply').show();
               table=$('#tablereply').DataTable();

            }
        })
    }

</script>

<script>
        function show_pdf_file(e,e1,e2)
    {
        // alert(e+e1+e2)
        // pending(e)
        document.getElementById('pdf-heading').innerHTML = 'MOM Note No: '+e1+'\n'+'Dated: '+e2;
        $('#iframepreview1').show();
        file = "/mom_ReportPdf/"+e;
        $('#iframepreview1').attr('src', file);
    }

    Filevalidation = (e) => 
    {
        file_id=e.id
        const fi = document.getElementById(file_id);
        if (fi.files.length > 0) {
            for (const i = 0; i <= fi.files.length - 1; i++) 
            {
                const fsize = fi.files.item(i).size;
                const file = Math.round((fsize / 1024));
                if (file >= 200) 
                {
                    alert("File too Big, please select a file less than 200kb");
                    document.getElementById(e.id).value=null;
                }
            }
        }
    }

</script>


{% endblock %} 

