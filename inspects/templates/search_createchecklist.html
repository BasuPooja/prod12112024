{% extends 'adminDash.html' %} 
{% block content %}

{% load static %}

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery.min.js"></script>
<!-- <link rel="stylesheet" href="jquery.dropdown.css"> -->
<script src="jquery.dropdown.js"></script>
<!-- Include the plugin's CSS and JS: -->

<script type="text/javascript" src="js/bootstrap-multiselect.js"></script>
<link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css"/>
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->

<link rel="stylesheet" type="text" href="{% static '/bootstrap-5.1.3-dist/css/font-awesome.min.css'%}">
<link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/bootstrap.min.css' %}">

<link href="{% static '/css/bootstrap-toggle.min.css' %}" rel="stylesheet">
<script src="{% static '/js/bootstrap-toggle.min.js' %}"></script>

    <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/select2.min.css' %}">
<link rel="stylesheet" href="{% static '/css/jquery-ui.css' %}">

<link rel="stylesheet" type="text/css" href="{% static '/css/quicksand.css' %} ">
     
<link rel="stylesheet" href="{% static '/css/font-awesome.min.css' %}">

<script src="{% static 'js/timepicker.js' %}"></script>
<!-- <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" /> -->

  <script src="{% static '/js/jquery.min.js' %}"></script>
   <!-- Select2 CSS --> 

<!-- jQuery --> <script src="{% static '/js/jquery.min4.js' %}"></script> 

<!-- Select2 JS --> 
<script src="{% static '/js/select2.min.js' %}"></script>
<!-- Load icon library -->
<link rel="stylesheet" href="{% static '/css/font-awesome.min.css' %}">
<!-- multiple selesct marked officer -->

<link href="css/jquery.multiselect.css" rel="stylesheet" type="text/css">
<script src="{% static '/js/jquery.dataTables.min.js' %}"></script>
  <link href="{% static '/css/jquery.dataTables.min.css' %}"  rel="stylesheet"/>
  <!-- Sheets for datepicker for target date -->
  
  <link rel="stylesheet" href="{% static '/css/jquery-ui.css' %}">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="{% static '/js/jquery-ui.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/css/lato.css' %} ">

  
  <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <link rel="stylesheet" type="text/css" href="{% static '/css/forms_common.css' %}" />  
  
  <br>

<style>
  * {
  box-sizing: border-box;
}
body {
        font-family: 'Quicksand', sans-serif;;
        height: 100%;
        margin: 0;
        }


    
      input[type=text]
      {
              width: 100%;
              padding: 12px 20px;
              margin: 8px 0;
              display: block;
              /* border: 1.5px solid rgb(14, 12, 12); */
              border-radius: 4px;
              box-sizing: border-box;
      }
    
      input[type=submit] {
              width: 40%;
              text-align: center;
              background-color: #4CAF50;
             
              padding: 14px 20px;
              margin: 8px 0;
              border: none;
              border-radius: 4px;
              cursor: pointer;
      }
    
      input[type=submit]:hover {
              background-color: #45a049;
              text-align: center;
      }
    
    
      input[type=button]:hover {
              background-color: #45a049;
              text-align: center;
      }
      /* #viewbtn{
        margin-left:1050px;
      } */
    
      .inputtag{
        height:20px;
      }
      .button {
  padding: 15px 25px;
  font-size: 12px;
  text-align: center;
  margin-left: 2em;
  cursor: pointer;
  outline: none;
  color: #fff;
  background-color: #04AA6D;
  border: none;
  border-radius: 15px;
 
}

.button:hover {background-color: #3e8e41}

.button:active {
  background-color: #3e8e41;
  box-shadow: 0 5px #666;
  transform: translateY(4px);
}
    </style>
<style>
    
        input[type=text],
        select {
                width: 100%;
                padding: 12px 20px;
                margin: 8px 0;
                display: block;
                color: rgb(38, 38, 38);
                border-radius: 4px;
                box-sizing: border-box;
        }

        input[type=submit] {
                width: 20%;
                text-align: center;
                background-color: #4CAF50;
                color: rgb(15, 12, 12);
                padding: 14px 20px;
                margin: 8px 0;
                border: none;
                border-radius: 4px;
                cursor: pointer;
        }

        input[type=submit]:hover {
                background-color: #45a049;
                text-align: center;
        }

        input[type=button] {
                width: 10%;
                text-align: center;
                background-color: #4CAF50;
                color: white;
                padding: 6px 6px;
                margin: 8px 0;
                border: none;
                border-radius: 4px;
                cursor: pointer;
        }

        input[type=button]:hover {
                background-color: #45a049;
                text-align: center;
        }
  #viewbtn {
    margin-left: 1200px;
    margin-right: 10px;
  }
  
/* Add Animation */
@-webkit-keyframes animatetop {
  from {top:-300px; opacity:0} 
  to {top:0; opacity:1}
}

@keyframes animatetop {
  from {top:-300px; opacity:0}
  to {top:0; opacity:1}
}

/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}


         
</style>

<h3 class="report_heading"> New Checklist</h3>
<button type="button" id="back" name="back" value="Back" onclick="history.back()" class="btn btn-success btn-md "
               style="float: right;margin-right: 2em;">Back</button>

<!-- </div> -->

<br><br>

<div class="container">
  <div class="inpt-container" id="container1" style="padding-bottom:10px;">
  <form action="/search_createchecklist/" method="post" >

  {% csrf_token %}
  
  
  <div class="row" id="row1" style="font-family: 'Lato', sans-serif;font-size: 1em; margin-left: 2em;">


        <div class="col" >
          <label class="lbl-caption" for="checklist_title">Checklist Title <span style="color:red;font-weight:bold">*</span></label>
          <input type="text"  id="checklist_title" name="checklist_title" 
          class="form-control" placeholder="Enter title" value="{{ inspection_Checklist.checklist_title }}" >
        </div>

          <div class='col' >
            <br>
            <br>
            <a href="#" onclick="selectTwo()" style="color:#0000FF;"   data-toggle="modal" data-target="#exampleModalCenter">
              Pick Title
            </a>
          </div>
     
            <div class="col" >
              <label class="lbl-caption" for="checklist_title">Checklist Version <span style="color:red;font-weight:bold">*</span></label>
              <input type="text"  id="checklist_version" name="checklist_version" 
              class="form-control" placeholder="Enter Version.." onblur="Version(this);" 
              value="{{ inspection_Checklist.checklist_version }}"  onkeypress="return isNumber(event);">
            
            </div>

            <div class="col">
              <label class="lbl-caption" for="dept_type" >Select Department<span style="color:red;font-weight:bold">*</span></b></label>
              <select class="form-control" id="dept_type" name="dept_type" onchange="myFunction()" required>
                <option  value="" disabled selected>select</option>
                {% for d in dept %} 
                <option  value="{{d.department_code}}">{{d.department_name}}</option>                
                {% endfor %}
              </select>
            </div>

            <div class="col">
              <label  class="lbl-caption" for="inspection_type" >Category Type<span style="color:red;font-weight:bold">*</span></b></label>

              <select class="form-control" id="inspection_type" name="inspection_type"required>
                  <option value="Select" disabled selected>Select</option>
                  <!-- {% for d in INSPECTION_TYPE %}
                  <option value="{{d.1}}" >{{d.1}}</option>
                  {% endfor %} -->

              </select>
              
            </div>


            
  </div> 
  </form>
  </div>
</div>  
  <br><br>
          <div class="container">
          <div class="col"> 
              <b style="margin-left: 4em;" >Add Activity </b><br><br>
              <table id="table1" class="table table-striped table-bordered center table-data">
              <thead >

                <tr>
                 <th >S.No.</th>
                 <th >Point To Be Checked</th>
                 
                
               </tr>
          
            </thead>
            {%if ass != ' None' %}
            <tbody  id="addworkmech">
            {% for i in ass %}
            
          <tr>
            <td aria-readonly="true" readonly style="text-align: center; width: 10px; font-family:verdana;">{{forloop.counter}}</td>
             <!-- <td ><textarea readonly aria-readonly="true" style="width:100%; height:100%; font-family:verdana; ">{{ j }}</textarea></td> -->
             <td> 
               
               <div class="autocomplete">
                
                
                 <textarea class="form-control" maxlength="250" id="activities"  name="activities_name" value="{{ i.activities }}" style="font-family:verdana;width:900px;" >{{ i.activities }}</textarea>
                 <!-- <input aria-readonly="true" readonly style="font-family:verdana;white-space:nowrap;;" type="text" id="work1{{forloop.counter}}"  name = "work1{{forloop.counter}}" class = "form-control" autocomplete = "off" style="width:900px;"  value="{{ j.activity }}" > -->
                
               </div>    
             </td>
           </tr>
          {%endfor%}
          {% endif %}
        </tbody>
            
      </table>
          </div>
          </div>
          </div>

      
         
      <div class="container">
      <a style="margin-left: 2em;color:#fff" name="addmech" id="addmech" class="btn btn-primary btn-sm">Add</a>
      <a  class="btn btn-danger btn-sm" style="color:#fff" id="deletemech" >Delete</a> 
     
      </div>

    <input type="hidden" value="{{forloop.counter}}" id="count_row" name="coun" >

   <div class="container">
    <div class="col-md-12">
    <button type="button"  class="btn btn-md " id="draft" name="draft" value="Save as draft" onclick="mydraft()" style=" margin-left:42%;background-color:#864493;color: #fff;">Save as Draft</button>
    <button type="button"   id="submit" name="submit" value="Submit" onclick="myfinalized()" class="btn btn-success btn-md " >Submit</button>
    

  
    
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" onclick="myFunction1()"> Add New Category</button>
    </div>
  </div>

    

    <br>
    <br>

 
       
<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Pick Title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>


      <div class="modal-body" id="myModal">
      
        <div  class="col-sm-6 form-group" >
            <label for="checklist_title">Checklist Title <span style="color:red;font-weight:bold">*</span></label>
              <select type="text"  id="checklist" name="checklist"class="form-control" 
                            placeholder="Enter title" style="width:400px">
              <option value="All" selected>All</option>
                {% for obj in obj %}
                <option value="{{obj.checklist_title}}"  selected="selected"
                  >{{obj.checklist_title}}</option>
                {% endfor %}

              </select>
        </div>

          

      </div>


      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id='close' data-dismiss="modal">Close</button>
        <button type="button" onclick="savecchange()"  class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel" onclick="myfunction1()">Add New Category </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <div class="row">
          
                <div class="col-md-1"></div>
                <div class="col-md" style="text-align: left;"> 
                  <label>Category Name</label><span style="color:red;font-weight:bold">*</span></div>
                  <div class="col-md">
                     <input type="text" class="form-control" id="categoryname" maxlength="50" name="categoryname" placeholder="Enter Category" required/>
              </div></div><br>
              <div class="row">
                <div class="col-md-1"></div>
              <div class="col-md" style="text-align: left;">
                <label>Department Name</label><span style="color:red;font-weight:bold">*</span></div>
                <div class="col-md">
                  <select class="form-control" style="width: 200px;" id="dept_type1" name="dept_type1"required>
                  <option  disabled selected  value="">select</option>
                  {% for d in dept %} 
                  <option  value="{{d.department_code}}">{{d.department_name}}</option>                
                  {% endfor %}
                </div>
              
              </div>
              
               <!-- <div class="col-md-5 form-group" style="text-align: left;">
                <label>Select Department<span style="color:red;font-weight:bold">*</span></label>
                <select class="form-control" id="dept_type" name="dept_type"required>
                  <div class="col-md" style="float: right;">
                    <option  value="" disabled hidden>select</option>
                    {% for d in dept %} 
                    <option  value="{{d.department_code}}">{{d.department_name}}</option>                
                    {% endfor %}
                  </div> -->
                 
                </select>
              </div>
              </div>
              </br>
          
      <div class="modal-footer ">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="btnn" onclick="savecategory()">Save</button>
      </div>
    </div>
    </div>
  </div>
</form>
<br>
<br>

<script>
    function myFunction1() {
   var x=confirm("Add new Category!");
  //  alert(x)

   if(x==false){
    return 
   }
   
  }
</script>

<script>

  function savecchange(){
    var checklist= $("#checklist").val();
    alert(checklist);
    $("#checklist_title").val(checklist);
   $('#close').click();
    //alert('hello');
    
  }
   

</script>

<script>
  $('#checklist').select2({
      dropdownParent: $('#myModal')
  });
</script>


<script>
  

  function mydraft(){
    let mydata=[]
    let count = $('#count_row').val()
    //alert(count);
    for(let x=1; x< parseInt(count)+1; x++){

      let dict = {}
      let activities = 'activities'+String(x)
      //alert(activities);
      let obdata = $('#'+activities).val()
      dict['activ'] = obdata
      mydata.push(dict)

      if(obdata =='' || obdata == null){
        alert("Please fill activities ")
        return False;
      }

    }

    if ($("#checklist_title").val()==''){  
      alert("Please fill Checklist Title ")
      return false;
    }

    if ($("#checklist_version").val()==''){  
      alert("Please fill Checklist Unique Version ")
      return false;    }
      
    
    if ($("#inspection_type").val()==''){ 
      alert("Please fill Inspection Type ")
      return false;
    }
    

    //alert('hrrrrrrrrr');
    let data1 = {
      activit1: JSON.stringify(mydata),
    
      checklist_title:$("#checklist_title").val(),
      checklist_version:$("#checklist_version").val(),
      inspection_type:$("#inspection_type").val(),
      dept_type:$("#dept_type").val(),
      btnValues:$('#draft').val(),
      csrfmiddlewaretoken: '{{ csrf_token }}'
    };


    

    $.ajax({
      url: '{% url "admin_checklist" %}',
      dataType: 'json',
      type: 'POST',
      data: data1,

            //data: {obs_data, obs_good, obs_notes, obs_award},
      success: function(res){
        alert("Record Saved as Draft.");
        window.location.reload();
     
      window.location.assign("/search_list_created_checklist/")

      }
    })
  }

  function myFunction(){
    $.ajax({
      url:"{% url 'add_category_type' %}",
          type: 'POST',
          dataType: 'json',
          
          data: {
            
            department:$('#dept_type').val(),
            csrfmiddlewaretoken: '{{ csrf_token }}',
          },
          success: function (response) {
          $('#inspection_type').empty();
          let row = '<option selected disabled hidden>--Select Division--</option>';
         
          for (let i = 0; i < response.dept.length; i++) {

            row += '<option value="' + response.dept[i].category_name + '">' + response.dept[i].category_name + ' </option>';
          }
          $('#inspection_type').append(row);
        }
    })
  }


  function myfinalized(){
    let mydata=[]
    let count = $('#count_row').val()
    //alert(count);
    for(let x=1; x< parseInt(count)+1; x++){

      let dict = {}
      let activities = 'activities'+String(x)
      //alert(activities);
      let obdata = $('#'+activities).val()
      dict['activ'] = obdata
      mydata.push(dict)

      if(obdata =='' || obdata == null){
        alert("Please fill activities ")
        return false;
      }
      
    }

    if ($("#checklist_title").val()==''){  
      alert("Please fill Checklist Title ")
      return false;
    }
    if ($("#checklist_version").val()==''){  
      alert("Please fill Checklist Unique Version ")
      return false;
    }
      
    
    if ($("#inspection_type").val()==''){ 
      alert("Please fill Inspection Type ")
      return false;
    }


    //alert('hrrrrrrrrr');
    let data1 = {
      activit1: JSON.stringify(mydata),
      dept_type:$("#dept_type").val(),
      checklist_title:$("#checklist_title").val(),
      checklist_version:$("#checklist_version").val(),
      inspection_type:$("#inspection_type").val(),
      btnValues:$('#submit').val(),
      csrfmiddlewaretoken: '{{ csrf_token }}'
    };

    var x = confirm('No editing will be permitted after submit, do you want to proceed?')

    if(x==false){
      return false
    }

    $.ajax({
      url: '{% url "admin_checklist_final" %}',
      dataType: 'json',
      type: 'POST',
      data: data1,

            //data: {obs_data, obs_good, obs_notes, obs_award},
      success: function(res){
        alert("Record saved Successfully.");
        window.location.reload();
    
      window.location.assign("/search_list_created_checklist/")

      }
    })
  }
 
  
  function Version(x){
    
    let checklist_title=$("#checklist_title").val();
    //alert('hh');
    
    let data={
         checklist_version: x.value,
         checklist_title:checklist_title,


    }

   $.ajax({
         url: '{% url "admin_checklist_version" %}',
         dataType: 'json',
         type: 'GET',
         data: data,

               //data: {obs_data, obs_good, obs_notes, obs_award},
         success: function(res){
           if(res.x==true)
           alert( res.ver2+"  "+"Allredy Exist please Choose Another One.");
     
         
         }
       })
 }
</script>
     
     
<script>
        function backredirect(){
          document.location.href ="{% url 'created_checklist' %}"
        }

        
</script> 

<script>
  $(document).ready(function(){
                   
                   $("#addmech").click(function (e) {
                    
                     var table = document.getElementById("addworkmech");
                     e.preventDefault();
                     var row = table.insertRow();
                  
                      var rowCount = $('#addworkmech tr').length;
                      j1=rowCount;
  
                    //  j1 = j1 + 1;
                     var activities = 'activities' + String(j1);
                    
                     $('#count_row').val(rowCount)
                     var cell1 = row.insertCell(0);
                     var cell2 = row.insertCell(1);
                    //  var cell3 = row.insertCell(2);
                     //var cell4 = row.insertCell(2);
  
                    cell1.innerHTML =
                    '<td style="width:5px;""><div style="text-align: center; width:5px font-family:verdana;">'+(j1)+'</div></td>';
                 
                  cell2.innerHTML =
                    '<td><div class="autocomplete1"><textarea maxlength="350" id=' + activities + ' name="activities"   autocomplete1 = "off"  class="form-control" required /></textarea></div></td>'; 
               


                    
                    $("textarea").each(function () {
                     this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                      }).on("input", function () {
                        this.style.height = "auto";
                        this.style.height = (this.scrollHeight) + "px";
                      });


                   });
   
                   
               });
  
  
               $('#deletemech').click(function (e) {
                      e.preventDefault();
                          var rowCount = $('#addworkmech tr').length;
    
                          j1=rowCount; 
                          $('#count_row').val(rowCount-1)
                      if (j1 > 0) {
   
                        document.getElementById("addworkmech").deleteRow(-1);
                        j1--;
                     
                      }
   
                }); 
  
   
</script>


<script>


</script>



<script>

  
        
  $('#btnn').click(function(){
    if($('#categoryname').val()=='' || $("#dept_type1").val() =='')
    {
        alert("Enter values");
        return false
    }
    else{
      if (confirm ("Are you sure you want to add the Category?")) {
      $.ajax({
        url:"{% url 'add_category' %}",
        type: 'POST',
        dataType: 'json',
        data: {
          
          categoryname:$('#categoryname').val(),
          department:$('#dept_type1').val(),
          
          csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
        },
        success: function(response){
          alert("Date Saved Successfully!!")
          location.reload();
        },
        error: function(response){
          alert('some error')
        }
      })
      }}
        

    
  });
       

</script>


{% comment %} <script>

  $(document).ready(function() {
    $('#inspection_type').select2();
  });
  $(document).ready(function() {
    $('#dept_type').select2();
  });


</script> {% endcomment %}

<script>
  function isNumber(e){
    e = e || window.event;
    var charCode = e.which ? e.which : e.keyCode;
    return /\d/.test(String.fromCharCode(charCode));
}
</script>

{% endblock %}