
{% extends 'base.html' %}
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>trainReport</title>
  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous"> -->
  <script src="{% static '/js/jquery-3.4.1.min.js' %}"></script>
  <script src="{% static '/js/popper.min.js' %}"></script>
  <script src="{% static '/js/Chart.min.js' %}"></script>
  <script src="{% static '/js/jquery-3.3.1.slim.min.js' %}"></script>
  <script src="{% static '/js/bootstrap.min.js' %}"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
  <script src="{% static '/js/jquery-ui.js' %}"></script>
  <script src="{% static '/js/jquery-1.12.4.js' %}"></script>
  <script src="{% static '/js/select2.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
  <script src="{% static '/js/moment.min.js' %}"></script>

  <script src="{% static '/js/jquery-3.3.1.js' %}"></script>
  <script src="{% static '/js/sweetalert.min.js' %}"></script>
  <script src="{% static '/js/jquery.min.js' %}"></script>
  <script src="{% static '/js/bootstrap.min1.js' %}"></script>
  <script src="{% static '/js/jquery.min1.js' %}"></script>
  <script src="{% static '/js/jquery-ui.min.js' %}"></script>
  <script src="{% static '/js/jspdf.min.js' %}"></script>



  <script src="{% static '/DataTables/datatables.min.js' %}"></script>
  <script src="{% static '/js/dataTables.bootstrap4.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/DataTables/datatables.min.css' %}" /> 

  <link rel="stylesheet" type="text/css" href="{% static '/css/bootstrap.min.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static '/css/jquery-ui.css' %}" />

  <script src="{% static '/js/jquery.timepicker.min.js' %}"></script>


  <!-- swasti link -->

  <script type="text/javascript" src="{% static '/daterangepicker-master/moment.min.js'%}"></script>
  <script type="text/javascript" src="{% static '/daterangepicker-master/daterangepicker.js'%}"></script>
  <link rel="stylesheet" type="  text/css" href="{%static '/daterangepicker-master/daterangepicker.css'%}" />

  
  <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
  <script rel="stylesheet" href="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

  <link rel="stylesheet" type="text/css" href="{% static '/css/forms_common.css' %}" />

  <style>

        div.dataTables_wrapper {
            /* width: 800px; */
            margin: 0 auto;
        }
    
        .inpt-container
    {
        background-image: linear-gradient(#cce3fc,#FFFFFF);
        border-bottom:2px solid #b0d8f5;
        margin-bottom:1rem;
    }
    
    h3.report_heading
        {
        position: relative;
        padding-bottom: 10px;
        font-weight: 600;
        color: #262626 !important;
        text-transform: uppercase;
        font-size: 18px;
        /* margin-left: 2rem; */
        text-align: center;
    }
    .report_heading::after {
        position: absolute;
        content: "";
        background: #C20E39;
        height: 3px;
        width: 64px;
        left: 0;
        right: 0;
        bottom: 0;
        margin: 0 auto;
    }
    
    
    </style>
  <style>
    /* th,
    td {
      white-space: nowrap;
    } */

    /* div.dataTables_wrapper {
      width: 800px;
      margin: 0 auto;
    } */
    
    #tableshow{
      table-layout: fixed;
    } 

    #thead_IC{
      word-wrap: break-word;
    } 

    /* table {
        border-collapse: collapse;
        table-layout: fixed;
        width: 350px;
       
      }

    table td {
        border: solid 1px #666;
        width: 110px;
        word-wrap: break-word;
        table-layout: fixed;
      } */

      .dataTables_wrapper .dataTables_filter{
    float: none;
    text-align: center;
    background-color: yellow;
}

.dataTables_length{
  float: none;
  background-color: yellow;
}


  </style>

</head>

<body>

  <div>
      <h3 id="h6" class="report_heading">LINEN REPORT</h3>
  </div>

  <div class="container" >

      <div class="inpt-container" id="filterForm" >  
        <div class="container " style="font-family:'Lato', sans-serif ; ">   
          <form id="form1" method="POST" style="width: 100%;"  id="filter">
          {%csrf_token%}          
            <div class="row mt-5">

              <div class="col-lg-3">
                <div class="form-group">
                  <label class="lbl-caption">From Date</label>
                  <input type="text" autocomplete="off" maxlength="10" placeholder="Select Date" class="form-control"
                    id="dateofInsp1" name="dateofInsp" readonly>
                </div>
              </div>
      
              <div class="col-lg-3">
                <div class="form-group">
                  <label class="lbl-caption">To Date</label>
                  <br>
                  <input type="text" autocomplete="off" maxlength="10" placeholder="Select Date" class="form-control"
                    id="dateofInsp2" name="dateofInsp" readonly>
                </div>
              </div>   
              
              <div class="col-lg-5 col-md-12 col-sm-12 mx-2">
                <div class="row float-right">
                <div class="form-group" >
                    <div class="row">
                      <div class="btn-toolbar mx-1" role="toolbar">
                          <div class="btn-group" role="group" >
                            <button type="button" class="btn btn-warning btn-sm" id="search_filter" style="margin-top:30px ;white-space: normal; word-wrap: break-word;" onclick="trainInspect('normal')" >Continue</button>
                            <button type="button" class="btn btn-secondary btn-sm" type="reset" id="btnReset"  style="margin-top:30px ;white-space: normal; word-wrap: break-word;" value="submit"  onclick="trainInspect('reset')">Reset</button>                          
                          </div>
                      </div>
                      
                      <div class="btn-toolbar mx-1 " role="toolbar" >
                          <div class="btn-group" role="group" >
                            <button type="button" name="submitpdf" id="submitpdf"  style="margin-top:30px ;white-space: normal; word-wrap: break-word;" class="btn btn-danger btn-sm" value="PDF"  onclick="pdfShow()" >PDF <i class="fa fa-file-pdf"></i></button> 
                            <button type="button" name="submitexcel" style="margin-top:30px ;white-space: normal; word-wrap: break-word;" id="submitexcel" class="btn btn-success btn-sm" value="excel"  onclick="excelShow()" >Excel <i class="fa fa-file-excel"></i></button> 
                          </div>
                      </div>
  
                    </div>
                    </div>
                </div>
              </div>
          
              <!-- <div class="col-lg-2">
                <div class="form-group">
                  <button type="button" class="btn btn-warning" id="search_filter"
                  style="margin-left:5em; margin-top:2em" onclick="trainInspect('normal')" >Continue</button>
                  </div>
              </div>
      
              <div class="col-lg-1">
                <div class="form-group">      
                  <button type="button" class="btn btn-secondary mb-2" type="reset" onclick="trainInspect('reset')" id="btnReset" value="submit"
                    style="margin-top: 2em;">Reset</button>
                </div>      
              </div> -->

            </div>         
          </form>
        </div> 
      </div>

      <!-- <div class="row" style="background-color:#426fcf;  color: white ;font-weight: bold; vertical-align: middle; padding-top: 5px;  padding-bottom: 5px; height: 40px; margin-left: 1.3%; margin-right: 1.2%; margin-bottom: 3px;" >
        <i class="fa-solid fa-thumbtack" style="margin-top:3px; margin-left:10px ;"></i>&nbsp;
        Show Entries &nbsp;
    
        <div class="dropdown">
          <button class="btn btn-sm bg-white dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height: 25px;">
          Select
          </button>
    
          <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
    
            <button class="dropdown-item" type="button">1</button>
          
            
          </div>
    
        </div>&nbsp;(No. of records:&nbsp;<span id="num"></span>) 
        <button type="button" style="margin-left: 2%; font-size: medium; border-radius: 4px; border: 2px solid #e7e7e7;background-color: white;" value="filter" onclick="show_filters(this.val)" ><i class="fa fa-filter" style="margin-right:3px ;"></i>Filter</button>

    
         <div class="dropdown">
          <button class="btn btn-sm bg-white dropdown-toggle" type="button" id="dropdownMenu3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="margin-left: 70%;" >
          Select Using
          </button>
    
          <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
            <button class="dropdown-item" type="button">Station Name</button>
            <button class="dropdown-item" type="button">Station Category</button>
            <button class="dropdown-item" type="button">Inspection Count</button>
          </div>
    
        </div> 
    
        <i class="fa-solid fa-magnifying-glass" style="margin-left:27% ;margin-top:0.5%"></i>
        <input id="myInput" type="text" placeholder="Search Text..." style="margin-left: 70%; margin-top: -1.8em; border-radius: 5px; height: 25px;">
        <i class="fa-solid fa-print" style="margin-top:-2%; cursor: pointer; margin-left: 2vw; " onclick="window.print();" ></i>
      </div> -->

      <div class="container mt-5">
        <div class="row" style="background-image: radial-gradient(circle farthest-side, #fceabb, #f8b500);  color: black ;font-weight: bold;height: 40px; vertical-align: middle;">
          <div class="col-lg-6 my-1">
            <div class="row ml-1">
              Show      
              <div class="col-lg-5">
                <select name="category" class="form-control-sm" id="selectedCategory" style="width:100%;">
                  <option value="" selected="selected" disabled>Select</option>
                  <option>10</option>
                  <option>50</option>
                </select>
              </div>
              Entries
            </div>
          </div>       
      
          <div class="col-lg-6 my-1">
            <div class="row float-right mr-2">
                <button class="btn btn-sm bg-white mr-2" style="height:30px; margin-top: 2px;" type="button" id="filterButton" value="filter" onclick="show_filters(this.val)" >
                  <i class="fa fa-filter fa-sm"></i>
                  Toggle Filter
                </button>
                        
                <div class="form-inline float-right">         
                  <div>
                    <input type="text" class="form-control form-control-sm" id="myInput" placeholder="Search Text..." >
                  </div>
                  <div>
                    <i class="fa-solid fa-print my-2 mx-2" onclick="window.print();"></i>
                  </div>          
                </div>
              </div>
            </div>
          </div> 
      </div>   


      <table class="table table-striped table-bordered table-sm table_icc table-data" width="100%" id="tableshow" cellspacing="0" >

        <thead id="thead_IC " style="font-size:1em; background-color:  #cce3fc">

        </thead>

        <tbody id="tbody_IC">

        </tbody>

      </table>

  
  </div>

</body>

<script>
   
   var x = $('#tableshow_length label').val()
  $(document).ready(function () {

    

$("#myInput").on("keyup", function(){
  var value = $(this).val().toLowerCase();
  $("#tbody_IC tr").filter(function() {
  $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)

});

});


    var currentdate = new Date();
    var startdate = moment().subtract(7, 'days')
    var enddate = moment()
    $("#dateofInsp1").val(startdate.format('DD-MM-YYYY'))
    $("#dateofInsp2").val(enddate.format('DD-MM-YYYY'))
    $("#dateofInsp1").datepicker({
      maxDate: currentdate,
      enddate: "currentdate",
      dateFormat: "dd-mm-yy",
      changeMonth: true,
      changeYear: true,
      todayHighlight: true,
      clearBtn: true

    });

    $('#dateofInsp1').change(function () {
      var dateofInsp1 = $('#dateofInsp1').val();
      console.log("hii", dateofInsp1)
      // var currentdate = new Date();
      // $("#dateofInsp2").val(currentdate.getDate() + "/" + parseInt(currentdate.getMonth() + 1) + "/" + currentdate.getFullYear())
      $("#dateofInsp2").val(enddate.format('DD-MM-YYYY'))
      $("#dateofInsp2").datepicker({
        maxDate: currentdate,
        minDate: dateofInsp1,
        dateFormat: "dd-mm-yy",
        changeMonth: true,
        changeYear: true,
        todayHighlight: true
      });
    })

    trainInspect('normal');
  });
  
  
  $(':input[readonly]').css({'background-color':'white'});

  function pdfShow()
  {
    var fromdate = $('#dateofInsp1').val();
    var todate = $('#dateofInsp2').val();
    submitbtn=$('#submitpdf').val();
    alert(submitbtn)
    if(fromdate!='' && todate!=''){
      window.open("{% url 'trainInspectpdf' %}"+"?fromdate="+fromdate+"&todate="+todate+'&submitbtn='+submitbtn,"_blank")
    }else{
      alert('No data available')
    }
  }

  function excelShow()
  {
    var fromdate = $('#dateofInsp1').val();
    var todate = $('#dateofInsp2').val();
    submitbtn=$('#submitexcel').val();
    alert(submitbtn)
    if(fromdate!='' && todate!=''){
      window.location.href="{% url 'trainInspectpdf' %}"+"?fromdate="+fromdate+"&todate="+todate+'&submitbtn='+submitbtn;
    }else{
      alert('No data available')
    }
  }

  function show_filters(val){
    alert('clicked on filter')
    $('#filterForm').show();
  }


function trainInspect(check) {

        

        var fromdate = $('#dateofInsp1').val();
        var todate = $('#dateofInsp2').val();
        data = {
            'fromdate': fromdate,
            'todate': todate,
            'check': check,
          }
          
        $.ajax
            ({
                url: '{% url "trainInspect" %}',
                dataType: 'json',
                type: 'GET',
                data: data,
                success: function (response) {
              
                  console.log(response.header)
                  header=response.header;

                  $('#tableshow thead').empty();
                  
                  var ro='';
                  var num=0;
                  ro += '<tr style="border:1px solid black;">'
                  ro += `<th style="border:1px solid black;" scope="col">Sr.No.</th>`
                  ro += `<th scope="col" style="border:1px solid black;">Train Number</th>`
                  ro += `<th scope="col" style="border:1px solid black;">Inspection Count</th>`
                  
                  for(let i=0;i<header.length;i++){
                    ro += `<th scope="col" style="border:1px solid black;">${header[i]['activity']}</th>`
                  }
                  ro += `<th scope="col" style="border:1px solid black;">Total Score</th>`
                  ro += `<th scope="col" style="border:1px solid black;">Avg Score</th>`
                  ro += '</tr>'

                  $('#tableshow thead').append(ro);

                  var table = $("#tableshow").DataTable()
                  table.destroy()
                  $('#tableshow tbody').empty();
                  
                    // var row1=''
                    body=response.result;
                    console.log('body',body)
                    for(let i1=0;i1<body.length;i1++)
                     
                      {
                        var row1=''
                        row1+=`<tr style="border:1px solid black;">`;
                        // console.log('dfsad',body[i1]['startstn_id__station_name'])
                        row1+=`<td style="border:1px solid black;" scope="col" >${++num}</td>`;
                        row1+=`<td scope="col" style="border:1px solid black;">${body[i1]['einspno_id__entityid']}</td>`;
                        row1+=`<td scope="col" style="border:1px solid black;">${body[i1]['count']}</td>`;
                        for(let i2=0;i2<header.length;i2++){
                            row1 += `<td scope="col" style="border:1px solid black;">${body[i1][header[i2]['activity']]}</td>`;
                        }
                        row1+=`<td scope="col"style="border:1px solid black;">${body[i1]['total']}</td>`;
                        row1+=`<td scope="col" style="border:1px solid black;">${body[i1]['average']}</td>`;
                        row1+=`</tr >`;
                    
                      $('#tableshow tbody').append(row1);
                        console.log(row1)
                      
                      }

                      // document.getElementById("num").innerHTML = num;
                  var table = $('#tableshow').DataTable({
                                            // scrollX: true,
                                            // scrollY:true,
                                            // scrollCollapse: true,
                                            // paging: true,
                                            scrollX: true,
                                            pageLength : 10,
                                            retrieve: true,
                                            "lengthChange": false,
                                            searching: false, 
                                            pagingType: "simple",
                                            "language": {
                                            "info": "Page _PAGE_ of _PAGES_",
                                            }
                                          });     
                                          if(check=='reset'){
                                            var currentdate = new Date();
                                            var startdate = moment().subtract(7, 'days')
                                            var enddate = moment()
                                            $("#dateofInsp1").val(startdate.format('DD-MM-YYYY'))
                                            $("#dateofInsp2").val(enddate.format('DD-MM-YYYY'))
                                          }                       
                }
            })
 
}
function show_filters(val){
  
  $('#filterForm').toggle();
}



</script>
</html>
{% endblock content %}